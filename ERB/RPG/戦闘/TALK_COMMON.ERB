;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:TALK_COMMON.ERB
;	Facility	:TALK時の共通処理
;
;	Licence		:ライセンスフリー。
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		2011/01/10		Ｎ鳥					新規作成
;	002		2011/01/11		Ｎ鳥					足りない→恵まれる系の記述がズレていたのを修正
;	003		2011/02/16		Ｎ鳥					悪魔ストレージ機能に対応
;	004		2011/05/07		Ｐ						会話の成否を種族単位で見るように変更
;	005		2011/05/09		Ｐ						会話に寄るダメージで回復していたのを修正
;	006		2012/02/04		ネトリス				大業物用の素質と経験の処理
;	007		2012/02/09		ネトリス				性的交渉の地の文『魅了』追加
;	008		2012/02/09		ネトリス				発情しているときも選択肢が性的なものだけになるように変更
;	009		2012/12/02		ネトリス				『PALAM:欲情』を『CFLAG:ダンジョン内発情用欲情値』に変更
;	010		2012/12/03		ネトリス				『異性を欲しがる』の条件を『CASE IS >= 3』に変更
;	011		2013/02/07		ネトリス				RelaxSprayの処理を追加
;	013		2013/03/15		ネトリス				野良悪魔素質ランダム設定の処理を追加
;	014		2013/03/12		ネトリス				命乞い処理を追加
;	015		2014/12/28		----					即落ち取得の処理順を変更
;	016		2015/07/28		ネトリス				仲魔のTALK設定（仲魔会話のお任せ）処理を追加
;	017		2017/05/16		ネトリス				インストールソフト：セカンドハローの処理を追加
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;=====================================================================
;会話の共通処理用ファイルです。
;=====================================================================

;=====================================================================
;戦闘時会話および合体時会話の口上テンプレートです。

;個別の悪魔に対応させたい場合はX1をキャラ番号に
;会話タイプ別に対応させたい場合はKX1をPUB(会話タイプの番号)に
;置き換えてください。

;例）ピクシーの口上を作りたいならX1⇒501に置き換え
;　　会話タイプ：女、淑女ならKX1⇒PUB304に置き換え

;知ってると便利そうな表記
;　%CSTR:ARG:X%　X = 11:一人称 12:二人称 20:種族
;　\@ CSTR:ARG:種族名 != "" ? %CSTR:ARG:種族名% # %STR:(ABL:ARG:種族)%
;　┗CSTRに種族名が記載されていればそれを、されていなければABLから種族名を割り出して表示する

;====================================================================
;悪魔会話
;====================================================================
@TALK_COMMON,ARG
#DIM ENEMYNUM, 1
#DIM 会話指名リスト, 7

;LOCAL 交渉目的　1仲魔　2お金　3ＭＡＧ　4アイテム　5いなくなれ
;LOCAL:1 RAND制御に。
;LOCAL:2 交渉に必要な数値
;LOCAL:3 直前に行った問答番号
;LOCAL:4 問答回数
TFLAG:交渉対象 = ARG
FLAG:交渉目的 = 0
TFLAG:TALK用ムフフ制御 = 0
TFLAG:TALK口上呼び出し用 = 0
TFLAG:捧げたキャラ = -1
ENEMYNUM = 0

;命乞い処理
;敵が命乞い
LOCAL:1 = 0
RESULT:1 = 0
IF GETBIT(FLAG:命乞いフラグ, 1)
	;命乞い発生済みのフラグを立てる
	CLEARBIT FLAG:命乞いフラグ, 1
	SETBIT FLAG:命乞いフラグ, 6
	CALL KOJO_TALK,ARG,91
	PRINTFORML %CALLNAME:ARG% begged %CALLNAME:PLAYER% for it's life
	PRINTFORML [0]Mercy　　　　　　　[1]No mercy
	CALL INPUTINT(0, 1)
	SELECTCASE RESULT
		;助ける
		CASE 0
			CALL KOJO_TALK,ARG,92
			;『@KOJO_TALK』をはさむ為、RESULT:0が上書きされてしまうのでRESULT:1を使う
			;口上内容で展開を変えられるように
			;無い場合は逃げる一択
			SELECTCASE RESULT:1
				;逃げる
				CASE 0
					GOTO ESCAPE
				;仲魔
				CASE 1
					GOTO PARTYIN
				;何かもらう
				CASE 2
					GOTO GIFT
				;奇襲
				CASE 3
					GOTO ASSAULT
			ENDSELECT
		;断る
		CASE 1
			CALL KOJO_TALK,ARG,93
			PRINTFORMW %CALLNAME:ARG% won't go out without a fight
			GOTO ANGRY
	ENDSELECT
;敵から取引を持ちかけられる
ELSEIF GETBIT(FLAG:命乞いフラグ, 2)
	;命乞い発生済みのフラグを立てる
	CLEARBIT FLAG:命乞いフラグ, 2
	SETBIT FLAG:命乞いフラグ, 6
	;取引内容は口上内で決められるようにする（RESULT:1 = 1.￥　2.魔貨　3.異性）
	;『@KOJO_TALK』をはさむ為、RESULT:0が上書きされてしまうのでRESULT:1を使う
	CALL KOJO_TALK,ARG,94
	;要求内容をLOCAL:1にしまう
	LOCAL:1 = RESULT:1
	;口上が無い場合はランダムで決める
	IF LOCAL:1 == 0
		;満たしていない条件に入った場合はここに戻る
		$ランダム取引内容_LOOP
		SELECTCASE RAND:3 + 1
			;￥
			CASE 1
				SIF !GETBIT(FLAG:命乞いフラグ, 3)
					GOTO ランダム取引内容_LOOP
				LOCAL:1 = 1
			;魔貨
			CASE 2
				SIF !GETBIT(FLAG:命乞いフラグ, 4)
					GOTO ランダム取引内容_LOOP
				LOCAL:1 = 2
			;異性
			CASE 3
				SIF !GETBIT(FLAG:命乞いフラグ, 5)
					GOTO ランダム取引内容_LOOP
				LOCAL:1 = 3
		ENDSELECT
	ENDIF
	PRINTFORM %CALLNAME:ARG% requested 
	SELECTCASE LOCAL:1
		;￥
		;要求額は所持￥の９０％、最低額は￥５００００
		CASE 1
			LOCAL = MONEY
			TIMES LOCAL , 0.90
			SIF LOCAL < 50000
				LOCAL = 50000
			PRINTFORM ￥{LOCAL}
		;魔貨
		;要求額は所持魔貨の９０％、最低額は１０００魔貨
		CASE 2
			LOCAL = MONEY:1
			TIMES LOCAL , 0.90
			SIF LOCAL < 1000
				LOCAL = 1000
			PRINTFORM {LOCAL} macca
		;異性
		CASE 3
			PRINTFORM %CALLNAME:PLAYER%'s body
	ENDSELECT
	PRINTFORML 
	;￥、魔貨を要求された場合は所持金を表示
	SIF LOCAL:1 == 1 || LOCAL:1 == 2
		PRINTFORML Held money:￥{MONEY}　　{MONEY:1}macca
	PRINTFORML [0]Give requested　　　　　　　[1]Do not
	CALL INPUTINT(0, 1)
	SELECTCASE RESULT
		;要求をのむ
		CASE 0
			SELECTCASE LOCAL:1
				;￥
				CASE 1
					CALL KOJO_TALK,ARG,95
					PRINTFORML ￥{LOCAL} was given
					MONEY -= LOCAL
				;魔貨
				CASE 2
					CALL KOJO_TALK,ARG,96
					PRINTFORML {LOCAL} macca was given
					MONEY:1 -= LOCAL
				;異性
				CASE 3
					TFLAG:捧げたキャラ = PLAYER
					CALL KOJO_TALK,ARG,97
					CALL SEXIAL_NEGOCIATE, ARG, PLAYER
			ENDSELECT
			;約束を守るかどうか口上内で決める（RESULT:1 = 1.去っていく　2.戦闘続行）
			CALL KOJO_TALK,ARG,98
			;口上が無い場合はランダムで決める
			IF RESULT:1 == 0
				SELECTCASE RAND:100
					CASE 0 TO 70
						RESULT:1 = 1
					CASEELSE
						RESULT:1 = 2
				ENDSELECT
			ENDIF
			SELECTCASE RESULT:1
				;去っていく
				CASE 1
					CALL KOJO_TALK,ARG,99
					PRINTFORMW %CALLNAME:ARG% went away
					RETURN 6
				;戦闘続行
				CASE 2
					CALL KOJO_TALK,ARG,100
					PRINTFORMW %CALLNAME:ARG% broke the promise
					GOTO ANGRY
			ENDSELECT
		;断る
		CASE 1
			CALL KOJO_TALK,ARG,101
			GOTO ANGRY
	ENDSELECT
ENDIF

;交渉対象の人数を獲得
;---- EDIT 004 ADD START -------------------------
FOR LOCAL, 7, 17
	SIF POS(LOCAL) >= 0 && NO:POS(LOCAL) == NO:ARG
		ENEMYNUM++
NEXT
;---- EDIT 004 ADD END   -------------------------

;すでに仲間にいるなら、友好的に会話終了

FOR LOCAL,0,CHARANUM
	;セカンドハローをインストールしている場合はチェックを打ち切って会話継続
	SIF SOFT_ON("セカンドハロー")
		BREAK
	IF NO:LOCAL == NO:ARG && (CFLAG:LOCAL:PTフラグ == 2 || (CFLAG:LOCAL:PTフラグ == 1 && CFLAG:LOCAL:所属ＣＯＭＰ != -1))
		CFLAG:ARG:友好度 += 30
		CALL INCREASE_LC,2
		LOCAL = 2
		GOTO SUCCESS_NEGOTIATE
	ENDIF
NEXT
RESULT = 0
;Ladyｰkiller
SIF !(CFLAG:(FINDCHARA(NO,NO:ARG)):PTフラグ > 0) && (TALENT:ARG:オトコ == 0 || TALENT:ARG:男の娘)
	CALL LADY_KILLERS,ARG
;GreenGrass
SIF !(CFLAG:(FINDCHARA(NO,NO:ARG)):PTフラグ > 0) && (TALENT:ARG:オトコ && TALENT:ARG:男の娘 == 0)
	CALL GREEN_GRASS,ARG
IF RESULT == 1
	FLAG:交渉目的 = 99
	CALL KOJO_TALK,ARG,1
	;GOTO PARTYIN
	GOTO NEGOTIATE_START
ENDIF

;話しかける側が女で魅了状態の場合、犯して欲しいに移動
IF (CFLAG:PLAYER:ステート == GET_STATE_NUM("CHARM")) && TALENT:PLAYER:オトコ == 0 && FLAG:ムフフ展開
	CALL KOJO_TALK,ARG,9
	GOTO OKASHITE
ENDIF

;会話担当があなたではなく、オプション設定『仲魔のTALK設定』が『仲魔に任せる』の時は専用処理へ飛ぶ
IF FLAG:仲魔会話のお任せ設定 == 1
	IF PLAYER != MASTER
		$お任せ会話_指名
		CALL 仲魔会話_お任せ, ARG
		;仲魔
		SIF RESULT == 1
			GOTO PARTYIN
		;何かもらう
		SIF RESULT == 2
			GOTO GIFT
		;奇襲
		SIF RESULT == 3
			GOTO ASSAULT
		;激怒
		SIF RESULT == 4
			GOTO ANGRY
		;逃げる
		SIF RESULT == 5
			GOTO ESCAPE
		;犯してもらう
		SIF RESULT == 6
			GOTO OKASHITE

	;５％の確率で相手の方から会話相手を指名してくる
	ELSEIF RAND:100 < 5
		LOCAL:1 = 0
		FOR LOCAL, 1, 7
			
			;あなたは飛ばす
			SIF POS(LOCAL) == MASTER
				CONTINUE
			
			;居ない場合は飛ばす
			SIF POS(LOCAL) == -1
				CONTINUE
			
			;会話が可能な状態でなければ飛ばす
			CALL INPUTABLE_CHARA,POS(LOCAL)
			SIF RESULT == 0
				CONTINUE
			
			会話指名リスト:(LOCAL:1) = POS(LOCAL)
			LOCAL:1++
			
		NEXT
		
		;指名できるキャラが居ない場合は終了
		SIF LOCAL:1 == 0
			GOTO 指名なし
		
		;会話指名リストに入っている番号の中からランダムで選ぶ
		PLAYER = 会話指名リスト:(RAND:(LOCAL:1))
		
		PRINTFORMW %CALLNAME:ARG% wanted to talk to %CALLNAME:PLAYER% alone
		PRINTFORML 
		PRINTFORML [0] %CALLNAME:PLAYER% go for this
		PRINTFORML [1] Decline
		
		CALL INPUTINT(0, 1)
		SELECTCASE RESULT
			;任せる
			CASE 0
				PRINTFORMW Negotiations with %CALLNAME:ARG% were left to %CALLNAME:PLAYER%
				GOTO お任せ会話_指名
			
			;断る
			CASE 1
				TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度 + 20*誘惑(MASTER,ARG)
				
				;奇襲される
				IF TFLAG:TALK用成功判定値 < 30
					;口上呼び出し
					CALL KOJO_TALK,ARG,37
					GOTO ASSAULT
				ELSEIF TFLAG:TALK用成功判定値 < 60
				;気分を害される
					;口上呼び出し
					CALL KOJO_TALK,ARG,38
					GOTO ANGRY
				;あなたとの交渉に移る
				ELSE
					PRINTFORMW %CALLNAME:ARG% does not seem particularly offended
				ENDIF
				
		
		ENDSELECT
		
		
	ENDIF
ENDIF
$指名なし


LOCAL:3 = -1

;最初は挨拶
TRYCCALLFORM GREET_K{NO:ARG},ARG
CATCH
	TRYCCALLFORM GREET_PUB{ABL:ARG:会話タイプ},ARG
	CATCH
		GOTO NEGOTIATE_START
	ENDCATCH
ENDCATCH
PRINTFORML
;仲魔
SIF RESULT == 1
	GOTO PARTYIN
;何かもらう
SIF RESULT == 2
	GOTO GIFT
SIF RESULT == 3
	GOTO ASSAULT
SIF RESULT == 4
	GOTO ANGRY
SIF RESULT == 5
	GOTO ESCAPE
;雰囲気が悪い
SIF RESULT == 6
	GOTO CHECK_TALKBREAK
;交渉へ
SIF RESULT == 7
	GOTO NEGOTIATE_START
;仲魔になった
SIF RESULT == 9
	RETURN 1
;ムフフ展開で搾りとられた
SIF RESULT == 10
	GOTO LOSTMAG
;ムフフ展開で満足させた
SIF RESULT == 11
	GOTO PARTYIN

$RETURNPOINT
;問答を成功すると交渉へ
	TRYCCALLFORM QUESTION_K{NO:ARG},ARG,LOCAL:3
	CATCH
		TRYCALLFORM QUESTION_PUB{ABL:ARG:会話タイプ},ARG,LOCAL:3
	ENDCATCH
	LOCAL:3 = RESULT:1
	PRINTFORML
	SIF RESULT == 1
		GOTO PARTYIN
	SIF RESULT == 2
		GOTO GIFT
	SIF RESULT == 3
		GOTO ASSAULT
	SIF RESULT == 4
		GOTO ANGRY
	SIF RESULT == 5
		GOTO ESCAPE
	SIF RESULT == 6
		GOTO CHECK_TALKBREAK
;仲魔になった
SIF RESULT == 9
	RETURN 1
;ムフフ展開で搾りとられた
SIF RESULT == 10
	GOTO LOSTMAG
;ムフフ展開で満足させた
SIF RESULT == 11
	GOTO PARTYIN


IF FLAG:交渉目的 > 0
	;おねだりの前の会話
	CALL KOJO_TALK,ARG,2
	GOTO ONEDARI
ENDIF

;交渉

$NEGOTIATE_START
	CALL KOJO_TALK,ARG,3

PRINTFORML
IF FLAG:ムフフ展開 == 0
	CALL INPUT_SELECT,1,"Join me",2,"Give me an item",3,"Leave me"
ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 > 5000 || 危険日(PLAYER) == 2
	CALL INPUT_SELECT, 4 , "I want to fuck you" ,5, "I want to be fucked"
ELSE
	CALL INPUT_SELECT,1,"Join me",2,"Give me an item",3,"Leave me",4,"I want to fuck you",5,"I want to be fucked"
ENDIF
FLAG:交渉目的 = RESULT
SELECTCASE RESULT
	CASE 1
		IF FLAG:交渉目的 == 99
			FLAG:交渉目的 = 1
			LOCAL = 1
			GOTO SUCCESS_NEGOTIATE
		ELSE
			FLAG:交渉目的 = 1
			LOCAL = 1
			GOTO ONEDARI
		ENDIF
	CASE 2
		SIF RAND:100 + RAND:(30)*誘惑(PLAYER,ARG) < 30 && CFLAG:ARG:緊張度 > RAND:10
			GOTO GET_DAMAGE
		IF FLAG:交渉目的 == 99
			FLAG:交渉目的 = 2
			LOCAL = 2
			CFLAG:ARG:友好度 += RAND:15
			GOTO SUCCESS_NEGOTIATE
		ELSE
			FLAG:交渉目的 = 2
			LOCAL = 2
			CFLAG:ARG:友好度 += RAND:15
			GOTO ONEDARI
		ENDIF
	CASE 3
		IF FLAG:交渉目的 == 99
			FLAG:交渉目的 = 3
			LOCAL = 3
			CFLAG:ARG:友好度 += RAND:60
			GOTO SUCCESS_NEGOTIATE
		ELSE
			FLAG:交渉目的 = 3
			LOCAL = 3
			CFLAG:ARG:友好度 += RAND:60
			GOTO ONEDARI
		ENDIF
	CASE 4
		IF EQUIP:MASTER:SexItem == 0 && EQUIP:MASTER:SexFriend == 1 && NUM_SUMMONER()
			LOCAL = 1
		ELSEIF EQUIP:MASTER:SexFriend == 0 && EQUIP:MASTER:SexItem == 1 && NUM_SUMMONER()
			LOCAL = 2
		ELSE
			LOCAL = 1 + RAND:2
		ENDIF
		IF 仮_やらせてくれるか？(ARG,PLAYER) == 0
			FLAG:交渉目的 = 4
			CALL KOJO_TALK,ARG,4
			;取り付く島もなし
			GOTO ANGRY
		ELSEIF 仮_やらせてくれるか？(ARG,PLAYER) == 1
			CALL KOJO_TALK,ARG,5
			;交渉次第
			IF FLAG:交渉目的 == 99
				FLAG:交渉目的 = 4
				GOTO YARANAIKA
			ELSE
				FLAG:交渉目的 = 4
				GOTO ONEDARI
			ENDIF
		ELSE
			FLAG:交渉目的 = 4
			CALL KOJO_TALK,ARG,6
			;一発おｋ
			GOTO YARANAIKA
		ENDIF
	CASE 5
		IF EQUIP:MASTER:SexItem == 0 && EQUIP:MASTER:SexFriend == 1 && NUM_SUMMONER()
			LOCAL = 1
		ELSEIF EQUIP:MASTER:SexFriend == 0 && EQUIP:MASTER:SexItem == 1 && NUM_SUMMONER()
			LOCAL = 2
		ELSE
			LOCAL = 1 + RAND:2
		ENDIF
		IF 仮_犯してくれるか？(ARG,PLAYER) == 0
			CALL KOJO_TALK,ARG,7
			;取り付く島もなし
			GOTO ANGRY
		ELSEIF 仮_犯してくれるか？(ARG,PLAYER) == 1
			;交渉次第
			CALL KOJO_TALK,ARG,8
			IF FLAG:交渉目的 == 99
				FLAG:交渉目的 = 5
				GOTO OKASHITE
			ELSE
				FLAG:交渉目的 = 5
				GOTO ONEDARI
			ENDIF
		ELSE
			;一発おｋ
			FLAG:交渉目的 = 5
			CALL KOJO_TALK,ARG,9
			GOTO OKASHITE
		ENDIF
ENDSELECT


$ONEDARI
		CALL KOJO_TALK,ARG,84
PRINTFORMW
SELECTCASE RAND:(3+仮_異性を要求するか？(ARG)*(1+(FLAG:月齢 == 8)))
	CASE 0
		;お金を要求
		TFLAG:TALK用要求値 = CSVBASE(NO:ARG,GETNUM(BASE,"LV"),0) * (300 + RAND:1000)/100
		CALL KOJO_TALK,ARG,10
		CALL INPUT_YN,"Yes","No"
		IF RESULT == 0 && MONEY < TFLAG:TALK用要求値
			;払おうとして、所持金が足りない場合
			CFLAG:ARG:友好度 -= RAND:5 +1
			TFLAG:TALK用成功判定値 = RAND:100 + RAND:(MAXBASE:PLAYER:知恵+MAXBASE:PLAYER:運/2) + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)

			
			;IF TFLAG:TALK用成功判定値 > 90
			;	;お金を恵まれる
			;	CALL KOJO_TALK,ARG,85
			;	PRINTFORMW ￥{TFLAG:TALK用要求値}恵まれた
			;	MONEY += TFLAG:TALK用要求値
			;	GOTO ONEDARI
			IF TFLAG:TALK用成功判定値 > 50
				;代わりのものを要求する
				CALL KOJO_TALK,ARG,11
				GOTO ONEDARI
			ELSEIF TFLAG:TALK用成功判定値 > 15
				;交渉失敗。逃げる
				CALL KOJO_TALK,ARG,12
				RESULT = 5
				CFLAG:ARG:緊張度 += 20
				GOTO GOODBYE
			ELSE
				;交渉失敗。敵対する
				CALL KOJO_TALK,ARG,13
				GOTO ANGRY
			ENDIF
			
			
		ELSEIF RESULT == 0
		;払った場合
			MONEY -= TFLAG:TALK用要求値
			CFLAG:ARG:友好度 += RAND:5 + 2
			TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			
			IF TFLAG:TALK用成功判定値 < 50
			;払ったのに逃げられる
				CALL KOJO_TALK,ARG,14
				GOTO ESCAPE
			ELSEIF TFLAG:TALK用成功判定値 < 80
			;さらに要求される
				CALL KOJO_TALK,ARG,15
				GOTO ONEDARI
			ELSE
			;交渉成功
				CALL KOJO_TALK,ARG,16
				GOTO SUCCESS_NEGOTIATE
			ENDIF
		ELSEIF RESULT == 1
		;断った場合
			CFLAG:ARG:友好度 -= RAND:5 + 2
			TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			IF TFLAG:TALK用成功判定値 < 30
			;交渉失敗。奇襲する
				CALL KOJO_TALK,ARG,17
				GOTO ASSAULT
			ELSEIF TFLAG:TALK用成功判定値 < 60
			;交渉失敗。敵対する
				CALL KOJO_TALK,ARG,18
				GOTO ANGRY
			ELSE
			;他のものを要求する
				CALL KOJO_TALK,ARG,19
				GOTO ONEDARI
			ENDIF
		ENDIF
	CASE 1
	;ＭＡＧを要求
		TFLAG:TALK用要求値 = CSVBASE(NO:ARG,GETNUM(BASE,"LV"),0) * (300 + RAND:1000)/100
		IF EQUIP:MASTER:DoubleValue == 1 && NUM_SUMMONER()
			TFLAG:TALK用要求値 = TFLAG:TALK用要求値 / 2
		ENDIF
		CALL KOJO_TALK,ARG,20
		CALL INPUT_YN,"Yes","No"
		IF RESULT == 0 && BASE:PLAYER:ＭＡＧ < TFLAG:TALK用要求値
		;払おうとするが、ＭＡＧが足りない場合
			CFLAG:ARG:友好度 -= RAND:5 +1
			TFLAG:TALK用成功判定値 = RAND:100 + RAND:(MAXBASE:PLAYER:知恵+MAXBASE:PLAYER:運/2) + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			
			
			IF TFLAG:TALK用成功判定値 > 90
				;MAGを恵まれる
				CALL KOJO_TALK,ARG,86
				PRINTFORMW {TFLAG:TALK用要求値} MAG was given
				CALL CONTROL_MAG,MASTER,TFLAG:TALK用要求値
				GOTO ONEDARI
			ELSEIF TFLAG:TALK用成功判定値 > 50
			;別のものを要求する
				CALL KOJO_TALK,ARG,21
				GOTO ONEDARI
			ELSEIF TFLAG:TALK用成功判定値 > 15
			;交渉失敗。立ち去る
				CALL KOJO_TALK,ARG,22
				RESULT = 5
				CFLAG:ARG:緊張度 += 20
				GOTO GOODBYE
			ELSE
			;交渉失敗。敵対する
				CALL KOJO_TALK,ARG,23
				GOTO ANGRY
			ENDIF
			
			
		ELSEIF RESULT == 0
		;払った場合
			CALL CONTROL_MAG,PLAYER,-TFLAG:TALK用要求値
			CFLAG:ARG:友好度 += RAND:5 + 2
			TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			
			IF TFLAG:TALK用成功判定値 < 50
			;払ったのに逃げられる
				;口上呼び出し
				CALL KOJO_TALK,ARG,24
				GOTO ESCAPE
			ELSEIF TFLAG:TALK用成功判定値 < 80
			;さらに要求する
				CALL KOJO_TALK,ARG,25
				GOTO ONEDARI
			ELSE
			;交渉成功
				CALL KOJO_TALK,ARG,26
				GOTO SUCCESS_NEGOTIATE
			ENDIF
		ELSEIF RESULT == 1
		;断った場合
			CFLAG:ARG:友好度 -= RAND:5 + 2
			TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			
			IF TFLAG:TALK用成功判定値 < 30
			;交渉失敗。奇襲する
				;口上呼び出し
				CALL KOJO_TALK,ARG,27
				GOTO ASSAULT
			ELSEIF TFLAG:TALK用成功判定値 < 60
			;交渉失敗。敵対する
				;口上呼び出し
				CALL KOJO_TALK,ARG,28
				GOTO ANGRY
			ELSE
			;他のものを要求する
				;口上呼び出し
				CALL KOJO_TALK,ARG,29
				GOTO ONEDARI
			ENDIF
		ENDIF
	CASE 2
		;口上呼び出し
		CALL KOJO_TALK,ARG,30
		CALL INPUT_YN,"Yes","No"
		IF RESULT == 0 && ITEM:"Life stone" < 1
			;渡そうとするが、持ってない場合
			CFLAG:ARG:友好度 -= RAND:5 +1
			TFLAG:TALK用成功判定値 = RAND:100 + RAND:(MAXBASE:PLAYER:知恵+MAXBASE:PLAYER:運/2) + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			
			
			IF TFLAG:TALK用成功判定値 > 90
				;MAGを恵まれる
				CALL KOJO_TALK,ARG,87
				PRINTFORMW Life stone was given
				CALL GET_ITEMS("Life stone",1)
				GOTO ONEDARI
			ELSEIF TFLAG:TALK用成功判定値 > 50
			;別のものを要求する
				;口上呼び出し
				CALL KOJO_TALK,ARG,31
				GOTO ONEDARI
			ELSEIF TFLAG:TALK用成功判定値 > 15
			;交渉失敗。立ち去る
				;口上呼び出し
				CALL KOJO_TALK,ARG,32
				RESULT = 5
				CFLAG:ARG:緊張度 += 20
				GOTO GOODBYE
			ELSE
			;交渉失敗。敵対する。
				;口上呼び出し
				CALL KOJO_TALK,ARG,33
				GOTO ANGRY
			ENDIF
			
			
		ELSEIF RESULT == 0
			;渡す
			ITEM:"Life stone" -= 1
			CFLAG:ARG:友好度 += RAND:5 + 2
			TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			
			
			IF TFLAG:TALK用成功判定値 < 50
			;払ったのに逃げられる
				;口上呼び出し
				CALL KOJO_TALK,ARG,34
				GOTO ESCAPE
			ELSEIF TFLAG:TALK用成功判定値 < 80
			;交渉失敗。逃げる
				;口上呼び出し
				CALL KOJO_TALK,ARG,35
				GOTO ONEDARI
			ELSE
			;交渉失敗。敵対する。
				;口上呼び出し
				CALL KOJO_TALK,ARG,36
				GOTO SUCCESS_NEGOTIATE
			ENDIF
		ELSEIF RESULT == 1
			;渡さない
			CFLAG:ARG:友好度 -= RAND:5 + 2
			TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)
			
			IF TFLAG:TALK用成功判定値 < 30
				;口上呼び出し
				CALL KOJO_TALK,ARG,37
				GOTO ASSAULT
			ELSEIF TFLAG:TALK用成功判定値 < 60
			;気分を害される
				;口上呼び出し
				CALL KOJO_TALK,ARG,38
				GOTO ANGRY
			ELSE
				;口上呼び出し
				CALL KOJO_TALK,ARG,39
				GOTO ONEDARI
			ENDIF
		ENDIF
	CASE IS >= 3
		;異性を欲しがる

		;口上呼び出し
		CALL KOJO_TALK,ARG,40

		$SEXIAL_REQ_LOOP
		PRINTFORML
		CALL INPUT_YN,"Yes","No"
		IF RESULT == 0
			;キャラ選択
			DRAWLINE
			PRINTL Who will be sent？
			CALL SHOW_NOW_FORMATION_P,0,2
			PRINTC [1000] - None
			$INPUT_LOOP_SEXIAL_REQ_CHOICE
			INPUT
			IF RESULT == 1000
				GOTO NO_SEXIAL_REQ
			ELSEIF	RESULT <= 0 || RESULT > 6 || POS(RESULT) == -1 || SEX_TALKABLE(ARG,POS(RESULT)) == 0
				GOTO INPUT_LOOP_SEXIAL_REQ_CHOICE
			ELSE
				RESULT:2 = RESULT
				;行動入力可能なキャラのみおｋ
				CALL INPUTABLE_CHARA,POS(RESULT:2)
				SIF RESULT == 0
					GOTO INPUT_LOOP_SEXIAL_REQ_CHOICE
			ENDIF
			TFLAG:捧げたキャラ = POS(RESULT:2)
			
			;異性をあてがった反応の口上呼び出し
			CALL KOJO_TALK,ARG,41

			;ここまで来たなら性的要求に応えられる
			CALL SEXIAL_NEGOCIATE,ARG,POS(RESULT:2)
			CFLAG:ARG:友好度 += RESULT
			PRINTW
			
			TFLAG:TALK用成功判定値 = FLAG:悪魔満足度 + CFLAG:ARG:友好度
			CFLAG:ARG:友好度 += FLAG:悪魔満足度
			
			
			;敗北してる場合ここでゲームオーバー
			IF FLAG:敗北フラグ
				;口上呼び出し
				CALL KOJO_TALK,ARG,42
				CALL SEXTALK_LOSE,ARG
			ENDIF
			
			;話しかけたキャラが倒れてたら会話終わり
			CALL INPUTABLE_CHARA,PLAYER
			IF RESULT == 0
				;口上呼び出し
				CALL KOJO_TALK,ARG,43
				RETURN 5
			ENDIF
			
			IF TFLAG:TALK用成功判定値 < 30
			;払ったのに逃げられる
				;口上呼び出し
				CALL KOJO_TALK,ARG,44
				GOTO ESCAPE
			ELSEIF TFLAG:TALK用成功判定値 < 80
			;満足してない
				;口上呼び出し
				CALL KOJO_TALK,ARG,45
				GOTO SEXIAL_REQ_LOOP
			ELSE
			;満足
				;口上呼び出し
				CALL KOJO_TALK,ARG,46
				GOTO SUCCESS_NEGOTIATE
			ENDIF
		ELSE
			$NO_SEXIAL_REQ
			CFLAG:ARG:友好度 -= RAND:5 + 2
			TFLAG:TALK用成功判定値 = RAND:100 + CFLAG:ARG:友好度
			
			

			
			IF TFLAG:TALK用成功判定値 < 30
			;交渉失敗。奇襲する
				;口上呼び出し
				CALL KOJO_TALK,ARG,47
				GOTO ASSAULT
			ELSEIF TFLAG:TALK用成功判定値 < 60
			;交渉失敗。敵対する
				;口上呼び出し
				CALL KOJO_TALK,ARG,48
				GOTO ANGRY
			ELSE
			;他のものを要求する
				;口上呼び出し
				CALL KOJO_TALK,ARG,49
				GOTO ONEDARI
			ENDIF
		ENDIF
	CASEELSE
ENDSELECT


$YARANAIKA
	CALL SEXIAL_ヤらせてもらう,ARG,PLAYER
	CFLAG:ARG:友好度 += RESULT
	
	TFLAG:TALK用成功判定値 = FLAG:悪魔満足度 + CFLAG:ARG:友好度
	CFLAG:ARG:友好度 += FLAG:悪魔満足度
	
	;敗北してる場合ここでゲームオーバー
	IF FLAG:敗北フラグ
		;口上呼び出し
		CALL KOJO_TALK,ARG,50
		CALL SEXTALK_LOSE,ARG
	ENDIF
	;主人が倒れてたら会話終わり
	CALL INPUTABLE_CHARA,PLAYER
	IF RESULT == 0
		;口上呼び出し
		CALL KOJO_TALK,ARG,51
		RETURN 5
	ENDIF
	IF TFLAG:TALK用成功判定値 < 80
	;満足して去っていく
		;口上呼び出し
		CALL KOJO_TALK,ARG,52
		RESULT = 2
		GOTO GOODBYE
	ELSE
		IF LOCAL == 1
			;口上呼び出し
			CALL KOJO_TALK,ARG,53
			GOTO PARTYIN
		ELSEIF LOCAL == 2
			;口上呼び出し
			CALL KOJO_TALK,ARG,54
			GOTO GIFT
		ELSEIF LOCAL == 3
			;口上呼び出し
			CALL KOJO_TALK,ARG,55
			RESULT = 6
			GOTO GOODBYE
		ENDIF
	ENDIF
$OKASHITE
	CALL SEXIAL_犯してもらう,ARG,PLAYER
	CFLAG:ARG:友好度 += RESULT
	
	TFLAG:TALK用成功判定値 = FLAG:悪魔満足度 + CFLAG:ARG:友好度
	CFLAG:ARG:友好度 += FLAG:悪魔満足度
	
	PRINTW
	
	;敗北してる場合ここでゲームオーバー
	IF FLAG:敗北フラグ
		;口上呼び出し
		CALL KOJO_TALK,ARG,56
		CALL SEXTALK_LOSE,ARG
	ENDIF
	;主人が倒れてたら会話終わり
	CALL INPUTABLE_CHARA,PLAYER
	;悪魔満足度が0でも会話終わり
	;魅了・睡眠でもINPUTABLE_CHARAは0を返してくるのでこの処理は不要
	;SIF FLAG:悪魔満足度 == 0
	;	RESULT = 0
	IF RESULT == 0 || MAXBASE:PLAYER:体力 == 0
		;口上呼び出し
		CALL KOJO_TALK,ARG,57
		RETURN 5
	ENDIF
	IF TFLAG:TALK用成功判定値 < 80
	;満足して去っていく
		;口上呼び出し
		CALL KOJO_TALK,ARG,58
		RESULT = 2
		GOTO GOODBYE
	ELSE
		IF LOCAL == 1
			;口上呼び出し
			CALL KOJO_TALK,ARG,59
			GOTO PARTYIN
		ELSEIF LOCAL == 2
			;口上呼び出し
			CALL KOJO_TALK,ARG,60
			GOTO GIFT
		ELSEIF LOCAL == 3
			;口上呼び出し
			CALL KOJO_TALK,ARG,61
			RESULT = 6
			GOTO GOODBYE
		ENDIF
	ENDIF


$SUCCESS_NEGOTIATE
IF FLAG:交渉目的 == 4
	;口上呼び出し
	CALL KOJO_TALK,ARG,88
	GOTO YARANAIKA
ENDIF
IF FLAG:交渉目的 == 5
	;口上呼び出し
	CALL KOJO_TALK,ARG,89
	GOTO OKASHITE
ENDIF
IF LOCAL == 1
	GOTO PARTYIN
ELSEIF LOCAL == 2
	GOTO GIFT
ELSEIF LOCAL == 3
	RESULT = 6
	GOTO GOODBYE
ENDIF

$ESCAPE
PRINTFORMW %CALLNAME:ARG% ran away

;---- EDIT 004 ADD START -------------------------
FOR LOCAL, 7 ,17
	SIF POS(LOCAL) >= 0 && NO:POS(LOCAL) == NO:ARG
		CALL REMOVE_POSITION, LOCAL
NEXT
;---- EDIT 004 ADD END   -------------------------
;CALL REMOVE_POSITION,CFLAG:ARG:ポジション
RETURN 5


$PARTYIN
IF FLAG:ＣＯＭＰ容量 > NUM_NAKAMA() + ソフト容量() && BASE:MASTER:LV >= CSVBASE(NO:ARG,GETNUM(BASE,"LV"),0)
	;口上呼び出し
	CALL KOJO_TALK,ARG,62
	;仲間になる
	PRINTFORMW %STR:(ABL:ARG:種族)% %CALLNAME:ARG% joined
	CALL ADD_NEW_COMPANION,NO:ARG,200
	
	;性的交渉などで経験等に変化がある場合のために会話相手と同期化
	FOR COUNT:1,0,65
		EXP:(CHARANUM-1):(COUNT:1) = EXP:(ARG):(COUNT:1)
	NEXT
	SIF EXP:(CHARANUM-1):Ｖ経験 > 0 && CSVTALENT(NO:ARG,GETNUM(TALENT,"処女"),0) > 0
		TALENT:(CHARANUM-1):処女 = 0
	;悪魔解析度が100未満なら100に。
	SIF FLAG:(20000+NO:ARG) < 100
		FLAG:(20000+NO:ARG) = 100
	;一応CFLAG:RelaxSprayをリセット
	CFLAG:ARG:RelaxSpray = 0
	;配偶者ランダム付与
	;配偶者がランダム付与されていた場合は、ここで設定しなおす
	SIF CSVCSTR(NO:(CHARANUM-1) , GETNUM(CSTR , "配偶者") , 0) == "" && CSTR:ARG:配偶者 != ""
		CSTR:(CHARANUM-1):配偶者 = %CSTR:ARG:配偶者%
	;野良悪魔素質ランダム設定
	;素質がランダム設定されていた場合は、ここで設定しなおす
	;こんなに必要ないけど一応
	FOR COUNT:1,10,160
		TALENT:(CHARANUM-1):(COUNT:1) = TALENT:(ARG):(COUNT:1)
	NEXT
	;会話相手が女で、会話キャラが大業物持ちでFLAG:悪魔満足度が200の場合、即落ち取得
	IF TALENT:(CHARANUM-1):オトコ == 0 && TALENT:PLAYER:大業物 && FLAG:悪魔満足度 == 200
		TALENT:(CHARANUM-1):即落ち = 1
		EXP:(CHARANUM-1):異常経験 += 2
	ENDIF
	RETURN 1
ELSEIF BASE:MASTER:LV < CSVBASE(NO:ARG,GETNUM(BASE,"LV"),0)
;マスターのレベルより高い場合
	;口上呼び出し
	CALL KOJO_TALK,ARG,63
	PRINTFORMW %CALLNAME:ARG% went away
	RETURN 6
ELSE
;ＣＯＭＰの空きが無い場合
	;口上呼び出し
	CALL KOJO_TALK,ARG,64
	PRINTFORMW %CALLNAME:ARG% went away
	RETURN 6
ENDIF

;女悪魔とのムフフ展開用にを追加
$LOSTMAG
;口上呼び出し
CALL KOJO_TALK,ARG,65
LOCAL:2 = CSVBASE(NO:ARG,GETNUM(BASE,"LV"),0) * (600 + RAND:1500) * -5 /10
CALL VAR_HP,PLAYER,-MAXBASE:PLAYER:ＨＰ/5,0
PRINTFORMW %CALLNAME:PLAYER% lost {LOCAL:2} MAG and strength

CALL CONTROL_MAG,PLAYER,LOCAL:2
RESULT = 2

;搾り取られたので主人の経験値を追加する
IF TALENT:PLAYER:オトコ || TALENT:PLAYER:男の娘
	EXP:PLAYER:射精経験      += 10
	EXP:PLAYER:奉仕快楽経験  += 10
	EXP:PLAYER:嗜虐快楽経験  += 20
ELSE
	EXP:PLAYER:Ｖ経験        += 10
	EXP:PLAYER:絶頂経験      += 10
	EXP:PLAYER:レズ経験      += 10
	IF TALENT:PLAYER:ふたなり == 1
		EXP:PLAYER:射精経験  += 10
	ENDIF
	EXP:PLAYER:奉仕快楽経験  += 10
	EXP:PLAYER:嗜虐快楽経験  += 20
ENDIF

GOTO GOODBYE

$GIFT
;---- EDIT 004 ADD START -------------------------
SIF RAND:100 + RAND:(MAXBASE:PLAYER:知恵+MAXBASE:PLAYER:運/2) + CFLAG:ARG:友好度 < 50 && FLAG:交渉目的 < 4
	GOTO GET_DAMAGE
;SIF RAND:3 == 0 && FLAG:調教難易度 == 1
;	GOTO GETMONEY
SIF RAND:3 == 0 && FLAG:交渉目的 > 3
	GOTO GETEXP
SIF RAND:2 == 0
	GOTO GETGIFT
GOTO GETMAG


$GETMONEY
;お金をくれる
;口上呼び出し
;---- EDIT 004 MOD START -------------------------
TFLAG:TALK用要求値 = CSVBASE(NO:ARG,GETNUM(BASE,"LV"),0) * (300 * ENEMYNUM + RAND:1000) * 5 /100
;---- EDIT 004 MOD END   -------------------------
CALL KOJO_TALK,ARG,66
PRINTFORMW %CALLNAME:PLAYER% got ￥{TFLAG:TALK用要求値}
MONEY += TFLAG:TALK用要求値
RESULT = 2
GOTO GOODBYE

$GETMAG
;ＭＡＧをくれる
;口上呼び出し
;---- EDIT 004 MOD START -------------------------
TFLAG:TALK用要求値 = CSVBASE(NO:ARG,GETNUM(BASE,"LV"),0) * (600 * ENEMYNUM + RAND:1500) * 5 /100
;---- EDIT 004 MOD END   -------------------------
CALL KOJO_TALK,ARG,67
PRINTFORMW %CALLNAME:PLAYER% got {TFLAG:TALK用要求値} MAG
CALL CONTROL_MAG,MASTER,TFLAG:TALK用要求値
RESULT = 2
GOTO GOODBYE

$GETEXP
;ＥＸＰをくれる
;口上呼び出し
;---- EDIT 004 MOD START -------------------------
TFLAG:TALK用要求値 = (COEFFICIENT_EXP(ABL:ARG:種族)+CFLAG:ARG:ＥＸＰ補正) * BASE:ARG:(GET_BASESTATUS(0)) * (4+BASE:ARG:LV/4) / 4
				;レベル差による補正
				SIF BASE:PLAYER:(GET_BASESTATUS(0)) > BASE:ARG:(GET_BASESTATUS(0)) + 5
					TFLAG:TALK用要求値 /= POWER(2 , MIN((BASE:PLAYER:(GET_BASESTATUS(0)) - BASE:ARG:(GET_BASESTATUS(0)) - 5)/4 , 30))
				IF BASE:PLAYER:(GET_BASESTATUS(0)) < BASE:ARG:(GET_BASESTATUS(0)) 
					TFLAG:TALK用要求値 *= POWER(3, MIN(( BASE:ARG:(GET_BASESTATUS(0)) - BASE:PLAYER:(GET_BASESTATUS(0)))/4,4))
					TFLAG:TALK用要求値 /= POWER(2, MIN(( BASE:ARG:(GET_BASESTATUS(0)) - BASE:PLAYER:(GET_BASESTATUS(0)))/4,4))
				ENDIF
				CFLAG:PLAYER:入手経験点 += TFLAG:TALK用要求値
;---- EDIT 004 MOD END   -------------------------
PRINTFORMW %CALLNAME:PLAYER% got EXP{TFLAG:TALK用要求値}
RESULT = 2
GOTO GOODBYE

$GET_DAMAGE
;ダメージを受ける
;口上呼び出し
CALL KOJO_TALK,ARG,68
;---- EDIT 004 MOD START -------------------------
;---- EDIT 005 FIX START -------------------------
LOCAL:2 = MAXBASE:PLAYER:ＨＰ * (17 + ENEMYNUM*3)/100
;---- EDIT 005 FIX END   -------------------------
;---- EDIT 004 MOD END   -------------------------
PRINTFORMW %CALLNAME:PLAYER% took {LOCAL:2} damage
CALL VAR_HP,PLAYER,-LOCAL:2,0
RESULT = 2
GOTO GOODBYE

$GETGIFT
;アイテムをくれたり、回復してくれる
	TFLAG:TALK用成功判定値 = RAND:100
	IF TFLAG:TALK用成功判定値 < 1 && FLAG:ソーマギフト == 0
		;口上呼び出し
		CALL KOJO_TALK,ARG,69
		PRINTFORMW %CALLNAME:ARG% used soma
		FOR LOCAL:9,1,7
			LOCALS = ポジション{LOCAL:9}
			SIF FLAG:LOCALS < 0
				CONTINUE
			SIF GET_STATE(CFLAG:(FLAG:LOCALS):ステート) == "DYING"
				CONTINUE
			;HP回復量
			LOCAL = MAXBASE:(FLAG:LOCALS):ＨＰ
			CALL VAR_HP,FLAG:LOCALS,LOCAL,3
			;MP回復量
			LOCAL = MAXBASE:(FLAG:LOCALS):ＭＰ
			CALL VAR_MP,FLAG:LOCALS,LOCAL,3
		NEXT
		FLAG:ソーマギフト += 1
	ELSEIF TFLAG:TALK用成功判定値 < 3 && FLAG:BeadChainギフト < 3
		;口上呼び出し
		CALL KOJO_TALK,ARG,70
		PRINTFORMW %CALLNAME:ARG% used BeadChain
		FOR LOCAL:9,1,7
		LOCALS = ポジション{LOCAL:9}
			SIF FLAG:LOCALS < 0
				CONTINUE
			SIF GET_STATE(CFLAG:(FLAG:LOCALS):ステート) == "DYING"
				CONTINUE
			;HP回復量
			LOCAL = MAXBASE:(FLAG:LOCALS):ＨＰ
			CALL VAR_HP,FLAG:LOCALS,LOCAL,3
		NEXT
		FLAG:BeadChainギフト += 1
	ELSEIF TFLAG:TALK用成功判定値 < 20
		;口上呼び出し
		CALL KOJO_TALK,ARG,71
		PRINTFORM %CALLNAME:PLAYER%は
		;もらえるアイテムの判定 1>2>3>Life stone
		IF ABL:ARG:アイテム1 > 0 && ABL:ARG:入手確率1 > RAND:100
			CALL GET_GIFT, ABL:ARG:アイテム1, 1
		ELSEIF ABL:ARG:アイテム2 > 0 && ABL:ARG:入手確率2 > RAND:100
			CALL GET_GIFT, ABL:ARG:アイテム2, 1
		ELSEIF ABL:ARG:アイテム3 > 0 && ABL:ARG:入手確率3 > RAND:100
			CALL GET_GIFT, ABL:ARG:アイテム3, 1
		ELSE
			CALL GET_GIFT, [[アイテム:Life stone]], 1
		ENDIF
	ELSEIF TFLAG:TALK用成功判定値 < 50
		;口上呼び出し
		CALL KOJO_TALK,ARG,72
		PRINTFORM %CALLNAME:PLAYER%は
		CALL GET_GIFT, [[アイテム:Life stone]], 1
	ELSEIF TFLAG:TALK用成功判定値 < 80
		;口上呼び出し
		CALL KOJO_TALK,ARG,73
		PRINTFORMW %CALLNAME:ARG% used a Life stone for %CALLNAME:PLAYER%。
		CALL VAR_HP,PLAYER,MAXBASE:PLAYER:ＨＰ/5,3
	ELSEIF TFLAG:TALK用成功判定値 < 90
		;口上呼び出し
		CALL KOJO_TALK,ARG,74
		PRINTFORMW %CALLNAME:ARG% used a Bead for %CALLNAME:PLAYER%。
		CALL VAR_HP,PLAYER,MAXBASE:PLAYER:ＨＰ,3
	ELSEIF TFLAG:TALK用成功判定値 < 100
		;口上呼び出し
		CALL KOJO_TALK,ARG,75
		PRINTFORM %CALLNAME:PLAYER% got 
		CALL GET_GIFT, [[アイテム:Bead]], 1
	ENDIF
RESULT = 2
GOTO GOODBYE

$CHECK_TALKBREAK
PRINTFORML
PRINTFORMW The talk became awkward...
PRINTFORML
TFLAG:TALK用成功判定値 = RAND:100 + RAND:(MAXBASE:PLAYER:知恵+MAXBASE:PLAYER:運/2) + CFLAG:ARG:友好度 + 20*誘惑(PLAYER,ARG)

;RelaxSprayをインストールしている場合
IF SOFT_ON("RelaxSpray")
	PRINTFORMW ＞Relaxation spray started
	PRINTFORML 
	SELECTCASE CFLAG:ARG:RelaxSpray
		CASE 0
			;口上呼び出し
			CALL KOJO_TALK,ARG,78
			PRINTFORML 
			PRINTFORML ＞The demon's 
			PRINTFORMW 　mood improved.
			CFLAG:ARG:RelaxSpray = 1
			GOTO RETURNPOINT
		CASE 1
			PRINTFORMW ＞But it didn't work.
	ENDSELECT
ENDIF

SELECTCASE TFLAG:TALK用成功判定値
	CASE IS < 20
	;会話失敗。奇襲する
		;口上呼び出し
		CALL KOJO_TALK,ARG,76
		GOTO ASSAULT
	CASE IS < 70
	;会話失敗。敵対する
		;口上呼び出し
		CALL KOJO_TALK,ARG,77
		GOTO ANGRY
	CASEELSE
	;会話継続
		;口上呼び出し
		CALL KOJO_TALK,ARG,78
		GOTO RETURNPOINT
ENDSELECT


$ANGRY
PRINTFORMW %CALLNAME:ARG% is fired up.
;---- EDIT 004 ADD START -------------------------
FOR LOCAL, 7, 17
	SIF POS(LOCAL) >= 0 && NO:POS(LOCAL) == NO:ARG
		CFLAG:POS(LOCAL):決裂フラグ = 1
NEXT
;---- EDIT 004 ADD END   -------------------------
;CFLAG:ARG:決裂フラグ = 1
RETURN 4

$ASSAULT
PRINTFORMW %CALLNAME:ARG% suddenly attacked!
;---- EDIT 004 ADD START -------------------------
FOR LOCAL, 7, 17
	SIF POS(LOCAL) >= 0 && NO:POS(LOCAL) == NO:ARG
		CFLAG:POS(LOCAL):決裂フラグ = 1
NEXT
;---- EDIT 004 ADD END   -------------------------
;CFLAG:ARG:決裂フラグ = 1
RETURN 3

$GOODBYE
;逃げるときの台詞
IF CFLAG:(FINDCHARA(NO,NO:ARG)):PTフラグ > 0
;同じ仲間がいる場合仲魔
	;口上呼び出し
	CALL KOJO_TALK,ARG,79
	PRINTFORML 
	PRINTFORMW %CALLNAME:ARG% went away
ELSEIF CFLAG:ARG:緊張度 > 20
;険悪な雰囲気
	;口上呼び出し
	CALL KOJO_TALK,ARG,80
	PRINTFORML 
	PRINTFORMW %CALLNAME:ARG% went away
ELSEIF CFLAG:ARG:友好度 < 50
;友好度が低い
	;口上呼び出し
	CALL KOJO_TALK,ARG,81
	PRINTFORML 
	PRINTFORMW %CALLNAME:ARG% went away
ELSEIF CFLAG:ARG:友好度 < 80
;友好度が普通
	;口上呼び出し
	CALL KOJO_TALK,ARG,82
	PRINTFORML 
	PRINTFORMW %CALLNAME:ARG% went away
ELSEIF CFLAG:ARG:友好度 > 79
;友好度が高い
	;口上呼び出し
	CALL KOJO_TALK,ARG,83
	PRINTFORML 
	PRINTFORMW %CALLNAME:ARG% went away
ENDIF
FOR LOCAL, 7, 17
	SIF POS(LOCAL) >= 0 && NO:POS(LOCAL) == NO:ARG
		CALL REMOVE_POSITION, LOCAL
NEXT
;CALL REMOVE_POSITION,CFLAG:ARG:ポジション
RETURN RESULT

;============================================================
;@誘惑？,ARG,ARG:1
;============================================================
@誘惑,ARG,ARG:1
#FUNCTION
SIF !HAVE_SKILL(ARG,[[スキル:誘惑]])
	RETURNF 0
SIF TALENT:(ARG:1):女嫌い && TALENT:ARG:オトコ == 0
	RETURNF -1
SIF TALENT:(ARG:1):男嫌い && (TALENT:ARG:オトコ && TALENT:ARG:男の娘 == 0)
	RETURNF -1
SIF (TALENT:(ARG:1):両刀)
	RETURNF 1
IF TALENT:(ARG:1):オトコ
	SIF (TALENT:ARG:オトコ == 0 || TALENT:ARG:男の娘) || (ABL:(ARG:1):ＢＬっ気 > 0 && TALENT:ARG:オトコ)
		RETURNF 1
ELSEIF TALENT:(ARG:1):オトコ == 0
	SIF (TALENT:ARG:オトコ) || (ABL:(ARG:1):レズっ気 > 0 && TALENT:ARG:オトコ == 0)
		RETURNF 1
ENDIF
RETURNF -1

;============================================================
;コード短縮用・TALK用口上呼び出し関数
;============================================================
@KOJO_TALK,ARG,ARG:1
TFLAG:TALK口上呼び出し用 = ARG:1
TRYCCALLFORM KOJO_TALK_K{NO:ARG},ARG,ARG:1
CATCH
	TRYCCALLFORM KOJO_TALK_PUB{ABL:ARG:会話タイプ},ARG,ARG:1
	CATCH
		SELECTCASE ARG:1
			CASE 1
				;1:Ladyｰkiller
				PRINTFORML %CALLNAME:ARG% seems entranced with %CALLNAME:PLAYER%
				
			CASE 2
				; 2:おねだり前の逡巡時(あいさつor問答で目的が決まっている場合)
			CASE 3
				; 3:交渉の目的を尋ねる
				PRINTFORML Your business was asked
			CASE 84
				;84:要求前の1文
			CASE 4
				; 4-6:交渉目的：やらせてくれと言った時の反応
				; 4:取り付く島もなし
					PRINTFORMW Refused intensely
			CASE 5
				; 5:交渉次第
				PRINTFORMW 条件次第でヤらせてくれるようだ
			CASE 6
				; 6:一発おｋ
				PRINTFORMW Consented willingly
				CALL MESSAGE_TALK
			CASE 7
				; 7-9:交渉目的：やらせてくれと言った時の反応
				; 7:取り付く島もなし
					PRINTFORMW Refused intensely
			CASE 8
				; 8:交渉次第
				PRINTFORMW 条件次第で犯してくれるようだ
			CASE 9
				; 9:一発おｋ
				PRINTFORMW Consented willingly
				CALL MESSAGE_TALK
			CASE 10
				;10:要求額を提示：￥
				PRINTFORML ￥{TFLAG:TALK用要求値} was demanded
				
			CASE 11
				;11-13:￥を払おうとしてお金が足りない
				;11:別のものを要求する
				PRINTFORMW Not enough money
			CASE 85
				;85 恵まれる
				PRINTFORMW Not enough money
				PRINTFORMW ＞%CALLNAME:ARG% looked miserable
			CASE 12
				;12:交渉失敗。立ち去る
				PRINTFORMW Not enough money
			CASE 13
				;13:交渉失敗。敵対する
				PRINTFORMW Not enough money
			CASE 14
				;14-16:￥を支払った
				;14:払ったのに逃げられる
			CASE 15
				;15:さらに要求される
			CASE 16
				;16:交渉成功
			CASE 17
				;17-19:￥を支払うのを断った::
				;17:交渉失敗。奇襲する
			CASE 18
				;18:交渉失敗。敵対する
			CASE 19
				;19:他のものを要求する:
			CASE 20
				;20:要求額を提示：ＭＡＧ
				PRINTFORML {TFLAG:TALK用要求値}MAG was demanded
			CASE 21
				;21-23:ＭＡＧを支払おうとしたが足りない
				;21:別のものを要求する
				PRINTFORMW Not enough ＭＡＧ
			CASE 86
				;86 恵まれる
				PRINTFORMW Not enough ＭＡＧ
				PRINTFORMW ＞%CALLNAME:ARG% looked miserable
			CASE 22
				;22:交渉失敗。立ち去る
				PRINTFORMW Not enough ＭＡＧ
			CASE 23
				;23:交渉失敗。敵対する
				PRINTFORMW Not enough ＭＡＧ
			CASE 24
				;24-26:ＭＡＧを支払った
				;24:払ったのに逃げられる
			CASE 25
				;25:さらに要求される
			CASE 26
				;26:交渉成功
			CASE 27
				;27-29:ＭＡＧを支払うのを断った
				;27:交渉失敗。奇襲する
			CASE 28
				;28:交渉失敗。敵対する
			CASE 29
				;29:他のものを要求する
			CASE 30
				;30:魔石を要求
				PRINTFORML Life stone was demanded
				
			CASE 31
				;31-33:魔石を渡そうとしたが持っていない
				;31:別のものを要求する
				PRINTFORMW But you don't have a Life stone
			CASE 87
				;87 恵まれる
				PRINTFORMW But you don't have a Life stone
				PRINTFORMW ＞%CALLNAME:ARG% looked miserable
			CASE 32
				;32:交渉失敗。立ち去る
				PRINTFORMW But you don't have a Life stone
			CASE 33
				;33:交渉失敗。敵対する
				PRINTFORMW But you don't have a Life stone
			CASE 34
				;34-36:魔石を渡した
				;34:払ったのに逃げられる
			CASE 35
				;35:さらに要求される
			CASE 36
				;36:交渉成功
			CASE 37
				;37-39:魔石を渡すのを断った
				;37:交渉失敗。奇襲する
			CASE 38
				;38:交渉失敗。敵対する
			CASE 39
				;39:他のものを要求する
			CASE 40
				;40:異性との性交渉を要求
				PRINTFORML \@TALENT:ARG:オトコ ?A female#A male\@ was demanded
			CASE 41
				;41:異性を宛がってもらった時の反応
				CALL MESSAGE_TALK
			CASE 42
				;42-46:性交渉が終わった後
				;42:敗北してる場合ここでゲームオーバー
			CASE 43
				;43:話しかけたキャラが倒れている
			CASE 44
				;44:ヤらせたのに逃げられる
				PRINTFORMW %CALLNAME:ARG% fled
			CASE 45
				;45:満足してない
				PRINTFORML %CALLNAME:ARG% was not satisfied
			CASE 46
				;46:満足
				PRINTFORMW %CALLNAME:ARG% was satisfied
			CASE 47
				;47-49:性交渉を断った
				;47:交渉失敗。奇襲する
			CASE 48
				;48:交渉失敗。敵対する
			CASE 49
				;49:他のものを要求する
			CASE 50
				;50-55:ヤらせてもらった後
				;50:敗北してる場合ここでゲームオーバー
			CASE 51
				;51:話かけたキャラが倒れいる
			CASE 52
				;52:去っていく
			CASE 53
				;53:満足し、仲魔になる
			CASE 54
				;54:満足し、アイテムをくれる
			CASE 53
				;53:満足し、見逃してくれる
				;現状、死に処理
			CASE 56
				;56-61:犯してもらった後
				;56:敗北してる場合ここでゲームオーバー
			CASE 57
				;57:話かけたキャラが倒れいる
			CASE 58
				;58:去っていく
			CASE 59
				;59:満足し、仲魔になる
			CASE 60
				;60:満足し、アイテムをくれる
			CASE 61
				;61:満足し、見逃してくれる
				;現状、死に処理
			CASE 62
				;62:仲魔になる
					IF FLAG:交渉目的 > 3
						PRINTFORMW Being satisfied with %CALLNAME:PLAYER%'s skills、%CALLNAME:ARG% joined
					ELSE
					ENDIF
			CASE 63
				;63:マスターのレベルより高い場合
				PRINTFORMW Though the negotiations were successful、your level was too low
			CASE 64
				;64:ＣＯＭＰの空きが無い場合
					PRINTFORML Though the negotiations were successful、you couldn't hold any more demons
			CASE 65
				;65:搾りとられた
			CASE 66
				;66:お金をくれる
				IF FLAG:交渉目的 > 3
					PRINTFORMW Satisfied with %CALLNAME:PLAYER%'s skills、the demon gave you money
				ELSE
				ENDIF
			CASE 67
				;67:ＭＡＧをくれる
				IF FLAG:交渉目的 > 3
					PRINTFORMW Satisfied with %CALLNAME:PLAYER%'s skills、the demon gave you ＭＡＧ
				ELSE
				ENDIF
			CASE 68
				;68:ダメージをくれる
			CASE 69
				;69-75:アイテムをくれるor回復してくれる
				;69:ソーマを使ってくれる
			CASE 70
				;70:BeadChainを使ってくれる
			CASE 71
				;71:ITEMor魔石をくれる
			CASE 72
				;72:魔石をくれる
			CASE 73
				;73:魔石を使ってくれる
			CASE 74
				;74:宝玉を使ってくれる
			CASE 75
				;75:宝玉をくれる
			CASE 76
				;76-78:気まずくなった
				;76:会話失敗。奇襲する
			CASE 77
				;77:会話失敗。敵対する
			CASE 78
				;78:会話継続
			CASE 79
				;79-83:立ち去る
				;79:同じ仲魔がいる場合
			CASE 80
				;険悪な雰囲気
			CASE 81
				;友好度が低い
			CASE 82
				;友好度が普通
			CASE 83
				;友好度が高い
			CASE 88
				;ヤらせてもらう・交渉が成功した場合
				PRINTFORMW As negotiations succeeded、you will fuck them
				CALL MESSAGE_TALK
			CASE 89
				;犯してもらう・交渉が成功した場合
				PRINTFORMW As negotiations succeeded、you will be fucked
				CALL MESSAGE_TALK
			CASE 90
				;ダンジョン内性欲処理：輪姦イベント
			CASE 91
				;敵が命乞いCASE91〜93
				;命乞い
			CASE 92
				;助けた場合（RETURN 0, X = 0.逃げる　1.仲魔になる　2.何か貰う　3.奇襲）
			CASE 93
				;断った場合
			CASE 94
				;敵から助ける代わりに取引を持ちかけられるCASE94〜101
				;取引内容（RETURN 0, X = 1.￥　2.魔貨　3.異性）
			CASE 95
				;要求をのむ（￥）
			CASE 96
				;要求をのむ（魔貨）
			CASE 97
				;要求をのむ（異性）
				CALL MESSAGE_TALK
			CASE 98
				;約束を守るかどうか口上内で決める（RETURN 0, X = 1.去っていく　2.戦闘続行）
			CASE 99
				;約束を守って去っていく
			CASE 100
				;約束を守らず戦闘続行
			CASE 101
				;要求を断る
		ENDSELECT
	ENDCATCH
ENDCATCH
;==============================================
;性的交渉の地の文
;==============================================
@MESSAGE_TALK,ARG = -1
;ARGが-1以外で呼び出されていた場合、ARGの番号のメッセージを呼び出し
SELECTCASE (ARG > -1 ? ARG # TFLAG:TALK口上呼び出し用)

	;------------------------------------------
	;ヤらせてもらう・一発ＯＫの場合
	;------------------------------------------
			CASE 6
				
	;------------------------------------------
	;犯してもらう・一発ＯＫの場合
	;------------------------------------------
			CASE 9
				TFLAG:メッセージパターン = 0
				IF TALENT:PLAYER:オトコ == 0 || TALENT:PLAYER:男の娘
					;魅了状態
					IF CFLAG:PLAYER:ステート == GET_STATE_NUM("CHARM")
						PRINTFORMW %CALLNAME:PLAYER%entrusts their body to %CALLNAME:交渉対象()%、stripping
						TFLAG:メッセージパターン = 8
					ELSEIF TEQUIP:PLAYER:スカートたくし上げ && RAND:4 == 0
						TFLAG:メッセージパターン = 1
						PRINTFORM %CALLNAME:PLAYER% is 
						IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
							PRINTFORM with a disappointing look 
						ELSEIF TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦 || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ == 5
							PRINTFORM showing off 
						ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 > 2500
							IF TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛 || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
								PRINTFORM looking down and blushing 
							ELSE
								PRINTFORM with a flushed expression
							ENDIF
						ELSE
							IF TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛 || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
								PRINTFORM looking down and blushing 
							ENDIF
						ENDIF
						IF TEQUIP:PLAYER:Ｖずらし可 && RAND:2 == 0
							TFLAG:メッセージパターン = 5
							;スカートたくし上げ・パンツずらし
							SELECTCASE TEQUIP:PLAYER:スカートたくし上げ
								CASE 1
									PRINTFORM lifting the end of their skirt、
								CASE 2
									PRINTFORM lifting their skirt、
								CASE 3
									PRINTFORM holding the end of their skirt in their mouth、
								CASE 4
									PRINTFORM holding the end of their skirt in their mouth、
							ENDSELECT
							PRINTFORML while shifting %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%、
							IF STAIN:PLAYER:3 & 4
								SIF PALAM:PLAYER:潤滑 >= PALAMLV:2 && TALENT:PLAYER:オトコ == 0
									PRINTFORM love juice and 
								PRINTFORM semen dripping from them 
							ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
								IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORM in expectation of being toyed with 
								ELSEIF TALENT:PLAYER:オトコ == 0
									PRINTFORM with love juice 
								ENDIF
								PRINTFORM soaking them
							ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM trembling in expectation
							ENDIF
							IF TALENT:PLAYER:男の娘
								PRINTFORMW 窄まりを指で広げ、%CALLNAME:交渉対象()%\@ HAVE_PENIS(交渉対象()) ? に子種をねだった # 誘ってみせた \@…
							ELSE
								PRINTFORMW \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げ、%CALLNAME:交渉対象()%\@ HAVE_PENIS(交渉対象()) ? に子種をねだった # 誘ってみせた \@…
							ENDIF
						ELSE
							SELECTCASE TEQUIP:PLAYER:スカートたくし上げ
								CASE 1
									PRINTFORML lifting the end of their skirt、
								CASE 2
									PRINTFORML lifting their skirt、
								CASE 3
									PRINTFORML holding the end of their skirt in their mouth、
								CASE 4
									PRINTFORML holding the end of their skirt in their mouth、
							ENDSELECT
							
							IF TEQUIP:PLAYER:陰唇露出 == -1
								;スカートたくし上げ・ノーパン
								IF STAIN:PLAYER:3 & 4
									SIF PALAM:PLAYER:潤滑 >= PALAMLV:2
										PRINTFORM 愛液と
									PRINTFORMW 精液でドロドロになっている\@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@が外気に晒された…
								ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
									IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
										PRINTFORM 弄ばれる事への期待で
									ELSE
										PRINTFORM 自らの愛液で
									ENDIF
									PRINTFORMW 濡れた\@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@があらわになった…
								ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORMW 期待してヒクヒクと震えている\@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@が外気に晒された…
								ENDIF
							ELSE
								;スカートたくし上げ・下着見せ
								IF TALENT:PLAYER:男の娘 && CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORMW %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%の下で可愛らしいペニスがガチガチにそそり立っている様子が丸見えになった…
								ELSEIF TALENT:PLAYER:男の娘
									PRINTFORMW 可愛らしいペニスを包み込んでいる%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%がさらけ出された…
								ELSEIF STAIN:PLAYER:16 & 4 || STAIN:PLAYER:17 & 4
									SIF STAIN:PLAYER:16 & 1 || STAIN:PLAYER:17 & 1
										PRINTFORM 愛液と
									PRINTFORMW 精液に塗れ、グチャグチャになった%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%がさらけ出された…
								ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
									PRINTFORMW 愛液でしっとりと湿り、秘唇を隠した部分にシミの浮かんだ%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%が外気に晒された…
								ENDIF
							ENDIF
						ENDIF
					ELSEIF !(TEQUIP:PLAYER:股間構造 & 1) && RAND:3 == 0
						TFLAG:メッセージパターン = 2
					;Ｍ字開脚・ノーパン+開帳
						PRINTFORM %CALLNAME:PLAYER%はおもむろに座り込み
						;ズボン履いてる場合は摺り下ろす
						SIF TEQUIP:PLAYER:股間構造 & 1
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%を脱ぎ捨てると
						IF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
							IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 頬を染めながら、
							ELSE
								PRINTFORM 羞恥に身を震わせながら
							ENDIF
							SIF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORML %CALLNAME:MASTER%の目の前であるにも関わらず
						ELSEIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ
							PRINTFORM 挑発的な笑みを浮かべながら
						ENDIF
							PRINTFORM 脚を大きく開き
					;Ｍ字開脚・パンツずらし
						IF TEQUIP:PLAYER:Ｖずらし可 && CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 扇情的な指先で
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%をずらし
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを指で広げて見せ、
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げて見せ、
							ENDIF
						ELSEIF TEQUIP:PLAYER:股間構造 & 2
							;ビキニ構造
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 扇情的な指先で
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%をずらし
							IF STAIN:PLAYER:3 & 4
								SIF PALAM:PLAYER:潤滑 >= PALAMLV:2 && TALENT:PLAYER:オトコ == 0
									PRINTFORM 愛液と
								PRINTFORM 精液がドロリと垂れ落ちる
							ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
								IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORM 弄ばれる事への期待で
								ELSEIF TALENT:PLAYER:オトコ == 0
									PRINTFORM 自らの愛液で
								ENDIF
								PRINTFORM 濡れた
							ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 期待にヒクヒクと震えている
							ENDIF

							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを指で広げて見せ、
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げて見せ、
							ENDIF
						ELSE
							;四つんばい・ボトムレスorノーパンorズボンはいてる(摺り下ろしずみ)
							PRINTFORM 隠す物など何も無い
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりをを指で広げて見せ
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@をを指で広げて見せ
							ENDIF
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 自らを慰めながら
						ENDIF
						PRINTFORMW %CALLNAME:交渉対象()%に犯して欲しいとおねだりをした……
					;Ｍ字開脚・ノーパン
					;Ｍ字開脚・パンツなぞり
					;Ｍ字開脚

					ELSEIF !(TALENT:PLAYER:絶壁 && TALENT:PLAYER:オトコ) && RAND:2 == 0
						TFLAG:メッセージパターン = 3
							PRINTFORM %CALLNAME:PLAYER%は
						;おっぱいオープン中			
						;おっぱい見えてる
						IF TEQUIP:PLAYER:乳房露出 == -1
							PRINTFORM 隠す物など何も無い
						;おっぱいオープン可能
						ELSEIF TEQUIP:PLAYER:胸前開き & 0
							PRINTFORM 胸元を開き						
						;胸での誘惑が不可な場合は脱ぐ
						ELSE
							PRINTFORM 衣服を脱ぎ
						ENDIF
						IF TALENT:PLAYER:爆乳 
							PRINTFORM 手に余るほどの爆乳を
						ELSEIF TALENT:PLAYER:巨乳 
							PRINTFORM 男の情欲を刺激する巨乳を
						ELSEIF TALENT:PLAYER:貧乳 
							PRINTFORM 僅かな膨らみを見せる乳房を
						ELSE
							PRINTFORM 形のよい乳房を
						ENDIF
						IF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
							IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORML 蕩け切った表情で、%CALLNAME:交渉対象()%に圧し付けながら
								PRINTFORMW 犯してくださいと言いつつキスを交わした
							ELSE
								PRINTFORML 恥ずかしそうに手で隠しながら
								PRINTFORMW 好きにして下さいと視線を逸らしながら呟いた
							ENDIF
						ELSEIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ
							PRINTFORML 揉みしだきながら擦り寄り%CALLNAME:交渉対象()%の手を胸にあてがうと
							PRINTFORMW 挑発的な笑みを浮かべた
						ELSE
							PRINTFORML 愛撫しながら
							PRINTFORMW %CALLNAME:交渉対象()%に犯して欲しいとおねだりをした……
						ENDIF
					ELSEIF RAND:2 == 0
						TFLAG:メッセージパターン = 4
					;足が無いキャラは四つんばいでなく、手を付いて尻を向ける？
						;PRINTFORM %CALLNAME:PLAYER%はその場に\@ TALENT:PLAYER:腕 || TALENT:PLAYER:\@\@\@、
						PRINTFORM %CALLNAME:PLAYER%は
						IF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
							IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 蕩け切った表情で、
							ELSE
								PRINTFORM もう我慢出来ないといった様子で、
							ENDIF
							SIF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORML %CALLNAME:MASTER%の目の前であるにも関わらず
						ELSEIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ
							PRINTFORM %CALLNAME:交渉対象()%に犯されることへの期待に身を震わせ
							PRINTFORM 蕩け切った表情で、
						ENDIF
						PRINTFORM その場に手を付いて四つん這いになり、
						SIF TEQUIP:PLAYER:スカートたくし上げ
							PRINTFORM スカートを捲り上げて
						;ズボン履いてる場合は摺り下ろす
						SIF TEQUIP:PLAYER:股間構造 & 1
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%を摺り下ろして
						PRINTFORM %CALLNAME:交渉対象()%に
						IF TEQUIP:PLAYER:Ｖずらし可 && CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
							;四つんばい・パンツずらし
							PRINTFORM 尻を
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 高く突き出すように
							PRINTFORM 向け、ずらした%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%の下から覗く
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを指で広げて見せ、
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げて見せ、
							ENDIF
						ELSEIF TEQUIP:PLAYER:股間構造 & 2
							;四つんばい・ビキニ構造
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%に包まれた尻を
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 高く突き出すように
							PRINTFORML 向けると、
						ELSE
							;四つんばい・ボトムレスorノーパンorズボンはいてる(摺り下ろしずみ)
							PRINTFORM 隠す物など何も無い
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を
							ENDIF
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 高く突き出すように
							PRINTFORML 向けると、
						ENDIF
						PRINTFORMW %CALLNAME:交渉対象()%に犯して欲しいとおねだりをした……
					ELSE
						TFLAG:メッセージパターン = 7						
					;フェラチオ
						PRINTFORM %CALLNAME:PLAYER%は%CALLNAME:交渉対象()%の前に跪き
						PRINTFORM そそり立つペニスを
						IF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
							IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								SIF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 )
									PRINTFORML %CALLNAME:MASTER%の目の前であるにも関わらず
								PRINTFORML ウットリとした顔で上目遣いをしながら口に咥え、
							ELSE
								PRINTFORML 眼を瞑りながらゆっくりと口に含み、
							ENDIF
						ELSEIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ
							PRINTFORML 愛しそうな表情で口に咥え自らを慰めながら、
						ELSE
							PRINTFORML 根元から舐め上げそのまま亀頭を口に含み、
						ENDIF
						IF ABL:PLAYER:技巧 > 6
							PRINTFORM ねっとりとした舌使いで
						ELSEIF ABL:PLAYER:技巧 > 3
							PRINTFORM 丹念な舌使いで
						ELSE
							PRINTFORM 稚拙な舌使いで
						ENDIF
						IF ABL:PLAYER:精液中毒 > 2
							PRINTFORMW 放たれた精液を喉を鳴らしながら飲み干した
						ELSE
							PRINTFORMW 射精させた
						ENDIF
					ENDIF
				ELSE
				;PLAYERがオトコかつ男の娘でない
					
				ENDIF
	;------------------------------------------
	;女を宛がった場合
	;------------------------------------------
	CASE 41, 97
		IF HAVE_PENIS(交渉対象())
		;竿持ちの場合
			IF 捧げたキャラ() != MASTER
			TFLAG:メッセージパターン = 6
				IF 危険日((捧げたキャラ()))
					IF TALENT:(捧げたキャラ()):発情可 || 危険日((捧げたキャラ())) == 2
						PRINTFORM 発情した%CALLNAME:(捧げたキャラ())%は
						SIF TALENT:(捧げたキャラ()):恋慕 || TALENT:(捧げたキャラ()):親愛
							PRINTFORM %CALLNAME:MASTER%に見られている事も忘れ
						PRINTFORMW %CALLNAME:交渉対象()%の子種を求めて必死に腰を使っている……
					ELSE
						PRINTFORMW %CALLNAME:(捧げたキャラ())%が危険日だと気付いた%CALLNAME:交渉対象()%は自らの種を執拗に膣内へ注ぎ込んでいる……
					ENDIF
				ELSEIF ABL:(捧げたキャラ()):種族 > 0 && FLAG:月齢 == 8
						PRINTFORMW 発情した%CALLNAME:(捧げたキャラ())%は
						SIF TALENT:(捧げたキャラ()):恋慕 || TALENT:(捧げたキャラ()):親愛
							PRINTFORM %CALLNAME:MASTER%に見られている事も忘れ
						PRINTFORMW %CALLNAME:交渉対象()%の子種を求めて必死に腰を使っている……
				ELSEIF TALENT:(捧げたキャラ()):恋慕 || TALENT:(捧げたキャラ()):親愛
					PRINTFORMW %CALLNAME:(捧げたキャラ())%は%CALLNAME:交渉対象()%に組み敷かれて思うがままに犯されている……
				ELSEIF TALENT:(捧げたキャラ()):淫乱 || TALENT:(捧げたキャラ()):娼婦
					PRINTFORMW %CALLNAME:(捧げたキャラ())%は%CALLNAME:交渉対象()%のペニスを受け入れると嬌声をあげて腰を振り始めた……
				ELSEIF TALENT:(捧げたキャラ()):服従 || TALENT:(捧げたキャラ()):隷属
					PRINTFORMW %CALLNAME:(捧げたキャラ())%は%CALLNAME:交渉対象()%のペニスへと丹念な奉仕をしている……
				ELSE
					PRINTFORMW %CALLNAME:(捧げたキャラ())%を%CALLNAME:交渉対象()%に宛がうと、貪るように犯し始めた……
				ENDIF
			ELSE
				IF RAND:4 == 0
					PRINTFORMW %CALLNAME:交渉対象()%に自分の体を提供した……
				ELSEIF RAND:3 == 0
					PRINTFORMW 自分から脚を大きく開いて%CALLNAME:交渉対象()%を誘うと、乱暴に組み敷かれ犯され続けた……
				ELSEIF RAND:2 == 0
					PRINTFORMW %CALLNAME:交渉対象()%に身を委ねた……
				ELSE
					PRINTFORMW %CALLNAME:交渉対象()%の為すがままに弄ばれた……
				ENDIF
				;本番回数が多い
				IF LOCAL:1 >= (LOCAL:2 || LOCAL:3)
					
				;アナル回数が多い
				ELSEIF LOCAL:2 >= LOCAL:3
					PRINTFORML 
					IF RAND:2 == 0
						PRINTFORM %CALLNAME:MASTER%は%CALLNAME:交渉対象()%
						IF RAND:2 == 0
							PRINTFORML に正常位で犯された
						ELSE
							PRINTFORM と向き合う姿勢
							IF RAND:2 == 0
								PRINTFORML で一つになった
							ELSE
								PRINTFORML で犯された
							ENDIF
						ENDIF
						;獣or鳥
						IF TALENT:交渉対象():獣 || TALENT:交渉対象():鳥
							PRINTFORM ケダモノの姿をした悪魔は%CALLNAME:MASTER%を押し倒し
						ELSE
							IF RAND:2 == 0
								PRINTFORM 力強く
							ELSE
								PRINTFORM 乱暴に
							ENDIF
							PRINTFORM 悪魔は%CALLNAME:MASTER%を押し倒すと
						ENDIF
						IF RAND:2 == 0
							PRINTFORM %CALLNAME:交渉対象()%はテクニックなど何もない荒々しい腰使いで
						ELSE
							PRINTFORM %CALLNAME:MASTER%の様子などお構い無しに
						ENDIF	
						IF RAND:2 == 0
							PRINTFORMW 何度も%CALLNAME:MASTER%の尻穴を突き上げて絶頂し熱い精液がアナルの中に流し込まれた
						ELSE
							PRINTFORMW 激しく尻穴を犯し、アナルの中に精液を吐き出していく
						ENDIF
					ELSE
						PRINTFORM %CALLNAME:交渉対象()%は%CALLNAME:MASTER%
						IF RAND:2 == 0
							PRINTFORM を組み伏すと
						ELSE
							PRINTFORM を押し倒して
						ENDIF
						IF RAND:2 == 0
							PRINTFORM バックから
						ELSE
							PRINTFORM 背後から
						ENDIF
						IF RAND:2 == 0
							PRINTFORML 挿入してきた
						ELSE
							PRINTFORML 一気にアナルを犯しはじめた
						ENDIF
						IF RAND:2 == 0
							PRINTFORM 力任せに
						ELSE
							PRINTFORM %CALLNAME:MASTER%の様子などお構い無しに
						ENDIF
						IF RAND:3 == 0
							PRINTFORM 叩きつけるように
						ELSEIF RAND:2 == 0
							PRINTFORM 荒々しく
						ELSE
							PRINTFORM 激しく
						ENDIF
						IF RAND:2 == 0
							PRINTFORMW %CALLNAME:交渉対象()%は何度も何度も肉棒をアナルの奥深くまで突き上げてくる
						ELSE
							PRINTFORMW 腰をつかい、%CALLNAME:MASTER%の尻穴の入り口は押し広げられていく
						ENDIF
					ENDIF
				;フェラ回数が多い
				ELSEIF LOCAL:3 >= LOCAL:2
					PRINTFORML 
					IF RAND:4 == 0
						PRINTFORML %CALLNAME:MASTER%は%CALLNAME:交渉対象()%の前に跪き口腔へと肉棒を咥え込んだ
						PRINTFORMW 丁寧に舌を絡め、口内全体で包み込むようにして刺激していく
					ELSEIF RAND:3 == 0
						PRINTFORML %CALLNAME:MASTER%は%CALLNAME:交渉対象()%に押えつけられ激しく口腔を犯された
						PRINTFORMW むせる%CALLNAME:MASTER%の様子などお構いなしに%CALLNAME:交渉対象()%は更に激しく腰を揺さぶってくる
					ELSEIF RAND:2 == 0
						PRINTFORML 鼻につく体臭を匂わせた%CALLNAME:交渉対象()%の汚らしい肉棒が%CALLNAME:MASTER%の口に捻じ込まれた
						PRINTFORMW 思わず苦しげに%CALLNAME:MASTER%が呻くと悪魔は喜び更に激しく腰を使い肉棒を口内一杯に擦りつけてきた
					ELSE
						PRINTFORML %CALLNAME:MASTER%の口に放たれた濃い%CALLNAME:交渉対象()%の精液の味が広がっていく
						PRINTFORMW あまりの量に受け止めきれず溢れた精液が%CALLNAME:MASTER%の口の端から零れ落ちていった
					ENDIF
				ENDIF
			ENDIF
		ELSE
		;痴女の場合
			IF 捧げたキャラ() != MASTER
				IF HAVE_PENIS(交渉対象())
					IF TALENT:(捧げたキャラ()):恋慕 || TALENT:(捧げたキャラ()):親愛
						PRINTFORMW %CALLNAME:(捧げたキャラ())%は%CALLNAME:交渉対象()%に組み敷かれて思うがままに犯されている……
					ELSEIF TALENT:(捧げたキャラ()):淫乱 || TALENT:(捧げたキャラ()):娼婦
						PRINTFORMw %CALLNAME:(捧げたキャラ())%は%CALLNAME:交渉対象()%と競い合うように腰を振り立てている……
					ELSEIF TALENT:(捧げたキャラ()):服従 || TALENT:(捧げたキャラ()):隷属
						PRINTFORMW %CALLNAME:(捧げたキャラ())%は%CALLNAME:交渉対象()%へと丹念な奉仕をしている……
					ELSE
						PRINTFORMW %CALLNAME:(捧げたキャラ())%を%CALLNAME:交渉対象()%に宛がうと、貪るように犯し始めた……
					ENDIF
				ELSE
				ENDIF
			ELSE
				IF RAND:4 == 0
					PRINTFORMW %CALLNAME:交渉対象()%に自分の体を提供した……
				ELSEIF RAND:3 == 0
					PRINTFORMW 自分から横になり%CALLNAME:交渉対象()%を誘うと、乱暴に組み敷かれ犯され続けた……
				ELSEIF RAND:2 == 0
					PRINTFORMW %CALLNAME:交渉対象()%に身を委ねた……
				ELSE
					PRINTFORMW %CALLNAME:交渉対象()%の為すがままに弄ばれた……
				ENDIF
			ENDIF
		ENDIF

	;------------------------------------------
	;犯してもらう・交渉が成功した場合
	;------------------------------------------
			CASE 89
				TFLAG:メッセージパターン = 0
				IF TALENT:PLAYER:オトコ == 0 || TALENT:PLAYER:男の娘
					IF TEQUIP:PLAYER:スカートたくし上げ && RAND:4 == 0
						TFLAG:メッセージパターン = 1
						PRINTFORM %CALLNAME:PLAYER%が
						IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
							PRINTFORM 蕩け切った表情で
						ELSEIF TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦 || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ == 5
							PRINTFORM 見せ付けるように
						ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 > 2500
							IF TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛 || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
								PRINTFORM 上気した顔を伏せて
							ELSE
								PRINTFORM 上気した表情で
							ENDIF
						ELSE
							IF TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛 || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
								PRINTFORM 赤くなった顔を伏せて
							ENDIF
						ENDIF
						IF TEQUIP:PLAYER:Ｖずらし可 && RAND:2 == 0
							TFLAG:メッセージパターン = 5
							;スカートたくし上げ・パンツずらし
							SELECTCASE TEQUIP:PLAYER:スカートたくし上げ
								CASE 1
									PRINTFORM スカートの端を摘まんで持ち上げ、
								CASE 2
									PRINTFORM スカートを摘まんで持ち上げ、
								CASE 3
									PRINTFORM スカートの端を持ち上げ口で咥え、
								CASE 4
									PRINTFORM スカートの端を持ち上げ口で咥え、
							ENDSELECT
							PRINTFORML %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%をずらすと、
							IF STAIN:PLAYER:3 & 4
								SIF PALAM:PLAYER:潤滑 >= PALAMLV:2 && TALENT:PLAYER:オトコ == 0
									PRINTFORM 愛液と
								PRINTFORM 精液がドロリと垂れ落ちる
							ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
								IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORM 弄ばれる事への期待で
								ELSEIF TALENT:PLAYER:オトコ == 0
									PRINTFORM 自らの愛液で
								ENDIF
								PRINTFORM 濡れた
							ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 期待にヒクヒクと震えている
							ENDIF
							IF TALENT:PLAYER:男の娘
								PRINTFORMW 窄まりを指で広げ、%CALLNAME:交渉対象()%\@ HAVE_PENIS(交渉対象()) ? に子種をねだった # 誘ってみせた \@…
							ELSE
								PRINTFORMW \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げ、%CALLNAME:交渉対象()%\@ HAVE_PENIS(交渉対象()) ? に子種をねだった # 誘ってみせた \@…
							ENDIF
						ELSE
							SELECTCASE TEQUIP:PLAYER:スカートたくし上げ
								CASE 1
									PRINTFORML lifting the end of their skirt、
								CASE 2
									PRINTFORML lifting their skirt、
								CASE 3
									PRINTFORML holding the end of their skirt in their mouth、
								CASE 4
									PRINTFORML holding the end of their skirt in their mouth、
							ENDSELECT
							
							IF TEQUIP:PLAYER:陰唇露出 == -1
								;スカートたくし上げ・ノーパン
								IF STAIN:PLAYER:3 & 4
									SIF PALAM:PLAYER:潤滑 >= PALAMLV:2
										PRINTFORM 愛液と
									PRINTFORMW 精液でドロドロになっている\@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@が外気に晒された…
								ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
									IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
										PRINTFORM 弄ばれる事への期待で
									ELSE
										PRINTFORM 自らの愛液で
									ENDIF
									PRINTFORMW 濡れた\@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@があらわになった…
								ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORMW 期待してヒクヒクと震えている\@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@が外気に晒された…
								ENDIF
							ELSE
								;スカートたくし上げ・下着見せ
								IF TALENT:PLAYER:男の娘 && CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORMW %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%の下で可愛らしいペニスがガチガチにそそり立っている様子が丸見えになった…
								ELSEIF TALENT:PLAYER:男の娘
									PRINTFORMW 可愛らしいペニスを包み込んでいる%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%がさらけ出された…
								ELSEIF STAIN:PLAYER:16 & 4 || STAIN:PLAYER:17 & 4
									SIF STAIN:PLAYER:16 & 1 || STAIN:PLAYER:17 & 1
										PRINTFORM 愛液と
									PRINTFORMW 精液に塗れ、グチャグチャになった%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%がさらけ出された…
								ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
									PRINTFORMW 愛液でしっとりと湿り、秘唇を隠した部分にシミの浮かんだ%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%が外気に晒された…
								ENDIF
							ENDIF
						ENDIF
					ELSEIF !(TEQUIP:PLAYER:股間構造 & 1) && RAND:3 == 0
						TFLAG:メッセージパターン = 2
					;Ｍ字開脚・ノーパン+開帳
						PRINTFORM %CALLNAME:PLAYER%はおもむろに座り込み
						;ズボン履いてる場合は摺り下ろす
						SIF TEQUIP:PLAYER:股間構造 & 1
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%を脱ぎ捨てると
						IF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
							IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 頬を染めながら、
							ELSE
								PRINTFORM 羞恥に身を震わせながら
							ENDIF
							SIF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORML %CALLNAME:MASTER%の目の前であるにも関わらず
						ELSEIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ
							PRINTFORM 挑発的な笑みを浮かべながら
						ENDIF
							PRINTFORM 脚を大きく開き
					;Ｍ字開脚・パンツずらし
						IF TEQUIP:PLAYER:Ｖずらし可 && CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 扇情的な指先で
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%をずらし
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを指で広げて見せ、
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げて見せ、
							ENDIF
						ELSEIF TEQUIP:PLAYER:股間構造 & 2
							;ビキニ構造
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 扇情的な指先で
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%をずらし
							IF STAIN:PLAYER:3 & 4
								SIF PALAM:PLAYER:潤滑 >= PALAMLV:2 && TALENT:PLAYER:オトコ == 0
									PRINTFORM 愛液と
								PRINTFORM 精液がドロリと垂れ落ちる
							ELSEIF PALAM:PLAYER:潤滑 >= PALAMLV:2
								IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
									PRINTFORM 弄ばれる事への期待で
								ELSEIF TALENT:PLAYER:オトコ == 0
									PRINTFORM 自らの愛液で
								ENDIF
								PRINTFORM 濡れた
							ELSEIF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 期待にヒクヒクと震えている
							ENDIF

							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを指で広げて見せ、
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げて見せ、
							ENDIF
						ELSE
							;四つんばい・ボトムレスorノーパンorズボンはいてる(摺り下ろしずみ)
							PRINTFORM 隠す物など何も無い
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりをを指で広げて見せ
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@をを指で広げて見せ
							ENDIF
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 自らを慰めながら
						ENDIF
						PRINTFORMW %CALLNAME:交渉対象()%に犯して欲しいとおねだりをした……
					;Ｍ字開脚・ノーパン
					;Ｍ字開脚・パンツなぞり
					;Ｍ字開脚

					ELSEIF !(TALENT:PLAYER:絶壁 && TALENT:PLAYER:オトコ) && RAND:2 == 0
						TFLAG:メッセージパターン = 3
							PRINTFORM %CALLNAME:PLAYER%は
						;おっぱいオープン中			
						;おっぱい見えてる
						IF TEQUIP:PLAYER:乳房露出 == -1
							PRINTFORM 隠す物など何も無い
						;おっぱいオープン可能
						ELSEIF TEQUIP:PLAYER:胸前開き & 0
							PRINTFORM 胸元を開き						
						;胸での誘惑が不可な場合は脱ぐ
						ELSE 
							PRINTFORM 衣服を脱ぎ
						ENDIF
						IF TALENT:PLAYER:爆乳 
							PRINTFORM 手に余るほどの爆乳を
						ELSEIF TALENT:PLAYER:巨乳 
							PRINTFORM 男の情欲を刺激する巨乳を
						ELSEIF TALENT:PLAYER:貧乳 
							PRINTFORM 僅かな膨らみを見せる乳房を
						ELSE
							PRINTFORM 形のよい乳房を
						ENDIF
						IF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
							IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 蕩け切った表情で、%CALLNAME:交渉対象()%に圧し付けながら
								PRINTFORMW 犯してくださいと言いつつキスを交わした
							ELSE
								PRINTFORM 恥ずかしそうに手で隠しながら
								PRINTFORMW 好きにして下さいと視線を逸らしながら呟いた
							ENDIF
						ELSEIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ
							PRINTFORM 揉みしだきながら擦り寄り
							PRINTFORM %CALLNAME:交渉対象()%の手を胸にあてがうと
							PRINTFORMW 挑発的な笑みを浮かべた
						ELSE
							PRINTFORM 愛撫しながら
							PRINTFORMW %CALLNAME:交渉対象()%に犯して欲しいとおねだりをした……
						ENDIF
					ELSE
						TFLAG:メッセージパターン = 4
					;足が無いキャラは四つんばいでなく、手を付いて尻を向ける？
						;PRINTFORM %CALLNAME:PLAYER%はその場に\@ TALENT:PLAYER:腕 || TALENT:PLAYER:\@\@\@、
						PRINTFORM %CALLNAME:PLAYER%は
						IF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 1 || TALENT:PLAYER:ＮＴＲ == 4
							IF CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
								PRINTFORM 蕩け切った表情で、
							ELSE
								PRINTFORM もう我慢出来ないといった様子で、
							ENDIF
							SIF ((TALENT:PLAYER:恋慕 || TALENT:PLAYER:親愛) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORML %CALLNAME:MASTER%の目の前であるにも関わらず
						ELSEIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 ) || TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:ＮＴＲ
							PRINTFORM %CALLNAME:交渉対象()%に犯されることへの期待に身を震わせ
							PRINTFORM 蕩け切った表情で、
						ENDIF
						PRINTFORM その場に手を付いて四つん這いになり、
						SIF TEQUIP:PLAYER:スカートたくし上げ
							PRINTFORM スカートを捲り上げて
						;ズボン履いてる場合は摺り下ろす
						SIF TEQUIP:PLAYER:股間構造 & 1
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%を摺り下ろして
						PRINTFORM %CALLNAME:交渉対象()%に
						IF TEQUIP:PLAYER:Ｖずらし可 && CFLAG:PLAYER:ダンジョン内発情用欲情値 >= 6000
							;四つんばい・パンツずらし
							PRINTFORM 尻を
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 高く突き出すように
							PRINTFORM 向け、ずらした%CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%の下から覗く
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを指で広げて見せ、
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を指で広げて見せ、
							ENDIF
						ELSEIF TEQUIP:PLAYER:股間構造 & 2
							;四つんばい・ビキニ構造
							PRINTFORM %CLOTHESNAMEF(PLAYER,TEQUIP:PLAYER:陰唇露出)%に包まれた尻を
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 高く突き出すように
							PRINTFORML 向けると、
						ELSE
							;四つんばい・ボトムレスorノーパンorズボンはいてる(摺り下ろしずみ)
							PRINTFORM 隠す物など何も無い
							IF TALENT:PLAYER:男の娘
								PRINTFORML 窄まりを
							ELSE
								PRINTFORML \@ TALENT:PLAYER:小人体型 ? 割れ目 # 秘唇\@を
							ENDIF
							SIF ((TALENT:PLAYER:淫乱 || TALENT:PLAYER:娼婦) && TALENT:PLAYER:ＮＴＲ == 0 )
								PRINTFORM 高く突き出すように
							PRINTFORML 向けると、
						ENDIF
						PRINTFORMW %CALLNAME:交渉対象()%に犯して欲しいとおねだりをした……
					ENDIF
				ELSE
				;PLAYERがオトコかつ男の娘でない
					
				ENDIF
ENDSELECT


;==========================================================
;@仲魔会話_お任せ
; 仲魔に会話を任せたときの処理
;<引数>
;	ARG    = 相手悪魔
;	PLAYER = 会話担当キャラ
;<戻り値>
;	1.仲魔になる 2.何か貰う 3.奇襲 4.激怒 5.逃走 6.犯してもらう
;==========================================================
@仲魔会話_お任せ, ARG
#DIM 会話成功率
#DIM 犯してもらう選択確率

犯してもらう選択確率 = 0
;一応口上の呼び出しも置いてみたけれど、口上の作業量的にきついかも
;ない方が良いと判断して無効化
;味方会話担当個人口上チェック
TRYCCALLFORM AUTO_K_PARTY{NO:PLAYER},ARG
CATCH
	;相手悪魔個人口上チェック
	TRYCCALLFORM AUTO_K{NO:ARG},ARG
	;相手悪魔汎用口上チェック
	CATCH
		TRYCCALLFORM AUTO_PUB{ABL:ARG:会話タイプ}, ARG
			;-1を返された場合（口上が書かれていない）は簡易計算
			SIF RESULT == -1
				CALL 仲魔会話_お任せ_簡易計算, ARG
		
		;ない場合は簡易式に
		CATCH
			;簡易計算
			CALL 仲魔会話_お任せ_簡易計算, ARG
			会話成功率 = RESULT
		ENDCATCH
	ENDCATCH
ENDCATCH

PRINTFORMW 交渉の結果が出るようだ……
PRINTFORML 

;結果
;成功
;成功の場合は魔貨・アイテム・仲魔が手に入る
;会話担当が『浮気癖』『淫ＮＴＲ』もしくは発情している場合は性交渉を望む事もある
IF RAND:100 < 会話成功率

	;ムフフがオンで会話担当が『浮気癖』『淫ＮＴＲ』もしくは発情している場合は性交渉も選択肢に入る
	;仲魔は少しだけ確率を落とす
	IF FLAG:ムフフ展開 == 1 && (TALENT:PLAYER:ＮＴＲ == 2 || TALENT:PLAYER:浮気癖 || CFLAG:PLAYER:ダンジョン内発情用欲情値 > 5000 || 危険日(PLAYER) == 2)
		;確率計算
		;淫ＮＴＲは+2
		SIF TALENT:PLAYER:ＮＴＲ == 2
			犯してもらう選択確率 += 2

		;浮気癖は+1
		SIF TALENT:PLAYER:浮気癖
			犯してもらう選択確率 += 1

		;ダンジョン内発情用欲情値が5000より大きい場合は+1
		SIF CFLAG:PLAYER:ダンジョン内発情用欲情値 > 5000
			犯してもらう選択確率 += 1

		;発情している場合は+2
		SIF 危険日(PLAYER) == 2
			犯してもらう選択確率 += 2
		
		SELECTCASE RAND:(4+犯してもらう選択確率)
			;仲魔
			CASE 0
				PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:ARG%に仲魔への勧誘を行い、成功した
				PRINTFORML 
				RETURN 1
			;何か貰う
			CASE 1 TO 3
				PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:ARG%に物品を要求し、それに成功した
				PRINTFORML 
				RETURN 2
			;犯してもらう
			CASEELSE
				;犯してもらえない場合は何か貰う
				IF 仮_犯してくれるか？(ARG,PLAYER) == 0
					PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:ARG%に物品を要求し、それに成功した
					PRINTFORML 
					RETURN 2
				
				;犯してもらえる場合
				ELSEIF 仮_犯してくれるか？(ARG,PLAYER)
					PRINTFORMW なんと%CALLNAME:PLAYER%は%CALLNAME:ARG%に自分を犯すよう頼んでいた！
					PRINTFORML 
					CALL KOJO_TALK,ARG,9
					RETURN 6
				ENDIF
				
				
				
		ENDSELECT

	;ムフフがオフ、若しくは上の条件に当てはまらない場合は魔貨・アイテム・仲魔のみ
	;仲魔は少しだけ確率を落とす
	ELSE
		SELECTCASE RAND:4
			;仲魔
			CASE 0
				PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:ARG%に仲魔への勧誘を行い、成功した
				PRINTFORML 
				RETURN 1
			;何か貰う
			CASEELSE
				PRINTFORMW %CALLNAME:PLAYER%は%CALLNAME:ARG%に物品を要求し、それに成功した
				PRINTFORML 
				RETURN 2
		ENDSELECT
	ENDIF
	
	
	

	

;失敗
ELSE
	PRINTFORMW %CALLNAME:PLAYER% negotiation attempt failed!
	;%CALLNAME:PLAYER%は交渉に失敗した！
	PRINTFORML 
	;とりあえず失敗結果はランダムで
	SELECTCASE RAND:3
		;奇襲
		CASE 0
			RETURN 3
		;激怒
		CASE 1
			RETURN 4
		;逃走
		CASE 2
			RETURN 5
	ENDSELECT
ENDIF


;==========================================================
;@仲魔会話_お任せ_簡易計算
; 口上がないときの簡易計算
;<引数>
;	ARG    = 相手悪魔
;	PLAYER = 会話担当キャラ
;<戻り値>
;	RESULT = 会話成功率
;==========================================================
@仲魔会話_お任せ_簡易計算, ARG
#DIM 会話成功率
#DIM 会話成功率計算用
#DIM 性交渉発生率
#DIM 性交渉発生フラグ
#DIM 性行為の回数

会話成功率 = 60
性交渉発生率 = 0
性交渉発生フラグ = 0

;ムフフがオンで異性を要求する場合は性交渉のフラグを立てる
SIF FLAG:ムフフ展開 == 1 && 仮_異性を要求するか？(ARG) > 0
	性交渉発生フラグ = 1

;性格の相性による基本値設定
;相手が臆病
IF TALENT:ARG:臆病
	SIF TALENT:PLAYER:大人しい
		会話成功率 += 5

	SIF TALENT:PLAYER:プライド高い || TALENT:PLAYER:生意気
		会話成功率 -= 5
ENDIF

;相手が反抗的
IF TALENT:ARG:反抗的
	SIF TALENT:PLAYER:プライド高い || TALENT:PLAYER:生意気 || TALENT:PLAYER:反抗的 || TALENT:PLAYER:ツンデレ
		会話成功率 -= 5
ENDIF

;相手が気丈
IF TALENT:ARG:気丈
	SIF TALENT:PLAYER:素直 || TALENT:PLAYER:大人しい || TALENT:PLAYER:臆病 || TALENT:PLAYER:気丈
		会話成功率 += 5
ENDIF

;相手が素直
IF TALENT:ARG:素直
	会話成功率 += 5
ENDIF

;相手が大人しい
IF TALENT:ARG:大人しい
	SIF TALENT:PLAYER:素直 || TALENT:PLAYER:大人しい || TALENT:PLAYER:臆病 || TALENT:PLAYER:気丈
		会話成功率 += 5

	SIF TALENT:PLAYER:プライド高い || TALENT:PLAYER:生意気 || TALENT:PLAYER:反抗的 || TALENT:PLAYER:ツンデレ
		会話成功率 -= 5
ENDIF

;相手がプライド高い
IF TALENT:ARG:プライド高い
	SIF TALENT:PLAYER:素直 || TALENT:PLAYER:大人しい || TALENT:PLAYER:気丈
		会話成功率 += 5

	SIF TALENT:PLAYER:プライド高い || TALENT:PLAYER:生意気 || TALENT:PLAYER:反抗的 || TALENT:PLAYER:ツンデレ || TALENT:PLAYER:臆病 || TALENT:PLAYER:プライド低い
		会話成功率 -= 10
ENDIF

;相手が生意気
IF TALENT:ARG:生意気
	SIF TALENT:PLAYER:素直 || TALENT:PLAYER:大人しい || TALENT:PLAYER:臆病
		会話成功率 += 5

	SIF TALENT:PLAYER:プライド高い || TALENT:PLAYER:生意気 || TALENT:PLAYER:反抗的 || TALENT:PLAYER:ツンデレ || TALENT:PLAYER:気丈 || TALENT:PLAYER:プライド低い
		会話成功率 -= 5
ENDIF

;相手がプライド低い
IF TALENT:ARG:プライド低い
	SIF TALENT:PLAYER:プライド高い
		会話成功率 += 10

ENDIF

;相手がツンデレ
IF TALENT:ARG:ツンデレ
	SIF TALENT:PLAYER:素直 || TALENT:PLAYER:気丈
		会話成功率 += 5

	SIF TALENT:PLAYER:プライド高い || TALENT:PLAYER:生意気 || TALENT:PLAYER:反抗的 || TALENT:PLAYER:ツンデレ || TALENT:PLAYER:気丈 || TALENT:PLAYER:プライド低い || TALENT:PLAYER:臆病
		会話成功率 -= 5
ENDIF


;交渉の種類：通常・キス要求・口奉仕要求（生えてるのならフェラ・ないならクンニ）・性交渉要求
;通常以外の確率は低くし、ムフフがオフの場合は発生しない

;性交渉発生の確率計算と相手がこちらを性的対象としてみるかどうかの判定
IF 性交渉発生フラグ == 1
	性交渉発生率 = 仮_異性を要求するか？(ARG)

	;乳房・臀部が露出していると確率上昇
	SIF TEQUIP:PLAYER:乳房露出 == -1 || TEQUIP:PLAYER:臀部露出 == -1
		性交渉発生率 += 1

	;乳首が露出していると確率上昇
	SIF TEQUIP:PLAYER:乳首露出 == -1
		性交渉発生率 += 1

	;陰唇が露出していると確率上昇
	SIF TEQUIP:PLAYER:陰唇露出 == -1
		性交渉発生率 += 1

	;それぞれの箇所に精液の汚れが付いている場合は確率上昇
	SIF GET_STAIN("ヴァギナ" , "精液" , PLAYER) ||GET_STAIN("口" , "精液" , PLAYER) || GET_STAIN("手" , "精液" , PLAYER) || GET_STAIN("胸" , "精液" , PLAYER) || GET_STAIN("髪" , "精液" , PLAYER)
		性交渉発生率 += 1

	;背徳の指輪を装備している場合は確率がかなり上がる
	SIF (TEQUIP:PLAYER:その他 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他2 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他3 == [[アイテム:背徳の指輪]])
		性交渉発生率 += 5

	;ハイレグアーマーを装備している場合は確率上昇、えろいから仕方ないね
	SIF EQUIP:PLAYER:胴 == [[アイテム:High-Cut Leotard]]
		性交渉発生率 += 1

	;Whore Clothesを装備している場合は確率上昇
	SIF EQUIP:PLAYER:胴 == [[アイテム:Whore Clothes]]
		性交渉発生率 += 2

	;ここで性の対象になるかを判定、ならない場合は性交渉はおこらない
	IF TALENT:ARG:オトコ
		;ＢＬっ気１以上じゃないと男の娘以外のオトコには起たない
		SIF ABL:ARG:ＢＬっ気 == 0 && (TALENT:PLAYER:オトコ && TALENT:PLAYER:男の娘 == 0)
			性交渉発生フラグ = 0
	ELSE
		;レズっ気１以上じゃないと女には起たない
		SIF (ABL:ARG:レズっ気 == 0 && (TALENT:PLAYER:オトコ == 0)) && TALENT:ARG:ふたなり == 0
			性交渉発生フラグ = 0
	ENDIF
	;回数計算：１〜３回+欲望の数値
	性行為の回数 = 1 + RAND:2 + ABL:ARG:欲望
ENDIF

;会話開始
FOR LOCAL, 0, 2
	SIF LOCAL == 1
		PRINTFORM Again 
	PRINTFORMW %CALLNAME:PLAYER% negotiates with %CALLNAME:ARG%...
	PRINTFORML 
	PRINTFORMW ・・・
	PRINTFORML 
	PRINTFORMW ・・
	PRINTFORML 
	PRINTFORMW ・
	PRINTFORML 
	
	;性交渉を要求する確率は20％〜
	IF 性交渉発生フラグ == 1 && RAND:(10+性交渉発生率) > 7
		SELECTCASE RAND:10
			;キス要求
			CASE 0 TO 4
				PRINTFORMW %CALLNAME:ARG%が%CALLNAME:PLAYER%にキスを要求してきた
				PRINTFORML 
				PRINTFORMW ・・・
				PRINTFORML 
				PRINTFORMW ・・
				PRINTFORML 
				PRINTFORMW ・
				PRINTFORML 
				
				;要求に応じてキスをする
				;特に対応した経験もないのでレズ・ＢＬEXPだけ判定する
				;淫ＮＴＲ・発情中・背徳の指輪装備中の場合は無条件で応じる
				IF TALENT:PLAYER:ＮＴＲ == 2 || CFLAG:PLAYER:ダンジョン内発情用欲情値 > 5000 || 危険日(PLAYER) == 2 || (TEQUIP:PLAYER:その他 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他2 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他3 == [[アイテム:背徳の指輪]])
					PRINTFORMW %CALLNAME:ARG%は要求に応じ、%CALLNAME:PLAYER%とキスを交わしている……
					会話成功率計算用 += 20
					性行為の回数 = 1 + RAND:2
					TCVAR:PLAYER:獲得キス経験 = 会話成功率計算用
					;レズ・ＢＬEXP計算
					IF IS_LESBIAN(ARG,PLAYER)
						CALL ADDS_EXP("レズ経験", 性行為の回数, ARG)
						CALL ADDS_EXP("レズ経験", 性行為の回数, PLAYER)
					ELSEIF IS_GAY(ARG,PLAYER)
						CALL ADDS_EXP("ＢＬ経験", 性行為の回数, ARG)
						CALL ADDS_EXP("ＢＬ経験", 性行為の回数, PLAYER)
					ENDIF
					;陥落している場合はCheatingEXPが付く
					IF 陥落(PLAYER)
						CALL ADDS_EXP("浮気経験", 1, PLAYER)
					ENDIF
					CALL SHOW_ADD_EXP, PLAYER
					;次の確率が上がる
					性交渉発生率 += 1

				;浮気癖の場合は３０％の確率で応じる
				ELSEIF TALENT:PLAYER:浮気癖
					PRINTFORMW %CALLNAME:ARG%は突きつけられた要求に迷っている
					
					IF RAND:10 < 3
						PRINTFORMW %CALLNAME:ARG%はしかたなく要求に応じ、%CALLNAME:PLAYER%とキスを交わしている……
						PRINTFORMW %CALLNAME:PLAYER%は嫌々しているとは思えないほどに熱の篭った口付けを交わしている……
						会話成功率計算用 += 20
						性行為の回数 = 会話成功率計算用
						TCVAR:PLAYER:獲得キス経験 = 1 + RAND:2
						;レズ・ＢＬEXP計算
						IF IS_LESBIAN(ARG,PLAYER)
							CALL ADDS_EXP("レズ経験", 性行為の回数, ARG)
							CALL ADDS_EXP("レズ経験", 性行為の回数, PLAYER)
						ELSEIF IS_GAY(ARG,PLAYER)
							CALL ADDS_EXP("ＢＬ経験", 性行為の回数, ARG)
							CALL ADDS_EXP("ＢＬ経験", 性行為の回数, PLAYER)
						ENDIF
						;陥落している場合はCheatingEXPが付く
						IF 陥落(PLAYER)
							CALL ADDS_EXP("浮気経験", 1, PLAYER)
						ENDIF
						CALL SHOW_ADD_EXP, PLAYER
						;次の確率が上がる
						性交渉発生率 += 1
					
					;拒否した場合はランダムで会話成功率が変化
					ELSE
						PRINTFORMW %CALLNAME:PLAYER% rejected %CALLNAME:ARG%'s request
						IF RAND:2 == 0
							会話成功率計算用 -= 10
						ELSE
							会話成功率計算用 = 0
						ENDIF
					ENDIF
				
				;その他:拒否
				ELSE
					PRINTFORMW %CALLNAME:PLAYER% rejected %CALLNAME:ARG%'s request
					IF RAND:2 == 0
						会話成功率計算用 -= 10
					ELSE
						会話成功率計算用 = 0
					ENDIF
				ENDIF
				PRINTFORML 
				
			;口奉仕要求
			CASE 5 TO 7
				PRINTFORMW %CALLNAME:ARG%が%CALLNAME:PLAYER%に口奉仕を要求してきた
				PRINTFORML 
				PRINTFORMW ・・・
				PRINTFORML 
				PRINTFORMW ・・
				PRINTFORML 
				PRINTFORMW ・
				PRINTFORML 
				
				;要求に応じて口奉仕をする
				;淫ＮＴＲ・発情中・背徳の指輪装備中の場合は無条件で応じる
				IF TALENT:PLAYER:ＮＴＲ == 2 || CFLAG:PLAYER:ダンジョン内発情用欲情値 > 5000 || 危険日(PLAYER) == 2 || (TEQUIP:PLAYER:その他 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他2 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他3 == [[アイテム:背徳の指輪]])
					;ペニスがある場合はフェラ
					IF HAVE_PENIS(ARG)
						PRINTFORMW %CALLNAME:PLAYER%は要求に応じ、%CALLNAME:ARG%のペニスを咥えている……
						TCVAR:PLAYER:獲得フェラ経験 = 性行為の回数
						TCVAR:PLAYER:獲得精液経験 = 性行為の回数

					;ない場合はクンニ
					ELSE
						PRINTFORMW %CALLNAME:PLAYER%は要求に応じ、%CALLNAME:ARG%のヴァギナに舌を這わせている……
					
					ENDIF
					会話成功率計算用 += 30
					;レズ・ＢＬEXP計算
					IF IS_LESBIAN(ARG,PLAYER)
						CALL ADDS_EXP("レズ経験", 性行為の回数, ARG)
						CALL ADDS_EXP("レズ経験", 性行為の回数, PLAYER)
					ELSEIF IS_GAY(ARG,PLAYER)
						CALL ADDS_EXP("ＢＬ経験", 性行為の回数, ARG)
						CALL ADDS_EXP("ＢＬ経験", 性行為の回数, PLAYER)
					ENDIF
					;陥落している場合はCheatingEXPが付く
					IF 陥落(PLAYER)
						CALL ADDS_EXP("浮気経験", 1, PLAYER)
					ENDIF
					CALL SHOW_ADD_EXP, PLAYER
					;次の確率が上がる
					性交渉発生率 += 1

				;浮気癖の場合は３０％の確率で応じる
				ELSEIF TALENT:PLAYER:浮気癖
					PRINTFORMW %CALLNAME:ARG%は突きつけられた要求に迷っている
					
					IF RAND:10 < 3
						;ペニスがある場合はフェラ
						IF HAVE_PENIS(ARG)
							PRINTFORMW %CALLNAME:PLAYER%はしかたなく要求に応じ、%CALLNAME:ARG%のペニスを咥えた……
							PRINTFORMW %CALLNAME:PLAYER%の舌使いは嫌々しているとは思えないほどに熱が入っている……
							TCVAR:PLAYER:獲得フェラ経験 = 性行為の回数
							TCVAR:PLAYER:獲得精液経験 = 性行為の回数

						;ない場合はクンニ
						ELSE
							PRINTFORMW %CALLNAME:PLAYER%はしかたなく要求に応じ、%CALLNAME:ARG%のヴァギナに舌を這わせた……
							PRINTFORMW %CALLNAME:PLAYER%の舌使いは嫌々しているとは思えないほどに熱が入っている……
						
						ENDIF
						会話成功率計算用 += 20
						性行為の回数 = 1 + RAND:2
						;レズ・ＢＬEXP計算
						IF IS_LESBIAN(ARG,PLAYER)
							CALL ADDS_EXP("レズ経験", 性行為の回数, ARG)
							CALL ADDS_EXP("レズ経験", 性行為の回数, PLAYER)
						ELSEIF IS_GAY(ARG,PLAYER)
							CALL ADDS_EXP("ＢＬ経験", 性行為の回数, ARG)
							CALL ADDS_EXP("ＢＬ経験", 性行為の回数, PLAYER)
						ENDIF
						;陥落している場合はCheatingEXPが付く
						IF 陥落(PLAYER)
							CALL ADDS_EXP("浮気経験", 1, PLAYER)
						ENDIF
						CALL SHOW_ADD_EXP, PLAYER
						;次の確率が上がる
						性交渉発生率 += 1
					
					;拒否した場合はランダムで会話成功率が変化
					ELSE
						PRINTFORMW %CALLNAME:PLAYER% rejected %CALLNAME:ARG%'s request
						IF RAND:2 == 0
							会話成功率計算用 -= 10
						ELSE
							会話成功率計算用 = 0
						ENDIF
					ENDIF
				
				;その他:拒否
				ELSE
					PRINTFORMW %CALLNAME:PLAYER% rejected %CALLNAME:ARG%'s request
					;%CALLNAME:PLAYER%は%CALLNAME:ARG%の要求を拒否した
					IF RAND:2 == 0
						会話成功率計算用 -= 10
					ELSE
						会話成功率計算用 = 0
					ENDIF
				ENDIF
				PRINTFORML 
				
				
			;本番要求
			CASE IS > 7
				PRINTFORMW %CALLNAME:ARG% demanded to have sex with %CALLNAME:PLAYER%
				PRINTFORML 
				PRINTFORMW ・・・
				PRINTFORML 
				PRINTFORMW ・・
				PRINTFORML 
				PRINTFORMW ・
				PRINTFORML 
				
				;要求に応じて性交渉をする
				;淫ＮＴＲ・発情中・背徳の指輪装備中の場合は無条件で応じる
				IF TALENT:PLAYER:ＮＴＲ == 2 || CFLAG:PLAYER:ダンジョン内発情用欲情値 > 5000 || 危険日(PLAYER) == 2 || (TEQUIP:PLAYER:その他 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他2 == [[アイテム:背徳の指輪]] || TEQUIP:PLAYER:その他3 == [[アイテム:背徳の指輪]])
					PRINTFORMW %CALLNAME:PLAYER% was embraced by %CALLNAME:ARG%、in accordance with the request……
					CALL SEXIAL_NEGOCIATE, ARG, PLAYER
					会話成功率計算用 += 40
					;次の確率が上がる
					性交渉発生率 += 1

				;浮気癖の場合は３０％の確率で応じる
				ELSEIF TALENT:PLAYER:浮気癖
					PRINTFORMW %CALLNAME:ARG% is tempted by the demand
					
					IF RAND:10 < 3
						PRINTFORMW %CALLNAME:PLAYER% was unwillingly embraced by %CALLNAME:ARG%、in accordance with the request……
						PRINTFORMW %CALLNAME:PLAYER% is disturbed while being embraced unwillingly……
						CALL SEXIAL_NEGOCIATE, ARG, PLAYER
						会話成功率計算用 += 40
						;次の確率が上がる
						性交渉発生率 += 1
					
					;拒否した場合はランダムで会話成功率が変化
					ELSE
						PRINTFORMW %CALLNAME:PLAYER% rejected %CALLNAME:ARG%'s request
						IF RAND:2 == 0
							会話成功率計算用 -= 10
						ELSE
							会話成功率計算用 = 0
						ENDIF
					ENDIF
				
				;その他:拒否
				ELSE
					PRINTFORMW %CALLNAME:PLAYER% rejected %CALLNAME:ARG%'s request
					IF RAND:2 == 0
						会話成功率計算用 -= 10
					ELSE
						会話成功率計算用 = 0
					ENDIF
				ENDIF
				PRINTFORML 
				
		ENDSELECT
		
		
		
		
	;通常の交渉
	ELSE
		;とりあえず５０％
		IF RAND:2 == 0
			会話成功率計算用 += 10
			
		ELSE
			会話成功率計算用 -= 10
			
		ENDIF
	
	ENDIF
	
	;印象の地の文表示
	;会話成功率計算用が＋なら好感、‐なら不満の地の文を表示
	IF 会話成功率計算用 > 0
		PRINTFORMW They seem to have a good impression
		
	ELSEIF 会話成功率計算用 < 0
		PRINTFORMW They seem dissatisfied
	
	ELSE
		PRINTFORMW Their impression did not change
	
	ENDIF
	会話成功率 += 会話成功率計算用
	
	PRINTFORML 
NEXT

RETURN 会話成功率














