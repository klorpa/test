;=======================================================================
;御茶ノ水シェルター
;=======================================================================
;ダンジョンフラグ:38:1 突入フラグ
;=======================================================================
;攻略条件
;=======================================================================

@PREREQUISITE_DUNGEON_38
SIF イベントフラグ:70:1 != 1
	RETURN 0
RETURN 1

;=======================================================================
;ダンジョン名
;=======================================================================
@GET_DUNGEON_NAME_38
RESULTS = 御茶ノ水シェルター

;=======================================================================
;フロア名表示
;=======================================================================
@FLOORNAME_38
PRINT 御茶ノ水シェルター
SELECTCASE FLAG:現M
	CASE 0
		PRINTL   １Ｆ
	CASE 1
		PRINTL   Ｂ１Ｆ
	CASE 2
		PRINTL   Ｂ２Ｆ
	CASE 3
		PRINTL   Ｂ３Ｆ
	CASE 4
		PRINTL   Ｂ４Ｆ
	CASE 5
		PRINTL   Ｂ５Ｆ
	CASE 6
		PRINTL   Ｂ６Ｆ
	CASE 7
		PRINTL   Ｂ７Ｆ
	CASE 8
		PRINTL   Ｂ８Ｆ
	CASE 9
		PRINTL   Ｂ９Ｆ
	CASE 10
		PRINTL   Ｂ１０Ｆ
	CASEELSE
		PRINTL
ENDSELECT


;=======================================================================
;特殊タイル表示
;=======================================================================

@TILE_MARK_38_0_4_7
RESULTS = Ｅ


@TILE_MARK_38_4_5_3
RESULTS = □


@TILE_MARK_38_5_3_3
RESULTS = Ｅ


@TILE_MARK_38_7_12_1
RESULTS = Ｅ

;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_38,ARG
FLAG:現M = 0
FLAG:現X = 4
FLAG:現Y = 1
;CALL AUTOMAP

;=======================================================================
;攻略開始時のイベント
;=======================================================================
@EVENT_DUNGEON_START_38
IF ダンジョンフラグ:38:1 == 0
	CALL MESSAGE_WINDOW_D, "", "＞" + CALLNAME:MASTER + "はファニエルとシェルターを救うため/＞御茶ノ水シェルターへとやってきた…"
	CALL MESSAGE_WINDOW_D, "", "＞やってきて分かったが、ここはすさまじく熱い/＞加えて彼方此方で炎が燃え盛っているようで、既に出口も失われた/＞少々のダメージは覚悟するべきか…"
	CALL MESSAGE_WINDOW_D, "ファニエル", "貴方を待っていました、人の子よ/わが名はファニエル、大天使が一です"
	CALL MESSAGE_WINDOW_D, "ファニエル", "私は地下の９階に籠ったシェルターの住民たちを守っています/貴方に倒していただきたい悪魔、アイムはその扉を破ろうとしているのです/どうかその悪魔を葬ってください"
	ダンジョンフラグ:38:1 = 1
ENDIF

;=======================================================================
;脱出時のイベント
;=======================================================================
@EVENT_DUNGEON_END_38
CALL MESSAGE_WINDOW_D, "", "＞ファニエルから協力報酬150000円を手に入れた/＞また、名声を200手に入れた"
MONEY += 150000
FLAG:名声 += 200
イベントフラグ:70:2 = 2

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_38,ARG,ARG:1

CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

;=======================================================================
;フロアデータ
;=======================================================================
@MAKE_FLOOR_38
SELECTCASE FLAG:現M
	CASE 0
	;１階
		FLAG:最大X = 12
		FLAG:最大Y = 12
					;012345678
		CALL MAKE_FLOOR_LINE, 0,"         "
		CALL MAKE_FLOOR_LINE, 1,"   111   "
		CALL MAKE_FLOOR_LINE, 2,"    2    "
		CALL MAKE_FLOOR_LINE, 3,"    1    "
		CALL MAKE_FLOOR_LINE, 4,"  11111  "
		CALL MAKE_FLOOR_LINE, 5,"  111 1  "
		CALL MAKE_FLOOR_LINE, 6,"  2 5    "
		CALL MAKE_FLOOR_LINE, 7,"  1 9    "
		CALL MAKE_FLOOR_LINE, 8,"  1      "
		CALL MAKE_FLOOR_LINE, 9,"  15117  "
		CALL MAKE_FLOOR_LINE,10,"         "
							    ;012345678


	CASE 1
	;地下１階
		FLAG:最大X = 7
		FLAG:最大Y = 7
							   ;0123456
		CALL MAKE_FLOOR_LINE,0,"       "
		CALL MAKE_FLOOR_LINE,1," 11111 "
		CALL MAKE_FLOOR_LINE,2," 11 11 "
		CALL MAKE_FLOOR_LINE,3," 11511 "
		CALL MAKE_FLOOR_LINE,4," 1   1 "
		CALL MAKE_FLOOR_LINE,5," 7   6 "
		CALL MAKE_FLOOR_LINE,6,"       "

	CASE 2
	;地下２階
		FLAG:最大X = 7
		FLAG:最大Y = 7
		CALL MAKE_FLOOR_LINE,0,"       "
		CALL MAKE_FLOOR_LINE,1," 51111 "
		CALL MAKE_FLOOR_LINE,2," 1 511 "
		CALL MAKE_FLOOR_LINE,3," 1  11 "
		CALL MAKE_FLOOR_LINE,4," 1   1 "
		CALL MAKE_FLOOR_LINE,5," 7   6 "
		CALL MAKE_FLOOR_LINE,6,"       "

	CASE 3
	;地下３階
		FLAG:最大X = 7
		FLAG:最大Y = 7
							   ;0123456
		CALL MAKE_FLOOR_LINE,0,"       "
		CALL MAKE_FLOOR_LINE,1," 11511 "
		CALL MAKE_FLOOR_LINE,2," 11111 "
		CALL MAKE_FLOOR_LINE,3," 11  1 "
		CALL MAKE_FLOOR_LINE,4," 1   1 "
		CALL MAKE_FLOOR_LINE,5," 7   6 "
		CALL MAKE_FLOOR_LINE,6,"       "


	CASE 4
	;地下４階
		FLAG:最大X = 7
		FLAG:最大Y = 7
		                       ;0123456
		CALL MAKE_FLOOR_LINE,0,"       "
		CALL MAKE_FLOOR_LINE,1," 11121 "
		CALL MAKE_FLOOR_LINE,2," 511 1 "
		CALL MAKE_FLOOR_LINE,3," 1   9 "
		CALL MAKE_FLOOR_LINE,4," 1   1 "
		CALL MAKE_FLOOR_LINE,5," 7   6 "
		CALL MAKE_FLOOR_LINE,6,"       "
	


	CASE 5
	;地下５階
		FLAG:最大X = 11
		FLAG:最大Y = 13
					 ;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"           "
		CALL MAKE_FLOOR_LINE, 1," 111112116 "
		CALL MAKE_FLOOR_LINE, 2," 1         "
		CALL MAKE_FLOOR_LINE, 3," 1 9       "
		CALL MAKE_FLOOR_LINE, 4," 5 2 1     "
		CALL MAKE_FLOOR_LINE, 5," 5 1211    "
		CALL MAKE_FLOOR_LINE, 6," 1 1       "
		CALL MAKE_FLOOR_LINE, 7," 1 1211    "
		CALL MAKE_FLOOR_LINE, 8," 1 1 11    "
		CALL MAKE_FLOOR_LINE, 9," 2 2       "
		CALL MAKE_FLOOR_LINE,10," 11111     "
		CALL MAKE_FLOOR_LINE,11," 1111127   "
		CALL MAKE_FLOOR_LINE,12,"           "

		;宝箱の設置
		CALL SET_TILE,5,4,ダンジョンフラグ:38:10,0,3
		

	CASE 6
	;地下６階
		FLAG:最大X = 14
		FLAG:最大Y = 10
					;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"              "
		CALL MAKE_FLOOR_LINE, 1,"     1 11     "
		CALL MAKE_FLOOR_LINE, 2,"     2  1     "
		CALL MAKE_FLOOR_LINE, 3,"     1  2     "
		CALL MAKE_FLOOR_LINE, 4," 111 1 1111   "
		CALL MAKE_FLOOR_LINE, 5," 111212511121 "
		CALL MAKE_FLOOR_LINE, 6," 111 1  111   "
		CALL MAKE_FLOOR_LINE, 7,"     1    1   "
		CALL MAKE_FLOOR_LINE, 8," 72115   611  "
		CALL MAKE_FLOOR_LINE, 9,"              "

		;宝箱の設置
		CALL SET_TILE,1,4,ダンジョンフラグ:38:11,0,3


	CASE 7
	;地下７階
		FLAG:最大X = 14
		FLAG:最大Y = 11
					;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"              "
		CALL MAKE_FLOOR_LINE, 1,"            9 "
		CALL MAKE_FLOOR_LINE, 2,"            2 "
		CALL MAKE_FLOOR_LINE, 3," 111111111151 "
		CALL MAKE_FLOOR_LINE, 4,"  1551  2 1 1 "
		CALL MAKE_FLOOR_LINE, 5,"121111 11 1 1 "
		CALL MAKE_FLOOR_LINE, 6,"  11   11 6 7 "
		CALL MAKE_FLOOR_LINE, 7,"121    2      "
		CALL MAKE_FLOOR_LINE, 8,"    151111111 "
		CALL MAKE_FLOOR_LINE, 9,"              "
		CALL MAKE_FLOOR_LINE,10,"              "

		;宝箱の設置
		CALL SET_TILE,0,5,ダンジョンフラグ:38:12,0,3

	CASE 8
	;地下８階
		FLAG:最大X = 14
		FLAG:最大Y = 13
							    ;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"              "
		CALL MAKE_FLOOR_LINE, 1," 1 1 1 1 1  9 "
		CALL MAKE_FLOOR_LINE, 2," 2 2 2 2 2  2 "
		CALL MAKE_FLOOR_LINE, 3," 111111111111 "
		CALL MAKE_FLOOR_LINE, 4,"  1  1  2 1 1 "
		CALL MAKE_FLOOR_LINE, 5,"121111 11 1 5 "
		CALL MAKE_FLOOR_LINE, 6,"  1    11 6 7 "
		CALL MAKE_FLOOR_LINE, 7,"121 1  2      "
		CALL MAKE_FLOOR_LINE, 8,"  1 2  1    1 "
		CALL MAKE_FLOOR_LINE, 9,"  1 1  1    2 "
		CALL MAKE_FLOOR_LINE,10,"  2 1 5551111 "
		CALL MAKE_FLOOR_LINE,11,"  111 1 1 1 1 "
		CALL MAKE_FLOOR_LINE,12,"              "


	CASE 9
	;地下９階
		FLAG:最大X = 13
		FLAG:最大Y = 13
							    ;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"             "
		CALL MAKE_FLOOR_LINE, 1,"      1      "
		CALL MAKE_FLOOR_LINE, 2,"      2      "
		CALL MAKE_FLOOR_LINE, 3,"   7111      "
		CALL MAKE_FLOOR_LINE, 4,"      121    "
		CALL MAKE_FLOOR_LINE, 5,"    111 2    "
		CALL MAKE_FLOOR_LINE, 6,"      1 1    "
		CALL MAKE_FLOOR_LINE, 7,"    611   11 "
		CALL MAKE_FLOOR_LINE, 8," 11   1  111 "
		CALL MAKE_FLOOR_LINE, 9," 11 12421111 "
		CALL MAKE_FLOOR_LINE,10,"  2   1   11 "
		CALL MAKE_FLOOR_LINE,11," 111111   11 "
		CALL MAKE_FLOOR_LINE,12,"             "


	CASE 10
	;地下１０階
		FLAG:最大X = 13
		FLAG:最大Y = 13
		
		
					;0123456789012
		CALL MAKE_FLOOR_LINE, 0,"             "
		CALL MAKE_FLOOR_LINE, 1," 111 11  1   "
		CALL MAKE_FLOOR_LINE, 2," 111 11  2   "
		CALL MAKE_FLOOR_LINE, 3,"  2  2   1   "
		CALL MAKE_FLOOR_LINE, 4," 55555   121 "
		CALL MAKE_FLOOR_LINE, 5,"   55526 1   "
		CALL MAKE_FLOOR_LINE, 6," 12555   121 "
		CALL MAKE_FLOOR_LINE, 7,"   1     1   "
		CALL MAKE_FLOOR_LINE, 8,"   155551121 "
		CALL MAKE_FLOOR_LINE, 9," 121  2  2   "
		CALL MAKE_FLOOR_LINE,10,"   1 11 11   "
		CALL MAKE_FLOOR_LINE,11," 121 11 1121 "
		CALL MAKE_FLOOR_LINE,12,"             "

		;宝箱の設置
		CALL SET_TILE,9,1,ダンジョンフラグ:38:13,0,3
	CASEELSE

ENDSELECT

;=======================================================================
;[5]調べる　実行時のイベント
;=======================================================================
@EVENT_CHECK_DUNGEON_38

;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
;% 10は10で割ったあまり、つまり下一桁がでてきます
;そして、下一桁はタイルの種類を表す
	SELECTCASE FLAG:現M
	CASE 0
	CASE 1
	CASE 2
	CASE 3
	CASE 4
	CASE 5
		CALL GET_TREASURE, 5514 , 10 , FLAG:現ダンジョン, LOCAL , 10
		ダンジョンフラグ:38:10 = 1
	CASE 6
		CALL GET_TREASURE, 1031 , 3 , FLAG:現ダンジョン, LOCAL , 11
		ダンジョンフラグ:38:11 = 1
	CASE 7
		CALL GET_TREASURE, 1002 , 2 , FLAG:現ダンジョン, LOCAL , 12
		ダンジョンフラグ:38:12 = 1		
	CASE 8
		
	CASE 9
		
	CASE 10
		CALL GET_TREASURE, 277 , 1 , FLAG:現ダンジョン, LOCAL , 13
		ダンジョンフラグ:38:13 = 1		
	CASEELSE
ENDSELECT
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
SELECTCASE FLAG:現M
	CASE 0
	CASE 1
		CALL DUNGEON_UPSTAIRS,0,5,9
	CASE 2
		CALL DUNGEON_UPSTAIRS,1,1,4
	CASE 3
		CALL DUNGEON_UPSTAIRS,2,1,4
	CASE 4
		CALL DUNGEON_UPSTAIRS,3,1,4
	CASE 5
		CALL DUNGEON_UPSTAIRS,4,1,4
	CASE 6
		CALL DUNGEON_UPSTAIRS,5,7,11
	CASE 7
		CALL DUNGEON_UPSTAIRS,6,3,8
	CASE 8
		CALL DUNGEON_UPSTAIRS,7,12,5
	CASE 9
		CALL DUNGEON_UPSTAIRS,8,12,6
	CASE 10
		CALL DUNGEON_UPSTAIRS,9,4,3
	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
SELECTCASE FLAG:現M
	CASE 0
		CALL DUNGEON_DOWNSTAIRS,1,5,4
	CASE 1
		CALL DUNGEON_DOWNSTAIRS,2,5,4
	CASE 2
		CALL DUNGEON_DOWNSTAIRS,3,5,4
	CASE 3
		CALL DUNGEON_DOWNSTAIRS,4,5,4
	CASE 4
		CALL DUNGEON_DOWNSTAIRS,5,9,1
	CASE 5
		CALL DUNGEON_DOWNSTAIRS,6,10,8
	CASE 6
		CALL DUNGEON_DOWNSTAIRS,7,10,5
	CASE 7
		CALL DUNGEON_DOWNSTAIRS,8,10,5
	CASE 8
		CALL DUNGEON_DOWNSTAIRS,9,5,7
	CASE 9
		CALL DUNGEON_DOWNSTAIRS,10,6,5
	CASEELSE
ENDSELECT
RETURN 1
;========
;イベント
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4

ELSE
	CALL MESSAGE_WINDOW_D, "", "＞Nothing seems to be here."
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時のイベント
;=======================================================================
@EVENT_ENTER_DUNGEON_38,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) % 10 == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	SELECTCASE FLAG:現M
	CASE 0
	CASE 1
	CASE 2
	CASE 3
	CASE 4
	CASE 5
		CALL GET_TREASURE, 5514 , 10 , FLAG:現ダンジョン, LOCAL , 10
		ダンジョンフラグ:38:10 = 1
	CASE 6
		CALL GET_TREASURE, 1031 , 3 , FLAG:現ダンジョン, LOCAL , 11
		ダンジョンフラグ:38:11 = 1
	CASE 7
		CALL GET_TREASURE, 1002 , 2 , FLAG:現ダンジョン, LOCAL , 12
		ダンジョンフラグ:38:12 = 1		
	CASE 8
		
	CASE 9
		
	CASE 10
		CALL GET_TREASURE, 277 , 1 , FLAG:現ダンジョン, LOCAL , 13
		ダンジョンフラグ:38:13 = 1		
	CASEELSE
ENDSELECT
	RETURN RESULT
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
SELECTCASE FLAG:現M
	CASE 0
	CASE 1
		CALL DUNGEON_UPSTAIRS,0,5,9
	CASE 2
		CALL DUNGEON_UPSTAIRS,1,1,4
	CASE 3
		CALL DUNGEON_UPSTAIRS,2,1,4
	CASE 4
		CALL DUNGEON_UPSTAIRS,3,1,4
	CASE 5
		CALL DUNGEON_UPSTAIRS,4,1,4
	CASE 6
		CALL DUNGEON_UPSTAIRS,5,7,11
	CASE 7
		CALL DUNGEON_UPSTAIRS,6,3,8
	CASE 8
		CALL DUNGEON_UPSTAIRS,7,12,5
	CASE 9
		CALL DUNGEON_UPSTAIRS,8,12,6
	CASE 10
		CALL DUNGEON_UPSTAIRS,9,4,3
	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
SELECTCASE FLAG:現M
	CASE 0
		CALL DUNGEON_DOWNSTAIRS,1,5,4
	CASE 1
		CALL DUNGEON_DOWNSTAIRS,2,5,4
	CASE 2
		CALL DUNGEON_DOWNSTAIRS,3,5,4
	CASE 3
		CALL DUNGEON_DOWNSTAIRS,4,5,4
	CASE 4
		CALL DUNGEON_DOWNSTAIRS,5,9,1
	CASE 5
		CALL DUNGEON_DOWNSTAIRS,6,10,8
	CASE 6
		CALL DUNGEON_DOWNSTAIRS,7,10,5
	CASE 7
		CALL DUNGEON_DOWNSTAIRS,8,10,5
	CASE 8
		CALL DUNGEON_DOWNSTAIRS,9,5,7
	CASE 9
		CALL DUNGEON_DOWNSTAIRS,10,6,5
	CASEELSE
ENDSELECT
RETURN 1

;========
;罠の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 5
	CALL DUNGEON_TRAP_HP,10
	RETURN 0
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1
;========================
;イベント
;========================
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4
SELECTCASE FLAG:現M
	CASE 0

	CASE 1
		
	CASE 2
		
	CASE 3
		
	CASE 4

	CASE 5

	CASE 6

	CASE 7

	CASE 8
		
	CASE 9
		CALL MESSAGE_WINDOW_D, "", "＞" + CALLNAME:MASTER + "は燃え盛る炎と悪魔を潜り抜け、御茶ノ水シェルターの居住区へとたどり着いた"
		CALL MESSAGE_WINDOW_D, "", "＞そこでは今まさに、３つ首の悪魔が炎を扉にぶつけているところだった…"
		CALL MESSAGE_WINDOW_D, "アイム", "あの腐れ天使めが、無駄な抵抗を続ける…/む、なんだ貴様ら！"
		CALL MESSAGE_WINDOW_D, "アイム", "貴様ら、アバドンを屠った…成程ファニエル、こいつらが切り札か！"
		CALL MESSAGE_WINDOW_D, "アイム", "良かろう、この火炎公アイムの力、篤と味わうがよい！"
		FLAG:逃走不可フラグ = 1
		FLAG:会話不能フラグ = 1
		FLAG:先制不意打ちキャンセル = 1
		CALL SET_ENEMY,9,1761,55,0,5;アイム
		MAXBASE:(CHARANUM-1):破魔 = 0
		MAXBASE:(CHARANUM-1):呪殺 = 0
		CFLAG:(CHARANUM-1):行動回数 = 2
		BASE:(CHARANUM-1):力 += 10
		BASE:(CHARANUM-1):知恵 += 10
		BASE:(CHARANUM-1):魔力 += 10
		BASE:(CHARANUM-1):耐力 += 10
		BASE:(CHARANUM-1):速さ += 10
		BASE:(CHARANUM-1):運 += 10
		CALL BATTLE_START
		FLAG:逃走不可フラグ = 0
		FLAG:会話不能フラグ = 0
		FLAG:先制不意打ちキャンセル = 0
		CALL MESSAGE_WINDOW_D, "アイム", "貴様ら、よもや、この私をも屠るとは…"
		CALL MESSAGE_WINDOW_D, "", "＞Fallenアイムは消え去った…"
		CALL MESSAGE_WINDOW_D, "ファニエル", "人の子よ、貴方のお蔭でこのシェルターは救われました"
		CALL MESSAGE_WINDOW_D, "ファニエル", "いずれこのシェルターも復興することでしょう/それではあなたを外までお送りしましょう/人の子よ、力を貸してくれてありがとう…"
		CALL SHOW_PICTURE, "D"
		CALL INPUT_SELECT_D("[1] ファニエルを要求する/[2] 素直に報酬を受け取る")
			IF RESULT == 1
				CALL MESSAGE_WINDOW_D, "ファニエル", "…！/分かりました、シェルターの住人達は救われたのです/それに報いるためならば、この身など差し出しましょう…"
				CALL MESSAGE_WINDOW_D, "", "＞大天使ファニエルが仲魔になった"
				CALL ADD_NEW_COMPANION,309,15000
			ENDIF
		イベントフラグ:70:1 = 2
		FLAG:脱出 = 1
	CASEELSE

ENDSELECT

ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 9
SELECTCASE FLAG:現M
	CASE 0
		CALL MESSAGE_WINDOW_D, "", "＞エレベーター内部から蒸し焼きにされた肉の匂いがする…"
	CASE 1
		
	CASE 2
		
	CASE 3
		
	CASE 4

	CASE 5
		CALL MESSAGE_WINDOW_D, "", "＞エレベーター内部から蒸し焼きにされた肉の匂いがする…"
	CASE 6
		
	CASE 7
		CALL MESSAGE_WINDOW_D, "", "＞エレベーター内部から蒸し焼きにされた肉の匂いがする…"
	CASE 8
		
	CASE 9
		
	CASEELSE
ENDSELECT
ENDIF


;--------------------------------
;炎ダメージ
;--------------------------------
@EVENT_BATTLE_ACTEND_DUNGEON38
LOCAL = FLAG:行動順1
SIF LOCAL < 0
	RETURN 0
SIF CFLAG:LOCAL:ステート == GET_STATE_NUM("DYING")
	RETURN 0
IF MAXBASE:LOCAL:火炎 == 999
	LOCAL:1 = 0
ELSE
	LOCAL:1 = RAND:20 + 10
	IF CFLAG:LOCAL:火炎無効化回数 > 0
		LOCAL:1 = 0
		CFLAG:LOCAL:火炎無効化回数 -= 1
	ELSE
		LOCAL:1 = LOCAL:1 * MAXBASE:LOCAL:火炎 / 100
	ENDIF
ENDIF
IF LOCAL:1 < 0
	LOCALS:1 = {-LOCAL:1}回復
ELSEIF LOCAL:1 == 0
	LOCALS:1 = BLOCK
ELSE
	LOCALS:1 = {LOCAL:1} DAMAGE
ENDIF
LOCALS = 炎が%CALLNAME:LOCAL%を襲う！
CALL MESSAGE_B(1, LOCALS)
PRINTFORMW TARGET:[{LOCAL,2}] %CALLNAME:LOCAL,20,LEFT%　>>>>>>　%LOCALS:1%
CALL VAR_HP, LOCAL, -(LOCAL:1), 0


;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_38
FLAG:エンカウント率 = FLAG:未遭遇歩数*5

;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_38
IF RAND:100 < FLAG:エンカウント率
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF

;=======================================================================
;敵の種族の種類数
;=======================================================================
@CLASS_NUM_38
RETURN CLASS_NUM_COMMON("上級")
;=======================================================================
;敵の総数
;ARGは出現する敵の種類です
;=======================================================================
@ENEMY_NUM_38, ARG
RETURN ENEMY_NUM_COMMON("上級", ARG)

;=======================================================================
;敵の種類
;=======================================================================
@ENEMY_38, ARG
	IF RAND:4 == 0
		RETURN 1033, 30;ピシャーチャ
	ELSEIF RAND:3 == 0
		RETURN 1712, 43;シトリー
	ELSEIF RAND:2 == 0
		RETURN [[キャラ:オルトロス]], 45
	ELSE
		RETURN [[キャラ:ジャックランタン]], 40
	ENDIF
