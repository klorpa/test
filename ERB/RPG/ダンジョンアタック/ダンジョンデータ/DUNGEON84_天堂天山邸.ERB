
;=======================================================================

;ダンジョンフラグ:84:0 = 1.クリアフラグ
;ダンジョンフラグ:84:1 = 1.初回
;ダンジョンフラグ:84:2 = 1.中ボス撃破
;ダンジョンフラグ:84:10- = 1.宝箱

;=======================================================================
;攻略条件
;=======================================================================
@PREREQUISITE_DUNGEON_84
IF ダンジョンフラグ:83:0 == 1 && !ダンジョンフラグ:84:0
	RETURN 1
ENDIF

;=======================================================================
;ダンジョン名
;=======================================================================
@GET_DUNGEON_NAME_84
RESULTS = Tenzan Tendou Mansion
;天堂天山邸

;=======================================================================
;フロア名表示
;=======================================================================
@FLOORNAME_84
PRINT Tendou Mansion 
;首領邸
SELECTCASE FLAG:現M
	CASE 0
		PRINTL 1F
	CASE 1
		PRINTL 2F
	CASE 2
		PRINTL 3F
	CASE 3
		PRINTL 4F
	CASE 4
		PRINTL 5F
	CASE 5
		PRINTL 6F
	CASE 6
		PRINTL 7F
	CASE 7
		PRINTL 8F
	CASE 8
		PRINTL 9F
	CASEELSE
		PRINTL
ENDSELECT
;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_84,ARG
FLAG:現M = 0
FLAG:現X = 6
FLAG:現Y = 21

;=======================================================================
;スタート時イベント
;=======================================================================
@EVENT_DUNGEON_START_84
IF ダンジョンフラグ:84:1 == 0
	CALL SHOW_PICTURE, "NONFLOORD"
	CALL MESSAGE_WINDOW_D, "", @"＞It seems there is a connection between the rogue police chief and the Tendou group./＞After receiving this information, %CALLNAME:MASTER% went to the Tendou mansion./＞Looking at the differentiated mansion, it seems that there really is a connection./＞You could find valueable information here."
	;天童組と警察署長が裏でつながっているとの/＞情報を得た%CALLNAME:MASTER%は屋敷の調査に訪れた/＞異界化している屋敷から見て、関係があるのは間違いはないだろう/＞なにか情報が得られるかもしれない
	ダンジョンフラグ:84:1 = 1
ENDIF

;=======================================================================
;フロアデータ
;=======================================================================
@MAKE_FLOOR_84
SELECTCASE FLAG:現M
	CASE 0
		FLAG:最大X = 13 
		FLAG:最大Y = 24 
		;                        0123456789012
		CALL MAKE_FLOOR_LINE, 0,"             "
		CALL MAKE_FLOOR_LINE, 1," 13   3   31 "
		CALL MAKE_FLOOR_LINE, 2," 11211111211 "
 		CALL MAKE_FLOOR_LINE, 3," 1  11111  1 "
		CALL MAKE_FLOOR_LINE, 4," 1         1 "
		CALL MAKE_FLOOR_LINE, 5," 111111 13 1 "
		CALL MAKE_FLOOR_LINE, 6," 1   11213 1 "
		CALL MAKE_FLOOR_LINE, 7," 1         1 "
		CALL MAKE_FLOOR_LINE, 8," 11111411111 "
		CALL MAKE_FLOOR_LINE, 9," 1    1    1 "
		CALL MAKE_FLOOR_LINE,10," 1  1 2 41 1 "
		CALL MAKE_FLOOR_LINE,11," 1111 6 11 1 "
		CALL MAKE_FLOOR_LINE,12," 1  2    2 1 "
		CALL MAKE_FLOOR_LINE,13," 1 11   11 1 "
		CALL MAKE_FLOOR_LINE,14," 1 11 6 11 1 "
		CALL MAKE_FLOOR_LINE,15," 1 2  2 2  1 "
		CALL MAKE_FLOOR_LINE,16," 1 11 1 1111 "
		CALL MAKE_FLOOR_LINE,17," 1 41 1 3  1 "
		CALL MAKE_FLOOR_LINE,18," 1    1    1 "
		CALL MAKE_FLOOR_LINE,19," 11111111111 "
		CALL MAKE_FLOOR_LINE,20,"      1      "
		CALL MAKE_FLOOR_LINE,21,"      1      "
		CALL MAKE_FLOOR_LINE,22,"      8      "
		CALL MAKE_FLOOR_LINE,23,"             "
		;                        0123456789012
		
		
	CASE 1
		FLAG:最大X = 26
		FLAG:最大Y = 14
		;                        01234567890123456789012345
		CALL MAKE_FLOOR_LINE, 0,"                          "
		CALL MAKE_FLOOR_LINE, 1," 11 14211 1114 4 11211 11 "
		CALL MAKE_FLOOR_LINE, 2," 11 11 11 15   1 11 14211 "
 		CALL MAKE_FLOOR_LINE, 3,"  2 2          1  2 2   2 "
		CALL MAKE_FLOOR_LINE, 4," 14 1121 126 7 1 14 44214 "
		CALL MAKE_FLOOR_LINE, 5," 1421  1 1   2 4 14211 11 "
		CALL MAKE_FLOOR_LINE, 6,"       1 11111       2  2 "
		CALL MAKE_FLOOR_LINE, 7,"       1        414214 11 "
		CALL MAKE_FLOOR_LINE, 8," 11211 1111 617   1 14211 "
		CALL MAKE_FLOOR_LINE, 9," 11 11 1  1  2    1    1  "
		CALL MAKE_FLOOR_LINE,10,"  2  2 1  1  1  41114  1  "
		CALL MAKE_FLOOR_LINE,11," 11 11 11 1  1         1  "
		CALL MAKE_FLOOR_LINE,12," 11211211 4  111111111111 "
		CALL MAKE_FLOOR_LINE,13,"                          "
		;                        01234567890123456789012345
		
		CASE 2
		FLAG:最大X = 13
		FLAG:最大Y = 12
		;                        0123456789012
		CALL MAKE_FLOOR_LINE, 0,"             "
		CALL MAKE_FLOOR_LINE, 1," 6 41 311111 "
		CALL MAKE_FLOOR_LINE, 2," 2 11214   1 "
 		CALL MAKE_FLOOR_LINE, 3," 1 1       1 "
		CALL MAKE_FLOOR_LINE, 4," 111 7211111 "
		CALL MAKE_FLOOR_LINE, 5,"             "
		CALL MAKE_FLOOR_LINE, 6,"  DDDDDD DDD "
		CALL MAKE_FLOOR_LINE, 7,"  D      DDD "
		CALL MAKE_FLOOR_LINE, 8," DDD 7D6 DDD "
		CALL MAKE_FLOOR_LINE, 9," D5D  2   D  "
		CALL MAKE_FLOOR_LINE,10," DDD  DDDDD  "
		CALL MAKE_FLOOR_LINE,11,"             "
		;                        0123456789012
		
		
		CASE 3
		FLAG:最大X = 17 
		FLAG:最大Y = 14 
		;                        01234567890123456
		CALL MAKE_FLOOR_LINE, 0,"                 "
		CALL MAKE_FLOOR_LINE, 1," 7 6 1211111 311 "
		CALL MAKE_FLOOR_LINE, 2," 2 2 1     1   1 "
 		CALL MAKE_FLOOR_LINE, 3," 11111 111 1   1 "
		CALL MAKE_FLOOR_LINE, 4,"       111 1   1 "
		CALL MAKE_FLOOR_LINE, 5," 111111111 11111 "
		CALL MAKE_FLOOR_LINE, 6," 1         1   1 "
		CALL MAKE_FLOOR_LINE, 7," 1   1111115   1 "
		CALL MAKE_FLOOR_LINE, 8," 1   1     1   1 "
		CALL MAKE_FLOOR_LINE, 9," 11111  7  11111 "
		CALL MAKE_FLOOR_LINE,10," 1   1  2  1   1 "
		CALL MAKE_FLOOR_LINE,11," 11     1     11 "
		CALL MAKE_FLOOR_LINE,12," 111111111111111 "
		CALL MAKE_FLOOR_LINE,13,"                 "
		;                        01234567890123456
		
		CASE 4
		FLAG:最大X = 15 
		FLAG:最大Y = 15 
		;                        012345678901234
		CALL MAKE_FLOOR_LINE, 0,"               "
		CALL MAKE_FLOOR_LINE, 1," 7 62111111111 "
		CALL MAKE_FLOOR_LINE, 2," 2           1 "
 		CALL MAKE_FLOOR_LINE, 3," 1 5 DDDDDDD 1 "
		CALL MAKE_FLOOR_LINE, 4," 1 D2D5   DD 1 "
		CALL MAKE_FLOOR_LINE, 5," 1 D D     D 1 "
		CALL MAKE_FLOOR_LINE, 6," 1 D D  E  D 1 "
		CALL MAKE_FLOOR_LINE, 7," 1 D 2  2  2 1 "
		CALL MAKE_FLOOR_LINE, 8," 1 D DD D DD 1 "
		CALL MAKE_FLOOR_LINE, 9," 1 D DD D DD 1 "
		CALL MAKE_FLOOR_LINE,10," 1 D    D    1 "
		CALL MAKE_FLOOR_LINE,11," 1 DDDDDDDDD 1 "
		CALL MAKE_FLOOR_LINE,12," 1           1 "
		CALL MAKE_FLOOR_LINE,13," 1111111111111 "
		CALL MAKE_FLOOR_LINE,14,"               "
		;                        012345678901234
		
		CASE 5
		FLAG:最大X = 16 
		FLAG:最大Y = 16 
		;                        0123456789012345
		CALL MAKE_FLOOR_LINE, 0,"                "
		CALL MAKE_FLOOR_LINE, 1," 6 72111111     "
		CALL MAKE_FLOOR_LINE, 2," 2   1    1     "
 		CALL MAKE_FLOOR_LINE, 3," 11111    11111 "
		CALL MAKE_FLOOR_LINE, 4," 1            1 "
		CALL MAKE_FLOOR_LINE, 5," 1 1111111111 1 "
		CALL MAKE_FLOOR_LINE, 6," 1 111      1 1 "
		CALL MAKE_FLOOR_LINE, 7," 1 11121 E  1 1 "
		CALL MAKE_FLOOR_LINE, 8," 1 2   1 2  1 1 "
		CALL MAKE_FLOOR_LINE, 9," 1 111 111  1 1 "
		CALL MAKE_FLOOR_LINE,10," 1 111      1 1 "
		CALL MAKE_FLOOR_LINE,11," 1 11121125 1 1 "
		CALL MAKE_FLOOR_LINE,12," 1     11   2 1 "
		CALL MAKE_FLOOR_LINE,13," 11111     11 3 "
		CALL MAKE_FLOOR_LINE,14,"     11111211   "
		CALL MAKE_FLOOR_LINE,15,"                "
		;                        0123456789012345
		
		CASE 6
		FLAG:最大X = 16 
		FLAG:最大Y = 15 
		;                        0123456789012345
		CALL MAKE_FLOOR_LINE, 0,"                "
		CALL MAKE_FLOOR_LINE, 1,"   7211111115   "
		CALL MAKE_FLOOR_LINE, 2,"     1     1121 "
 		CALL MAKE_FLOOR_LINE, 3," 11111        1 "
		CALL MAKE_FLOOR_LINE, 4," 1     111    1 "
		CALL MAKE_FLOOR_LINE, 5," 1 126 111111 1 "
		CALL MAKE_FLOOR_LINE, 6," 1 1   1    1 1 "
		CALL MAKE_FLOOR_LINE, 7," 1 11111 E  1 1 "
		CALL MAKE_FLOOR_LINE, 8," 1 1   1 2  1 1 "
		CALL MAKE_FLOOR_LINE, 9," 1 11511 1  1 1 "
		CALL MAKE_FLOOR_LINE,10," 1     1 1111 1 "
		CALL MAKE_FLOOR_LINE,11," 1     1 5    1 "
		CALL MAKE_FLOOR_LINE,12," 11115      111 "
		CALL MAKE_FLOOR_LINE,13,"    1111111115  "
		CALL MAKE_FLOOR_LINE,14,"                "
		;                        0123456789012345
		
		CASE 7
		FLAG:最大X = 13 
		FLAG:最大Y = 13 
		;                        0123456789012
		CALL MAKE_FLOOR_LINE, 0,"             "
		CALL MAKE_FLOOR_LINE, 1," 126 7211111 "
		CALL MAKE_FLOOR_LINE, 2," 1     115 1 "
 		CALL MAKE_FLOOR_LINE, 3," 1         1 "
		CALL MAKE_FLOOR_LINE, 4," 1 1111151 1 "
		CALL MAKE_FLOOR_LINE, 5," 11315111111 "
		CALL MAKE_FLOOR_LINE, 6,"             "
		;                        0123456789012
		
		CASE 8
		FLAG:最大X = 12 
		FLAG:最大Y = 10 
		;                        012345678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1,"    1111111 "
		CALL MAKE_FLOOR_LINE, 2," 7211     1 "
		CALL MAKE_FLOOR_LINE, 3,"          1 "
		CALL MAKE_FLOOR_LINE, 4," 11111    1 "
 		CALL MAKE_FLOOR_LINE, 5,"  1  1    1 "
		CALL MAKE_FLOOR_LINE, 6,"  1  1    1 "
		CALL MAKE_FLOOR_LINE, 7,"  2  1    1 "
		CALL MAKE_FLOOR_LINE, 8,"  4  111111 "
		CALL MAKE_FLOOR_LINE, 9,"            "
		;                        012345678901
		

	CASEELSE
ENDSELECT


;=======================================================================
;タイル調整
;=======================================================================
@MAKE_FLOOR_LINE_COMMON_84, ARG, ARG:1, ARG:2
#LOCALSIZE 20
SIF ARG:1 == 0 && ARG:2 == 0
	VARSET LOCAL
SELECTCASE ARG
	CASE 3
		IF GETBIT(ダンジョンフラグ:(FLAG:現ダンジョン):(FLAG:現M+10), LOCAL:3)
			DA:(ARG:1):(ARG:2) = 1
			ELSE
			DA:(ARG:1):(ARG:2) = FLAG:現M *1000 + LOCAL:3 * 10 + 3
		ENDIF
		LOCAL:3++
	CASE 4 TO 9
		DA:(ARG:1):(ARG:2) = FLAG:現M *1000 + LOCAL:ARG * 10 + ARG
		LOCAL:ARG++
	
ENDSELECT

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_84,ARG,ARG:1
IF FLAG:現M == 1 && ARG == 6 && ARG:1 == 4
		IF FLAG:現X < ARG
	CALL MESSAGE_WINDOW_D, "", "＞This door is locked."
	;＞扉は閉ざされている
		RETURN 0
	ENDIF
ENDIF

IF FLAG:現M == 3 && ARG == 6 && ARG:1 == 1
		IF FLAG:現X > ARG
	CALL MESSAGE_WINDOW_D, "", "＞This door is locked."
		RETURN 0
	ENDIF
ENDIF

IF FLAG:現M == 5 && ARG == 10 && ARG:1 == 14
		IF FLAG:現X < ARG
	CALL MESSAGE_WINDOW_D, "", "＞This door is locked."
		RETURN 0
	ENDIF
ENDIF

IF FLAG:現M == 5 && ARG == 6 && ARG:1 == 7
		IF FLAG:現X < ARG
	CALL MESSAGE_WINDOW_D, "", "＞This door is locked."
		RETURN 0
	ENDIF
ENDIF

IF FLAG:現M == 6 && ARG == 13 && ARG:1 == 2
		IF FLAG:現X < ARG
	CALL MESSAGE_WINDOW_D, "", "＞This door is locked."
		RETURN 0
	ENDIF
ENDIF

IF FLAG:現M == 8 && ARG == 2 && ARG:1 == 7 
	CALL MESSAGE_WINDOW_D, "", "＞You feel a strong evil presence from the other side of the door./＞Open the door?"
	;扉の向こうから強い邪気を感じる/＞扉をあけますか？
			CALL INPUT_YN_D,"Yes","No"
		SIF RESULT
			RETURN 0
ENDIF


CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT
;=======================================================================
;タイル定義
;=======================================================================
@TILE_MARK_COMMON_84_4, ARG , ARG:1 , ARG:2
SELECTCASE ARG / 10
	CASE 1,2,200,201
		SETCOLOR 0x00ff00
		RESULTS = ｍ
	CASE 800 
		RESULTS = ！
	CASEELSE
		RESULTS = □
	ENDSELECT
	
@TILE_MARK_COMMON_84_5, ARG, ARG:1, ARG:2
IF FLAG:ライトマ || (EQUIP:MASTER:DarkScanner && NUM_SUMMONER())
		RESULTS = \@GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 ?罠#□\@
ELSE
SELECTCASE ARG / 10
		CASE 200, 400, 401,
		SETCOLOR 0x404040
			RESULTS = □
		CASEELSE
			RESULTS = \@GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 ?罠#□\@
	ENDSELECT
ENDIF

@TILE_MARK_COMMON_84_D, ARG, ARG:1, ARG:2
IF FLAG:ライトマ || (EQUIP:MASTER:DarkScanner && NUM_SUMMONER())
	SELECTCASE ARG/10
		CASEELSE
			RESULTS = □
	ENDSELECT
ELSE
	SETCOLOR 0x404040
	SELECTCASE ARG/10
		CASEELSE
			RESULTS = □
	ENDSELECT
ENDIF

;=======================================================================
;[5]調べる　実行時のイベント
;=======================================================================
@EVENT_CHECK_DUNGEON_84

;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) % 10 == 8
		CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	CALL TRESURING_CALLING_84
	RETURN RESULT

;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 6
	CALL UPSTAIRS_84
	RETURN RESULT

ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 7
	CALL DOWNSTAIRS_84
	RETURN RESULT

;==========
;イベントの処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4
	 
SELECTCASE FLAG:現M
	CASE 0
		IF FLAG:現X == 3 && FLAG:現Y == 17
			CALL MESSAGE_WINDOW_D, "チンピラ", "あーん、/どこに目えつけてんじゃ、アホんだら！/しばいたろかボケェ！！ "
		ELSEIF  FLAG:現X == 8 && FLAG:現Y == 10
			CALL MESSAGE_WINDOW_D, "チンピラ", "なんじゃい、われ！/どたま、かち割ったろか！/このガキャーーーー！！ "
		ENDIF
		
	CASE 2
		IF FLAG:現X == 3 && FLAG:現Y == 1
			CALL MESSAGE_WINDOW_D, "Employee", "It seems my boss wanted youthfulness./He became fond of immortality./And his obsession changed him."
			;組員	親分が欲したのは、若さだった。/不老不死ってやつだ。/その狂気が親分を変えちまった。
 			CALL MESSAGE_WINDOW_D, "Employee", "金と女にゃ不自由しない、/それだけじゃ不足だったのか………/俺には親分の本意が、まだわからん。"
		ELSEIF  FLAG:現X == 7 && FLAG:現Y == 2
			CALL MESSAGE_WINDOW_D, "Employee", "My boss has changed./In the past, he was such a different person..."
			;親分は変わっちまった。/昔はあんな、お人じゃなかった……… 
		ENDIF
		ENDSELECT
	RETURN 1
	
ELSE
	CALL MESSAGE_WINDOW_D, "", "＞Nothing seems to be here."
	;何も無いようだ
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時のイベント
;=======================================================================
@EVENT_ENTER_DUNGEON_84,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) % 10 == 8
	CALL DUNGEON_EXIT
	RETURN 1

;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	CALL TRESURING_CALLING_84
	RETURN RESULT
	
;========
;罠の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 ==  5 
	CALL TRAP_84
	RETURN RESULT
	
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1

;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 6
	CALL UPSTAIRS_84
	RETURN RESULT

ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 7
	CALL DOWNSTAIRS_84
	RETURN RESULT

		
;==========
;イベントの処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4

	SELECTCASE FLAG:現M
	CASE 0
		IF FLAG:現X == 6 && FLAG:現Y == 8
			 IF ARG == 4
				CALL SHOW_FORCEMOVE, "L", "D", , ,  "The floor suddenly moved!"
				;突然床が動き出した！
			 ELSEIF ARG == 6
				CALL SHOW_FORCEMOVE, "R", "D", , ,  "The floor suddenly moved!"
			 ENDIF
		ENDIF
	CASE 1
			IF FLAG:現X == 21 && FLAG:現Y == 4
			 IF ARG == 4
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
			 ;＞ワープゾーンだ！
				FLAG:現X = 5
				FLAG:現Y = 1
			 ENDIF
			ELSEIF FLAG:現X == 5 && FLAG:現Y == 1
			 IF ARG == 4
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 21
				FLAG:現Y = 4
			 ENDIF
			ELSEIF FLAG:現X == 15 && FLAG:現Y == 1
			CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 13
				FLAG:現Y = 10
			ELSEIF FLAG:現X == 13 && FLAG:現Y == 1
			CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 13
				FLAG:現Y = 10
			ELSEIF FLAG:現X == 18 && FLAG:現Y == 5
			 IF ARG == 4
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 21
				FLAG:現Y = 2
			 ENDIF
			ELSEIF FLAG:現X == 21 && FLAG:現Y == 2
			 IF ARG == 4
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 18
				FLAG:現Y = 5
			 ENDIF
			ELSEIF FLAG:現X == 24 && FLAG:現Y == 4
			 IF ARG == 2
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 2
				FLAG:現Y = 4
			 ENDIF
			ELSEIF FLAG:現X == 2 && FLAG:現Y == 4
			 IF ARG == 2
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 24
				FLAG:現Y = 4
			 ENDIF
			ELSEIF FLAG:現X == 21 && FLAG:現Y == 8
			 IF ARG == 4
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 2
				FLAG:現Y = 5
			 ENDIF
			ELSEIF FLAG:現X == 2 && FLAG:現Y == 5
			 IF ARG == 4
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 21
				FLAG:現Y = 8
			 ENDIF
			ELSEIF FLAG:現X == 21 && FLAG:現Y == 7
			 IF ARG == 2
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 18
				FLAG:現Y = 4
			 ENDIF
			ELSEIF FLAG:現X == 18 && FLAG:現Y == 4
			 IF ARG == 2
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 21
				FLAG:現Y = 7
			 ENDIF
			ELSEIF FLAG:現X == 20 && FLAG:現Y == 4
			 IF ARG == 2
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 16
				FLAG:現Y = 7
			 ENDIF
			ELSEIF FLAG:現X == 16 && FLAG:現Y == 7
			CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 20
				FLAG:現Y = 4
			ELSEIF FLAG:現X == 15 && FLAG:現Y == 5
			CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 7
				FLAG:現Y = 8
			ELSEIF FLAG:現X == 18 && FLAG:現Y == 7
			 IF ARG == 4
			 CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 18
				FLAG:現Y = 1
			 ENDIF
			ELSEIF FLAG:現X == 16 && FLAG:現Y == 10
			CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 15
				FLAG:現Y = 3
			ELSEIF FLAG:現X == 20 && FLAG:現Y == 10
			CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 13
				FLAG:現Y = 10
			ELSEIF FLAG:現X == 10 && FLAG:現Y == 12
			CALL MESSAGE_WINDOW_D, "", "＞Warp zone!"
				FLAG:現X = 13
				FLAG:現Y = 1
		ENDIF
		
		CASE 8
		IF FLAG:現X == 2 && FLAG:現Y == 8
		CALL MESSAGE_WINDOW_D, "", "＞In the back of a luxuriously decorated room,/＞an old man was sitting./＞He had an atmosphere to him that was quite unusual for a human."
		;豪華な装飾で飾り付けられた部屋の奥で/＞人間とは思えぬ雰囲気をまとう、/＞年老いた男が鎮座していた
		CALL MESSAGE_WINDOW_D, "Tendou", "You are the one who defeated those 3?/I am the chairman of the Tendou goup, Tenzan Tendou."
		;天堂", "われぇ、どこの三下じゃ？/わしが天堂組会長、天堂天山と知ってか。
		CALL MESSAGE_WINDOW_D, "Tendou", "I came this far and I'm so close./I will not abandon my wish./I won't succumb to death but you will face it here."
		;ここまで来るたぁ、立派なもんだが、/わしのタマァ取らせんぞ。/とっとと、死にさらせ。 
		CALL MESSAGE_WINDOW_D, "", "＞While he speaks, Tendou's appearance starts to change/＞and shifts into that of a vicous demon./"
		;天堂の肉体が生気を取り戻し、/＞その姿を禍々しい悪魔へと変異させてゆく
		CALL MESSAGE_WINDOW_D, "", "＞1 Haunt Tendou appeared!"
		
		FLAG:逃走不可フラグ = 1
		FLAG:会話不能フラグ = 1
		FLAG:先制不意打ちキャンセル = 1
		
			;テンドウ
				CALL SET_ENEMY,9,[[キャラ:テンドウ]],64,0,1
				CFLAG:(CHARANUM-1):ＨＰ補正 = 4200
				CFLAG:(CHARANUM-1):ＭＰ補正 = 8000
				CFLAG:(CHARANUM-1):行動回数 = 2
				CFLAG:(CHARANUM-1):速度補正 = 15
				BASE:(CHARANUM-1):力 += 6
				BASE:(CHARANUM-1):知恵 += 6
				BASE:(CHARANUM-1):魔力 += 6
				BASE:(CHARANUM-1):速さ += 8
				CALL SYNC_STATUS,(CHARANUM-1)
				CALL HEALTH_CHARA,(CHARANUM-1)
				CSTR:(CHARANUM-1):思考パターン = D84_テンドウ
				
				CALL BATTLE_START
		FLAG:逃走不可フラグ = 0
		FLAG:会話不能フラグ = 0
		FLAG:先制不意打ちキャンセル = 0
		
		CALL MESSAGE_WINDOW_D, "Tendou", "Huh, is the rejuvenation power faded...?/More blood, I collected so much blood.../Because of the golden statue...."
		;ぐうっ、若返りの力が切れたか……/もっと血を、子分どもに集めさせた血を/ためた黄金像を…………。
		CALL MESSAGE_WINDOW_D, "Tendou", "...I can still fight on..../Blood, golden statue....." 
		;……まだまだ戦える……/血を、黄金像を…………。
		CALL MESSAGE_WINDOW_D, "Sid", "This is it. Tendou./Your role is finished./I won't waste any more energy on you."
		;シド	そこまででス。天堂さン。/あなたの役目ハ、終わりましタ。/あなたニ、これ以上エナジーを使わせるのはムダでス。
		CALL MESSAGE_WINDOW_D, "", "＞Sid appeared out of nowhere"
		;どこからともなくシドが姿を現した
		CALL MESSAGE_WINDOW_D, "Sid","あなたハ、子分を使って地上げしたリ、/建設会社ニ、封印の祠や神社を壊させたリ、/吸血鬼となっテ、血を集めてくれましタ。"
		CALL MESSAGE_WINDOW_D, "Sid","Your part in this is over./Well, fighting against the demon summoner,/you can't win."
		;あなたの仕事ハ、これでおしまいでス。/もう一度、デビルサマナーと戦ってモ、/勝てないでしょウ。
		CALL MESSAGE_WINDOW_D, "Sid","And because you lost, you also lost your value./Well, change back to the poor old man,/becaues you will die."
		;利用価値が無くなリ、戦いにも負けタ、/あなたハ、元のあわれな老人に戻っテ、/死ぬのでス。
		CALL MESSAGE_WINDOW_D, "Sid","Anyway, seeya."
		;でハ、さようなラ。 
		CALL MESSAGE_WINDOW_D, "", "＞Sid disappeared as apruptly as he came"
		;シドは姿を消すように去っていった
		CALL MESSAGE_WINDOW_D, "Tendou", "...will I really die now...?/Damn, I was so close.../Death...."
		;……これで死ぬんか……/くそっ、おれはやつらにおどらされたあげく/死ぬんか…………。
		CALL MESSAGE_WINDOW_D, "", "＞Haunt Tendou was defeated..."
		CALL MESSAGE_WINDOW_D, "", "＞For eliminating Tendou and the threat he posed,/＞you received ￥50000 and gained 300 fame."
		;組織の不穏分子を排除したことにより、/＞報酬として口座に￥50000が支払われ、名声300得た
		MONEY += 50000
		ダンジョンフラグ:84:0 = 1
		FLAG:名声 += 300
		FLAG:脱出 = 1
		ENDIF
	ENDSELECT
ENDIF

;テンドウ戦闘行動
@SET_ACTION_D84_テンドウ,ARG
;入力行動を-1とターゲットを-1にしておく
CFLAG:ARG:入力行動 = -1
CFLAG:ARG:ターゲット = -1

IF CFLAG:ARG:１moreフラグ == 2
	IF RAND:2 == 0
	CFLAG:ARG:入力行動 = 2039
	ELSE
	CFLAG:ARG:入力行動 = 1411
	ENDIF
	
ELSEIF CFLAG:ARG:行動した回数 == 0
	SELECTCASE RAND:100
		CASE 0 TO 40
			CFLAG:ARG:入力行動 = 1010
		CASE 41 TO 80
			CFLAG:ARG:入力行動 = 2062
		CASEELSE
			CFLAG:ARG:入力行動 = 2039
		ENDSELECT
ELSE
		SELECTCASE RAND:100
		CASE 0 TO 25
			CFLAG:ARG:入力行動 = 1010
		CASE 25 TO 55
			CFLAG:ARG:入力行動 = 2062
		CASE 56 TO 75
			CFLAG:ARG:入力行動 = [[スキル:ＡＴＴＡＣＫ]]
		CASEELSE
			CFLAG:ARG:入力行動 = 2039
		ENDSELECT
	ENDIF

FOR LOCAL:1, 0, 5
	FOR LOCAL, 1, 7
		IF POS(LOCAL) > 0 && CFLAG:POS(LOCAL):AUTO_SPLIT("命中強化/回避強化/魔法威力強化/攻撃強化/防御強化", "/", LOCAL:1) > 4
			CFLAG:ARG:入力行動 = [[スキル:デ・カジャ]]
			CFLAG:ARG:ターゲット = -1
		ENDIF
	NEXT
NEXT
;アクション実行不能
CALL CHECK_ACTIONABLE, ARG, CFLAG:ARG:入力行動
SIF RESULT == 0
	CFLAG:ARG:入力行動 = 0
;ここまでターゲットが決まってなかったら、ランダムターゲットをよんで決定
SIF CFLAG:ARG:ターゲット == -1
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
RETURN 1


;========
;階段移動
;========
@UPSTAIRS_84
SELECTCASE FLAG:現M
	CASE 0
		SIF FLAG:現X == 6 && FLAG:現Y == 14
			CALL DUNGEON_UPSTAIRS,1,14,8
		SIF FLAG:現X == 6 && FLAG:現Y == 11
			CALL DUNGEON_UPSTAIRS,1,13,4
	CASE 1
		SIF FLAG:現X == 11 && FLAG:現Y == 4
			CALL DUNGEON_UPSTAIRS,2,5,4
		SIF FLAG:現X == 12 && FLAG:現Y == 8
			CALL DUNGEON_UPSTAIRS,2,5,8
	CASE 2
		SIF FLAG:現X == 7 && FLAG:現Y == 8
			CALL DUNGEON_UPSTAIRS,3,8,9
		SIF FLAG:現X == 1 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,3,1,1
	CASE 3
		SIF FLAG:現X == 3 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,4,1,1
	CASE 4
		SIF FLAG:現X == 3 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,5,3,1
	CASE 5
		SIF FLAG:現X == 1 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,6,3,1
	CASE 6
		SIF FLAG:現X == 5 && FLAG:現Y == 5
			CALL DUNGEON_UPSTAIRS,7,5,1
	CASE 7
		SIF FLAG:現X == 3 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,8,1,2
	CASEELSE
ENDSELECT
RETURN 1

@DOWNSTAIRS_84
SELECTCASE FLAG:現M
	CASE 1
		SIF FLAG:現X == 14 && FLAG:現Y == 8
			CALL DUNGEON_DOWNSTAIRS,0,6,14
		SIF FLAG:現X == 13 && FLAG:現Y == 4
			CALL DUNGEON_DOWNSTAIRS,0,6,11
	CASE 2
		SIF FLAG:現X == 5 && FLAG:現Y == 4
			CALL DUNGEON_DOWNSTAIRS,1,11,4
		SIF FLAG:現X == 5 && FLAG:現Y == 8
			CALL DUNGEON_DOWNSTAIRS,1,12,8
	CASE 3
		SIF FLAG:現X == 8 && FLAG:現Y == 9
			CALL DUNGEON_DOWNSTAIRS,2,7,8
		SIF FLAG:現X == 1 && FLAG:現Y == 1
			CALL DUNGEON_DOWNSTAIRS,2,1,1
	CASE 4
		SIF FLAG:現X == 1 && FLAG:現Y == 1
			CALL DUNGEON_DOWNSTAIRS,3,3,1
	CASE 5
		SIF FLAG:現X == 3 && FLAG:現Y == 1
			CALL DUNGEON_DOWNSTAIRS,4,3,1
	CASE 6
		SIF FLAG:現X == 3 && FLAG:現Y == 1
			CALL DUNGEON_DOWNSTAIRS,5,1,1
	CASE 7
		SIF FLAG:現X == 5 && FLAG:現Y == 1
			CALL DUNGEON_DOWNSTAIRS,6,5,5
	CASE 8
		SIF FLAG:現X == 1 && FLAG:現Y == 2
			CALL DUNGEON_DOWNSTAIRS,7,3,1
	CASEELSE
ENDSELECT
RETURN 1
;=======================================================================
;エレベーター
;=======================================================================
@DUNGEON_ELEVATOR_84, ARG
RESULT:1 = 4
RESULT:2 = 5
RESULT:3 = 6
RESULTS:1 = ５Ｆ
RESULTS:2 = ６Ｆ
RESULTS:3 = ７Ｆ
RETURN -1

;=======================================================================
;宝箱の中身
;=======================================================================
@TRESURING_CALLING_84
#LOCALSIZE 3
LOCAL = FLAG:現M + 10

LOCAL:1 = (DA:(FLAG:現X):(FLAG:現Y) / 10) % 100
SELECTCASE DA:(FLAG:現X):(FLAG:現Y) / 10
		CASE 0
			CALL GET_TREASURE, [[アイテム:MegidoStone]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 1
			CALL GET_TREASURE, [[アイテム:Bizen Tanto]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 2
			CALL GET_TREASURE_MAG, , 4000 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 3
			CALL GET_TREASURE, [[アイテム:M16 Rifle]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 4
			CALL GET_TREASURE, [[アイテム:Howa Carbine]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 5
			CALL GET_TREASURE, [[アイテム:Medicine]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 200
			CALL GET_TREASURE_MONEY, 0 , 50000 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 300
			CALL GET_TREASURE, [[アイテム:EnIncense]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 500
			CALL GET_TREASURE, [[アイテム:MegidolaStone]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
		CASE 700
			CALL GET_TREASURE, [[アイテム:Thunder-fang Axe]] , 1 , FLAG:現ダンジョン, LOCAL , LOCAL:1
	ENDSELECT
RETURN 1


;========
;罠置き場
;========
@TRAP_84
SELECTCASE FLAG:現M
	CASE 1
		CALL MESSAGE_WINDOW_D, "", "＞It's a pitfall!"
				SIF FLAG:現X == 11 && FLAG:現Y == 2
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X-5,  FLAG:現Y+7
	CASE 2
		CALL MESSAGE_WINDOW_D, "", "＞It's a pitfall!"
				SIF FLAG:現X == 2 && FLAG:現Y == 9
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X+6,  FLAG:現Y+2
	CASE 3
		CALL MESSAGE_WINDOW_D, "", "＞It's a pitfall!"
				SIF FLAG:現X == 11 && FLAG:現Y == 7
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X-4,  FLAG:現Y-1
	CASE 4
		CALL MESSAGE_WINDOW_D, "", "＞It's a pitfall!"
				SIF FLAG:現X == 6 && FLAG:現Y == 4
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X+3,  FLAG:現Y+1
				SIF FLAG:現X == 3 && FLAG:現Y == 3
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X,  FLAG:現Y
	CASE 5
		CALL MESSAGE_WINDOW_D, "", "＞It's a pitfall!"
				SIF FLAG:現X == 10 && FLAG:現Y == 11
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X,  FLAG:現Y-2
	CASE 6
		CALL MESSAGE_WINDOW_D, "", "＞It's a pitfall!"
				SIF FLAG:現X == 12 && FLAG:現Y == 1
				CALL DUNGEON_WORP, FLAG:現M-2, FLAG:現X,  FLAG:現Y
				SIF FLAG:現X == 5 && FLAG:現Y == 12
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X,  FLAG:現Y+1
				SIF FLAG:現X == 13 && FLAG:現Y == 13
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X-1,  FLAG:現Y+1
				SIF FLAG:現X == 9 && FLAG:現Y == 11
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X-1,  FLAG:現Y+1
				SIF FLAG:現X == 5 && FLAG:現Y == 9
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X-1,  FLAG:現Y+1
	CASE 7
		CALL MESSAGE_WINDOW_D, "", "＞It's a pitfall!"
				SIF FLAG:現X == 9 && FLAG:現Y == 2
				CALL DUNGEON_WORP, FLAG:現M-5, FLAG:現X,  FLAG:現Y+4
				SIF FLAG:現X == 5 && FLAG:現Y == 5
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X+2,  FLAG:現Y+4
				SIF FLAG:現X == 8 && FLAG:現Y == 4
				CALL DUNGEON_WORP, FLAG:現M-3, FLAG:現X+2,  FLAG:現Y+4
	ENDSELECT
;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_84

SELECTCASE FLAG:現M
	CASE 0,1
		FLAG:エンカウント率 = FLAG:未遭遇歩数*5
	CASE 2,3,4,5,6
		FLAG:エンカウント率 = 5 + FLAG:未遭遇歩数*5
	CASEELSE
		FLAG:エンカウント率 = 10 + FLAG:未遭遇歩数*5
ENDSELECT
SIF FLAG:未遭遇歩数 < 5
	FLAG:エンカウント率 = 0
;=======================================================================
;必要レベル目安
;推奨LV 雑魚最低LV 雑魚最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_84
RETURN 50, 25, 54, 64 

;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_84
IF RAND:100 < FLAG:エンカウント率
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF

;=======================================================================
;敵の種族の種類数
;=======================================================================
@CLASS_NUM_84
SELECTCASE FLAG:現M
	CASE 0,1,2,3,4,5,6
		RETURN CLASS_NUM_COMMON("上級")
	CASE 7,8
		RETURN CLASS_NUM_COMMON("最上級")
ENDSELECT
;=======================================================================
;敵の総数
;ARGは出現する敵の種類です
;=======================================================================
@ENEMY_NUM_84, ARG
SELECTCASE FLAG:現M
	CASE 0,1,2,3,4,5,6
		RETURN ENEMY_NUM_COMMON("上級", ARG)
	CASE 7,8
		RETURN ENEMY_NUM_COMMON("最上級", ARG)
ENDSELECT
;=======================================================================
;敵の種類
;=======================================================================
@ENEMY_84, ARG
SELECTCASE FLAG:現M
	CASE 0,1
		SELECTCASE RAND:100
			CASE IS < 30
				RETURN [[キャラ:やくざ]], 25
			CASE IS < 55
				RETURN [[キャラ:インキュバス]], 39
			CASE IS < 70
				RETURN [[キャラ:ジャンキー]], 35
			CASE IS < 85
				RETURN [[キャラ:ハンニャ]], 36
			CASE IS < 100
				RETURN [[キャラ:タラスク]], 38
		ENDSELECT
	CASE 2,3,4
		SELECTCASE RAND:100
			CASE IS < 30
				RETURN [[キャラ:ヴァーチャー]], 46
			CASE IS < 55
				RETURN [[キャラ:サキュバス]], 47
			CASE IS < 70
				RETURN [[キャラ:バルバトス]], 48
			CASE IS < 85
				RETURN [[キャラ:クドラク]], 48
			CASE IS < 100
				RETURN [[キャラ:ダッキ]], 47
			ENDSELECT
	CASE 5,6
		SELECTCASE RAND:100
			CASE IS < 30
				RETURN [[キャラ:ティターニア]], 51
			CASE IS < 55
				RETURN [[キャラ:シャドウ]], 49
			CASE IS < 70
				RETURN [[キャラ:バルバトス]], 49
			CASE IS < 85
				RETURN [[キャラ:クドラク]], 50
			CASE IS < 100
				RETURN [[キャラ:サキュバス]], 49
			ENDSELECT
	CASE 7,8
		SELECTCASE RAND:100
			CASE IS < 25
				RETURN [[キャラ:ティターニア]], 53
			CASE IS < 40
				RETURN [[キャラ:ヴェータラ]], 53
			CASE IS < 55
				RETURN [[キャラ:サキュバス]], 53
			CASE IS < 70
				RETURN [[キャラ:クドラク]], 54 
			CASE IS < 85
				RETURN [[キャラ:バルバトス]], 50
			CASE IS < 100
				RETURN [[キャラ:ギリメカラ]], 54
			ENDSELECT	
ENDSELECT

;=======================================================================
;輪姦参加悪魔
;=======================================================================
@DUNGEON_RAPE_DEVIL_84
;ランダムにどの悪魔が出るか決定
;RETURN CSV番号 , 人数 , レベル
SELECTCASE RAND:3
	CASE 0
		RETURN [[キャラ:インキュバス]] , 3 + RAND:10 , CSVBASE([[キャラ:インキュバス]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:やくざ]] , 3 + RAND:10 , CSVBASE([[キャラ:やくざ]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:ジャンキー]] , 3 + RAND:10 , CSVBASE([[キャラ:ジャンキー]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT