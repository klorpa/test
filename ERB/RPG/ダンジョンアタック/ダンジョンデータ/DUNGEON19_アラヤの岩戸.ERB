;=======================================================================
;アラヤの岩戸
;
;ダンジョンナンバー19
;=======================================================================
;ダンジョンフラグ:19:0 = 同行者(1:エリー 2:アヤセ 3:マキ)
;ダンジョンフラグ:19:1 = 0:岩戸未クリア 1:接触成功 2:麻希接触失敗
;ダンジョンフラグ:19:2 = ペルソナ成長イベント
;ダンジョンフラグ:19:3 = 鏡装備取得イベント

;=======================================================================
;攻略条件
;=======================================================================
@PREREQUISITE_DUNGEON_19
;迷いの森クリアかつ麻希が存在してること
IF ダンジョンフラグ:12:1 == 1 && ダンジョンフラグ:19:1 == 0 && GETCHARA([[キャラ:麻希]]) >= 0
	RETURN 1
ELSE
	RETURN 0
ENDIF

;=======================================================================
;ダンジョン名
;=======================================================================
@GET_DUNGEON_NAME_19
RESULTS = Alaya Cavern
;アラヤの岩戸


;=======================================================================
;フロア名表示
;=======================================================================
@FLOORNAME_19
PRINT Alaya Cavern

;=======================================================================
;特殊タイル表示
;=======================================================================
@TILE_MARK_19_1_3_7
RESULTS = Ｔ
@TILE_MARK_19_7_14_1
RESULTS = Ｔ


;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_19,ARG
FLAG:現M = 0
FLAG:現X = 5
FLAG:現Y = 18
;CALL AUTOMAP

;=======================================================================
;スタート時イベント
;=======================================================================
@EVENT_DUNGEON_START_19
CALL SHOW_PICTURE, "NONFLOORD", @"%CALLNAME:MASTER%のアジト"
CALL MESSAGE_WINDOW, "", "＞園村 麻希の心象世界での探索は続く/＞迷いの森で接触した麻希から受け取ったコンパクトには/＞神社が映し出されていた/＞心象世界内に神社は一つ、アラヤ神社しかない", , "ログを残さない/ボタンを利用する/再利用しない", "CENTER", 72, 4
CALL MESSAGE_WINDOW, "", "＞何か手掛かりでもあるかと、/＞探索してみると裏庭の大岩の裏から/＞洞窟の様な場所に入れる事が分かった", , "ログを残さない/ボタンを利用する/再利用しない", "CENTER", 72, 4
CALL MESSAGE_WINDOW, "", "＞此処はアラヤの岩戸、個人の心象世界と人という種全体が/＞共有する総合無意識の接点だ/＞人ならざる悪魔なら兎も角、/＞人の身でここに入れる者は限られる", , "ログを残さない/ボタンを利用する/再利用しない", "CENTER", 72, 4
CALL MESSAGE_WINDOW, "", "........./...../...", , "ログを残さない/ボタンを利用する/再利用しない", "CENTER", 72, 4
CALL SHOW_PICTURE, "EMPTY"

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_19,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

;=======================================================================
;フロアデータ
;=======================================================================
@MAKE_FLOOR_19
SELECTCASE FLAG:現M
	CASE 0
		
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 4,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 6,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 7,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 8,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 9,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,10,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,11,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,12,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,13,"0000006000000000000"
		CALL MAKE_FLOOR_LINE,14,"0000011000000000000"
		CALL MAKE_FLOOR_LINE,15,"0000010000000000000"
		CALL MAKE_FLOOR_LINE,16,"0000040000000000000"
		CALL MAKE_FLOOR_LINE,17,"0000111000000000000"
		CALL MAKE_FLOOR_LINE,18,"0000080000000000000"

	CASE 1
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 4,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000000111000000000"
		CALL MAKE_FLOOR_LINE, 6,"0000000001000000000"
		CALL MAKE_FLOOR_LINE, 7,"0009000001011000000"
		CALL MAKE_FLOOR_LINE, 8,"0002000001010000000"
		CALL MAKE_FLOOR_LINE, 9,"0111001111110000000"
		CALL MAKE_FLOOR_LINE,10,"0100006000010000000"
		CALL MAKE_FLOOR_LINE,11,"0111000001111100000"
		CALL MAKE_FLOOR_LINE,12,"0001000001000100000"
		CALL MAKE_FLOOR_LINE,13,"0001007001000100000"
		CALL MAKE_FLOOR_LINE,14,"0001111111000000000"
		CALL MAKE_FLOOR_LINE,15,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,16,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,17,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 2
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 4,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 5,"0001111111600000000"
		CALL MAKE_FLOOR_LINE, 6,"0001000000000000000"
		CALL MAKE_FLOOR_LINE, 7,"0001000000000000000"
		CALL MAKE_FLOOR_LINE, 8,"0001000000000000000"
		CALL MAKE_FLOOR_LINE, 9,"0001111100000000000"
		CALL MAKE_FLOOR_LINE,10,"0000107000000000000"
		CALL MAKE_FLOOR_LINE,11,"0000100000000000000"
		CALL MAKE_FLOOR_LINE,12,"0000100000000000000"
		CALL MAKE_FLOOR_LINE,13,"0000111000110000000"
		CALL MAKE_FLOOR_LINE,14,"0000001112110000000"
		CALL MAKE_FLOOR_LINE,15,"0000111000110000000"
		CALL MAKE_FLOOR_LINE,16,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,17,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 3
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 4,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000111111700000000"
		CALL MAKE_FLOOR_LINE, 6,"0011100100000000000"
		CALL MAKE_FLOOR_LINE, 7,"0010000100000000000"
		CALL MAKE_FLOOR_LINE, 8,"0010000110000000000"
		CALL MAKE_FLOOR_LINE, 9,"0010000010000000000"
		CALL MAKE_FLOOR_LINE,10,"0020000010000000000"
		CALL MAKE_FLOOR_LINE,11,"0111000020000000000"
		CALL MAKE_FLOOR_LINE,12,"0111000060000000000"
		CALL MAKE_FLOOR_LINE,13,"0111000000000000000"
		CALL MAKE_FLOOR_LINE,14,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,15,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,16,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,17,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	

	CASE 4
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 4,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 6,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 7,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 8,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 9,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,10,"0600000111100000000"
		CALL MAKE_FLOOR_LINE,11,"0100000010101100000"
		CALL MAKE_FLOOR_LINE,12,"0100000070121100000"
		CALL MAKE_FLOOR_LINE,13,"0101000000101100000"
		CALL MAKE_FLOOR_LINE,14,"0111000000100000000"
		CALL MAKE_FLOOR_LINE,15,"0101111011111100000"
		CALL MAKE_FLOOR_LINE,16,"0100001110000100000"
		CALL MAKE_FLOOR_LINE,17,"0100111011100100000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	

	CASE 5
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 4,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 6,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 7,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 8,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 9,"0111111111111110000"
		CALL MAKE_FLOOR_LINE,10,"0700000000000011000"
		CALL MAKE_FLOOR_LINE,11,"0000000000000001000"
		CALL MAKE_FLOOR_LINE,12,"0111000116000001110"
		CALL MAKE_FLOOR_LINE,13,"0111000100000001010"
		CALL MAKE_FLOOR_LINE,14,"0020000100000000010"
		CALL MAKE_FLOOR_LINE,15,"0111111100010000110"
		CALL MAKE_FLOOR_LINE,16,"0000000100010001100"
		CALL MAKE_FLOOR_LINE,17,"0000011111111111000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 6
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 4,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 6,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 7,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 8,"0000000000061000000"
		CALL MAKE_FLOOR_LINE, 9,"0000000000001000000"
		CALL MAKE_FLOOR_LINE,10,"0001111111001000000"
		CALL MAKE_FLOOR_LINE,11,"0001000001001000000"
		CALL MAKE_FLOOR_LINE,12,"0001000007001111000"
		CALL MAKE_FLOOR_LINE,13,"0001000000000100000"
		CALL MAKE_FLOOR_LINE,14,"0001000000111111000"
		CALL MAKE_FLOOR_LINE,15,"0001111100100000000"
		CALL MAKE_FLOOR_LINE,16,"0000000111100000000"
		CALL MAKE_FLOOR_LINE,17,"0000000000000000000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 7
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0111110010010090010"
		CALL MAKE_FLOOR_LINE, 2,"0100000010010020020"
		CALL MAKE_FLOOR_LINE, 3,"0100111011110011110"
		CALL MAKE_FLOOR_LINE, 4,"0111101110011110010"
		CALL MAKE_FLOOR_LINE, 5,"0100000000000000010"
		CALL MAKE_FLOOR_LINE, 6,"0111111110000110010"
		CALL MAKE_FLOOR_LINE, 7,"0000000011110011110"
		CALL MAKE_FLOOR_LINE, 8,"0000100000070000100"
		CALL MAKE_FLOOR_LINE, 9,"0000100000000000100"
		CALL MAKE_FLOOR_LINE,10,"0000100000011111110"
		CALL MAKE_FLOOR_LINE,11,"0011111000000000010"
		CALL MAKE_FLOOR_LINE,12,"0010001100001110010"
		CALL MAKE_FLOOR_LINE,13,"0111100101111010010"
		CALL MAKE_FLOOR_LINE,14,"0100100101000011110"
		CALL MAKE_FLOOR_LINE,15,"0011100111011110010"
		CALL MAKE_FLOOR_LINE,16,"0010000101002000010"
		CALL MAKE_FLOOR_LINE,17,"0011210101001000110"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
		;イベントの設置
		CALL SET_TILE,5,17,ダンジョンフラグ:(FLAG:現ダンジョン):1,0,4
		CALL SET_TILE,12,17,ダンジョンフラグ:(FLAG:現ダンジョン):2,0,4
		CALL SET_TILE,17,1,ダンジョンフラグ:(FLAG:現ダンジョン):3,0,4

	CASEELSE
ENDSELECT



;=======================================================================
;[5]調べる　実行時のイベント
;=======================================================================
@EVENT_CHECK_DUNGEON_19

;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
	SELECTCASE FLAG:現M
		CASE 0
			CALL DUNGEON_UPSTAIRS,1,(FLAG:現X),(FLAG:現Y)
		CASE 1
			CALL DUNGEON_UPSTAIRS,2,(FLAG:現X),(FLAG:現Y)
		CASE 2
			CALL DUNGEON_UPSTAIRS,3,(FLAG:現X),(FLAG:現Y)
		CASE 3
			CALL DUNGEON_UPSTAIRS,4,(FLAG:現X),(FLAG:現Y)
		CASE 4
			CALL DUNGEON_UPSTAIRS,5,(FLAG:現X),(FLAG:現Y)
		CASE 5
			CALL DUNGEON_UPSTAIRS,6,(FLAG:現X),(FLAG:現Y)
		CASE 6
			CALL DUNGEON_UPSTAIRS,7,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
	RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	SELECTCASE FLAG:現M
		CASE 1
			CALL DUNGEON_DOWNSTAIRS,0,(FLAG:現X),(FLAG:現Y)
		CASE 2
			CALL DUNGEON_DOWNSTAIRS,1,(FLAG:現X),(FLAG:現Y)
		CASE 3
			CALL DUNGEON_DOWNSTAIRS,2,(FLAG:現X),(FLAG:現Y)
		CASE 4
			CALL DUNGEON_DOWNSTAIRS,3,(FLAG:現X),(FLAG:現Y)
		CASE 5
			CALL DUNGEON_DOWNSTAIRS,4,(FLAG:現X),(FLAG:現Y)
		CASE 6
			CALL DUNGEON_DOWNSTAIRS,5,(FLAG:現X),(FLAG:現Y)
		CASE 7
			CALL DUNGEON_DOWNSTAIRS,6,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
RETURN 1

;========
;イベントの処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 4
	SELECTCASE FLAG:現M
		CASE 7
			SIF FLAG:現X == 12 && FLAG:現Y == 17
				CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "……まだ何か用か？/何時までもこんな所に居るもんじゃないぞ……"
				;あなたらしき人影
	ENDSELECT
	RETURN 1
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 9
	CALL DUNGEON_TERMINAL
	RETURN 1
ELSE
	PRINTW Nothing seems to be here.
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時のイベント
;=======================================================================
@EVENT_ENTER_DUNGEON_19,ARG
#LOCALSIZE 2
#LOCALSSIZE 1
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
	SELECTCASE FLAG:現M
		CASE 0
			CALL DUNGEON_UPSTAIRS,1,(FLAG:現X),(FLAG:現Y)
		CASE 1
			CALL DUNGEON_UPSTAIRS,2,(FLAG:現X),(FLAG:現Y)
		CASE 2
			CALL DUNGEON_UPSTAIRS,3,(FLAG:現X),(FLAG:現Y)
		CASE 3
			CALL DUNGEON_UPSTAIRS,4,(FLAG:現X),(FLAG:現Y)
		CASE 4
			CALL DUNGEON_UPSTAIRS,5,(FLAG:現X),(FLAG:現Y)
		CASE 5
			CALL DUNGEON_UPSTAIRS,6,(FLAG:現X),(FLAG:現Y)
		CASE 6
			CALL DUNGEON_UPSTAIRS,7,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
	RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	SELECTCASE FLAG:現M
		CASE 1
			CALL DUNGEON_DOWNSTAIRS,0,(FLAG:現X),(FLAG:現Y)
		CASE 2
			CALL DUNGEON_DOWNSTAIRS,1,(FLAG:現X),(FLAG:現Y)
		CASE 3
			CALL DUNGEON_DOWNSTAIRS,2,(FLAG:現X),(FLAG:現Y)
		CASE 4
			CALL DUNGEON_DOWNSTAIRS,3,(FLAG:現X),(FLAG:現Y)
		CASE 5
			CALL DUNGEON_DOWNSTAIRS,4,(FLAG:現X),(FLAG:現Y)
		CASE 6
			CALL DUNGEON_DOWNSTAIRS,5,(FLAG:現X),(FLAG:現Y)
		CASE 7
			CALL DUNGEON_DOWNSTAIRS,6,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
	RETURN 1

;========
;イベントの処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 4
	IF FLAG:現M == 0
		LOCAL:1 = 0
		;PT内に異聞録女キャラが一人だけいるときに通過可能
		FOR LOCAL, 1, 7
			;空きポジションは勘定外
			SIF POS(LOCAL) < 0
				CONTINUE
			;主人は勘定外
			SIF POS(LOCAL) == MASTER
				CONTINUE
			;Human以外は勘定外
			SIF ABL:POS(LOCAL):種族
				CONTINUE
			;人数カウント
			LOCAL:1++
			;条件を満たす人間の数をカウント
			SELECTCASE NO:POS(LOCAL)
				CASE [[キャラ:エリー]]
					ダンジョンフラグ:(FLAG:現ダンジョン):0 = 1
				CASE [[キャラ:アヤセ]]
					ダンジョンフラグ:(FLAG:現ダンジョン):0 = 2
				CASE [[キャラ:麻希]]
					ダンジョンフラグ:(FLAG:現ダンジョン):0 = 3
			;	CASE [[キャラ:ゆきのさん]]
			;		ダンジョンフラグ:(FLAG:現ダンジョン):0 = 4
				CASEELSE
					;4人以外の人間がいる場合は追加で人数加算することで強制的に定員オーバー
					LOCAL:1 += 100
			ENDSELECT
		NEXT
		;人数カウントが1以外の時
		IF LOCAL:1 != 1
			CALL SHOW_FORCEMOVE, "D", "D", , , "＞You where pushed back by a strange force."
			;奇妙な力で押し返された
			CALL MESSAGE_WINDOW_D, "", @"＞Maybe you don't have a person that can pass here with you,/＞or maybe you have too many people with you.../＞Only one of them can proceed together with %CALLNAME:MASTER%."
			;＞ここに踏み入る資格を持つ人間が居ないのか、/＞或いは人が多過ぎて拒絶されているのか……/＞資格を持つ人間と、%CALLNAME:MASTER%の二人だけなら進めるかもしれない
		ENDIF
	ELSEIF FLAG:現M == 7
		IF FLAG:現X == 5 && FLAG:現Y == 17
			CALL SHOW_PICTURE, "D"
			CALL MESSAGE_WINDOW_D, "", "＞Just like a night sky,/＞there was a void space spreading as far as you could see,/＞with countles stars flickering..."
			;そこはまるで夜空の様だった/＞見渡す限りに虚空が広がり/＞そこに無数の星々が明滅している……
			IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 1
				CALL MESSAGE_WINDOW_D, "Eriko", "Really!?/Can I believe this?/That one of those..."
				;Realy！？/信じられて？/あの光一つ一つが……
			ELSEIF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 2
				CALL MESSAGE_WINDOW_D, "Ayase", @"Awesome!/%ANATANAME("T", "!!/, t")% ake a look at that star there, wow..."
				;凄い！/%ANATANAME(, "！！/")%みてよ、あの星、あれ……
			ELSEIF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 3
				CALL MESSAGE_WINDOW_D, "Maki", "...that star, that one light...."
				;……あの星、あの光一つ一つが……
				CALL MESSAGE_WINDOW_D, "", "＞Maki looked up at it for a while./＞She gently murmured something to herself while gazing into the distance."
				;麻希は暫く呆然とそれを見上げていたが/＞何処か遠くを見る様な眼でそっとつぶやいた
			ENDIF
			CALL MESSAGE_WINDOW_D, "", "＞This is a person's consciousness./＞A place similar to a persons's heart./＞Thats where you where now."
			;人の意識なのだと/＞人の心に通じる場所に/＞今自分たちは居るのだと彼女は語った
			CALL MESSAGE_WINDOW_D, "", "＞...there must be some purposeful objects here."
			;……そしてここに目的の物があるに違いない
			CALL MESSAGE_WINDOW_D, "", "........./...../..."
			CALL MESSAGE_WINDOW_D, "", "＞Following the light of what you seek amid this emtyness,/＞wasn't difficult."
			;虚空の中から目当ての光を見つけ出すのは、/＞そう難しくは無かった
			CALL MESSAGE_WINDOW_D, "", "＞Eventually, you found the consciousness of the 'real' Maki Sonomura./＞However, it looked weak, withered./＞You'll have to listen intently to her words/＞because her voice is weak."
			;だが、見つけ出した「本物」の園村 麻希の意識は/＞あちこち虫食いの様に欠けた無残な姿であった/＞その言葉も耳を澄まさなければ/＞聞き取れないほど弱弱しい
			IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 3
				CALL MESSAGE_WINDOW_D, "", @"＞Maki, who was brought by %CALLNAME:MASTER%, rushed over to her/＞and intensively tried to appeal to her 'Body'."
				;%CALLNAME:MASTER%が連れてきた麻希は必死に、/＞そして激しく己の「本体」に語りかけ、訴えかけた
				CALL MESSAGE_WINDOW_D, "", "＞Did the real Maki feel something?/＞'Maki Sonomura's other self,/＞was handed the compact she had hanging arround her neck."
				;そこに何か感じる物があったのだろうか？/＞「園村 麻希」はもう一人の己に/＞自分の首から下げていたコンパクトを手渡した
				CALL MESSAGE_WINDOW_D, "", "＞You received the compact."
				;コンパクトを手に入れた
				ITEM:コンパクト = 1
				CALL MESSAGE_WINDOW_D, "Maki", "I guess this is the key./...it's all I needed."
				;これが多分、鍵なんだと思う/……これで必要な物は揃ったね
				CALL MESSAGE_WINDOW_D, "", @"＞Maki muttered to herself as if to confirm something,/＞then she looked over at %CALLNAME:MASTER%."
				;麻希はそれを確かめるように呟いて、/＞%CALLNAME:MASTER%に目を向けた
				CALL MESSAGE_WINDOW_D, "Maki", "Please, help me a bit more."
				;お願い、もう少しだけ手を貸して
				ダンジョンフラグ:(FLAG:現ダンジョン):1 = 1
				FLAG:脱出 = 1
			ELSE
				IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 1
					CALL MESSAGE_WINDOW_D, "", "＞Eriko desperately appealed to 'Maki Sonomura'."
					;エリーは必死に「園村 麻希」に訴えかけた
				ELSEIF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 2
					CALL MESSAGE_WINDOW_D, "", "＞Ayase desperately appealed to 'Maki Sonomura'."
					;アヤセは必死に「園村 麻希」に訴えかけた
				ENDIF
				CALL MESSAGE_WINDOW_D, "", @"＞However, 'Maki Sonomura' didn't show any interrest./＞When they stopped talking,/＞'Maki Sonomura' turned to %CALLNAME:MASTER%."
				;だが、「園村 麻希」は関心を示さない/＞やがて話が途切れると、/＞「園村 麻希」は%CALLNAME:MASTER%の方を向いた
				CALL MESSAGE_WINDOW_D, "Maki Sonomura", "Hey, why did you come to this place?/Why can't you just leave me alone?"
				;ねぇ、あなたはどうしてこんな所まで来たの？/私の事なんて放っておけば良かったんじゃないの？
				CALL INPUT_SELECT_D, "[0] Maybe I will/[1] Because I gain something by saving you/[2] I want to save you"
				;そうかも知れない/[1] 麻希を救う事に得があるから/[2] 救いたいから
				LOCAL = RESULT
				SELECTCASE LOCAL
					CASE 0
						CALL MESSAGE_WINDOW_D, "Maki Sonomura", "...well. Then just go back home..."
						;……そう。じゃあ早く帰って……
						CALL MESSAGE_WINDOW_D, "", @"＞'Maki Sonomura' said so and closed her mouth./＞All further attempts by %CALLNAME:MASTER% to get her to speak where met with silence."
						;「園村 麻希」はそう言って口を閉じ/＞二度と%CALLNAME:MASTER%の言葉にこたえることはなかった
						CALL MESSAGE_WINDOW_D, "", "＞With this, the conversation had failed./＞Since you couldn't get 'Maki Sonomura's cooperation,/＞you can no longer solve this on your own."
						;残念ながら、話し合いは失敗した/＞「園村 麻希」の協力を得られなかった以上/＞独力解決の道は断たれた
						CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER% decided to report this to the Phantom Society/＞and to leave all this behind./＞With that resolve, you left the Alaya Cavern."
						;%CALLNAME:MASTER%はファントムに報告し/＞後を任せることにして/＞アラヤの岩戸を後にすることにした
						CALL MESSAGE_WINDOW_D, "", "........./...../..."
						CALL SHOW_PICTURE, "EMPTY"
						CALL SHOW_PICTURE, "NONFLOORD"
						CALL MESSAGE_WINDOW_D, "", "＞...you received a report from the Phantom Society later./＞There was a document detailing the technology gained from the investigation of the DEVA system./＞Since your Maki is still here,/＞the DEVA system might not have been stopped completely."
						;……後ほどファントムから/＞DEVAシステムの調査によって得られた技術についての資料が届いた/＞麻希が消えたりはしていない辺り、/＞DEVAシステムは停止していないのだろう
						CALL MESSAGE_WINDOW_D, "", @"＞But what exactly the Phantom Society did to the system/＞and what happened to the real 'Maki Sonomura',/＞%CALLNAME:MASTER% never found out..."
						;だが、ファントムがシステムをどうしたのか、/＞本物の「園村 麻希」がどうなったのかについて、/＞%CALLNAME:MASTER%が知る事は無かった……
						CALL MESSAGE_WINDOW_D, "", "＞As compensation for the role you played in this investigation, you where paid ￥50000."
						;この件の報酬として、￥50000が支払われた
						;速やかに報告しなかったペナルティで報酬が減っている
						ダンジョンフラグ:(FLAG:現ダンジョン):1 = 2
						ダンジョンフラグ:11:7 = 1
						CALL INCREASE_LD,-5
						FLAG:脱出 = 1
						MONEY += 50000
					CASE 1
						CALL MESSAGE_WINDOW_D, "", "＞You are not sure if she is good for manual labor,/＞but just her looks alone make her valueable."
						;手間に見合うか否かは置いて、/＞女と言うだけで確保しておく価値はある
						CALL MESSAGE_WINDOW_D, "", @"＞When %CALLNAME:MASTER% shared %HIS_HER(MASTER)% thoughts on the benefits of saving her,/＞'Maki Sonomura' made a step back, as if repulsed."
						;%CALLNAME:MASTER%の脳裡をよぎった「メリット」の内容に気が付いたのだろうか、/＞「園村 麻希」はおぞましい物を見るように、一歩下がった
						CALL MESSAGE_WINDOW_D, "Maki Sonomura", "...return home. NOW...."
						;……帰って、今すぐ……
						CALL INPUT_YN_D,"Yes","No"
						IF RESULT == 0
							CALL MESSAGE_WINDOW_D, "", "＞With this, the conversation had failed./＞Since you couldn't get 'Maki Sonomura's cooperation,/＞you can no longer solve this on your own."
							CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER% decided to report this to the Phantom Society/＞and to leave all this behind./＞With that resolve, you left the Alaya Cavern."
							CALL MESSAGE_WINDOW_D, "", "........./...../..."
							CALL SHOW_PICTURE, "EMPTY"
							CALL SHOW_PICTURE, "NONFLOORD"
							CALL MESSAGE_WINDOW_D, "", "＞...you received a report from the Phantom Society later./＞There was a document detailing the technology gained from the investigation of the DEVA system./＞Since your Maki is still here,/＞the DEVA system might not have been stopped completely."
							CALL MESSAGE_WINDOW_D, "", @"＞But what exactly the Phantom Society did to the system/＞and what happened to the real 'Maki Sonomura',/＞%CALLNAME:MASTER% never found out..."
							CALL MESSAGE_WINDOW_D, "", "＞As compensation for the role you played in this investigation, you where paid ￥50000."
							;速やかに報告しなかったペナルティで報酬が減っている
							CALL INCREASE_LD,-10
							ダンジョンフラグ:(FLAG:現ダンジョン):1 = 2
							ダンジョンフラグ:11:7 = 1
							FLAG:脱出 = 1
							MONEY += 50000
						ELSE
							;ボス戦
							CALL MESSAGE_WINDOW_D, "Maki Sonomura", "...return home...!"
							;……帰ってぇっ……！
							CALL MESSAGE_WINDOW_D, "", @"＞With a shout by 'Maki Sonomura' the compact on her chest lowered and began to emit light./＞Masky objects appeared and surrounded %CALLNAME:MASTER%."
							;「園村 麻希」の叫びと共に、胸から下げたコンパクトが光を放ち、/＞仮面の様な物が%CALLNAME:MASTER%達を取り囲んだ
							FLAG:逃走不可フラグ = 1
							FLAG:会話不能フラグ = 1
							FLAG:先制不意打ちキャンセル = 1
							CALL MESSAGE_WINDOW_D, "", "＞６ Karma's appeared!"
							;業魔が６体出た！
							CALL SET_ENEMY,7,1020,45,0,1
							CALL SET_ENEMY,8,1021,47,0,1
							CALL SET_ENEMY,9,1022,49,0,1
							CALL SET_ENEMY,10,1023,50,0,1
							CALL SET_ENEMY,11,1024,52,0,1
							CALL SET_ENEMY,12,1025,55,0,1
							CALL BATTLE_START
							FLAG:逃走不可フラグ = 0
							FLAG:会話不能フラグ = 0
							FLAG:先制不意打ちキャンセル = 0
							CALL SHOW_PICTURE, "D"
							CALL MESSAGE_WINDOW_D, "Maki Sonomura", "....Ah...a...."
							CALL MESSAGE_WINDOW_D, "", "＞You took the compact from the frightened 'Maki Sonomura'./＞...it seems this is the key."
							;怯える「園村 麻希」が後生大事に抱えているコンパクトを奪い取った/＞……おそらくこれが鍵なのだろうと思われる
							CALL MESSAGE_WINDOW_D, "", "＞You received the compact."
							ITEM:コンパクト = 1
							IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 1
								CALL MESSAGE_WINDOW_D, "", @"＞Eriko was staring at %CALLNAME:MASTER% with wide eyes./＞Even though you where doing this to save Maki,/＞her resolved seemed to waver."
								;エリーは、%CALLNAME:MASTER%を眉を顰めて睨んでいる/＞麻希を助けるためとはいえ/＞納得がいかないようだ
								CALL MESSAGE_WINDOW_D, "Eriko", "（If we don't do this, Maki won't be saved, but...）"
								;（こうしなければ、Makiは助からないのかも知れませんけど……）
								BASE:GETCHARA([[キャラ:エリー]]):忠誠度 -= 500
							ELSE
								CALL MESSAGE_WINDOW_D, "", @"＞Ayase was staring at %CALLNAME:MASTER% with wide eyes./＞Even though you where doing this to save Maki,/＞her resolved seemed to waver."
								CALL MESSAGE_WINDOW_D, "Ayase", "（...a bit....aren't we doing something terrible here?...）"
								;（……ちょっとぉ……これ酷いんじゃないかな……）
								BASE:GETCHARA([[キャラ:アヤセ]]):忠誠度 -= 500
							ENDIF
							CALL MESSAGE_WINDOW_D, "", @"＞Ignoring the gaze of %HIS_HER(MASTER)% companion, %CALLNAME:MASTER% left the Alaya Cavern."
							;%CALLNAME:MASTER%は非難の視線を気にせずアラヤの岩戸を後にした
							CALL INCREASE_LD,-10
							ダンジョンフラグ:(FLAG:現ダンジョン):1 = 1
							FLAG:脱出 = 1
						ENDIF
					CASE 2
						;話し合い成功？
						CALL MESSAGE_WINDOW_D, "Maki Sonomura", "...why...why do you want that...."
						;……どうして……あなたにそんな理由……
						IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 1
							CALL MESSAGE_WINDOW_D, "Eriko", "あら、理由がなければ手を差し伸べてはいけませんの？"
						ELSE
							CALL MESSAGE_WINDOW_D, "Ayase", "理由がどうとかややこしく考えなくて良いんじゃないのぉ？"
						ENDIF
						CALL MESSAGE_WINDOW_D, "Maki Sonomura", "＞その言葉に何か感じる物があったのだろうか？/＞'Maki Sonomura' gave you a brief smile/＞and handed you the compact she had hanging from her neck."
						;その言葉に何か感じる物があったのだろうか？/＞「園村 麻希」は儚げに微笑んで、/＞首から下げていたコンパクトを手渡してくれた
						CALL MESSAGE_WINDOW_D, "", "＞You received the compact."
						ITEM:コンパクト = 1
						CALL INCREASE_LD,+10
						ダンジョンフラグ:(FLAG:現ダンジョン):1 = 1
						FLAG:脱出 = 1
				ENDSELECT
			ENDIF
		ELSEIF FLAG:現X == 12 && FLAG:現Y == 17
			;最強封神具
			IF ダンジョンフラグ:(FLAG:現ダンジョン):2 == 0
				IF ダンジョンフラグ:(FLAG:現ダンジョン):3 == 0
					CALL MESSAGE_WINDOW_D, "", @"＞There was a person here./＞It's face was hazy somehow and you couldn't see it clearly/＞but from the clothes and posture, it looked exactly like %CALLNAME:MASTER%..."
					;そこには一人の人間がいた/＞その人間の顔は靄がかかったようではっきりとは見えないが/＞服装からしぐさまで、何から何まで%CALLNAME:MASTER%にそっくりだ……
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "……こんな所まで来たのか、ご苦労な事だな？/だけどよ、こんな事してる場合かぁ？/ファントムからのノルマは果たしたのかよ？"
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "てめぇのケツに火がついてんじゃねぇのか？/ビタ一文にもなりゃしねぇ事やってて良いのか/...how do I know this?/Because I am you too."
					;てめぇのケツに火がついてんじゃねぇのか？/ビタ一文にもなりゃしねぇ事やってて良いのか/……なんでそんな事知ってるかって？/俺もお前だからだよ
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "Our ability, even personality may be different,/everything may be differnt,/yet, I'm still a part of you."
					;性格も違えば、能力も違う、/何もかもが異なってるかも知れんが、/それでも俺はお前の人格の一つなのさ
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "...from the bottom of your unconsciousness, all I can do is watch./And see what kind of person you become.."
					;……無意識の底から、お前の行動を眺めてる事しか出来ない、/ちんけな人格だがな
					CALL MESSAGE_WINDOW_D, "", @"＞ククッと%ANATANAME("Your 'other self'", "？")%は不快な笑みを浮かべた"
				ELSE
					CALL MESSAGE_WINDOW_D, "", @"＞先ほど出会った、%CALLNAME:MASTER%にそっくりな人影がいる/＞相変わらず、顔は靄が掛かったように見えない"
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "お前の面をまた見るとはなぁ……"
				ENDIF
				LOCAL = 0
				IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 1
					LOCALS = Eriko
					;エリー
					LOCAL = 4514
				ELSEIF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 2
					LOCALS = Ayase
					;アヤセ
					LOCAL = 4515
				ELSE
					LOCALS = Maki
					;麻希
					LOCAL = 4519
				ENDIF
				IF LOCAL
					CALL MESSAGE_WINDOW_D, "" , @"＞ただならぬ雰囲気を感じたのか、%LOCALS%が/＞%CALLNAME:MASTER%にそっと寄り添ってきた"
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "...hmm, anyway./I don't have anything for you here./That woman with you on the other hand..."
					;……ふ〜ん、まぁいいやな/いずれにせよ、お前にはここで得られる物など何もない/だが、そこの姉ちゃんはその限りじゃねぇな……
					LOCAL = GETCHARA(LOCAL)
					CALL MESSAGE_WINDOW_D, "", @"＞%ANATANAME("Your 'other self'", "？")% took something from %HIS_HER(MASTER)% pocket/＞and handed it to %LOCALS%."
					;は、ポケットから何かを取りだすと、/＞それを%LOCALS%に押し付けるように手渡した
					IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 1
						CALL MESSAGE_WINDOW_D, "", "＞エリーが受け取ったのは一冊の本の様だ/＞それを受け取った途端、/＞エリーの背後から、彼女のペルソナ「二ケー」が出現する"
						CALL MESSAGE_WINDOW_D, "", "＞本は燃えるように光を放ち、/＞二ケーに吸い込まれるように消えた/＞エリーの初期ペルソナが成長した！"
						ABL:LOCAL:初期ペルソナ = [[キャラ:ミカエル(ペルソナ)]]
					ELSEIF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 2
						CALL MESSAGE_WINDOW_D, "", "＞アヤセが受け取ったのは……鹿の剥製……か？/＞それを受け取った途端、アヤセの背後から、/＞彼女のペルソナ「フーリー」が出現する"
						CALL MESSAGE_WINDOW_D, "", "＞剥製は燃えるように光を放ち、/＞フーリーに吸い込まれるように消えた/＞アヤセの初期ペルソナが成長した！"
						ABL:LOCAL:初期ペルソナ = [[キャラ:フレイ(ペルソナ)]]
					ELSE
						CALL MESSAGE_WINDOW_D, "", "＞麻希が受け取ったのは宝石の飾り物の様に見える/＞それを受け取った途端、麻希の背後から、/＞彼女のペルソナ「マソ」が出現する"
						CALL MESSAGE_WINDOW_D, "", "＞宝石は燃えるように光を放ち、/＞マソに吸い込まれるように消えた/＞麻希の初期ペルソナが成長した！"
						ABL:LOCAL:初期ペルソナ = [[キャラ:ヴェルザンディ(ペルソナ)]]
					ENDIF
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "……んじゃな"
					CALL SYNC_STATUS, LOCAL
					ダンジョンフラグ:(FLAG:現ダンジョン):2 = 1
				ENDIF
			ELSE
				CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "もう、ここには用はないだろう？/だったら早く出ていきな/あんまり長居する様な場所じゃないぞ……"
				CALL MESSAGE_WINDOW_D, , @"＞%ANATANAME("Your 'other self'", "？")%は、そう言って背を向け、掻き消す様に消えた"
			ENDIF
		ELSEIF FLAG:現X == 17 && FLAG:現Y == 1
			;鏡装備
			IF ダンジョンフラグ:(FLAG:現ダンジョン):3 == 0
				IF ダンジョンフラグ:(FLAG:現ダンジョン):2 == 0
					;最強ペルソナイベント見てない
					CALL MESSAGE_WINDOW_D, "", @"＞There was a person here./＞It's face was hazy somehow and you couldn't see it clearly/＞but from the clothes and posture, it looked exactly like %CALLNAME:MASTER%..."
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "……こんな所まで来たのか、ご苦労な事だな？/だけどよ、こんな事してる場合かぁ？/ファントムからのノルマは果たしたのかよ？"
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "てめぇのケツに火がついてんじゃねぇのか？/ビタ一文にもなりゃしねぇ事やってて良いのか/……なんでそんな事知ってるかって？/俺もお前だからだよ"
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "Our ability, even personality may be different,/everything may be differnt,/yet, I'm still a part of you."
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "...from the bottom of your unconsciousness, all I can do is watch./And see what kind of person you become.."
					CALL MESSAGE_WINDOW_D, "", @"＞ククッと%ANATANAME("Your 'other self'", "？")%は不快な笑みを浮かべた"
				ELSE
					CALL MESSAGE_WINDOW_D, "", @"＞先ほど出会った、%CALLNAME:MASTER%にそっくりな人影がいる/＞相変わらず、顔は靄が掛かったように見えない"
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "お前の面をまた見るとはなぁ……"
				ENDIF
				CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "まぁ、ここまで来た以上はこれを渡しておかんとな"
				CALL MESSAGE_WINDOW_D, "", @"＞%ANATANAME("Your 'other self'", "？")%はいかにも嫌そうにポケットをごそごそまさぐり始めた"
				LOCAL = 0
				IF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 1
					LOCAL = 4514
					LOCALS = Eriko
					;エリー
				ELSEIF ダンジョンフラグ:(FLAG:現ダンジョン):0 == 2
					LOCAL = 4515
					LOCALS = Ayase
					;アヤセ
				ELSE
					LOCAL = 4519
					LOCALS = Maki
					;麻希
				ENDIF
				IF LOCAL
					LOCAL:1 = 0
					LOCAL = GETCHARA(LOCAL)
					IF 陥落(LOCAL) >= 2
						CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "This woman..../It seems you did pretty good..."
						;そこの女……/なかなかうまい事やったみたいじゃないか……
						CALL MESSAGE_WINDOW_D, "", @"＞%ANATANAME("Your 'other self'", "？")% said./＞%LOCALS% blushed at thoose words./＞%ANATANAME("Your 'other self'", "？")%は舌打ちをして、/＞%HE_SHE(MASTER,1)% took a mirror shard from %HIS_HER(MASTER)% pocket and gave it to you."
						;＞%ANATANAME("Your 'other self'", "？")%の言葉に/＞%LOCALS%は頬を赤らめた/＞%ANATANAME("Your 'other self'", "？")%は舌打ちをして、/＞ポケットから鏡の破片を取り出して寄越した"
						CALL MESSAGE_WINDOW_D, "", @"＞In %CALLNAME:MASTER%'s hands, the mirror fragment turned into a sword./＞You got a Spiegel Blade."
						;鏡の破片は、%CALLNAME:MASTER%の手中で一振りの剣に変わった/＞Spiegel Bladeを手に入れた。
						LOCAL:1 += 1
						ITEM:"Spiegel Blade" += 1
					ENDIF
					IF ダンジョンフラグ:12:2 == 1 || ダンジョンフラグ:12:3 == 1
						CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "Odd how heavily some people rely on you."
						;お前の事を随分と頼りにしている奴もいるらしい、奇特な事だ
						CALL MESSAGE_WINDOW_D, "", @"＞%ANATANAME("Your 'other self'", "？")% said./＞%LOCALS% responded with a smile./＞%ANATANAME("Your 'other self'", "？")%は鼻を鳴らして、/＞%HE_SHE(MASTER,1)% took a mirror shard from %HIS_HER(MASTER)% pocket and gave it to you."
						;は笑顔で答えた
						CALL MESSAGE_WINDOW_D, "", @"＞In %CALLNAME:MASTER%'s hands, the mirror fragment turned into a mask./＞You got a Spiegel Mask."
						;鏡の破片は、%CALLNAME:MASTER%の手中で一枚の仮面に変わった/＞Spiegel Maskを手に入れた。
						LOCAL:1 += 1
						ITEM:"Spiegel Mask" += 1
					ENDIF
					;P1ヒロイン全員保有
					IF FINDCHARA_B(4519,0) != -1 && FINDCHARA_B(4514,0) != -1 && FINDCHARA_B(4515,0) != -1 && FINDCHARA_B(4535,0) != -1
						CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "You got a talent to make friends don't you?"
						;上手く味方を増やしたもんだな？
						CALL MESSAGE_WINDOW_D, "", @"＞%ANATANAME("Your 'other self'", "？")% said./＞%LOCALS% gazed at %ANATANAME("Your 'other self'", "？")%./＞%ANATANAME("Your 'other self'", "？")%は鼻を鳴らして、/＞%HE_SHE(MASTER,1)% took a mirror shard from %HIS_HER(MASTER)% pocket and gave it to you."
						;を睨みつけた
						CALL MESSAGE_WINDOW_D, "", @"＞In %CALLNAME:MASTER%'s hands, the mirror fragment turned into an armor./＞You got a Spiegel Mail."
						;鏡の破片は、%CALLNAME:MASTER%の手中で鎧に変わった/＞Spiegel Mailを手に入れた。
						LOCAL:1 += 1
						ITEM:"Spiegel Mail" += 1
					ENDIF
					CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "……んじゃな"
					CALL SYNC_STATUS, LOCAL
					ダンジョンフラグ:(FLAG:現ダンジョン):3 = 1
				ENDIF
			ELSE
				CALL MESSAGE_WINDOW_D, ANATANAME("Your 'other self'", "？"), "もう、ここには用はないだろう？/だったら早く出ていきな/あんまり長居する様な場所じゃないぞ……"
				CALL MESSAGE_WINDOW_D, , @"＞%ANATANAME("Your 'other self'", "？")%は、そう言って背を向け、掻き消す様に消えた"
			ENDIF
		ENDIF
	ENDIF
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 9
	CALL DUNGEON_TERMINAL
	RETURN 1
ENDIF

RETURN 0

;=======================================================================
;必要レベル目安
;推奨LV 雑魚最低LV 雑魚最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_19
RETURN 48, 45, 55, 0
;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_19
FLAG:エンカウント率 = MAX((FLAG:未遭遇歩数 - 5) * 5, 0)
;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_19
IF RAND:100 < FLAG:エンカウント率
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF
;=======================================================================
;敵の種族の種類数
;=======================================================================
@CLASS_NUM_19
RETURN CLASS_NUM_COMMON("上級")
;=======================================================================
;敵の総数
;ARGは出現する敵の種類です
;=======================================================================
@ENEMY_NUM_19, ARG
RETURN ENEMY_NUM_COMMON("上級", ARG)
;=======================================================================
;敵の種類
;=======================================================================
@ENEMY_19, ARG
SELECTCASE RAND:100
	CASE IS < 20
		RETURN 1020, 45
	CASE IS < 40
		RETURN 1021, 47
	CASE IS < 60
		RETURN 1022, 49
	CASE IS < 80
		RETURN 1023, 50
	CASE IS < 90
		RETURN 1024, 52
	CASE IS < 100
		RETURN 1025, 55
ENDSELECT

