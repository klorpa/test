;=======================================================================
;アヴィディア界
;
;ダンジョンナンバー60
;=======================================================================
;ダンジョンフラグ:(FLAG:現ダンジョン):0 = クリアフラグ
;ダンジョンフラグ:(FLAG:現ダンジョン):1 = ショートカットスイッチ？
;
;その他みているフラグ
;イベントフラグ:1:0 マヨーネＧＥＴフラグ
;=======================================================================
;攻略条件
;=======================================================================
@PREREQUISITE_DUNGEON_60
;岩戸クリア
IF ダンジョンフラグ:19:1 == 1 && ダンジョンフラグ:60:0 == 0
	RETURN 1
ELSE
	RETURN 0
ENDIF

;=======================================================================
;ダンジョン名
;=======================================================================
@GET_DUNGEON_NAME_60
RESULTS = Avidya World


;=======================================================================
;フロア名表示
;=======================================================================
@FLOORNAME_60
PRINT Avidya World

;=======================================================================
;特殊タイル表示
;=======================================================================
@TILE_MARK_60_0_18_8
RESULTS = →
@TILE_MARK_60_0_18_10
RESULTS = →
@TILE_MARK_60_0_18_14
RESULTS = →
@TILE_MARK_60_0_18_16
RESULTS = →
@TILE_MARK_60_1_18_8
RESULTS = →
@TILE_MARK_60_1_18_10
RESULTS = →
@TILE_MARK_60_4_18_5
RESULTS = →
@TILE_MARK_60_4_18_7
RESULTS = →
@TILE_MARK_60_4_18_13
RESULTS = →
@TILE_MARK_60_4_18_15
RESULTS = →
@TILE_MARK_60_5_18_2
RESULTS = →
@TILE_MARK_60_5_18_4
RESULTS = →
@TILE_MARK_60_5_18_14
RESULTS = →
@TILE_MARK_60_5_18_16
RESULTS = →

@TILE_MARK_60_1_0_8
RESULTS = ←
@TILE_MARK_60_1_0_10
RESULTS = ←
@TILE_MARK_60_1_0_14
RESULTS = ←
@TILE_MARK_60_1_0_16
RESULTS = ←
@TILE_MARK_60_2_0_8
RESULTS = ←
@TILE_MARK_60_2_0_10
RESULTS = ←
@TILE_MARK_60_3_0_5
RESULTS = ←
@TILE_MARK_60_3_0_7
RESULTS = ←
@TILE_MARK_60_3_0_13
RESULTS = ←
@TILE_MARK_60_3_0_15
RESULTS = ←
@TILE_MARK_60_4_0_2
RESULTS = ←
@TILE_MARK_60_4_0_4
RESULTS = ←
@TILE_MARK_60_4_0_14
RESULTS = ←
@TILE_MARK_60_4_0_16
RESULTS = ←

@TILE_MARK_60_0_4_0
RESULTS = ↑
@TILE_MARK_60_0_6_0
RESULTS = ↑

@TILE_MARK_60_6_4_18
RESULTS = ↓
@TILE_MARK_60_6_6_18
RESULTS = ↓

@TILE_MARK_60_2_2_5
RESULTS = Ｔ
@TILE_MARK_60_5_2_12
RESULTS = Ｔ


;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_60,ARG
FLAG:現M = 0
FLAG:現X = 3
FLAG:現Y = 18
;CALL AUTOMAP

;=======================================================================
;スタート時イベント
;=======================================================================
@EVENT_DUNGEON_START_60
	CALL MESSAGE_WINDOW_D, "", @"＞園村 麻希の心象世界での探索もついに佳境に入った/＞岩戸の奥底で出会った「園村 麻希」のコンパクトが行くべき道を指し示す/＞%CALLNAME:MASTER%が訪れたのは、聖エルミン学園の図書室だった。"
	CALL MESSAGE_WINDOW_D, "", @"＞そこには巨大な扉が置かれていた/＞その扉は、脈打つような光を放ちながら、不気味に鳴動している/＞まるで心臓の様なその扉に、%CALLNAME:MASTER%は手を掛けた。"
	CALL MESSAGE_WINDOW_D, "", "………………/…………/……"

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_60,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT
;=======================================================================
;フロアデータ
;=======================================================================
@MAKE_FLOOR_60
SELECTCASE FLAG:現M
	CASE 0
		
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000909000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0061111000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000001100000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000100000000000"
		CALL MAKE_FLOOR_LINE, 4,"0011111100000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000000010000000000"
		CALL MAKE_FLOOR_LINE, 6,"0000000010000000000"
		CALL MAKE_FLOOR_LINE, 7,"0011100111000000000"
		CALL MAKE_FLOOR_LINE, 8,"0011100101000000019"
		CALL MAKE_FLOOR_LINE, 9,"0001000101000000010"
		CALL MAKE_FLOOR_LINE,10,"0011111101111000019"
		CALL MAKE_FLOOR_LINE,11,"0010000100001011110"
		CALL MAKE_FLOOR_LINE,12,"0010110101111010000"
		CALL MAKE_FLOOR_LINE,13,"0011100101000010000"
		CALL MAKE_FLOOR_LINE,14,"0110111011100010019"
		CALL MAKE_FLOOR_LINE,15,"0011110010111110010"
		CALL MAKE_FLOOR_LINE,16,"0000100000100010019"
		CALL MAKE_FLOOR_LINE,17,"0111100000100011110"
		CALL MAKE_FLOOR_LINE,18,"0008000000000000000"
		;イベントの設置
		CALL SET_TILE,8,4,ダンジョンフラグ:(FLAG:現ダンジョン):1,1,1

	CASE 1
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0101111111111110100"
		CALL MAKE_FLOOR_LINE, 4,"0111000000010000100"
		CALL MAKE_FLOOR_LINE, 5,"0101000111111100100"
		CALL MAKE_FLOOR_LINE, 6,"0001000100000000100"
		CALL MAKE_FLOOR_LINE, 7,"0111000101000111110"
		CALL MAKE_FLOOR_LINE, 8,"9101010101111100019"
		CALL MAKE_FLOOR_LINE, 9,"0101010100000111010"
		CALL MAKE_FLOOR_LINE,10,"9101110101110001019"
		CALL MAKE_FLOOR_LINE,11,"0001000111111101010"
		CALL MAKE_FLOOR_LINE,12,"0001010101110101010"
		CALL MAKE_FLOOR_LINE,13,"0101010100000101010"
		CALL MAKE_FLOOR_LINE,14,"9111011100011101000"
		CALL MAKE_FLOOR_LINE,15,"0100010011110101010"
		CALL MAKE_FLOOR_LINE,16,"9100000010000001110"
		CALL MAKE_FLOOR_LINE,17,"0100111111111111010"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 2
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0111111111000000000"
		CALL MAKE_FLOOR_LINE, 2,"0100100001000000000"
		CALL MAKE_FLOOR_LINE, 3,"0110100101111101100"
		CALL MAKE_FLOOR_LINE, 4,"0000111100001001000"
		CALL MAKE_FLOOR_LINE, 5,"0090010000001111100"
		CALL MAKE_FLOOR_LINE, 6,"0020111100000000110"
		CALL MAKE_FLOOR_LINE, 7,"0111100000001100010"
		CALL MAKE_FLOOR_LINE, 8,"9100000000000111110"
		CALL MAKE_FLOOR_LINE, 9,"0100000000011111000"
		CALL MAKE_FLOOR_LINE,10,"9101100001001001100"
		CALL MAKE_FLOOR_LINE,11,"0111000001110001100"
		CALL MAKE_FLOOR_LINE,12,"0000011100011111110"
		CALL MAKE_FLOOR_LINE,13,"0111110111000000010"
		CALL MAKE_FLOOR_LINE,14,"0001000101000001010"
		CALL MAKE_FLOOR_LINE,15,"0011100101110001110"
		CALL MAKE_FLOOR_LINE,16,"0010100100011110010"
		CALL MAKE_FLOOR_LINE,17,"0060100101110011110"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 3
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0011110011110000000"
		CALL MAKE_FLOOR_LINE, 2,"0010010110010000000"
		CALL MAKE_FLOOR_LINE, 3,"0111010100010000100"
		CALL MAKE_FLOOR_LINE, 4,"0100011101111000100"
		CALL MAKE_FLOOR_LINE, 5,"9100000101101111110"
		CALL MAKE_FLOOR_LINE, 6,"0100000011111011100"
		CALL MAKE_FLOOR_LINE, 7,"9100011110001111100"
		CALL MAKE_FLOOR_LINE, 8,"0101110000000011110"
		CALL MAKE_FLOOR_LINE, 9,"0001010000000000000"
		CALL MAKE_FLOOR_LINE,10,"0001010001010011110"
		CALL MAKE_FLOOR_LINE,11,"0001000011011111100"
		CALL MAKE_FLOOR_LINE,12,"0001111111001011110"
		CALL MAKE_FLOOR_LINE,13,"9100100001101111100"
		CALL MAKE_FLOOR_LINE,14,"0100000000111110000"
		CALL MAKE_FLOOR_LINE,15,"9100000000001000000"
		CALL MAKE_FLOOR_LINE,16,"0111111111111100000"
		CALL MAKE_FLOOR_LINE,17,"0070000000000100000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"

	CASE 4
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0111000000011111010"
		CALL MAKE_FLOOR_LINE, 2,"9101100001110001110"
		CALL MAKE_FLOOR_LINE, 3,"0100100111000011010"
		CALL MAKE_FLOOR_LINE, 4,"9100100101000010010"
		CALL MAKE_FLOOR_LINE, 5,"0001111101000010019"
		CALL MAKE_FLOOR_LINE, 6,"0001000001000110010"
		CALL MAKE_FLOOR_LINE, 7,"0011111001100100019"
		CALL MAKE_FLOOR_LINE, 8,"0110001100100110010"
		CALL MAKE_FLOOR_LINE, 9,"0100000100100010010"
		CALL MAKE_FLOOR_LINE,10,"0111001100100010010"
		CALL MAKE_FLOOR_LINE,11,"0001111000100010000"
		CALL MAKE_FLOOR_LINE,12,"0011001100101110010"
		CALL MAKE_FLOOR_LINE,13,"0010000110101000019"
		CALL MAKE_FLOOR_LINE,14,"9110000010111000010"
		CALL MAKE_FLOOR_LINE,15,"0100000010000000019"
		CALL MAKE_FLOOR_LINE,16,"9100000000000111010"
		CALL MAKE_FLOOR_LINE,17,"0000000000000101110"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	

	CASE 5
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0070001111100001110"
		CALL MAKE_FLOOR_LINE, 2,"0111111010000001019"
		CALL MAKE_FLOOR_LINE, 3,"0100001010000001010"
		CALL MAKE_FLOOR_LINE, 4,"0111000011100000019"
		CALL MAKE_FLOOR_LINE, 5,"0010000001100000000"
		CALL MAKE_FLOOR_LINE, 6,"0111000011100000000"
		CALL MAKE_FLOOR_LINE, 7,"0100000110000010000"
		CALL MAKE_FLOOR_LINE, 8,"0104000100010110000"
		CALL MAKE_FLOOR_LINE, 9,"0102000111111110000"
		CALL MAKE_FLOOR_LINE,10,"0111210001100000000"
		CALL MAKE_FLOOR_LINE,11,"0020000111000100000"
		CALL MAKE_FLOOR_LINE,12,"0090000010111100010"
		CALL MAKE_FLOOR_LINE,13,"0000000011110100110"
		CALL MAKE_FLOOR_LINE,14,"0000000010000101019"
		CALL MAKE_FLOOR_LINE,15,"0000000010111111010"
		CALL MAKE_FLOOR_LINE,16,"0000000010000001019"
		CALL MAKE_FLOOR_LINE,17,"0000000011001111110"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
		;イベントの設置
		CALL SET_TILE,5,10,ダンジョンフラグ:(FLAG:現ダンジョン):1,0,4

	CASE 6
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0101010101010101010"
		CALL MAKE_FLOOR_LINE, 2,"0101110101110111010"
		CALL MAKE_FLOOR_LINE, 3,"0111011101011101010"
		CALL MAKE_FLOOR_LINE, 4,"0101010111010101110"
		CALL MAKE_FLOOR_LINE, 5,"0100000101000101010"
		CALL MAKE_FLOOR_LINE, 6,"0101010100010100010"
		CALL MAKE_FLOOR_LINE, 7,"0101110101011101010"
		CALL MAKE_FLOOR_LINE, 8,"0111010111010101110"
		CALL MAKE_FLOOR_LINE, 9,"0101010101010001010"
		CALL MAKE_FLOOR_LINE,10,"0100010001011101000"
		CALL MAKE_FLOOR_LINE,11,"0001010111010101010"
		CALL MAKE_FLOOR_LINE,12,"0101010101000101110"
		CALL MAKE_FLOOR_LINE,13,"0111010000010001010"
		CALL MAKE_FLOOR_LINE,14,"0101110001010100010"
		CALL MAKE_FLOOR_LINE,15,"0101010001110111010"
		CALL MAKE_FLOOR_LINE,16,"0100000001011101110"
		CALL MAKE_FLOOR_LINE,17,"0111111001010100060"
		CALL MAKE_FLOOR_LINE,18,"0000909000000000000"
	
	CASE 7
		FLAG:最大X = 19
		FLAG:最大Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0111111111101111110"
		CALL MAKE_FLOOR_LINE, 2,"0100000001000010010"
		CALL MAKE_FLOOR_LINE, 3,"0101101111110111010"
		CALL MAKE_FLOOR_LINE, 4,"0111000100000001010"
		CALL MAKE_FLOOR_LINE, 5,"0101011111101100010"
		CALL MAKE_FLOOR_LINE, 6,"0101110000000101010"
		CALL MAKE_FLOOR_LINE, 7,"0001010111110111010"
		CALL MAKE_FLOOR_LINE, 8,"0101011100010101010"
		CALL MAKE_FLOOR_LINE, 9,"0111010101010101010"
		CALL MAKE_FLOOR_LINE,10,"0101000002010001010"
		CALL MAKE_FLOOR_LINE,11,"0100000001110101010"
		CALL MAKE_FLOOR_LINE,12,"0101000000000101110"
		CALL MAKE_FLOOR_LINE,13,"0111011111000111010"
		CALL MAKE_FLOOR_LINE,14,"0101001000000101010"
		CALL MAKE_FLOOR_LINE,15,"0001111110111100010"
		CALL MAKE_FLOOR_LINE,16,"0100001000001000110"
		CALL MAKE_FLOOR_LINE,17,"0111111111111110070"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
		;イベントの設置
		CALL SET_TILE,9,9,ダンジョンフラグ:(FLAG:現ダンジョン):0,0,4
	CASEELSE
ENDSELECT



;=======================================================================
;[5]調べる　実行時のイベント
;=======================================================================
@EVENT_CHECK_DUNGEON_60

;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
	SELECTCASE FLAG:現M
		CASE 0
			CALL DUNGEON_UPSTAIRS,5,(FLAG:現X),(FLAG:現Y)
		CASE 2
			CALL DUNGEON_UPSTAIRS,3,(FLAG:現X),(FLAG:現Y)
		CASE 6
			CALL DUNGEON_UPSTAIRS,7,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
	RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	SELECTCASE FLAG:現M
		CASE 3
			CALL DUNGEON_DOWNSTAIRS,2,(FLAG:現X),(FLAG:現Y)
		CASE 5
			CALL DUNGEON_DOWNSTAIRS,0,(FLAG:現X),(FLAG:現Y)
		CASE 7
			CALL DUNGEON_DOWNSTAIRS,6,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
RETURN 1

;========
;イベントの処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 4
	IF FLAG:現M == 5
		IF FLAG:現X == 5
			PRINTW ＞There is a switch here.
			PRINTW ＞Do you want to flip it?
			CALL INPUT_YN,"Yes","No"
			IF RESULT == 0
				PRINTW ＞There was a sound as if something heavy moved.
				ダンジョンフラグ:(FLAG:現ダンジョン):1 = 1
			ENDIF
		ENDIF
	ENDIF
	CALL MAKE_FLOOR, FLAG:現ダンジョン
	CALL AUTOMAP
	
	RETURN 1
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 9
	SELECTCASE FLAG:現M
		CASE 2
			SIF FLAG:現X == 2 && FLAG:現Y == 5
				CALL DUNGEON_TERMINAL
	ENDSELECT
	RETURN 1
ELSE
	PRINTW Nothing seems to be here.
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時のイベント
;=======================================================================
@EVENT_ENTER_DUNGEON_60,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;==========
;特殊タイルの処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 9
	SELECTCASE FLAG:現M
		CASE 0
			IF FLAG:現X == 18
				FLAG:現X = 0
				FLAG:現M = 1
			ENDIF
			IF FLAG:現Y == 0
				FLAG:現Y = 18
				FLAG:現M = 6
			ENDIF
		CASE 1
			IF FLAG:現X == 0
				FLAG:現X = 18
				FLAG:現M = 0
			ELSEIF FLAG:現X == 18
				FLAG:現X = 0
				FLAG:現M = 2
			ENDIF
		CASE 2
			IF FLAG:現X == 0
				FLAG:現X = 18
				FLAG:現M = 1
			ELSEIF FLAG:現X == 2
				CALL DUNGEON_TERMINAL
			ENDIF
		CASE 3
			IF FLAG:現X == 0
				FLAG:現X = 18
				FLAG:現M = 4
			ENDIF
		CASE 4
			IF FLAG:現X == 18
				FLAG:現X = 0
				FLAG:現M = 3
			ELSEIF FLAG:現X == 0
				FLAG:現X = 18
				FLAG:現M = 5
			ENDIF
		CASE 5
			IF FLAG:現X == 18
				FLAG:現X = 0
				FLAG:現M = 4
			ELSEIF FLAG:現X == 2
				CALL DUNGEON_TERMINAL
			ENDIF
		CASE 6
			IF FLAG:現Y == 18
				FLAG:現Y = 0
				FLAG:現M = 0
			ENDIF
		CASEELSE
	ENDSELECT
	CALL MAKE_FLOOR, FLAG:現ダンジョン
	CALL AUTOMAP
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
	SELECTCASE FLAG:現M
		CASE 0
			CALL DUNGEON_UPSTAIRS,5,(FLAG:現X),(FLAG:現Y)
		CASE 2
			CALL DUNGEON_UPSTAIRS,3,(FLAG:現X),(FLAG:現Y)
		CASE 6
			CALL DUNGEON_UPSTAIRS,7,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
	RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	SELECTCASE FLAG:現M
		CASE 3
			CALL DUNGEON_DOWNSTAIRS,2,(FLAG:現X),(FLAG:現Y)
		CASE 5
			CALL DUNGEON_DOWNSTAIRS,0,(FLAG:現X),(FLAG:現Y)
		CASE 7
			CALL DUNGEON_DOWNSTAIRS,6,(FLAG:現X),(FLAG:現Y)
		CASEELSE
	ENDSELECT
RETURN 1

;========
;イベントの処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 4
	IF FLAG:現M == 5
		IF FLAG:現X == 3
			PRINTW It's a pitfall!
			FLAG:現M = 0
			CALL MAKE_FLOOR, FLAG:現ダンジョン
			CALL AUTOMAP
		ELSEIF FLAG:現X == 5
			PRINTW ＞There is a switch here.
			PRINTW ＞Do you want to flip it?
			CALL INPUT_YN,"Yes","No"
			IF RESULT == 0
				PRINTW ＞There was a sound as if something heavy moved.
				ダンジョンフラグ:(FLAG:現ダンジョン):1 = 1
			ENDIF
		ENDIF
	ELSEIF FLAG:現M == 7
;パンドラ
		CALL MESSAGE_WINDOW_D, "", "＞You entered a large room./＞In it's back, there was a sizeable machine installed, that emitted an eery light./＞This seems to be the DEVA system."
		;＞そこは開けた部屋だった。/＞部屋の奥には、大がかりな機械が据え付けられ、不気味な光を発している。/＞恐らくは、アレがDEVAシステムなのだろう。
		CALL MESSAGE_WINDOW_D, "", "＞In front of the machine, there stood a woman./＞The appearance of the woman is exactly like Maki Sonomura./＞However, her size that of a small giant and there are wings like thoose of a butterfly on her back."
		;そしてその前には、一人の女が立っている。/＞その女は、園村 麻希そっくりの容姿を持っているが、/＞身体は巨人と称して良い程に大きく、背には蝶の様な美しい羽があった。
		CALL MESSAGE_WINDOW_D, "Pandora", "This is my 「Door of Paradise」.//I've been dreaming of it for a long time...and now I have it."
		;"これは私の「楽園の扉」//ずっと夢見ていたの……やっと手に入れたのよ"
		CALL MESSAGE_WINDOW_D, "Pandora", "I won't let you have it...!/I am going to make a paradise with it./何もない、空っぽの楽園をね"
		;絶対に渡さないわ……！/私はこれで楽園を作るの/何もない、空っぽの楽園をね
		PRINTW Tyrant Pandora appeared!
		CUSTOMDRAWLINE =
		WAIT
		FLAG:逃走不可フラグ = 1
		FLAG:会話不能フラグ = 1
		FLAG:先制不意打ちキャンセル = 1
		CALL SET_ENEMY,9,220,80,0,1
		CFLAG:(CHARANUM-1):ＨＰ補正 = 5000
		CALL SYNC_STATUS,(CHARANUM-1)
		CALL HEALTH_CHARA,(CHARANUM-1)
		CFLAG:(CHARANUM-1):行動回数 = 2
		CSTR:(CHARANUM-1):思考パターン = 220
		CALL BATTLE_START
		FLAG:逃走不可フラグ = 0
		FLAG:会話不能フラグ = 0
		FLAG:先制不意打ちキャンセル = 0
		CALL MESSAGE_WINDOW_D, "", "＞The collapsed Pandora slowly dissapeared while wearing an erratic expression."
		;倒れたパンドラは何か言いたげな表情でゆっくりと消えていった。
		CALL MESSAGE_WINDOW_D, "", "＞A crack runs through this world.../＞With Pandoras dissapearance, the power to support this world was lost./＞It's probably too late to escape now..."
		;＞世界に亀裂が走っていく…/＞パンドラが消えて、世界を支える力が失われたのだろう。/＞今から脱出しようにも、間に合いそうにない
;麻希がいれば、外に出してくれる。いなければシステムをハックして脱出
		IF FINDCHARA_B([[キャラ:麻希]])== 2
			CALL MESSAGE_WINDOW_D, "", "＞While you where thinking, Maki approached you."
			;そう思ったところで麻希が進み出た。
			CALL MESSAGE_WINDOW_D, "Maki", "Leave this to me./I'll get everyone out of here safely."
			;私に任せて。/皆、無事に外に出して見せるから
			CALL MESSAGE_WINDOW_D, "", @"＞At Maki's words, %CALLNAME:MASTER% vision began to fade into white."
			;麻希のその言葉と共に、%CALLNAME:MASTER%の視界が白く染まり始めた。
			CALL MESSAGE_WINDOW_D, "Maki", "...because I'm only a part of the real Maki Sonumuras personality,//I can't follow you from here..."
			;……私は、本物の園村 麻希の人格の一つでしかないから、//ここから先には付いていけないから……
			CALL MESSAGE_WINDOW_D, "", @"＞Fading, the last thing %CALLNAME:MASTER% saw, was a calm smile on Maki's face..."
			;薄れていく%CALLNAME:MASTER%の視界に最後に映ったのは、麻希の穏やかな微笑みだった……
			ダンジョンフラグ:(FLAG:現ダンジョン):0 = 1
		ELSE
			CALL MESSAGE_WINDOW_D, "", "＞...you'll have to interfere with the DEVA system./＞I you can't gain some time to escape.../＞The ground shakes, the ceiling starts to break down as this world starts to collapse."
			;……DEVAシステムに介入するしかない。/＞逃げる時間位は稼がなければ……/＞足元は揺れ、天井には罅が入り、目に見える速度で全てが崩壊していく中、"
			CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%, recalling the investigation report on the DEVA system,/＞attempts to interface with it using %HIS_HER(MASTER)% COMP..."
			;%CALLNAME:MASTER%は、DEVAシステムについての調査報告を思い出しながら、/＞COMPを介してDEVAシステムの操作を試みた……
			IF FINDCHARA_B([[キャラ:ゆきのさん]])== 2
				CALL MESSAGE_WINDOW_D, "Yukino", "Look out!!"
				;危ない！！
				CALL MESSAGE_WINDOW_D, "", @"＞Yukino called onto her persona to destroy the fragments of the ceiling that where about to fall on %CALLNAME:MASTER%."
				;%CALLNAME:MASTER%の頭上に落ちてきた天井の破片を、ゆきののペルソナが打ち払う。
				CALL MESSAGE_WINDOW_D, "Yukino", "Don't worry about your surroundings! I'll keep you safe!"
				;周りは気にしなくていい！そっちは任せたよ！
			ENDIF
			CALL MESSAGE_WINDOW_D, "", "＞...without a human to interface with it,/＞it's impossible to keep the DEVA system running for long./＞However, you managed to earn some time by padding the failed part./＞Then you began a hasty escape."
			;……媒介である人間なしで、/＞長期間DEVAシステムを動作させ続ける事は出来ない/＞破綻した部分を穴埋めして何とか時間を稼ぐ事は出来た/＞後は必死で逃げるのみだ
			IF FINDCHARA_B([[キャラ:エリー]])== 2
				CALL MESSAGE_WINDOW_D, "Eriko", "This way!"
				;こちらですわ！
				CALL MESSAGE_WINDOW_D, "", "＞Eriko took the lead during the escape./＞The remembered the way through the maze well."
				;エリーの先導で走る。/＞長大な迷路を、彼女は良く覚えていた。
			ENDIF
			IF FINDCHARA_B([[キャラ:アヤセ]])== 2
				CALL MESSAGE_WINDOW_D, "Ayase", "Ouch ou...quick hurry!"
				;痛い痛いヤバいヤバい早く早く！
				CALL MESSAGE_WINDOW_D, "", "＞Ayase ran while crying out./＞She desperately tried to keep up with you, while shielding her head from falling debris."
				;アヤセがわめきながら走る。/＞降り注ぐ破片から頭部をかばいながら必死についてきていた。
			ENDIF
		ENDIF
		CALL MESSAGE_WINDOW_D, "", "......../...../..../..."
		CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%'s Office"
		;マヨーネＧＥＴ済み
		IF イベントフラグ:1:0 == 3
			CALL MESSAGE_WINDOW_D, "Agent", "We received your report./Well done...is what I'd normally say."
			;報告は見せて貰った。/良くやった……と言いたい所だが
			CALL MESSAGE_WINDOW_D, "Agent", "...we had too little time./If only you had reported on this directly after the incident at Deva Yuga./That way, we would have had a change to study the DEVA system in operation."
			;……時間が掛かり過ぎているな、/デヴァ・ユガ消滅直後に報告を上げて貰っていればな/そうしていれば、稼働中のDEVAシステムもこちらの手に入ったんだが
			CALL MESSAGE_WINDOW_D, "", @"＞After %CALLNAME:MASTER% had sent the report, an Agent of the Phantom Society had contacted %HIM_HER(MASTER)% shortly after./＞It seems the organisation didn't agree with how you handled things."
			;%CALLNAME:MASTER%の報告書を読んだファントム・ソサエティのエージェントは、/＞不服そうにそう言った後電話を切った
		ELSE
			CALL MESSAGE_WINDOW_D, "Mayone", "報告は見せて頂きましたわ。/良くやった……と言って差し上げたい所ですけど……"
			CALL MESSAGE_WINDOW_D, "Mayone", "時間が掛かり過ぎていますわね、/何故デヴァ・ユガ消滅直後に報告を上げて貰えなかったのかしら？/そうしていれば、稼働中のDEVAシステムもこちらの手に入ったと言うのに"
			CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%の報告書を読んだマヨーネは、/＞不服そうにそう言った後電話を切った"
		ENDIF
		CALL MESSAGE_WINDOW_D, "", "＞It seems that because of your actions, the DEVA system bacame non-functional./＞Still, the matter is settled with this./＞As compensation for your work, you received ￥50000."
		;DEVAシステムは機能を停止してしまったらしい。/＞いずれにせよ、これでこの件は片付いたと言う事になる。/＞この件の報酬として、￥50000が支払われた。
		CALL MESSAGE_WINDOW_D, "", "＞...well, this ammount of pay is quite adequate for all the work you had with this./＞And because the organisation was unhappy with the results,/＞you might have to work harder to make up for it."
		;……働きに見合った報酬とは言えないかもしれない。/＞組織の不興をかってしまったせいで、/＞今後は立ち回りにも気を付ける必要も出てきた。
		CALL MESSAGE_WINDOW_D, "", @"＞...but it's not like all of %CALLNAME:MASTER%'s work was for naught."
		;……だが、得るものはあったと%CALLNAME:MASTER%は思う
		IF FINDCHARA_B([[キャラ:麻希]])== 2
			CALL MESSAGE_WINDOW_D, "", @"＞When you carefully approached the 「real」 Maki Sonomura,/＞it seemed that the memories of the 「Ideal Maki」, the one that disapreared, where intact./＞In addition, she confirmed when %CALLNAME:MASTER% asked if she still wanted to stay with %HIM_HER(MASTER)%."
			;離れた所で雑談に興じる「本物の」園村 麻希/＞あの時消えた「理想の自分」が得た記憶や経験がそのまま残っているらしく、/＞ここに残ることを望み、%CALLNAME:MASTER%もそれを了承した"
			CALL MESSAGE_WINDOW_D, "", "＞While she felt very much like the Maki you knew at first,/＞you gradually noticed a difference."
			;＞最初こそ言動に違和感を感じたものの、/＞段々と差異を感じなくなってきた。
			CALL MESSAGE_WINDOW_D, "", "＞Is the influence of her 「Ideal Self」 that strong?/＞It can't be said for sure if the real one is influnced by the 「Ideal Self」 or just catching up with her past now./＞It's likely not even Maki herself knows for sure..."
			;「理想の自分」の影響が強いのか、/＞「本物の自分」がかつての理想に追いつきつつあるのか、/＞きっとそれは本人ですら分からない事だろう……
		ENDIF
		CALL MESSAGE_WINDOW_D, "", @"＞...while playing with a card in %HIS_HER(MASTER)% fingers,/＞%CALLNAME:MASTER% kept thinking about all that had happened,/＞until %HE_SHE(MASTER)% eventually felt into slumber..."
		;……いつの間にか手の中にあったカードを指先で弄びながら/＞しばらく考えを巡らせていた%CALLNAME:MASTER%だったが、/＞やがてゆっくりとまどろみの中に落ちていった……
		CALL MESSAGE_WINDOW_D, "", "＞You got the material card 【Avatara】."
		;テリアルカード【アヴァターラ】を手に入れた
		ITEM:アヴァターラ = 1
		MONEY += 50000
;迷いの森侵入禁止
		ダンジョンフラグ:12:0 = 10
;地下鉄侵入禁止
		ダンジョンフラグ:11:7 = 1

		IF CHECK_TIMELIMIT(1,DAY < 51)
;			CALL MESSAGE_WINDOW_D, "", "/―――女神異聞録ペルソナ トゥルーエンド―――"
			CALL MESSAGE_WINDOW_D, "", "/Ending No.028 (女神異聞録ペルソナ　セベク編エンド　be your true Mind)"
			FLAG:5 = 9
			SETBIT FLAG:キャンセル済みED,28
			SETBIT FLAG:発見ED,28
			FLAG:脱出 = 1
			PRINTFORML [0]End [1]Continue [2]Start new-game plus
			CALL INPUTINT,0, 1, 2
			IF RESULT == 0
				QUIT
			ELSEIF RESULT == 1
				CALL REQUEST_50_DAY_END
			ELSEIF RESULT == 2
				CALL START_NEWGAME
				RETURN 1
			ENDIF
		ENDIF
		ダンジョンフラグ:60:0 = 1
		FLAG:脱出 = 1
	ENDIF

;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1
ENDIF

RETURN 0

;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_60
	FLAG:エンカウント率 = FLAG:未遭遇歩数*5
;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_60
IF RAND:100 < FLAG:エンカウント率
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF
;=======================================================================
;敵の種族の種類数
;=======================================================================
@CLASS_NUM_60
RETURN CLASS_NUM_COMMON("上級")
;=======================================================================
;敵の総数
;ARGは出現する敵の種類です
;=======================================================================
@ENEMY_NUM_60, ARG
RETURN ENEMY_NUM_COMMON("上級", ARG)
;=======================================================================
;敵の種類
;=======================================================================
@ENEMY_60, ARG
SELECTCASE RAND:100
	CASE IS < 10
		RETURN 1020, 55
	CASE IS < 20
		RETURN 1021, 56
	CASE IS < 30
		RETURN 1022, 57
	CASE IS < 40
		RETURN 1023, 58
	CASE IS < 50
		RETURN 1024, 59
	CASE IS < 60
		RETURN 1025, 60
	CASE IS < 70
		RETURN 356, 56
	CASE IS < 80
		RETURN 706, 55
	CASE IS < 90
		RETURN 656, 56
	CASEELSE
		RETURN 408, 56
ENDSELECT

;パンドラ思考パターン
@SET_ACTION_220,ARG
IF FLAG:経過ターン数 == 0
	LOCAL = 0
ELSEIF LOCAL == 0
	LOCAL = 1
ELSE
	LOCAL = 0
ENDIF

IF LOCAL == 0 && CFLAG:ARG:行動した回数 == 0
		PRINTFORML ┏>MESSAGE━━━━━━━━━━━━━━━━━━┓
		PRINTFORML ┃パンドラの髪が赤く染まっていく……　　　　　┃
		PRINTFORML ┃　　　　　　　　　　　　　　　　　　　　　　┃
		PRINTFORMW ┗━━━━━━━━━━━━━━━━━━━━━━┛
		PRINTL 
	MAXBASE:ARG:40 = 120
	MAXBASE:ARG:41 = 100
	MAXBASE:ARG:42 = 120
	MAXBASE:ARG:43 = 120
	MAXBASE:ARG:44 = -50
	MAXBASE:ARG:45 = -50
	MAXBASE:ARG:46 = -50
	MAXBASE:ARG:47 = -50
	MAXBASE:ARG:52 = -50
	MAXBASE:ARG:53 = -50
	MAXBASE:ARG:54 = -50
	MAXBASE:ARG:55 = -50
	MAXBASE:ARG:56 = -50
	CFLAG:ARG:入力行動 = [[スキル:雷の洗礼]]
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
ELSEIF LOCAL == 1 && CFLAG:ARG:行動した回数 == 0
		PRINTFORML ┏>MESSAGE━━━━━━━━━━━━━━━━━━┓
		PRINTFORML ┃パンドラの髪が青く染まっていく……　　　　　┃
		PRINTFORML ┃　　　　　　　　　　　　　　　　　　　　　　┃
		PRINTFORMW ┗━━━━━━━━━━━━━━━━━━━━━━┛
		PRINTL 
	MAXBASE:ARG:40 = 50
	MAXBASE:ARG:41 = 50
	MAXBASE:ARG:42 = 50
	MAXBASE:ARG:43 = 50
	MAXBASE:ARG:44 = 100
	MAXBASE:ARG:45 = 100
	MAXBASE:ARG:46 = 100
	MAXBASE:ARG:47 = 100
	MAXBASE:ARG:52 = 100
	MAXBASE:ARG:53 = 100
	MAXBASE:ARG:54 = 100
	MAXBASE:ARG:55 = 100
	MAXBASE:ARG:56 = 100
	CFLAG:ARG:入力行動 = [[スキル:絶対零度]]
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
ELSEIF CFLAG:ARG:行動した回数 == 1
	IF LOCAL == 0
		CFLAG:ARG:入力行動 = [[スキル:バタフライストーム]]
		CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
	ELSE
		IF CFLAG:ARG:攻撃強化 < -8 || CFLAG:ARG:命中強化 < -8 || CFLAG:ARG:回避強化 < -8 || CFLAG:ARG:魔法威力強化 < -8
			CFLAG:ARG:入力行動 = [[スキル:デ・クンダ]]
			CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
		ELSEIF CFLAG:ARG:魔法威力強化 < 16
			CFLAG:ARG:入力行動 = [[スキル:マカ・カジャ]]
			CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
		ELSE
			CFLAG:ARG:入力行動 = [[スキル:雷の洗礼]]
			CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
		ENDIF
	ENDIF
ENDIF
;アクション実行不能なら自動的に通常攻撃にする
CALL CHECK_ACTIONABLE, ARG, CFLAG:ARG:入力行動
IF RESULT == 0
	CFLAG:ARG:入力行動 = 0
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
ENDIF
;ここまでターゲットが決まってなかったら、ランダムターゲットをよんで決定
SIF CFLAG:ARG:ターゲット == -1
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:入力行動
RETURN 1


;=======================================================================
;輪姦参加悪魔
;=======================================================================
@DUNGEON_RAPE_DEVIL_60
;ランダムにどの悪魔が出るか決定
;RETURN CSV番号 , 人数 , レベル
SELECTCASE RAND:3
	CASE 0
		RETURN [[キャラ:インキュバス]] , 3 + RAND:10 , CSVBASE([[キャラ:インキュバス]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:ドミニオン]] , 3 + RAND:10 , CSVBASE([[キャラ:ドミニオン]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:ベルセルク]] , 3 + RAND:10 , CSVBASE([[キャラ:ベルセルク]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT
