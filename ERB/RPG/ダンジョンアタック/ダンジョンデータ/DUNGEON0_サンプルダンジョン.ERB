
;=======================================================================
;サンプルダンジョン(戦闘テスト用)
;ダンジョンのテンプレートみたいなものです
;ダンジョンナンバー0
;情報が古いので参考にするのはエコービルのほうがいいでしょう
;
;ちょっと戦闘テスト用に変更
;指定したレベルの敵と戦ってみる感じのダンジョンに
;=======================================================================




;=======================================================================
;攻略条件
;=======================================================================
@PREREQUISITE_DUNGEON_0
;DEBUG条件を外したいならこの次の行を削る
SIF FLAG:DEBUG
	RETURN 1
RETURN 0


;=======================================================================
;ダンジョン名
;=======================================================================
@GET_DUNGEON_NAME_0
RESULTS = サンプルダンジョン


;=======================================================================
;フロア名表示
;=======================================================================
@FLOORNAME_0
PRINT サンプルダンジョン
PRINTFORML   {FLAG:現M + 1}F (1枠あたりの敵出現率{(FLAG:現M + 1) * 5}％)



;=======================================================================
;特殊タイル表示
;=======================================================================
@TILE_MARK_0_X_X
RESULTS = 特


;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_0,ARG
FLAG:現M = 0
FLAG:現X = 1
FLAG:現Y = 18
FOR LOCAL, 0, 100
	ダンジョンフラグ:0:LOCAL = 0
NEXT
PRINTL 出現する敵の最低レベルを指定してください
CALL INPUT_MANY(1, 99)
LOCAL:1 = RESULT
PRINTL 出現する敵の最大レベルが最低レベルよりいくつ高いかを指定してください
CALL INPUT_MANY(0, 10)
LOCAL:2 = RESULT + LOCAL:1
FOR LOCAL, 1, 2000
	SIF !EXISTCSV(LOCAL,0)
		CONTINUE
	SIF CSVCFLAG(LOCAL,GETNUM(CFLAG,"特殊合体のみ"),0)
		CONTINUE
	SIF CSVCFLAG(LOCAL,GETNUM(CFLAG,"合体条件有り"),0)
		CONTINUE
	SIF CSVCFLAG(LOCAL,GETNUM(CFLAG,"全書召喚不可"),0)
		CONTINUE
	SIF CSVBASE(LOCAL,GETNUM(BASE,"LV"),0) < LOCAL:1
		CONTINUE
	SIF CSVBASE(LOCAL,GETNUM(BASE,"LV"),0) > LOCAL:2
		CONTINUE
	CALL INCREASE_ANALYZE, LOCAL, 10
	ダンジョンフラグ:0:0 += 1
	ダンジョンフラグ:0:(ダンジョンフラグ:0:0) = LOCAL
NEXT
IF ダンジョンフラグ:0:0 == 0
	PRINTL 出現可能な悪魔がいません！
	RESTART
ELSE
	PRINTL 出現悪魔は以下の通りです
	FOR LOCAL, 1, ダンジョンフラグ:0:0 + 2
		SIF ダンジョンフラグ:0:LOCAL == 0
			BREAK
		PRINTFORM \@ CSVCSTR(ダンジョンフラグ:0:LOCAL,GETNUM(CSTR,"種族名"),0) != "" ? %CSVCSTR(ダンジョンフラグ:0:LOCAL,GETNUM(CSTR,"種族名"),0),10,LEFT% # %STR:(CSVABL(ダンジョンフラグ:0:LOCAL,GETNUM(ABL,"種族"),0)),10,LEFT%\@　
		PRINTFORM %CSVCALLNAME(ダンジョンフラグ:0:LOCAL,0),20,LEFT%　
		PRINTFORML LV{CSVBASE(ダンジョンフラグ:0:LOCAL,GETNUM(BASE,"LV"),0),6}
	NEXT
	WAIT
ENDIF


;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_0,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

;=======================================================================
;フロアデータ
;=======================================================================
@MAKE_FLOOR_0
SELECTCASE FLAG:現M
	CASE 0
	;１階
		FLAG:最大X = 20
		FLAG:最大Y = 20
		CALL MAKE_FLOOR_LINE,0,"00000000000000000000"
		CALL MAKE_FLOOR_LINE,1,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,2,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,3,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,4,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,5,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,6,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,7,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,8,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,9,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,10,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,11,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,12,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,13,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,14,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,15,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,16,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,17,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,18,"01611111111111111110"
		CALL MAKE_FLOOR_LINE,19,"08000000000000000000"
	CASE 18
		FLAG:最大X = 20
		FLAG:最大Y = 20
		CALL MAKE_FLOOR_LINE,0,"00000000000000000000"
		CALL MAKE_FLOOR_LINE,1,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,2,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,3,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,4,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,5,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,6,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,7,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,8,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,9,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,10,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,11,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,12,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,13,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,14,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,15,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,16,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,17,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,18,"01171111111111111110"
		CALL MAKE_FLOOR_LINE,19,"08000000000000000000"
	CASEELSE
		FLAG:最大X = 20
		FLAG:最大Y = 20
		CALL MAKE_FLOOR_LINE,0,"00000000000000000000"
		CALL MAKE_FLOOR_LINE,1,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,2,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,3,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,4,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,5,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,6,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,7,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,8,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,9,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,10,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,11,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,12,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,13,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,14,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,15,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,16,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,17,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,18,"01671111111111111110"
		CALL MAKE_FLOOR_LINE,19,"08000000000000000000"
ENDSELECT



;=======================================================================
;[5]調べる　実行時のイベント
;=======================================================================
@EVENT_CHECK_DUNGEON_0

;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 3
	SELECTCASE FLAG:現M
		CASE 0
			IF FLAG:現X == 7 && FLAG:現Y == 6
				CALL GET_TREASURE,1001,1,0,0
			ENDIF
		CASE 1
			IF FLAG:現X == 1 && FLAG:現Y == 1
				CALL GET_TREASURE,2001,1,0,1
			ENDIF
	ENDSELECT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
	CALL DUNGEON_UPSTAIRS_ID, FLAG:現M+1, 7
RETURN 1
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	CALL DUNGEON_DOWNSTAIRS_ID, FLAG:現M-1, 6
RETURN 1

ELSE
	PRINTW Nothing seems to be here.
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時のイベント
;=======================================================================
@EVENT_ENTER_DUNGEON_0,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 3
	SELECTCASE FLAG:現M
		CASE 0
			IF FLAG:現X == 7 && FLAG:現Y == 6
				CALL GET_TREASURE,1001,1,0,0
			ENDIF
		CASE 1
			IF FLAG:現X == 1 && FLAG:現Y == 1
				CALL GET_TREASURE,2001,1,0,1
			ENDIF
	ENDSELECT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
	CALL DUNGEON_UPSTAIRS_ID, FLAG:現M+1, 7
RETURN 1
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	CALL DUNGEON_DOWNSTAIRS_ID, FLAG:現M-1, 6
RETURN 1
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1
ENDIF
RETURN 0


;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_0
SELECTCASE FLAG:現M
	CASE 0
		FLAG:エンカウント率 = FLAG:未遭遇歩数*5
	CASE 1
		FLAG:エンカウント率 = FLAG:未遭遇歩数*5
ENDSELECT



;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_0
IF RAND:100 < FLAG:エンカウント率
	$LOOP_ENCOUNT
	LOCAL:2 = 0
	FOR LOCAL,7,17,1
		;1Fは１枠あたり10％の確率で出現
		;2Fは１枠あたり20％の確率で出現
		IF RAND:100 < (FLAG:現M+1) * 5
			LOCAL:3 = ダンジョンフラグ:0:(RAND:(ダンジョンフラグ:0:0) + 1)
			CALL SET_ENEMY,LOCAL, LOCAL:3 , CSVBASE(LOCAL:3, GETNUM(BASE,"LV"),0),0
			LOCAL:2 += 1
		ENDIF
	NEXT
	SIF LOCAL:2 == 0
		GOTO LOOP_ENCOUNT
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF










