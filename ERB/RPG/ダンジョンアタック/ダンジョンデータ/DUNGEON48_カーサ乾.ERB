
;=======================================================================
;カーサ乾
;
;ダンジョンフラグ:48:0 = 1.ボス
;ダンジョンフラグ:48:1 = 1.初回
;ダンジョンフラグ:48:10-13 = 1.宝箱

;ダンジョンナンバー48
;=======================================================================

;=======================================================================
;攻略条件
;=======================================================================
@PREREQUISITE_DUNGEON_48
SIF 依頼フラグ:5:0 >= 1 && !ダンジョンフラグ:48:0
	RETURN 1
RETURN 0

;=======================================================================
;ダンジョン名
;=======================================================================
@GET_DUNGEON_NAME_48
RESULTS = Casa Dry
;カーサ乾


;=======================================================================
;フロア名表示
;=======================================================================
@FLOORNAME_48
PRINT Casa Dry
;カーサ乾
SELECTCASE FLAG:現M
	CASE 0
		PRINTL   １Ｆ
	CASE 1
		PRINTL   ２Ｆ
	CASE 2
		PRINTL   ３Ｆ
	CASE 3
		PRINTL   ４Ｆ
	CASEELSE
		PRINTL
ENDSELECT


;=======================================================================
;特殊タイル表示
;=======================================================================
@TILE_MARK_48_0_8_5
RESULTS = Ｅ
@TILE_MARK_48_1_8_5
RESULTS = Ｅ
@TILE_MARK_48_2_8_7
RESULTS = Ｅ
@TILE_MARK_48_2_8_9
RESULTS = Ｅ
@TILE_MARK_48_3_8_7
RESULTS = Ｅ
@TILE_MARK_48_3_8_9
RESULTS = Ｅ
@TILE_MARK_48_4_1_8
RESULTS = Ｅ

;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_48,ARG
FLAG:現M = 0
FLAG:現X = 2
FLAG:現Y = 4
;CALL AUTOMAP

;=======================================================================
;スタート時イベント
;=======================================================================
@EVENT_DUNGEON_START_48
IF ダンジョンフラグ:48:1 == 0
	CUSTOMDRAWLINE =
	PRINTFORMW You received a request to solve the incident at a differentiated appartment, Casa Dry.
	;異界化したマンション、カーサ乾の調査依頼をあなたは受けた
	PRINTFORMW You should investigate quickly and return things to normal, before any inhabitants get hurt.
	;住民への被害が出る前に原因を早急に究明しマンションに戻さねばなるまい
	ダンジョンフラグ:48:1 = 1
ENDIF

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_48,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT
;=======================================================================
;フロアデータ
;=======================================================================
@MAKE_FLOOR_48
SELECTCASE FLAG:現M
	CASE 0
	;１階
		FLAG:最大X = 12
		FLAG:最大Y = 12 
							    ;012345678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 6211111111 "
		CALL MAKE_FLOOR_LINE, 2,"          1 "
		CALL MAKE_FLOOR_LINE, 3,"          1 "
		CALL MAKE_FLOOR_LINE, 4,"8211211   1 "
		CALL MAKE_FLOOR_LINE, 5,"     1129 1 "
		CALL MAKE_FLOOR_LINE, 6,"          1 "
		CALL MAKE_FLOOR_LINE, 7,"     11   1 "
		CALL MAKE_FLOOR_LINE, 8," 111  2   1 "
		CALL MAKE_FLOOR_LINE, 9," 2 11111111 "
		CALL MAKE_FLOOR_LINE,10," 6          "
		CALL MAKE_FLOOR_LINE,11,"            "
							    ;012348678901

		;宝箱の設置
		CALL SET_TILE,5,7,ダンジョンフラグ:48:10,0,3
		;
		CALL SET_TILE,6,4,ダンジョンフラグ:48:0,0,4

	CASE 1
	;２階
		FLAG:最大X = 12
		FLAG:最大Y = 12 
							    ;012348678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 721111 621 "
		CALL MAKE_FLOOR_LINE, 2,"   1  1   1 "
		CALL MAKE_FLOOR_LINE, 3," 111  11111 "
		CALL MAKE_FLOOR_LINE, 4,"  11 1      "
		CALL MAKE_FLOOR_LINE, 5,"   1 1129 1 "
		CALL MAKE_FLOOR_LINE, 6,"          1 "
		CALL MAKE_FLOOR_LINE, 7," 111   11 1 "
		CALL MAKE_FLOOR_LINE, 8," 1 111 2  1 "
		CALL MAKE_FLOOR_LINE, 9," 2 2 111111 "
		CALL MAKE_FLOOR_LINE,10," 7 6        "
		CALL MAKE_FLOOR_LINE,11,"            "
							    ;012348678901

		;宝箱の設置
		CALL SET_TILE,5,4,ダンジョンフラグ:48:11,0,3
		CALL SET_TILE,8,7,ダンジョンフラグ:48:12,0,3

	CASE 2
	;３階
		FLAG:最大X = 12
		FLAG:最大Y = 13 
							    ;012348678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 1 1211 721 "
		CALL MAKE_FLOOR_LINE, 2," 1 1  1   1 "
		CALL MAKE_FLOOR_LINE, 3," 1 1  1 621 "
		CALL MAKE_FLOOR_LINE, 4," 121  1   1 "
		CALL MAKE_FLOOR_LINE, 5,"   15 11111 "
		CALL MAKE_FLOOR_LINE, 6,"   11     1 "
		CALL MAKE_FLOOR_LINE, 7," 1 511129 1 "
		CALL MAKE_FLOOR_LINE, 8," 2        1 "
		CALL MAKE_FLOOR_LINE, 9," 11111129 1 "
		CALL MAKE_FLOOR_LINE,10,"   2      1 "
		CALL MAKE_FLOOR_LINE,11,"   7 111111 "
		CALL MAKE_FLOOR_LINE,12,"            "
							    ;012348678901

	CASE 3
	;４階
		FLAG:最大X = 12
		FLAG:最大Y = 15 
							    ;012348678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 515 111111 "
		CALL MAKE_FLOOR_LINE, 2," 1 1 11   1 "
		CALL MAKE_FLOOR_LINE, 3," 5 5 11 7 1 "
		CALL MAKE_FLOOR_LINE, 4," 1 1 1  2 1 "
		CALL MAKE_FLOOR_LINE, 5," 5   2  1 1 "
		CALL MAKE_FLOOR_LINE, 6," 121 11   1 "
		CALL MAKE_FLOOR_LINE, 7,"   1 1129 1 "
		CALL MAKE_FLOOR_LINE, 8," 121      1 "
		CALL MAKE_FLOOR_LINE, 9," 1 111129 1 "
		CALL MAKE_FLOOR_LINE,10," 1          "
		CALL MAKE_FLOOR_LINE,11," 11       1 "
		CALL MAKE_FLOOR_LINE,12," 111      2 "
		CALL MAKE_FLOOR_LINE,13," 1111111111 "
		CALL MAKE_FLOOR_LINE,14,"            "
							    ;012348678901

		;宝箱の設置
		CALL SET_TILE,3,4,ダンジョンフラグ:48:13,0,3
		;
		CALL SET_TILE,10,11,ダンジョンフラグ:48:0,0,4

	CASEELSE

ENDSELECT



;=======================================================================
;[5]調べる　実行時のイベント
;=======================================================================
@EVENT_CHECK_DUNGEON_48

;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 3
	CALL TRESURING_CALLING_48
	RETURN 1
;==========
;イベントの処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 4
	CALL EVENTING_CALLING_48
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
SELECTCASE FLAG:現M
	CASE 0
		SIF FLAG:現X == 1 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,1,3,1
		SIF FLAG:現X == 1 && FLAG:現Y == 10
			CALL DUNGEON_UPSTAIRS,1,1,8
	CASE 1
		SIF FLAG:現X == 8 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,2,10,1
		SIF FLAG:現X == 3 && FLAG:現Y == 10
			CALL DUNGEON_UPSTAIRS,2,3,9
	CASE 2
		SIF FLAG:現X == 8 && FLAG:現Y == 3
			CALL DUNGEON_UPSTAIRS,3,8,5
	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	SELECTCASE FLAG:現M
		CASE 1
			SIF FLAG:現X == 1 && FLAG:現Y == 1
				CALL DUNGEON_DOWNSTAIRS,0,3,1
			SIF FLAG:現X == 1 && FLAG:現Y == 10
				CALL DUNGEON_DOWNSTAIRS,0,1,8
		CASE 2
			SIF FLAG:現X == 8 && FLAG:現Y == 1
				CALL DUNGEON_DOWNSTAIRS,1,10,1
			SIF FLAG:現X == 3 && FLAG:現Y == 11
				CALL DUNGEON_DOWNSTAIRS,1,3,8
		CASE 3
			SIF FLAG:現X == 8 && FLAG:現Y == 3
				CALL DUNGEON_DOWNSTAIRS,2,10,3
		CASEELSE
	ENDSELECT
	RETURN 1


;==========
;ターミナル
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 9
	SELECTCASE FLAG:現M
		CASE 0
			SIF FLAG:現X == 8 && FLAG:現Y == 5
				CALL E_INUI_01
		CASE 1
			SIF FLAG:現X == 8 && FLAG:現Y == 5
				CALL E_INUI_01
		CASE 2
			SIF FLAG:現X == 8 && FLAG:現Y == 7
				CALL E_INUI_01
			SIF FLAG:現X == 8 && FLAG:現Y == 9
				CALL E_INUI_02
		CASE 3
			SIF FLAG:現X == 8 && FLAG:現Y == 7
				CALL E_INUI_01
			SIF FLAG:現X == 8 && FLAG:現Y == 9
				CALL E_INUI_02
		CASEELSE
	ENDSELECT
	RETURN 1
ELSE
	PRINTW There seems to be nothing here.
	;何も無いようだ
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時のイベント
;=======================================================================
@EVENT_ENTER_DUNGEON_48,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 3
	CALL TRESURING_CALLING_48
	RETURN 1
;========
;罠の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 5
	CALL TRAP_48
	RETURN RESULT
;==========
;イベントの処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 4
	CALL EVENTING_CALLING_48
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
SELECTCASE FLAG:現M
	CASE 0
		SIF FLAG:現X == 1 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,1,3,1
		SIF FLAG:現X == 1 && FLAG:現Y == 10
			CALL DUNGEON_UPSTAIRS,1,1,8
	CASE 1
		SIF FLAG:現X == 8 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,2,10,1
		SIF FLAG:現X == 3 && FLAG:現Y == 10
			CALL DUNGEON_UPSTAIRS,2,3,9
	CASE 2
		SIF FLAG:現X == 8 && FLAG:現Y == 3
			CALL DUNGEON_UPSTAIRS,3,8,5
	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	SELECTCASE FLAG:現M
		CASE 1
			SIF FLAG:現X == 1 && FLAG:現Y == 1
				CALL DUNGEON_DOWNSTAIRS,0,3,1
			SIF FLAG:現X == 1 && FLAG:現Y == 10
				CALL DUNGEON_DOWNSTAIRS,0,1,8
		CASE 2
			SIF FLAG:現X == 8 && FLAG:現Y == 1
				CALL DUNGEON_DOWNSTAIRS,1,10,1
			SIF FLAG:現X == 3 && FLAG:現Y == 11
				CALL DUNGEON_DOWNSTAIRS,1,3,8
		CASE 3
			SIF FLAG:現X == 8 && FLAG:現Y == 3
				CALL DUNGEON_DOWNSTAIRS,2,10,3
		CASEELSE
	ENDSELECT
	RETURN 1

;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 2
	IF FLAG:現M == 3 && FLAG:現X == 10 && FLAG:現Y == 12 && ダンジョンフラグ:48:0 == 0
		PRINTW There is the presence of a powerful enemy on the other side.
		;扉の向こうから邪気を感じる
		PRINTL Do you open the door?
		;扉を開けるか？
		PRINTL 
		CALL INPUT_YN,"Yes","No"
		IF RESULT == 0
			CALL DUNGEON_DOOR,ARG
		ELSEIF RESULT == 1
			FLAG:現Y = 13
		ENDIF
	ELSE
		CALL DUNGEON_DOOR,ARG
	ENDIF
	RETURN 1
	
;==========
;ターミナル
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 9
	SELECTCASE FLAG:現M
		CASE 0
			SIF FLAG:現X == 8 && FLAG:現Y == 5
				CALL E_INUI_01
		CASE 1
			SIF FLAG:現X == 8 && FLAG:現Y == 5
				CALL E_INUI_01
		CASE 2
			SIF FLAG:現X == 8 && FLAG:現Y == 7
				CALL E_INUI_01
			SIF FLAG:現X == 8 && FLAG:現Y == 9
				CALL E_INUI_02
		CASE 3
			SIF FLAG:現X == 8 && FLAG:現Y == 7
				CALL E_INUI_01
			SIF FLAG:現X == 8 && FLAG:現Y == 9
				CALL E_INUI_02
		CASEELSE
	ENDSELECT
	RETURN 1
ENDIF
RETURN 0
;=======================================================================
;必要レベル目安
;推奨LV 雑魚最低LV 雑魚最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_48
RETURN 25, 22, 27, 25

;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_48
;FLAG:エンカウント率 = 0
IF FLAG:現M < 3
	FLAG:エンカウント率 = FLAG:未遭遇歩数*5 + 5
ELSEIF FLAG:現M == 3
	FLAG:エンカウント率 = FLAG:未遭遇歩数*5 + 10
ENDIF

;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_48
IF RAND:100 < FLAG:エンカウント率
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF
;=======================================================================
;敵の種族の種類数
;=======================================================================
@CLASS_NUM_48
RETURN CLASS_NUM_COMMON("中級")
;=======================================================================
;敵の総数
;ARGは出現する敵の種類です
;=======================================================================
@ENEMY_NUM_48, ARG
RETURN ENEMY_NUM_COMMON("中級", ARG)
;=======================================================================
;敵の種類
;=======================================================================
@ENEMY_48, ARG
SELECTCASE FLAG:現M
	CASE 0
	;一階
		SELECTCASE RAND:100
			CASE IS < 20
				;20％　妖魔コッパテングLv19（22）
				RETURN [[キャラ:コッパテング]], 22
			CASE IS < 35
				;15%　妖鬼オニ　Lv20（23）
				RETURN [[キャラ:オニ]], 23
			CASE IS < 50
				;15%　龍王ノズチ　Lv19（22）
				RETURN [[キャラ:ノズチ]], 22
			CASE IS < 65
				;15%　妖鬼ユキジョロウ　Lv21（24）
				RETURN [[キャラ:ユキジョロウ]], 24
			CASE IS < 80
				;15%　魔獣ブラックウィドウ　Lv23
				RETURN [[キャラ:ブラックウィドウ]], 23
			CASE IS < 90
				;10%　外道グーラー　Lv22
				RETURN [[キャラ:グーラー]], 22
			CASE IS < 100
				;10%　妖精エルフ　Lv23
				RETURN [[キャラ:エルフ]], 23
		ENDSELECT
	CASE 1
	;二階
		SELECTCASE RAND:100
			CASE IS < 20
				;20％　妖魔コッパテングLv19（22）
				RETURN [[キャラ:コッパテング]], 22
			CASE IS < 35
				;15%　妖鬼オニ　Lv20（23）
				RETURN [[キャラ:オニ]], 23
			CASE IS < 50
				;15%　龍王ノズチ　Lv19（22）
				RETURN [[キャラ:ノズチ]], 22
			CASE IS < 65
				;15%　妖鬼ユキジョロウ　Lv21（24）
				RETURN [[キャラ:ユキジョロウ]], 24
			CASE IS < 80
				;15%　魔獣ブラックウィドウ　Lv23
				RETURN [[キャラ:ブラックウィドウ]], 23
			CASE IS < 90
				;10%　外道グーラー　Lv22
				RETURN [[キャラ:グーラー]], 22
			CASE IS < 100
				;10%　妖精エルフ　Lv23
				RETURN [[キャラ:エルフ]], 23
		ENDSELECT
	CASE 2
	;三階
		SELECTCASE RAND:100
			CASE IS < 15
				;15％　妖魔イソラLv23
				RETURN [[キャラ:イソラ]], 23
			CASE IS < 35
				;20%　妖鬼モムノフ　Lv25
				RETURN [[キャラ:モムノフ]], 25
			CASE IS < 50
				;15%　魔獣オルトロス　Lv23
				RETURN [[キャラ:オルトロス]], 23
			CASE IS < 70
				;20%　妖鬼ハンニャ　Lv25
				RETURN [[キャラ:ハンニャ]], 25
			CASE IS < 85
				;15%　妖鳥ケライノー　Lv25
				RETURN [[キャラ:ケライノー]], 25
			CASE IS < 100
				;15%　妖精エルフ　Lv23
				RETURN [[キャラ:エルフ]], 23
		ENDSELECT
	CASE 3
	;四階
		SELECTCASE RAND:100
			CASE IS < 15
				;15％　妖魔イソラLv23（26）
				RETURN [[キャラ:イソラ]], 26
			CASE IS < 35
				;20%　妖鬼モムノフ　Lv25
				RETURN [[キャラ:モムノフ]], 25
			CASE IS < 50
				;15%　魔獣オルトロス　Lv23
				RETURN [[キャラ:オルトロス]], 23
			CASE IS < 70
				;20%　妖鬼ハンニャ　Lv25
				RETURN [[キャラ:ハンニャ]], 25
			CASE IS < 85
				;15%　妖鳥ケライノー　Lv25
				RETURN [[キャラ:ケライノー]], 25
			CASE IS < 100
				;15%　妖精バンシー　Lv27
				RETURN [[キャラ:バンシー]], 27
		ENDSELECT
ENDSELECT

;=======================================================================
;イベントまとめ
;=======================================================================
@EVENTING_CALLING_48
SELECTCASE FLAG:現M
	CASE 0
		IF FLAG:現X == 6 && FLAG:現Y == 4 && ダンジョンフラグ:48:0 == 0
			PRINTFORML ＞There is the ghost of an apparment resident.
			;＞マンション住人の幽霊がいる
			PRINTFORMW 「I heard that a soldier committed suicide in this place long ago.」
			;「ここって昔、兵隊さんがおおぜい自殺した場所だったって、聞いたわ」
			PRINTFORMW 「I wonder if ghosts will come out, I'm scared.」
			;「幽霊でも出るのかしら、怖いわね」
		ENDIF
	CASE 3
		IF FLAG:現X == 10 && FLAG:現Y == 11 && ダンジョンフラグ:48:0 == 0
			CUSTOMDRAWLINE =
			PRINTW 異界と化したマンション、カーサ乾の一室
			PRINTW Beyond the door, there are ghosts in uniforms the Japanese army used to wear long ago.
			;扉の向こうには旧日本軍の制服を着た亡霊達が整列していた
			PRINTW 
			PRINTW 「...who enters our domain?」
			;「……我が領域に進入するのは誰か？」
			PRINTW 「Miserable human beings who disturb our sleep.」
			;「我らの眠りを邪魔する不埒な人間許すまじ」
			PRINTW 「...dry platoon, assault!!」
			;「……乾小隊、突撃！！」
			PRINTL 
			PRINTL ４ Ghost Soldiers appeared!
			;怨霊 部隊兵が４体現われた！
			PRINTL １ Ghost Inui appeared!
			;怨霊 イヌイが１体現れた！
			PRINTW 
			CUSTOMDRAWLINE =
			WAIT
			FLAG:逃走不可フラグ = 1
			FLAG:会話不能フラグ = 1
			FLAG:先制不意打ちキャンセル = 1
			IF FLAG:戦闘難易度 >= 3 || FLAG:周回回数 >= 1 || BASE:MASTER:LV >= 30
				;部隊兵Lv21
				CALL SET_ENEMY,8,1088,30,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;部隊兵
				CALL SET_ENEMY,9,1088,30,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;部隊兵
				CALL SET_ENEMY,10,1088,30,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;部隊兵
				CALL SET_ENEMY,13,1088,30,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;イヌイLv25
				CALL SET_ENEMY,14,1089,34,0,1
				CFLAG:(CHARANUM-1):ＨＰ補正 += 500
				CFLAG:(CHARANUM-1):ＭＰ補正 += 5000
				CFLAG:(CHARANUM-1):速度補正 += 10
				CALL SYNC_STATUS,(CHARANUM-1)
				CALL HEALTH_CHARA,(CHARANUM-1)
			ELSE
				;部隊兵
				CALL SET_ENEMY,8,1088,21,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;部隊兵
				CALL SET_ENEMY,9,1088,21,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;部隊兵
				CALL SET_ENEMY,10,1088,21,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;部隊兵
				CALL SET_ENEMY,13,1088,21,0,1
				CSTR:(CHARANUM-1):思考パターン = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)

				;イヌイ
				CALL SET_ENEMY,14,1089,25,0,1
				CFLAG:(CHARANUM-1):ＭＰ補正 += 500
				CFLAG:(CHARANUM-1):ＭＰ補正 += 5000
				CFLAG:(CHARANUM-1):速度補正 += 10
				CALL SYNC_STATUS,(CHARANUM-1)
				CALL HEALTH_CHARA,(CHARANUM-1)
			ENDIF
			CALL BATTLE_START
			FLAG:逃走不可フラグ = 0
			FLAG:会話不能フラグ = 0
			FLAG:先制不意打ちキャンセル = 0
			CUSTOMDRAWLINE =
			PRINTL
			PRINTW 「...We committed suicide out of regret, longing to sleep peacefully...」
			PRINTW 「But after only half a century, a building for a moneylender was built here...」
			PRINTW 「From that, anger flowed into us and made us restless spirits...」 
			PRINTW
			PRINTW Ghost Inei disappeared...
			;怨霊 イヌイ達は消えていった…
			PRINTL 
			PRINTL The differentiated Casa Dry returned to normal.
			;異界化したカーサ乾は元に戻った
			PRINTW ￥50000 where paid as reward.
			;報酬として口座に￥50000が支払われた
			CUSTOMDRAWLINE =
			MONEY += 50000
			ダンジョンフラグ:48:0 = 1
			DA:(FLAG:現X):(FLAG:現Y) = 1
			FLAG:脱出 = 1
			RETURN 1
		ENDIF
	CASEELSE
	ENDSELECT
	RETURN 1
RETURN 0
;=======================================================================
;宝箱まとめ
;=======================================================================
@TRESURING_CALLING_48
	SELECTCASE FLAG:現M
		CASE 0
			;Life stone
			CALL GET_TREASURE,1002,2,48,10
		CASE 1
			SIF FLAG:現X == 5 && FLAG:現Y == 4
				;NapalmBomb
				CALL GET_TREASURE,1102,2,48,11
			SIF FLAG:現X == 8 && FLAG:現Y == 7
				;Fa Sheng
				CALL GET_TREASURE,2090,1,48,12
		CASE 3
			;Revenge Gauntlet
			CALL GET_TREASURE,4008,1,48,13
	ENDSELECT
RETURN 0

;========
;罠置き場
;========
@TRAP_48
SELECTCASE FLAG:現M
	CASE 2
		IF RAND:3 == 0
			CALL DUNGEON_TRAP_POISON,40
		ELSEIF RAND:2 == 0
			CALL DUNGEON_TRAP_HP,10
		ELSE
			CALL DUNGEON_TRAP_MP,10
		ENDIF
	CASE 3
		IF RAND:3 == 0
			CALL DUNGEON_TRAP_POISON,40
		ELSEIF RAND:2 == 0
			CALL DUNGEON_TRAP_HP,10
		ELSE
			CALL DUNGEON_TRAP_MP,10
		ENDIF
ENDSELECT
RETURN 0


@E_INUI_01
PRINTL There is an elevator.
;ここはエレベーターだ。
PRINTW -Please select the floor you want to go to-
;-行きたい階のボタンを押して下さい-
PRINTL [1]１Ｆ
PRINTL [2]２Ｆ
PRINTL [3]３Ｆ
PRINTL [4]４Ｆ
PRINTL [99]Cancel
$INPUT_LOOP_INUI_01
INPUT
IF RESULT == 99
	RETURN 1
ELSEIF RESULT == 1
	IF FLAG:現M == 0
		RETURN 1
	ELSE
		FLAG:現M = 0
		FLAG:現X = 6
		FLAG:現Y = 5
	ENDIF
ELSEIF RESULT == 2
	IF FLAG:現M == 1
		RETURN 1
	ELSE
		FLAG:現M = 1
		FLAG:現X = 6
		FLAG:現Y = 5
	ENDIF
ELSEIF RESULT == 3
	IF FLAG:現M == 2
		RETURN 1
	ELSE
		FLAG:現M = 2
		FLAG:現X = 6
		FLAG:現Y = 7
	ENDIF
ELSEIF RESULT == 4
	IF FLAG:現M == 3
		RETURN 1
	ELSE
		FLAG:現M = 3
		FLAG:現X = 6
		FLAG:現Y = 7
	ENDIF
ELSE
	GOTO INPUT_LOOP_INUI_01
ENDIF

CALL MAKE_FLOOR, FLAG:現ダンジョン
CALL AUTOMAP

@E_INUI_02
PRINTL There is an elevator.
PRINTW -Please select the floor you want to go to-
PRINTL [3]３Ｆ
PRINTL [4]４Ｆ
PRINTL [99]Cancel
$INPUT_LOOP_INUI_02
INPUT
IF RESULT == 99
	RETURN 1
ELSEIF RESULT == 3
	IF FLAG:現M == 2
		RETURN 1
	ELSE
		FLAG:現M = 2
		FLAG:現X = 6
		FLAG:現Y = 9
	ENDIF
ELSEIF RESULT == 4
	IF FLAG:現M == 3
		RETURN 1
	ELSE
		FLAG:現M = 3
		FLAG:現X = 6
		FLAG:現Y = 9
	ENDIF
ELSE
	GOTO INPUT_LOOP_INUI_02
ENDIF

CALL MAKE_FLOOR, FLAG:現ダンジョン
CALL AUTOMAP



@SET_ACTION_1088,ARG
IF CFLAG:MASTER:攻撃強化 >= 8 || CFLAG:MASTER:命中強化 >= 8 || CFLAG:MASTER:防御強化 >= 8 || CFLAG:MASTER:命中強化 >= 8
	IF RAND:2 == 0
		;自爆
		CALL CHECK_ACTIONABLE,ARG,2005
			SIF RESULT == 0
				GOTO DECIDE_ACTION
		CFLAG:ARG:入力行動 = 2005
		CALL RANDOM_TARGET,ARG,2005
		RETURN 1
	ELSE
		CALL CHECK_ACTIONABLE,ARG,113
		SIF RESULT == 0
			GOTO DECIDE_ACTION
		CFLAG:ARG:入力行動 = 113
		CALL RANDOM_TARGET,ARG,113
		RETURN 1
	ENDIF
	
ELSEIF 現HP割合(ARG) < 50
	SELECTCASE RAND:100
		CASE IS < 10
			;自爆
			CALL CHECK_ACTIONABLE,ARG,2005
				SIF RESULT == 0
					GOTO DECIDE_ACTION
			CFLAG:ARG:入力行動 = 2005
			CALL RANDOM_TARGET,ARG,2005
			RETURN 1
		CASE IS < 30
			CALL CHECK_ACTIONABLE,ARG,111
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:入力行動 = 111
			CALL RANDOM_TARGET,ARG,111
			RETURN 1
		CASE IS < 65
			CALL CHECK_ACTIONABLE,ARG,112
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:入力行動 = 112
			CALL RANDOM_TARGET,ARG,112
			RETURN 1
		CASE IS < 100
			CALL CHECK_ACTIONABLE,ARG,113
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:入力行動 = 113
			CALL RANDOM_TARGET,ARG,113
			RETURN 1
	ENDSELECT

ELSEIF 現HP割合(ARG) >= 50
	SELECTCASE RAND:100
		;
		CASE IS < 35
			CALL CHECK_ACTIONABLE,ARG,111
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:入力行動 = 111
			CALL RANDOM_TARGET,ARG,111
			RETURN 1
		;
		CASE IS < 70
			CALL CHECK_ACTIONABLE,ARG,112
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:入力行動 = 112
			CALL RANDOM_TARGET,ARG,112
			RETURN 1
		CASE IS < 100
			CALL CHECK_ACTIONABLE,ARG,113
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:入力行動 = 113
			CALL RANDOM_TARGET,ARG,113
			RETURN 1
	ENDSELECT
ELSE
	$DECIDE_ACTION
	CALL SEARCH_ACT,ARG
	IF RESULT == 0
		CFLAG:ARG:入力行動 = -1
		CFLAG:ARG:防御フラグ = 1
		RETURN 0
	ENDIF
	LOCAL = RAND:RESULT
	;スキル番号決定
	LOCAL:1 = S:(10+LOCAL)
	$TARGET_LOOP
	
	CALL RANDOM_TARGET,ARG,LOCAL:1
	CALLFORM SKILL_TARGET_{LOCAL:1}
	;ここでスキル番号を行動内容に代入
	SIF CFLAG:ARG:ターゲット == -1
		GOTO DECIDE_ACTION
	CFLAG:ARG:入力行動 = LOCAL:1
ENDIF


;=======================================================================
;輪姦参加悪魔
;=======================================================================
@DUNGEON_RAPE_DEVIL_48
;ランダムにどの悪魔が出るか決定
;RETURN CSV番号 , 人数 , レベル
SELECTCASE RAND:4
	CASE 0
		RETURN [[キャラ:モムノフ]] , 3 + RAND:10 , CSVBASE([[キャラ:モムノフ]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:オニ]] , 3 + RAND:10 , CSVBASE([[キャラ:オニ]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:オルトロス]] , 3 + RAND:10 , CSVBASE([[キャラ:オルトロス]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 3
		RETURN [[キャラ:イソラ]] , 3 + RAND:10 , CSVBASE([[キャラ:イソラ]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT
