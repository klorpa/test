;=======================================================================
;軽子坂高校
;ボス オキュペテー または モー・ショボー２体
;ダンジョンナンバー2　ＭＡＰ0~5
;=======================================================================
;フラグ
;ダンジョンフラグ:2:0-10 = 宝箱
;ダンジョンフラグ:2:11 = ボス撃破フラグ(1.倒した)
;ダンジョンフラグ:2:12 = レイコフラグ(1.奴隷にした 2.放っておいた)
;
;=======================================================================
;攻略条件
;=======================================================================
@PREREQUISITE_DUNGEON_2
;REQ2 軽子坂高校体育館(1)をクリアしていなければダメ
SIF 依頼フラグ:2:0 == 0
	RETURN 0
;REQ3 軽子坂高校体育館(2)をクリアしていなければダメ
SIF 依頼フラグ:3:0 == 0
	RETURN 0
;D7軽子坂上層をクリアしていない
SIF ダンジョンフラグ:7:1
	RETURN 0
RETURN 1


;=======================================================================
;ダンジョン名
;=======================================================================
@GET_DUNGEON_NAME_2
RESULTS = Karukozaka High School


;=======================================================================
;フロア名表示
;=======================================================================
@FLOORNAME_2
PRINT Karukozaka High School
SELECTCASE FLAG:現M
	CASE 0
		PRINTL   B１Ｆ
	CASE 1
		PRINTL   １Ｆ
	CASE 2
		PRINTL   ２Ｆ
	CASE 3
		PRINTL   ３Ｆ
	CASE 4
		PRINTL   ４Ｆ
	CASE 5
		PRINTL   ５Ｆ
	CASEELSE
		PRINTL
ENDSELECT


;=======================================================================
;特殊タイル表示
;=======================================================================
@TILE_MARK_2_X_X
RESULTS = 特


;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_2,ARG
FLAG:現M = 0
FLAG:現X = 9
FLAG:現Y = 2
;CALL AUTOMAP


;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_2,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

;=======================================================================
;フロアデータ
;=======================================================================
@MAKE_FLOOR_2
SELECTCASE FLAG:現M
	CASE 0
	;１階
		FLAG:最大X = 10
		FLAG:最大Y = 6
		CALL MAKE_FLOOR_LINE,0,"0000000000"
		CALL MAKE_FLOOR_LINE,1,"0121111110"
		CALL MAKE_FLOOR_LINE,2,"0001001018"
		CALL MAKE_FLOOR_LINE,3,"0121600010"
		CALL MAKE_FLOOR_LINE,4,"0000001210"
		CALL MAKE_FLOOR_LINE,5,"0000000000"
		CALL MAKE_FLOOR_LINE,6,"0000000000"
		CALL MAKE_FLOOR_LINE,7,"0000000000"
		CALL MAKE_FLOOR_LINE,8,"0000000000"
		CALL MAKE_FLOOR_LINE,9,"0000000000"
		
		;宝箱の設置
		CALL SET_TILE,1,3,ダンジョンフラグ:2:0,0,3
		
		;イベントの設置
		CALL SET_TILE,8,2,ダンジョンフラグ:2:12,0,4

	CASE 1
	;２階
		FLAG:最大X = 15
		FLAG:最大Y = 15
		CALL MAKE_FLOOR_LINE,0,"000000000000000"
		CALL MAKE_FLOOR_LINE,1,"012111211111210"
		CALL MAKE_FLOOR_LINE,2,"000002010000000"
		CALL MAKE_FLOOR_LINE,3,"011111010101000"
		CALL MAKE_FLOOR_LINE,4,"010001010201000"
		CALL MAKE_FLOOR_LINE,5,"010601011111210"
		CALL MAKE_FLOOR_LINE,6,"010201000001000"
		CALL MAKE_FLOOR_LINE,7,"011111000121000"
		CALL MAKE_FLOOR_LINE,8,"000000000001000"
		CALL MAKE_FLOOR_LINE,9,"000000010111210"
		CALL MAKE_FLOOR_LINE,10,"000000020111000"
		CALL MAKE_FLOOR_LINE,11,"000000011111110"
		CALL MAKE_FLOOR_LINE,12,"000000000201000"
		CALL MAKE_FLOOR_LINE,13,"000000072101210"
		CALL MAKE_FLOOR_LINE,14,"000000000000000"
		
		;宝箱の設置
		CALL SET_TILE,11,3,ダンジョンフラグ:2:1,0,3
	CASE 2
	;3階
		FLAG:最大X = 9
		FLAG:最大Y = 17
		CALL MAKE_FLOOR_LINE,0,"000000000"
		CALL MAKE_FLOOR_LINE,1,"011111000"
		CALL MAKE_FLOOR_LINE,2,"010002000"
		CALL MAKE_FLOOR_LINE,3,"010106000"
		CALL MAKE_FLOOR_LINE,4,"010200000"
		CALL MAKE_FLOOR_LINE,5,"011111000"
		CALL MAKE_FLOOR_LINE,6,"020000000"
		CALL MAKE_FLOOR_LINE,7,"011111010"
		CALL MAKE_FLOOR_LINE,8,"020002020"
		CALL MAKE_FLOOR_LINE,9,"010121110"
		CALL MAKE_FLOOR_LINE,10,"000000010"
		CALL MAKE_FLOOR_LINE,11,"000111010"
		CALL MAKE_FLOOR_LINE,12,"000201010"
		CALL MAKE_FLOOR_LINE,13,"000701210"
		CALL MAKE_FLOOR_LINE,14,"000001020"
		CALL MAKE_FLOOR_LINE,15,"000121010"
		CALL MAKE_FLOOR_LINE,16,"000000000"
		
		;宝箱の設置
		CALL SET_TILE,5,5,ダンジョンフラグ:2:2,0,3
	CASE 3
	;4階
		FLAG:最大X = 17
		FLAG:最大Y = 9
		CALL MAKE_FLOOR_LINE,0,"00000000000000000"
		CALL MAKE_FLOOR_LINE,1,"00000001211111210"
		CALL MAKE_FLOOR_LINE,2,"00000000000100010"
		CALL MAKE_FLOOR_LINE,3,"01111101112107010"
		CALL MAKE_FLOOR_LINE,4,"02010200010102010"
		CALL MAKE_FLOOR_LINE,5,"06010101210001110"
		CALL MAKE_FLOOR_LINE,6,"00010000010000000"
		CALL MAKE_FLOOR_LINE,7,"01211111110000000"
		CALL MAKE_FLOOR_LINE,8,"00000000000000000"

		;宝箱の設置
		CALL SET_TILE,7,1,ダンジョンフラグ:2:3,0,3
		CALL SET_TILE,7,5,ダンジョンフラグ:2:4,0,3
		CALL SET_TILE,5,5,ダンジョンフラグ:2:5,0,3
		CALL SET_TILE,1,7,ダンジョンフラグ:2:6,0,3
		CALL SET_TILE,7,3,ダンジョンフラグ:2:7,0,3
	CASE 4
	;5階
		FLAG:最大X = 9
		FLAG:最大Y = 17
		CALL MAKE_FLOOR_LINE,0,"000000000"
		CALL MAKE_FLOOR_LINE,1,"011111000"
		CALL MAKE_FLOOR_LINE,2,"010201000"
		CALL MAKE_FLOOR_LINE,3,"000101000"
		CALL MAKE_FLOOR_LINE,4,"070101000"
		CALL MAKE_FLOOR_LINE,5,"020101110"
		CALL MAKE_FLOOR_LINE,6,"010102020"
		CALL MAKE_FLOOR_LINE,7,"012101010"
		CALL MAKE_FLOOR_LINE,8,"000001000"
		CALL MAKE_FLOOR_LINE,9,"000111110"
		CALL MAKE_FLOOR_LINE,10,"000100010"
		CALL MAKE_FLOOR_LINE,11,"000126010"
		CALL MAKE_FLOOR_LINE,12,"000100010"
		CALL MAKE_FLOOR_LINE,13,"000111110"
		CALL MAKE_FLOOR_LINE,14,"000000000"
		CALL MAKE_FLOOR_LINE,15,"000000000"
		CALL MAKE_FLOOR_LINE,16,"000000000"
		
		;宝箱の設置
		CALL SET_TILE,1,2,ダンジョンフラグ:2:8,0,3
	CASE 5
	;6階
		FLAG:最大X = 17
		FLAG:最大Y = 9
		CALL MAKE_FLOOR_LINE,0,"00000000000000000"
		CALL MAKE_FLOOR_LINE,1,"00000000111211110"
		CALL MAKE_FLOOR_LINE,2,"00000000100011000"
		CALL MAKE_FLOOR_LINE,3,"00011112101211210"
		CALL MAKE_FLOOR_LINE,4,"00000110000011000"
		CALL MAKE_FLOOR_LINE,5,"00072112101211110"
		CALL MAKE_FLOOR_LINE,6,"00000110001000000"
		CALL MAKE_FLOOR_LINE,7,"00011112111000000"
		CALL MAKE_FLOOR_LINE,8,"00000000000000000"

		;宝箱の設置
		CALL SET_TILE,15,1,ダンジョンフラグ:2:9,0,3
		CALL SET_TILE,8,5,ダンジョンフラグ:2:10,0,3
		;イベントの設置
		CALL SET_TILE,15,3,ダンジョンフラグ:2:11,0,4

	CASEELSE





ENDSELECT



;=======================================================================
;[5]調べる　実行時のイベント
;=======================================================================
@EVENT_CHECK_DUNGEON_2

;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 3
	SELECTCASE FLAG:現M
		CASE 0
			IF FLAG:現X == 1 && FLAG:現Y == 3
				;Medecine
				CALL GET_TREASURE,1001,1,FLAG:現ダンジョン,0
			ENDIF
		CASE 1
			IF FLAG:現X == 11 && FLAG:現Y == 3
				;Iron Pumpkin
				CALL GET_TREASURE,3004,1,FLAG:現ダンジョン,1
			ENDIF
		CASE 2
			IF FLAG:現X == 5 && FLAG:現Y == 5
				;High-Cut Leotard
				CALL GET_TREASURE,3501,1,FLAG:現ダンジョン,2
			ENDIF
		CASE 3
			IF FLAG:現X == 7 && FLAG:現Y == 1
				;LuIncense
				CALL GET_TREASURE,1015,1,FLAG:現ダンジョン,3
			ELSEIF FLAG:現X == 7 && FLAG:現Y == 5
				;400MAG
				CALL GET_TREASURE_MAG, 0,400,FLAG:現ダンジョン,4
			ELSEIF FLAG:現X == 5 && FLAG:現Y == 5
				;Slicer
				CALL GET_TREASURE,2006,1,FLAG:現ダンジョン,5
			ELSEIF FLAG:現X == 1 && FLAG:現Y == 7
				;InIncense
				CALL GET_TREASURE,1011,1,FLAG:現ダンジョン,6
			ELSEIF FLAG:現X == 7 && FLAG:現Y == 3
				;Arm Bridge
				CALL GET_TREASURE,4004,1,FLAG:現ダンジョン,7
			ENDIF
		CASE 4
			IF FLAG:現X == 1 && FLAG:現Y == 2
				;Dancing Heel
				CALL GET_TREASURE,4504,1,FLAG:現ダンジョン,8
			ENDIF
		CASE 5
			IF FLAG:現X == 15 && FLAG:現Y == 1
				;コルセっく
				CALL GET_TREASURE,2008,1,FLAG:現ダンジョン,9
			ELSEIF FLAG:現X == 8 && FLAG:現Y == 5
				;StIncense
				CALL GET_TREASURE,1010,1,FLAG:現ダンジョン,10
			ENDIF
	ENDSELECT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
	SELECTCASE FLAG:現M
		CASE 0
			SIF FLAG:現X == 4 && FLAG:現Y == 3
				CALL DUNGEON_UPSTAIRS,1,7,13
		CASE 1
			SIF FLAG:現X == 3 && FLAG:現Y == 5
				CALL DUNGEON_UPSTAIRS,2,3,13
		CASE 2
			SIF FLAG:現X == 5 && FLAG:現Y == 3
				CALL DUNGEON_UPSTAIRS,3,13,3
		CASE 3
			SIF FLAG:現X == 1 && FLAG:現Y == 5
				CALL DUNGEON_UPSTAIRS,4,1,4
		CASE 4
			SIF FLAG:現X == 5 && FLAG:現Y == 11
				CALL DUNGEON_UPSTAIRS,5,3,5

		CASEELSE
	ENDSELECT
	RETURN 1
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
	SELECTCASE FLAG:現M
		CASE 1
			SIF FLAG:現X == 7 && FLAG:現Y == 13
				CALL DUNGEON_DOWNSTAIRS,0,4,3
		CASE 2
			SIF FLAG:現X == 3 && FLAG:現Y == 13
				CALL DUNGEON_DOWNSTAIRS,1,3,5
		CASE 3
			SIF FLAG:現X == 13 && FLAG:現Y == 3
				CALL DUNGEON_DOWNSTAIRS,2,5,3
		CASE 4
			SIF FLAG:現X == 1 && FLAG:現Y == 4
				CALL DUNGEON_DOWNSTAIRS,3,1,5
		CASE 5
			SIF FLAG:現X == 3 && FLAG:現Y == 5
				CALL DUNGEON_DOWNSTAIRS,4,5,11
		CASEELSE
	ENDSELECT
	RETURN 1
ELSE
	CALL MESSAGE_WINDOW_D, "", "＞Nothing seeems to be here."
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時のイベント
;=======================================================================
@EVENT_ENTER_DUNGEON_2,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 3
	SELECTCASE FLAG:現M
		CASE 0
			IF FLAG:現X == 1 && FLAG:現Y == 3
				;Medecine
				CALL GET_TREASURE,1001,1,FLAG:現ダンジョン,0
			ENDIF
		CASE 1
			IF FLAG:現X == 11 && FLAG:現Y == 3
				;Iron Pumpkin
				CALL GET_TREASURE,3004,1,FLAG:現ダンジョン,1
			ENDIF
		CASE 2
			IF FLAG:現X == 5 && FLAG:現Y == 5
				;High-Cut Leotard
				CALL GET_TREASURE,3501,1,FLAG:現ダンジョン,2
			ENDIF
		CASE 3
			IF FLAG:現X == 7 && FLAG:現Y == 1
				;LuIncense
				CALL GET_TREASURE,1015,1,FLAG:現ダンジョン,3
			ELSEIF FLAG:現X == 7 && FLAG:現Y == 5
				;400MAG
				CALL GET_TREASURE_MAG, ,400, FLAG:現ダンジョン,4
			ELSEIF FLAG:現X == 5 && FLAG:現Y == 5
				;Slicer
				CALL GET_TREASURE,2006,1,FLAG:現ダンジョン,5
			ELSEIF FLAG:現X == 1 && FLAG:現Y == 7
				;InIncense
				CALL GET_TREASURE,1011,1,FLAG:現ダンジョン,6
			ELSEIF FLAG:現X == 7 && FLAG:現Y == 3
				;Arm Bridge
				CALL GET_TREASURE,4004,1,FLAG:現ダンジョン,7
			ENDIF
		CASE 4
			IF FLAG:現X == 1 && FLAG:現Y == 2
				;Dancing Heel
				CALL GET_TREASURE,4504,1,FLAG:現ダンジョン,8
			ENDIF

		CASE 5
			IF FLAG:現X == 15 && FLAG:現Y == 1
				;Corseca
				CALL GET_TREASURE,2008,1,FLAG:現ダンジョン,9
			ELSEIF FLAG:現X == 8 && FLAG:現Y == 5
				;力の香り
				CALL GET_TREASURE,1010,1,FLAG:現ダンジョン,10
			ENDIF
	ENDSELECT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
SELECTCASE FLAG:現M
	CASE 0
		SIF FLAG:現X == 4 && FLAG:現Y == 3
			CALL DUNGEON_UPSTAIRS,1,7,13
	CASE 1
		SIF FLAG:現X == 3 && FLAG:現Y == 5
			CALL DUNGEON_UPSTAIRS,2,3,13
	CASE 2
		SIF FLAG:現X == 5 && FLAG:現Y == 3
			CALL DUNGEON_UPSTAIRS,3,13,3
	CASE 3
		SIF FLAG:現X == 1 && FLAG:現Y == 5
			CALL DUNGEON_UPSTAIRS,4,1,4
	CASE 4
		SIF FLAG:現X == 5 && FLAG:現Y == 11
			CALL DUNGEON_UPSTAIRS,5,3,5

	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
SELECTCASE FLAG:現M
	CASE 1
		SIF FLAG:現X == 7 && FLAG:現Y == 13
			CALL DUNGEON_DOWNSTAIRS,0,4,3
	CASE 2
		SIF FLAG:現X == 3 && FLAG:現Y == 13
			CALL DUNGEON_DOWNSTAIRS,1,3,5
	CASE 3
		SIF FLAG:現X == 13 && FLAG:現Y == 3
			CALL DUNGEON_DOWNSTAIRS,2,5,3
	CASE 4
		SIF FLAG:現X == 1 && FLAG:現Y == 4
			CALL DUNGEON_DOWNSTAIRS,3,1,5
	CASE 5
		SIF FLAG:現X == 3 && FLAG:現Y == 5
			CALL DUNGEON_DOWNSTAIRS,4,5,11

	CASEELSE
ENDSELECT
RETURN 1
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1

;========================
;イベント
;========================
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 4
	IF FLAG:現M == 5
		IF RAND:2 == 0
			CALL MESSAGE_WINDOW_D, "", "＞This seems to be the deepest part of the Makai made at Karukozaka High School.../＞There were two Moh Shuvuu where, holding hands/＞while spinning together in the air."
			CALL MESSAGE_WINDOW_D, "Moh Shuvuu", "What is a human doing in such a place?"
			CALL MESSAGE_WINDOW_D, "Another Moh Shuvuu", "Will you play with us?"
			CALL MESSAGE_WINDOW_D, "Moh Shuvuu", "Deity Emperor told us we are allowed to kill anyone/who gets lost in the Makai he created at the school."
			CALL MESSAGE_WINDOW_D, "Another Moh Shuvuu", "We are fearsome demons."
			CALL MESSAGE_WINDOW_D, "Moh Shuvuu", "Oh, we chatted long enough./Now we'll quickly kill you ☆"
			CALL MESSAGE_WINDOW_D, "", "＞2 Raptor Moh Shuvuu appeared!"
			FLAG:逃走不可フラグ = 1
			FLAG:会話不能フラグ = 1
			FLAG:先制不意打ちキャンセル = 1
			CALL SET_ENEMY,8,902,18,0,1
			CFLAG:(CHARANUM-1):行動回数 = 2
			CFLAG:(CHARANUM-1):ＨＰ補正 = 300
			CFLAG:(CHARANUM-1):ＭＰ補正 = 1000
			;ザンマ
			ABL:(CHARANUM-1):スキル1 = 1002
			;マハ・ザン
			ABL:(CHARANUM-1):スキル2 = 1005
			;ドルミナー
			ABL:(CHARANUM-1):スキル3 = 1222
			ABL:(CHARANUM-1):スキル4 = 0
			ABL:(CHARANUM-1):スキル5 = 0
			ABL:(CHARANUM-1):スキル6 = 0
			ABL:(CHARANUM-1):スキル7 = 0
			ABL:(CHARANUM-1):スキル8 = 0
			CALL SYNC_STATUS,(CHARANUM-1)
			CALL HEALTH_CHARA,(CHARANUM-1)

			CALL SET_ENEMY,9,902,18,0,1
			CFLAG:(CHARANUM-1):行動回数 = 2
			CFLAG:(CHARANUM-1):ＨＰ補正 = 300
			CFLAG:(CHARANUM-1):ＭＰ補正 = 1000
			;夢見針
			ABL:(CHARANUM-1):スキル1 = 105
			;羽ばたき
			ABL:(CHARANUM-1):スキル2 = 311
			;気合
			ABL:(CHARANUM-1):スキル3 = 511
			ABL:(CHARANUM-1):スキル4 = 0
			ABL:(CHARANUM-1):スキル5 = 0
			ABL:(CHARANUM-1):スキル6 = 0
			ABL:(CHARANUM-1):スキル7 = 0
			ABL:(CHARANUM-1):スキル8 = 0
			CALL SYNC_STATUS,(CHARANUM-1)
			CALL HEALTH_CHARA,(CHARANUM-1)

			CALL BATTLE_START
			FLAG:逃走不可フラグ = 0
			FLAG:会話不能フラグ = 0
			FLAG:先制不意打ちキャンセル = 0
			CALL SHOW_PICTURE, "D"
			CALL MESSAGE_WINDOW_D, "Moh Shuvuu", "Ouch, how naughty of you to hit girls."
			CALL MESSAGE_WINDOW_D, "Another Moh Shuvuu", "Fuee, we'll tell the Deity Emperor."
			CALL MESSAGE_WINDOW_D, "", "＞The two Moh Shuvuu flew away..."
		ELSE
			CALL MESSAGE_WINDOW_D, "", "＞This seems to be the deepest part of the Makai made at Karukozaka High School..."
			CALL MESSAGE_WINDOW_D, "Flight Ocypete", "I thought only students trying to escape would come here.../...well it doesn't matter./Anyone who tries to stop the Deity Empror's plan to unify the world is to die for that crime!"
			CALL MESSAGE_WINDOW_D, "", "＞1 Flight Ocypete appeared!"
			FLAG:逃走不可フラグ = 1
			FLAG:会話不能フラグ = 1
			FLAG:先制不意打ちキャンセル = 1
			CALL SET_ENEMY,9,903,19,0,1
			CFLAG:(CHARANUM-1):行動回数 = 2
			;☆ボスの癖にドウマンよりもHPも攻撃も全て弱すぎるので補正をいれさせてもらう
			;CSVのスキル2が羽ばたきと書いて毒ひっかきの件…
			CFLAG:(CHARANUM-1):ＨＰ補正 = 700
			CFLAG:(CHARANUM-1):ＭＰ補正 = 1000
			CFLAG:(CHARANUM-1):速度補正 = 10
			;マヒひっかき
			ABL:(CHARANUM-1):スキル1 = 303
			;羽ばたき
			ABL:(CHARANUM-1):スキル2 = 311
			;肉彦
			ABL:(CHARANUM-1):スキル3 = 506
			;マハ・ガル
			ABL:(CHARANUM-1):スキル4 = 1704
			ABL:(CHARANUM-1):スキル5 = 0
			ABL:(CHARANUM-1):スキル6 = 0
			ABL:(CHARANUM-1):スキル7 = 0
			ABL:(CHARANUM-1):スキル8 = 0
			CALL SYNC_STATUS,(CHARANUM-1)
			CALL HEALTH_CHARA,(CHARANUM-1)
			CALL BATTLE_START
			FLAG:逃走不可フラグ = 0
			FLAG:会話不能フラグ = 0
			FLAG:先制不意打ちキャンセル = 0
			CALL SHOW_PICTURE, "D"
			CALL MESSAGE_WINDOW_D, "", "＞Flight Ocypete was defeated..."
		ENDIF
		CALL MESSAGE_WINDOW_D, "", "＞You broke part of Makai and made interaction with the outside world easier./＞This allowed some of the students to escape./＞Their parents paid you ￥50000 in gratitude./＞...But, you definitely became an enemy of the self-proclaimed「Deity Emperor」with this..."
		MONEY += 50000
		DA:(FLAG:現X):(FLAG:現Y) = 1
		ダンジョンフラグ:2:11 = 1
		FLAG:脱出 = 1
	ELSE
		CALL MESSAGE_WINDOW_D, "", "＞You entered the Makai created within Karukozaka High School.../＞Suddenly, someone called to you from behind./＞When you turned back, standing there, /＞was a schoolgirl with glasses, wearing the Karukozaka High School uniform."
		CALL MESSAGE_WINDOW_D, "Schoolgirl", "Who are you?/You don't look like a student..."
		CALL MESSAGE_WINDOW_D, "", "＞Talked for a bit and learned that her name was Akanezawa Reiko./＞She seems to be one of the students attempting to resolve the situation./＞...But, this girl, it　seems like she knows something more about this matter.../＞However, she remains silent when questioned closely..."
		CALL INPUT_YN_D("Stop prying", "Capture her for later interrogation")
		IF RESULT == 0
			CALL MESSAGE_WINDOW_D, "", @"＞Even if %CALLNAME:MASTER% pries, Reiko could really not be involved./＞You decided to leave her alone."
			DA:(FLAG:現X):(FLAG:現Y) = 1
			ダンジョンフラグ:2:12 = 2
		ELSE
			CALL MESSAGE_WINDOW_D, "Reiko", "...W-what are you doing!?/N-noooo!!"
			CALL MESSAGE_WINDOW_D, "", "＞Reiko Akanezawa was obtained"
			CALL ADD_NEW_COMPANION,4508,500,1
			DA:(FLAG:現X):(FLAG:現Y) = 1
			ダンジョンフラグ:2:12 = 1
		ENDIF
	ENDIF
	RETURN 1
ENDIF
RETURN 0

;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_2
FLAG:エンカウント率 = FLAG:未遭遇歩数*3
SIF FLAG:未遭遇歩数 < 8
	FLAG:エンカウント率 = 0


;=======================================================================
;必要レベル目安
;推奨LV 雑魚最低LV 雑魚最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_2
RETURN 6, 3, 17, 19


;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_2
IF RAND:100 < FLAG:エンカウント率
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF


;=======================================================================
;敵の種族の種類数
;=======================================================================
@CLASS_NUM_2
RETURN CLASS_NUM_COMMON("初級")


;=======================================================================
;敵の総数
;ARGは出現する敵の種類です
;RAND(X, Y)はX〜Y-1のうちのどれかになるRANDです
;なお, ここで帰った数字は下限を種族数, 上限を10として自動的に調整されます
;
;軽子坂高校も初期のダンジョンなので数は抑え目
;=======================================================================
@ENEMY_NUM_2, ARG
RETURN ENEMY_NUM_COMMON("初級", ARG)


;=======================================================================
;敵の種類
;=======================================================================
@ENEMY_2, ARG
SELECTCASE FLAG:現M
	;１Ｆでの遭遇
	CASE 0
		SELECTCASE RAND:100
			CASE IS < 30
				;30%でピクシー
				RETURN 501, 3
			CASE IS < 50
				;20%でゾンビちゃん
				RETURN 1001, 4
			CASE IS < 70
				;20%でアプサラス
				RETURN 401, 5
			CASE IS < 90
				;10%でゾンビドッグ
				RETURN 1083, 1
			CASE IS < 90
				;10%でチョンチョン
				RETURN 951, 4
			CASE IS < 100
				;10%でコボルト
				RETURN 651, 5
		ENDSELECT
	;2Ｆでの遭遇
	CASE 1
		SELECTCASE RAND:100
			CASE IS < 20
				;20%でゾンビちゃん 1
				RETURN 1001, 7
			CASE IS < 40
				;20%でカハク
				RETURN 601, 7
			CASE IS < 60
				;20%でゾンビナース
				RETURN 1002, 9
			CASE IS < 80
				;20%でアンドラス
				RETURN [[キャラ:アンドラス]], 8
			CASE IS < 100
				;20%でゴブリン
				RETURN 552, 7
		ENDSELECT
	;2Ｆでの遭遇
	CASE 2
		SELECTCASE RAND:100
			CASE IS < 20
				;20%でゾンビナース 1
				RETURN 1002, 11
			CASE IS < 40
				;20%でヨモツシコメ
				RETURN 602, 14
			CASE IS < 60
				;20%ではなこさん
				RETURN 1003, 13
			CASE IS < 80
				;20%でブラウに-
				RETURN 553, 11
			CASE IS < 100
				;20%でイヌガミ
				RETURN 853, 12
		ENDSELECT
	;2Ｆでの遭遇
	CASE 3
		SELECTCASE RAND:100
			CASE IS < 20
				;20%でリリム 
				RETURN 402, 12
			CASE IS < 40
				;40%でヨモツシコメ
				RETURN 602, 14
			CASE IS < 60
				;40%ではなこさん
				RETURN 1003, 13
			CASE IS < 80
				;40%でJフロスト
				RETURN 512, 15
			CASE IS < 100
				;40%でネコマタ
				RETURN 801, 12
		ENDSELECT
	;4Ｆでの遭遇
	CASE 4
		SELECTCASE RAND:100
			CASE IS < 20
				;20%ではなこさん 1
				RETURN 1003, 16
			CASE IS < 40
				;40%でドリアード
				RETURN 502, 15
			CASE IS < 55
				;40%でラミア
				RETURN 702, 10
			CASE IS < 70
				;40%でパリカー
				RETURN 411, 14
			CASE IS < 85
				;イッポンダタラ
				RETURN 664, 13
			CASE IS < 100
				;40%でJ	フロスト
				RETURN 512, 15
		ENDSELECT
	;5Ｆでの遭遇
	CASE 5
		SELECTCASE RAND:100
			CASE IS < 20
				;20%でカシマレイコ
				RETURN 1004, 17
			CASE IS < 60
				;40%でドリアード 1
				RETURN 502, 15
			CASE IS < 80
				;イッポンダタラ
				RETURN 664, 16
			CASE IS < 100
				;40%でモーショボー
				RETURN 902, 15
		ENDSELECT
	ENDSELECT
;=======================================================================
;エンカウント処理
;=======================================================================
;@CHECK_ENCOUNT_2
;IF RAND:100 < FLAG:エンカウント率
;	$LOOP_ENCOUNT
;	SELECTCASE FLAG:現M
;		
;		CASE 0
;		;１Ｆでの遭遇
;			LOCAL:2 = 0
;			FOR LOCAL,7,17,1
;				;１枠あたり10％の確率で出現
;				IF RAND:100 < 10
;					SELECTCASE RAND:100
;						CASE IS < 30
;							;50%でピクシー
;							CALL SET_ENEMY,LOCAL,501,3,0
;							
;						CASE IS < 50
;							;30%でゾンビちゃん
;							CALL SET_ENEMY,LOCAL,1001,4,0
;						CASE IS < 70
;							;20%でアプサラス
;							CALL SET_ENEMY,LOCAL,401,5,0
;						CASE IS < 90
;							;20%でチョンチョン
;							CALL SET_ENEMY,LOCAL,951,4,0
;						CASE IS < 100
;							;10%でコボルト
;							CALL SET_ENEMY,LOCAL,651,5,0
;					ENDSELECT
;					LOCAL:2 += 1
;				ENDIF
;			NEXT
;			SIF LOCAL:2 == 0
;				GOTO LOOP_ENCOUNT
;			
;		CASE 1
;		;2Ｆでの遭遇
;			LOCAL:2 = 0
;			FOR LOCAL,7,17,1
;				;１枠あたり10％の確率で出現
;				IF RAND:100 < 10
;					SELECTCASE RAND:100
;						CASE IS < 20
;							;20%でゾンビちゃん 1
;							CALL SET_ENEMY,LOCAL,1001,7,0
;							
;						CASE IS < 40
;							;20%でカハク
;							CALL SET_ENEMY,LOCAL,601,7,0
;						CASE IS < 60
;							;20%でゾンビナース
;							CALL SET_ENEMY,LOCAL,1002,9,0
;						CASE IS < 80
;							;20%でアンドラス
;							CALL SET_ENEMY,LOCAL,[[キャラ:アンドラス]],8,0
;						CASE IS < 100
;							;20%でゴブリン
;							CALL SET_ENEMY,LOCAL,552,7,0
;					ENDSELECT
;					LOCAL:2 += 1
;				ENDIF
;			NEXT
;			SIF LOCAL:2 == 0
;				GOTO LOOP_ENCOUNT
;			
;		CASE 2
;		;2Ｆでの遭遇
;			LOCAL:2 = 0
;			FOR LOCAL,7,17,1
;				;１枠あたり10％の確率で出現
;				IF RAND:100 < 10
;					SELECTCASE RAND:100
;						CASE IS < 20
;							;20%でゾンビナース 1
;							CALL SET_ENEMY,LOCAL,1002,11,0
;							
;						CASE IS < 40
;							;20%でヨモツシコメ
;							CALL SET_ENEMY,LOCAL,602,14,0
;						CASE IS < 60
;							;40%ではなこさん
;							CALL SET_ENEMY,LOCAL,1003,13,0
;						CASE IS < 80
;							;40%でブラウに-
;							CALL SET_ENEMY,LOCAL,553,11,0
;						CASE IS < 100
;							;20%でイヌガミ
;							CALL SET_ENEMY,LOCAL,853,12,0
;					ENDSELECT
;					LOCAL:2 += 1
;				ENDIF
;			NEXT
;			SIF LOCAL:2 == 0
;				GOTO LOOP_ENCOUNT
;		CASE 3
;		;2Ｆでの遭遇
;			LOCAL:2 = 0
;			FOR LOCAL,7,17,1
;				;１枠あたり10％の確率で出現
;				IF RAND:100 < 10
;					SELECTCASE RAND:100
;						CASE IS < 20
;							;20%でリリム 1
;							CALL SET_ENEMY,LOCAL,402,12,0
;						CASE IS < 40
;							;40%でヨモツシコメ
;							CALL SET_ENEMY,LOCAL,602,14,0
;						CASE IS < 60
;							;40%ではなこさん
;							CALL SET_ENEMY,LOCAL,1003,13,0
;						CASE IS < 80
;							;40%でJフロスト
;							CALL SET_ENEMY,LOCAL,512,15,0
;						CASE IS < 100
;							;40%でネコマタ
;							CALL SET_ENEMY,LOCAL,801,12,0
;					ENDSELECT
;					LOCAL:2 += 1
;				ENDIF
;			NEXT
;			SIF LOCAL:2 == 0
;				GOTO LOOP_ENCOUNT
;		CASE 4
;		;4Ｆでの遭遇
;			LOCAL:2 = 0
;			FOR LOCAL,7,17,1
;				;１枠あたり10％の確率で出現
;				IF RAND:100 < 10
;					SELECTCASE RAND:100
;						CASE IS < 20
;							;20%ではなこさん 1
;							CALL SET_ENEMY,LOCAL,1003,16,0
;							
;						CASE IS < 40
;							;40%でドリアード
;							CALL SET_ENEMY,LOCAL,502,15,0
;						CASE IS < 60
;							;40%でラミア
;							CALL SET_ENEMY,LOCAL,702,10,0
;						CASE IS < 80
;							;40%でパリカー
;							CALL SET_ENEMY,LOCAL,411,14,0
;						CASE IS < 100
;							;40%でJ	フロスト
;							CALL SET_ENEMY,LOCAL,512,15,0
;					ENDSELECT
;					LOCAL:2 += 1
;				ENDIF
;			NEXT
;			SIF LOCAL:2 == 0
;				GOTO LOOP_ENCOUNT
;		CASE 5
;		;5Ｆでの遭遇
;			LOCAL:2 = 0
;			FOR LOCAL,7,17,1
;				;１枠あたり10％の確率で出現
;				IF RAND:100 < 10
;					SELECTCASE RAND:100
;						CASE IS < 20
;							;20%でカシマレイコ
;							CALL SET_ENEMY,LOCAL,1004,17,0
;						CASE IS < 60
;							;40%でドリアード 1
;							CALL SET_ENEMY,LOCAL,502,15,0
;						CASE IS < 100
;							;40%でモーショボー
;							CALL SET_ENEMY,LOCAL,902,15,0
;					ENDSELECT
;					LOCAL:2 += 1
;				ENDIF
;			NEXT
;			SIF LOCAL:2 == 0
;				GOTO LOOP_ENCOUNT
;			
;	ENDSELECT
;	RETURN 1
;ELSE
;	FLAG:未遭遇歩数 += 1
;	RETURN 0
;ENDIF

;=======================================================================
;輪姦参加悪魔
;=======================================================================
@DUNGEON_RAPE_DEVIL_2
;ランダムにどの悪魔が出るか決定
;RETURN CSV番号 , 人数 , レベル
SELECTCASE RAND:4
	CASE 0
		RETURN [[キャラ:イッポンダタラ]] , 3 + RAND:10 , CSVBASE([[キャラ:イッポンダタラ]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:コボルト]] , 3 + RAND:10 , CSVBASE([[キャラ:コボルト]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:アンドラス]] , 3 + RAND:10 , CSVBASE([[キャラ:アンドラス]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 3
		RETURN [[キャラ:ブラウニー]] , 3 + RAND:10 , CSVBASE([[キャラ:ブラウニー]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT











