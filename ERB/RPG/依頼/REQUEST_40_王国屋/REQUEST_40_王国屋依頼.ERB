
;====================
;条件
;====================
@PLAYABLE_REQUEST_40
IF  イベントフラグ:18:0
	RESULTS = Paradigm X Pet Shop
	RETURN 1
ENDIF
RETURN 0

;====================
;説明
;====================
@EXPLAIN_REQUEST_40
PRINTFORML Going to the Pet Shop
PRINTFORML Can receive the Pet Shop requests
;====================
;内容
;====================
@REQUEST_40
#LOCALSIZE 2
#LOCALSSIZE 10
#DIM ページ
#DIMS 依頼, 10
#DIM SELLCHARA
#DIM PRICE
#DIM REQ
#DIM LINE
;一日一回、依頼を生成
IF ONCEDAY("王国屋依頼")
	FOR LOCAL, 1, 4
		SIF SAVESTR:@"王国屋依頼{LOCAL}" == "" || !GETBIT(依頼フラグ:40:0, LOCAL)
			CALL SET_OUKOKUYA, LOCAL
	NEXT
ENDIF

;CALL SHOW_PICTURE, "blank", "ペットショップ 王国屋"
CALL SHOW_PICTURE, "NONFLOORD", "Paradigm X Pet Shop"
;初回
IF !STRFLAG_REQ("王国屋初回", 1)
	CALL MESSAGE_WINDOW, "", "＞Paradigm X Pet Shop/＞Surrounded by many colorful electronic pets,/＞there is an old man with glasses and an apron,/＞his smile is reflected on ther screens.", , , , , 4
	;ペットショップ 王国屋/＞カラフルで愛らしい電子ペットの達の群れの中に/＞エプロンをつけた、眼鏡の老人が/＞笑みを浮かべているのが画面に映っている
	CALL MESSAGE_WINDOW, "Owner", "Welcome to the pet shop!/My name is Rokugoru and I'm the owner here./Pleased to meet you!", , , , , 4
	;"店主", "ようこそペットショップへ！/僕はここの店主のロク五郎です/よろしく！
	CALL MESSAGE_WINDOW, "Rokugoru", "Since I'm dealing in electrical pets,/this is a digital pet shop.", , , , , 4
	;ロク五郎", "うちは電子ペットを扱っている、/デジタルペットショップなんですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Look!/This one for example./It's called mechy./Isn't it cute?", , , , , 4
	;ほらっ！/僕の周りにいるこの子たち！/メッチーって言うんですねー/かわいいですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "But it's already reserved for a customer./They all are!!", , , , , 4
	;でもこれ、ぜーんぶ予約済み！/もう全部！！
	CALL MESSAGE_WINDOW, "Rokugoru", "So, I currently don't have anything to sell you./I'm sorry.", , , , , 4
	;だから今売れるのが無いんです/ごめんなさいねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Oh?　Whats this?/Oh! Huh./You have the password registered./You are a trainer.", , , , , 4
	;んっ！　どうしたメッチー！/おやっ！　おやおやっ！/キミはパスワードが登録されてるね/しかも調教師ですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Ah. /Mechie says/you are quite clever.", , , , , 4
	;この子！/メッチーが教えてくれるんです/賢いですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Well,/for you, since you have a password,/I have some special deals.", , , , , 4
	;でっ、/パスワードを持ってるキミには/別の生き物を紹介しますねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Let me re-introduce my shop./Paradigm X Pet Shop!/Rokugorus pleasant 'servants'.", , , , , 4
	;さあっ、始まりますよ！/ペットショップ王国屋！！/ロク五郎と愉快な奴隷たちー
	CALL MESSAGE_WINDOW, "Rokugoru", "First, let me briefly explain./You are a trainer./I can sell your cute demon to customers./It's a great job.", , , , , 4
	;じゃあ、簡単に説明しますねー/キミは調教師ですねー/可愛い悪魔達をもっと可愛くしてあげる、/すばらしいお仕事ですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "But, what kind of cuteness do the customers want?/Is there something special to pay attention to?/I know these questions./I understand.", , , , , 4
	;でもお客さんがどんな可愛さを求めてるか/悩んだりすることもあるんじゃないかなー？/うんうん、わかります/わかりますよー
	CALL MESSAGE_WINDOW, "Rokugoru", "I know what the customer wants,/and also what doesn't sell well./Here, take a look at this girl.", , , , , 4
	;お客さんのほうも好みの子が/なかなか売ってるのを見かけないとかもあるんですよー/ほらこの子とかみてくださいー
	CALL MESSAGE_WINDOW, "", "＞On a screen, the picture of a female demon appears", , , , , 4
	;＞一匹の女悪魔が映像が浮かびあがる
	CALL MESSAGE_WINDOW, "Rokugoru", "Oh、look at this lusting face/desperately lusting for a cock/So cute", , , , , 4
	CALL MESSAGE_WINDOW, "Rokugoru", "But、this girl is still a virgin that has not had her first kiss/And now I will put her back", , , , , 4
	CALL MESSAGE_WINDOW, "Rokugoru", "It is not time yet/Be a good girl and wait some more/I will give you to your master soon", , , , , 4
	CALL MESSAGE_WINDOW, "", "＞The picture of demon disappeared from the screen...", , , , , 4
	;女悪魔の姿が消えた……
	CALL MESSAGE_WINDOW, "Rokugoru", "Wasn't that cute?", , , , , 4
	;可愛かったですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Well, there are many customers who want girls like that,/but they are in short supply.", , , , , 4
	;とまぁこういう悪魔がほしいお客さんも多いんですねー/でも売り物としていつも市場にあるわけじゃないんですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "So, I listen to the customers wishes,/then find a trainer that can fullfill the requirements./Thats why,/I'd like you to provide me you services.", , , , , 4
	;そこでお客様から注文を聞いて/調教師の人にお仕事を頼むことにしたんですよー/そういうわけでキミには/注文通りの悪魔を用意してもらいたいのですよー
	CALL MESSAGE_WINDOW, "Rokugoru", "Of course I'll pay you for what you provide./And if they are extra cute,/they will sell for higher prices.", , , , , 4
	;もちろん用意したらお金が払ってもらえるんですねー/しかも可愛さに目がない人達ですよー/普通に売るより高くなるんですねー
ENDIF
$INPUT_LOOP
CALL MESSAGE_WINDOW, "Rokugoru", "Well then, what shall we do?", , , , , 4
;さて、どうしましょうかねー？
CALL INPUT_SELECT_M, "[0] Get Request/[1] Listen to Story/[2] Listen to Explanation/[9] Leave the store", "/", "ログを残さない/ボタンを利用する" , 1, 4, "LEFT", 72
IF RESULT == 9
	CALL MESSAGE_WINDOW, "Rokugoru", "It can get pretty lonely here. /Please come back soon.", , , , , 4
	;ほらっメッチー、さびしいですねー/また来てくださいねー
	RETURN 0
ELSEIF RESULT == 0
	$INPUT_LOOP_REQ
	;CALL SHOW_PICTURE, "blank", "ペットショップ 王国屋"
	CALL SHOW_PICTURE, "NONFLOORD", "Paradigm X Pet Shop"
	VARSET 依頼
	SIF SAVESTR:王国屋依頼1 != ""
		依頼+= @"/[1] General Request 1%\@GETBIT(依頼フラグ:40:0, 1) ?(予約中)#\@%"
	SIF SAVESTR:王国屋依頼2 != ""
		依頼 += @"/[2] General Request 2%\@GETBIT(依頼フラグ:40:0, 2) ?(予約中)#\@%"
	SIF SAVESTR:王国屋依頼3 != ""
		依頼 += @"/[3] General Request 3%\@GETBIT(依頼フラグ:40:0, 3) ?(予約中)#\@%"
	LOCAL:1 = 0
	FOR LOCAL, 4, 64
		RESULTS = 
		TRYCCALLFORM PLAYABLE_OUKOKUYA_REQ_{LOCAL}
			IF RESULT
				依頼:(LOCAL:1) += @"/[{LOCAL,2}] %RESULTS%"
			ELSE
				CONTINUE
			ENDIF
		CATCH
			CONTINUE
		ENDCATCH
		IF STRCOUNT(依頼:(LOCAL:1), "/") >= 9
			;一文字目が/になってるはずなので削る
			依頼:(LOCAL:1) = %SUBSTRING(依頼:(LOCAL:1), 1)%
			依頼:(LOCAL:1) += @"/[99] Return/%\@LOCAL:1 > 0 ? [100] Previous page#\@%"
			LOCAL:1++
		ELSEIF STRCOUNT(依頼:(LOCAL:1), "/") == 1 && LOCAL:1 > 0
			依頼:(LOCAL:1 - 1) += "/[101] Next page"
		ENDIF
	NEXT
	IF 依頼:(LOCAL:1) != ""
		;一文字目が/になってるはずなので削る
		依頼:(LOCAL:1) = %SUBSTRING(依頼:(LOCAL:1), 1)%
		依頼:(LOCAL:1) += "/" * (8 - STRCOUNT(依頼:(LOCAL:1), "/"))
		依頼:(LOCAL:1) += @"/[99] Return/%\@LOCAL:1 > 0 ? [100] Previous page#\@%"
	;依頼がない場合
	ELSEIF !LOCAL:1
		CALL MESSAGE_WINDOW, "Rokugoru", "Oh, looks like I don't have any requests available now. /Well, check in again tomorrow and I might have something.", , , , , 4
		;あ〜、今は無いみたいですねー/明日になればまた注文が入ってくると思いますよー
		CALL SHOW_PICTURE, "blank", "Paradigm X Pet Shop"
		GOTO INPUT_LOOP
	ENDIF
	
	CALL INPUT_SELECT_M, 依頼:ページ, "/", "ログを残さない/ボタンを利用する" , 3, 4, "LEFT", 72
	IF RESULT == 101
		ページ++
		GOTO INPUT_LOOP_REQ
	ELSEIF RESULT == 100
		ページ--
		GOTO INPUT_LOOP_REQ
	ELSEIF RESULT == 99
		;CALL SHOW_PICTURE, "blank", "ペットショップ 王国屋"
		CALL SHOW_PICTURE, "NONFLOORD", "Paradigm X Pet Shop"
		GOTO INPUT_LOOP
	ELSE
		R = RESULT
		IF RANGE(R, 1, 3)
			$SHOW_RANDOM
			CALL SHOW_OUKOKUYA_REQ_RANDOM, R
			CALL INPUT_SELECT_M, @"[0] Fullfill the request/[1] %\@GETBIT(依頼フラグ:40:0, R) ? Release reservation # Place reservation\@%/[2] 仲魔の素質検索/[9] See Other Requests", "/", "ログを残さない/ボタンを利用する" , 1, 4, "LEFT", 72
			;依頼を達成する	予約を解除する # 予約する
			CLEARLINE 1
			IF RESULT == 9
				GOTO INPUT_LOOP_REQ
			ELSEIF RESULT == 0
				LINE = LINECOUNT
				CALL INPUT_CHARA_LIST("Who will you sell?", "CHARASELLABLE_OUKOKUYA_REQ")
				CLEARLINE LINECOUNT - LINE
				IF RESULT == 1000
					GOTO SHOW_RANDOM
				ELSE
					SELLCHARA = RESULT
					CALL CHARA_SELL, SELLCHARA, 1
					PRICE = RESULT
					;価格補正をかける
					SPLIT SAVESTR:@"王国屋依頼{R}", "/", LOCALS
					PRICE *= (100 + TOINT(LOCALS:5))
					PRICE /= 100
					CALL MESSAGE_WINDOW, "", @"＞%NAME:SELLCHARA% can be sold for {PRICE}Macca/＞Do you want to sell?", , , , , 4
					;%NAME:SELLCHARA%は{PRICE}魔貨で売却できます/＞売却してもよろしいですか？
					CALL INPUT_YN_M,"Yes" ,"No" , , "ログを残さない/ボタンを利用する", "LEFT", 4, 72
					IF RESULT == 0
						CALL MESSAGE_WINDOW, "", @"＞%NAME:SELLCHARA% has been sold/＞You got {PRICE}Macca", , , , , 4
						;%NAME:SELLCHARA%を売却し/＞{PRICE}魔貨を手に入れました
						;売却時の諸々の処理
						CALL CHARASELL_AFTER, SELLCHARA, PRICE
						;依頼を破棄
						SAVESTR:@"王国屋依頼{R}" = 
						;予約破棄
						CLEARBIT 依頼フラグ:40:0, R
						;CALL SHOW_PICTURE, "blank", "ペットショップ 王国屋"
						CALL SHOW_PICTURE, "NONFLOORD", "Paradigm X Pet Shop"
					ELSE
						GOTO SHOW_RANDOM
					ENDIF
				ENDIF
			ELSEIF RESULT == 1
				CALL MESSAGE_WINDOW, "", @"＞%\@GETBIT(依頼フラグ:40:0, R) ? Reservation canceled # Reservation made\@%", , , , , 4
				;予約を解除しました # 予約しました
				INVERTBIT 依頼フラグ:40:0, R
				GOTO SHOW_RANDOM
			ELSEIF RESULT == 2
				LINE = LINECOUNT
				CALL INPUT_CHARA_LIST("条件素質所持", "CHARATALENTCHECK_OUKOKUYA_REQ")
				CLEARLINE LINECOUNT - LINE
				GOTO SHOW_RANDOM
			ENDIF
		ELSE
			$SHOW_REQ
			CALLFORM EXPLAIN_OUKOKUYA_REQ_{R}
			;行数あわせ
			RESULTS += "/" * MAX(17 - STRCOUNT(RESULTS, "/"),0)
			;CALL SHOW_PICTURE, "blank", "ペットショップ 王国屋", RESULTS
			CALL SHOW_PICTURE, "NONFLOORD", "Paradigm X Pet Shop", RESULTS
			CALL INPUT_SELECT_M, @"[0] Complete Request/[9] See Other Requests", "/", "ログを残さない/ボタンを利用する" , 1, 4, "LEFT", 72
			IF RESULT == 9
				GOTO INPUT_LOOP_REQ
			ELSE
				LINE = LINECOUNT
				CALL INPUT_CHARA_LIST("Who will you sell?", "CHARASELLABLE_OUKOKUYA_REQ")
				;誰を売りますか？
				CLEARLINE LINECOUNT - LINE
				IF RESULT == 1000
					GOTO SHOW_REQ
				ELSE
					SELLCHARA = RESULT
					CALL MESSAGE_WINDOW, "", @"＞Do you want to sell %NAME:SELLCHARA%/＞to fullfill this request?", , , , , 4
					;を売却し/＞依頼を達成してもよろしいですか？
					CALL INPUT_YN_M,"Yes" ,"No" , , "ログを残さない/ボタンを利用する", "LEFT", 4, 72
					IF RESULT == 0
						;報酬獲得処理
						CALLFORM TAKE_REWARD_OUKOKUYA_REQ_{R}, SELLCHARA
						;売却時の諸々の処理
						CALL CHARASELL_AFTER, SELLCHARA, PRICE
						SETBIT 依頼フラグ:40:0, R
						;CALL SHOW_PICTURE, "blank", "ペットショップ 王国屋"
						CALL SHOW_PICTURE, "NONFLOORD", "Paradigm X Pet Shop"
					ELSE
						GOTO SHOW_REQ
					ENDIF
				ENDIF
			ENDIF
		ENDIF
	ENDIF
ELSEIF RESULT == 1
	CALL MESSAGE_WINDOW, "Rokugoru", "Ah、look look、a good child/A pretty match", , , , , 4
	CALL MESSAGE_WINDOW, "Rokugoru", "ほらっ、こうすると喜ぶんですよー/ぐぁ！ メッチー！！/メッチー！ くぅ！！", , , , , 4
	CALL MESSAGE_WINDOW, "Rokugoru", "Hahaha……/……たまにかむんですねー", , , , , 4
	CALL MESSAGE_WINDOW, "Rokugoru", "でも、しかりつけてはいけませんよー/やさしく接する事が大切なんです/かわいいですねー", , , , , 4
ELSE
	CALL MESSAGE_WINDOW, "Rokugoru", "Then I'll explain./First of all, there are general and special requests.", , , , , 4
	;それじゃあ説明しますねー/まず依頼には一般依頼と特別依頼があるんですねー
	CALL MESSAGE_WINDOW, "Rokugoru", "General requests have annoymous customers,/a lot of different people make these requests./General requests change everyday,/but I'll keep a request if you make a reservation for it.", , , , , 4
	;一般依頼は匿名の依頼で/いろんな人がいろんな依頼を出すのですねー/これは毎日違う依頼を紹介するけど/予約してくれればその依頼を残しますよー
	CALL MESSAGE_WINDOW, "Rokugoru", "If you can't fullfill a request right away but could do it/given some time, you should make a reservation for that one./Of course you should eventually fullfill it./If you can't, please cancel the reservation.", , , , , 4
	;すぐには達成できないけど準備はできると思うなら/予約しておくといいですねー/もちろん予約したからには達成はして欲しいですが/無理そうならキャンセルしてくださいねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Special requests are not from ordinary customers./It's a request from thoose more involved, like other summoners./I can't introduce them on a daily basis,/but if there are some, they'll stay untill they are fullfilled.", , , , , 4
	;特別依頼は一般人ではなく/サマナーをはじめとした悪魔と関わる者達からの依頼ですねー/こっちは日替わりで紹介することはできないけど/予約しないと消えちゃうということはないですよー
	CALL MESSAGE_WINDOW, "Rokugoru", "Special requests are often more complicated than general ones/but you can take your time fullfilling them.", , , , , 4
	;一般依頼より細かくややこしい依頼だったりすることが多いので/出来そうならのんびりと準備するといいですよー
	CALL MESSAGE_WINDOW, "Rokugoru", "Depending on the request,/there may be other conditions you need to fullfill./But all goods have to be demons that fullfilled their sell condition./Please keep that in mind.", , , , , 4
	;どちらの依頼も表示されてる条件の他に/奴隷は悪魔であること/奴隷として売却可能であることが/条件になるので注意してくださいねー
	CALL MESSAGE_WINDOW, "Rokugoru", "Since more difficult requests mean more rewards,/you should aim for the most difficult ones you can manage.", , , , , 4
	;また難易度が高い依頼ほど報酬も多くなるので/できるだけ難しい依頼を頑張るといいですよー
ENDIF
GOTO INPUT_LOOP
	
