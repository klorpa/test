
;====================
;条件
;====================
@PLAYABLE_REQUEST_23
;10F突破が条件, 幾月がいない(最終指令を受け取る)と発生しない
IF ダンジョンフラグ:[[ダンジョン:Tartarus]]:1 >= 2 && イベントフラグ:9:0 < 4 || FLAG:DEBUG == 1
	RESULTS = Study Materials Collection
	RETURN 1
ENDIF
RETURN 0

;====================
;説明
;====================
@EXPLAIN_REQUEST_23
IF !STRFLAG_REQ("初回", 0, 23)
	PRINTL 
	PRINTL A contract from Ikutsuki
	PRINTFORML He wishes to talk to %CALLNAME:MASTER%
	PRINTL 
ELSE
	PRINTL 
	PRINTFORML Request from Ikutsuki
	PRINTFORML Bring him things to help him study shadows
	PRINTL 
ENDIF
;====================
;内容
;====================
@REQUEST_23
IF !STRFLAG_REQ("初回", 1, 23)
	PRINTL ＞When you agreed to meet Ikutsuki, he came over at once.
	PRINTL ＞He was as casual as ever...
	PRINTL 
	PRINTL Ikutsuki:
	PRINTW 「Hey, your Tartarus exporation seems to be going well.」
	;「やぁ, Tartarusの攻略は順調みたいだね」
	PRINTW 「That's good news for me.」
	;「おかげで僕も助かってるよ」
	PRINTW 「I'm glad Mayone introduced me to you.」
	;「ほんとに君を紹介しくれたマヨーネさんさまさまよね」
	PRINTW 「Ah, of course I'm also grateful to you.」
	;「あ, もちろん君にも感謝しているよ」
	PRINTW 「No really, you are an excellent summoner.」
	;「いやぁほんと, 優秀なサマナーさまさまなわけだ」
	PRINTW 「Well, well, now about todays matter...」
	;「それで, まぁ, 今日の用件だけど…」
	PRINTW 「You see, I have to do research on shadows as well.」
	;「ちょっと, シャドウの研究のほうもやらなくちゃいけなくなってね」
	PRINTW 「I was hoping you'd help me do just that, by gathering some materials for me.」
	;「そのための材料を集めるのを手伝ってもらえないかな」
	PRINTW 「The Yatsura shadow has a strange thing that looks like garbage but may be useful.」
	;「やつらシャドウは, しゃあどうしたもんだろうっていうような変なゴミをもってることがあってね」
	PRINTW 「All you have to do is bring me one of thoose.」
	;「それを持ってきてくれればいい」
	PRINTW 「When you do, I'll reward you with points.」
	;「そうしたら, それに応じてポイントつけるから」
	PRINTW 「Once you have enough points, you can exchange them for a price.」
	;「そのポイントに応じて景品と交換でいこうかんなぁ, と」
	PRINTW 「Well, prices like the one I gave you when you took my first request.」
	;「景品は前にもちょっと話したけど, 奴隷だね」
	PRINTW 「Anyway, just continue to explore and bring back anything that looks interresting.」
	;「探索のついででいいから, それっぽいものを見つけたら是非頼むよ」
	PRINTL 
	PRINTW ＞You got a request from Ikutsuki
	PRINTL ＞If you find anything that might be useful for his research, 
	PRINTW ＞you should bring it to Ikutsuki
ELSE
	IF STRFLAG_NUM_REQ("報告") > 0 && STRFLAG_NUM_REQ("報告") + 3 <= DAY && !STRFLAG_REQ("P4", 1)
		PRINTL Ikutsuki:
		PRINTW 「I got some samples from the shadows of ParadigmＸ.」
		;「例のパラダイムＸのシャドウのことだけど」
		PRINTW 「With that, the higher-ups have finally given me more funding.」
		;「上層部がけっこうこの調査に資金を出してくれてね」
		PRINTW 「Which means that my research work will be quite a bit easier.」
		;「僕の調査のほうも, わりと自由にやれてるんだよ」
		PRINTW 「Well, since this is thanks to you, I though about how I could repay you.」
		;「で, それもこれも君のおかげというわけだし, 僕なりに君に還元しようかとかんげんてみたわけだけど」
		PRINTW 「And as it happens, some people disappeared in Inaba town while I was investigating there.」
		;「人間が放りこまれている稲羽市のほうの調査のついでに, 人を攫ってみることにしてみたんだ」
		PRINTW 「I guess they where thrown into the TV?」
		PRINTW 「Hah...Anyway, that means I can now sell you some people from Inaba too.」
		;「と, いうわけで, これからは稲羽市の人間も奴隷としてポイント交換できるよ」
		PRINTW 「Well, aren't my goods getting better and better?」
		;「商品の種類はおおいに越したことないだろう？」
		PRINTW 「Now that I 'restocked' in a way, I hope your motivation to work for me has increased.」
		;「うんうん, 充実の交換ラインナップで, 君の僕に対する好感度も大アップとうわけだ」
		PRINTW 「Well then, what can I do for you today?」
		;「よし, それじゃあ, 今日はなんのようかな？」
	;ちょっとメティスイベントはさみますね(Tartarus内に登場させたのでオミット)
;	ELSEIF STRFLAG_NUM_REQ("累計点数") > 200 && ダンジョンフラグ:70:21 == 0 && ダンジョンフラグ:70:(1) >= 4
;		PRINTL Ikutsuki:
;		PRINTFORMW 「やあやあ%CALLNAME:MASTER%くん」
;		PRINTW 「ところでお話があるんだけど, 君ってロボットとかまで調教できたりするのかな？」
;		PRINTW 「いや, ちょっとうちの研究所から覚えの無い子が出てきてね……」
;		PRINTW 「調べようにもなかなか抵抗するもんで, 正直厄介払いをしたいのさ」
;		PRINTW 「と, いうわけで欲しければポイントと交換するから, 言ってね」
;		ダンジョンフラグ:70:21 = 1
	ELSE
		IF STRFLAG_NUM_REQ("累計点数") > 1000 && !ITEM:MutationGear
				PRINTL Ikutsuki:
				PRINTW 「Hi, please take this.」
				PRINTL 
				PRINTW ＞Ikutsuki handed you a disk
				PRINTL 
				PRINTL Ikutsuki:
				PRINTW 「It is MutationGear, a software to promote mutations in personas.」
				PRINTW 「As a by-product of studying shadows, we got this souvenir.」
				PRINTW 「Hm, points?　Ah, that's fine.」
				PRINTL 「It was made for your ＣＯＭＰ,
				PRINTW 　please take it as a gift.」
				PRINTL 
				PRINTW ＞Software【MutationGear】obtained
				ITEM:MutationGear = 1
		ELSEIF STRFLAG_NUM_REQ("累計点数") > 750 && STRFLAG_REQ("マイナスカード販売") && !STRFLAG_REQ("EXPカード販売", 1)
			PRINTL Ikutsuki:
			PRINTW 「I guess you are used to this by now, please take this.」
			;「いい加減, おなじみのことだだろうけど, これを受け取ってくれ」
			PRINTL 
			PRINTW ＞Ikutsuki handed you a card
			PRINTL 
			PRINTL Ikutsuki:
			PRINTW 「This card is able to directly transfer power to a persona.」
			;「今度のカードはシャドウの力をペルソナに移すことができる」
			PRINTW 「Because of this, you can now purely strengthen personas.」
			;「つまり, 今までのカードと違い, 純粋にペルソナを強めることができる」
			PRINTW 「Maybe with this, personas will become a new experience?」
			;「この強化が可能になったことで, 今日から, ぜんぜん違うペルソナライフがはじまるんじゃないかな？」
			PRINTW 「Ah...the process to make them is a bit...awkward. You'll have to spend points to get more.」
			;「まぁ…作るのが厄介だから, それ相応のポイントがないとちょっと渡せないけど…」
			PRINTL 
			PRINTW >You got a Flower card
			;名花のカードを手に入れた
			PRINTL 
			ITEM:名花のカード += 1
		ELSEIF STRFLAG_NUM_REQ("累計点数") > 500 && STRFLAG_REQ("インセンスカード販売") && !STRFLAG_REQ("マイナスカード販売", 1)
			PRINTL Ikutsuki:
			PRINTW 「First of all, please take this.」
			;「用件に入るまえにこれをちょっと受け取ってくれ」
			PRINTL 
			PRINTW ＞Ikutsuki handed you a card
			PRINTL 
			PRINTL Ikutsuki:
			PRINTW 「Just like the card I gave you before, this one can alter the power of personas.」
			;「それも前に渡したカードと同じで, ペルソナを変質させることができる」
			PRINTW 「And during my research, I was able to create this variation.」
			;「研究の結果, 前とは違った力をシャドウから引き出せたんでね」
			PRINTW 「For the most part, it should work similar to the last one.」
			;「大体, 注意点は前のカードとおんなじだ」
			PRINTW 「And like with the last one, you can now exchange points for more of them.」
			;「これからはこのカードも引換るから, 使ってくれ」
			PRINTL 
			PRINTW >You got an ALL minus card
			PRINTL 
			ITEM:ALLマイナスカード += 1
		;ベルベットルームにいったことがあるのも条件
		ELSEIF STRFLAG_NUM_REQ("累計点数") > 250 && イベントフラグ:5:0 && !STRFLAG_REQ("インセンスカード販売", 1)
			PRINTL Ikutsuki:
			PRINTW 「You came, first, take this.」
			PRINTL 
			PRINTW ＞Ikutsuki handed you a card
			PRINTL 
			PRINTL Ikutsuki:
			PRINTW 「Our research has advanced thanks to you.」
			PRINTW 「Thus we were able to make this.」
			PRINTL 「This is a thing that extracts the power of shadows for use in a persona.
			PRINTW 　And can improve a persona's stats.」
			PRINTW 「Well, we don't have proper equipment, so...we can't use it at all.」
			PRINTW 「I'm guessing, but you seem to know someone who can use this.」
			PRINTW 「Ah, no need to tell me the details.」
			PRINTW 「I only study shadows, it is enough for me if I help out clearing Tartarus.」
			PRINTW 「Even if you go to some other place, I don't mind.」
			PRINTW 「As for what I gave you, I gave it because you had helped my work.」
			PRINTW 「It's fine if you don't need it, but please say if you need more.」
			PRINTW 「But, they are some trouble to make.」
			PRINTW 「Just like slaves, exchange points for them.」
			PRINTL 
			PRINTW >STR incense card obtained
			PRINTL 
			ITEM:STRインセンスカード += 1
		ENDIF
		$START
		PRINTL Ikutsuki:
		PRINTW 「Now, what will it be?」
	ENDIF
	PRINTL 
	PRINTL [0] Turn in shadow materials
	PRINTL [1] Purchase a slave
	SIF STRFLAG_REQ("インセンスカード販売")
		PRINTL [2] Purchase cards
	SIF ダンジョンフラグ:[[ダンジョン:雪子姫の城]]:8 && STRFLAG_NUM_REQ("報告",,,,23) == 0
		PRINTL [3] Talk about Princess Yukiko's Castle
;	SIF ダンジョンフラグ:70:21 > 0
;		PRINTL [4] Buy a robot
	PRINTL [9] Leave
	CALL INPUTINT(0, 1, STRFLAG_REQ("インセンスカード販売")*2, !STRFLAG_NUM_REQ("報告",,,,23)*3,!STRFLAG_NUM_REQ("メティス",,,,23)*4, 9)
	IF RESULT == 0
		IF SUMARRAY(ITEM, 300, 317)
		;322 (changed from this, since 317 is the last item related to P3 as far as I can tell)
			PRINTL Ikutsuki:
			PRINTW 「Then, let me look.」
			PRINTW 「Now let's see...what do we have here?」
			PRINTW 「Then, well...」
			LOCAL:1 = 0
			;ちょっとメッセージの変化用
			LOCAL:99 = 0
			FOR LOCAL, 300 , 317
				IF ITEM:LOCAL > 0
					IF ITEMPRICE:LOCAL >= 50 && STRFLAG_REQ(ITEMNAME:LOCAL, 1)
						IF LOCAL:99 == 0
							PRINTFORML 「%ITEMNAME_E(LOCAL)%, huh...You already gave me one of thoose, so you'll get less points this time.」
							;か…。これは前にもらってるからポイントが少なくなるよ
							LOCAL:99 = 1
						ELSE
							PRINTFORML 「%ITEMNAME_E(LOCAL)%, huh...You already gave me one of thoose, so you'll get less points this time.」
						ENDIF
						PRINTFORMW 「%ITEMNAME_E(LOCAL)%, and {ITEM:LOCAL} of them, thats {20*ITEM:LOCAL} points...」
						LOCAL:1 += 20*ITEM:LOCAL
					ELSE
						IF ITEMPRICE:LOCAL >= 50 && ITEM:LOCAL > 1
							PRINTFORML 「%ITEMNAME_E(LOCAL)%, and you have found more than just one of them.
							PRINTFORML 　Well, I'll just take 1 for {ITEMPRICE:LOCAL} points, and the rest for 20 points each.」
							PRINTFORMW 　Which means thats {ITEMPRICE:LOCAL+20*(ITEM:LOCAL-1)} points...」
							LOCAL:1 += ITEMPRICE:LOCAL+20*(ITEM:LOCAL-1)
						ELSE
							LOCAL:1 += ITEMPRICE:LOCAL*ITEM:LOCAL
							PRINTFORMW 「{ITEM:LOCAL} %ITEMNAME_E(LOCAL)%\@ ITEM:LOCAL > 1 ? s # \@, I'll give you {ITEMPRICE:LOCAL*ITEM:LOCAL} points for \@ ITEM:LOCAL > 1 ? them # it \@...」
							;「%ITEMNAME:LOCAL%が{ITEM:LOCAL}個で, {ITEMPRICE:LOCAL*ITEM:LOCAL}点…」
						ENDIF
					ENDIF
					ITEM:LOCAL = 0
				ENDIF
			NEXT
			PRINTFORMW 「All together, that's {LOCAL:1} points.」
			依頼フラグ:(FLAG:進行中依頼):0 += LOCAL:1
			CALLF STRFLAG_NUM_REQ("累計点数", "+=", , LOCAL:1)
			PRINTFORMW 「With this, you now have a total of {依頼フラグ:(FLAG:進行中依頼):0} points.」
			PRINTFORMW 「Please continue to work hard in the future.」
		ELSE
			PRINTFORMW ＞You have nothing Ikutsuki is interested in...
		ENDIF
		GOTO START
	ELSEIF RESULT == 1
		PRINTL Ikutsuki:
		PRINTFORMW 「You currently have {依頼フラグ:(FLAG:進行中依頼):0} points.」
		IF 依頼フラグ:(FLAG:進行中依頼):0 < 100
			PRINTW 「100 points are needed for a slave...and you don't have enough.」
			PRINTW 「If you work hard, you'll definitely get enough though.」
			PRINTW 「It is a human. That is too unusual a product to give away for free.」
		ELSE
			$CHOICE
			PRINTL 「Well, which will you buy?」
			VARSET LOCAL
			COUNT = 1
			FOR LOCAL, 4575, 4597
				SELECTCASE LOCAL
					CASE 4576, 4577 , 4578, 4579, 4595
						IF GETCHARA(LOCAL) == -1 && !STRFLAG_REQ(CSVCALLNAME(LOCAL,0)) && STRFLAG_REQ("P4")
							LOCAL:COUNT = LOCAL
							PRINTFORM [{COUNT,2}] %CSVNAME(LOCAL,0),16, LEFT%
							COUNT++
							SIF COUNT % 2
								PRINTL
						ENDIF
					CASE 4580, 4581, 4582, 4583, 4589, 4590, 4591, 4592, 4593, 4594
						CONTINUE
					CASEELSE
						IF GETCHARA(LOCAL) == -1 && !STRFLAG_REQ(CSVCALLNAME(LOCAL,0))
							LOCAL:COUNT = LOCAL
							PRINTFORM [{COUNT,2}] %CSVNAME(LOCAL,0),16, LEFT%
							COUNT++
							SIF COUNT % 2
								PRINTL
						ENDIF
				ENDSELECT
			NEXT
			PRINTL
			PRINTL [99] Return
			$INPUT_LOOP
			INPUT
			IF RESULT == 99
				PRINTL Ikutsuki:
				PRINTW 「Stop purchasing?」
			ELSEIF RESULT <= 0 || RESULT > 99 || LOCAL:RESULT == 0 
				GOTO INPUT_LOOP
			ELSE
				PRINTL Ikutsuki:
				PRINTFORMW 「%CSVNAME(LOCAL:RESULT,0)% is the one you want?」
				LOCAL = LOCAL:RESULT
				CALL INPUT_YN,"Yes","No"
				PRINTL Ikutsuki:
				IF RESULT == 0
					PRINTW 「Then, I'll send it to your office.」
					PRINTL 
					PRINTFORMW ＞%CSVNAME(LOCAL,0)% obtained
					CALLF STRFLAG_REQ(CSVCALLNAME(LOCAL,0), 1)
					依頼フラグ:(FLAG:進行中依頼):0 -= 100
					CALL ADD_NEW_COMPANION, LOCAL, 200
				ELSE
					PRINTW 「Oh, a different one?」
					PRINTW 「Well, take another look then.」
					GOTO CHOICE
				ENDIF
			ENDIF
		ENDIF
	ELSEIF RESULT == 2
		LOCAL:3 = LINECOUNT
		$CARDCHOICE
		CLEARLINE LINECOUNT - LOCAL:3
		PRINTL 
		PRINTL Ikutsuki:
		PRINTFORML 「You currently have {依頼フラグ:(FLAG:進行中依頼):0} points.」
		PRINTW 「Well, choose a card.」
		DRAWLINE
		FOR LOCAL, 0, 6
			LOCAL:1 = GETNUM(ITEM, "STRインセンスカード") + LOCAL
			PRINTFORM [{LOCAL,2}] %ITEMNAME_E(LOCAL:1),20,LEFT% 100P　
			SIF LOCAL % 2 == 1
				PRINTL 
		NEXT
		IF STRFLAG_REQ("マイナスカード販売")
			FOR LOCAL, 0, 6
				LOCAL:1 = GETNUM(ITEM, "STRマイナスカード") + LOCAL
				PRINTFORM [{LOCAL+6,2}] %ITEMNAME_E(LOCAL:1),20,LEFT% 100P　
				SIF LOCAL % 2 == 1
					PRINTL 
			NEXT
			PRINTFORM [12] %"ALL minus card",20,LEFT% 200P　
			;ALLマイナスカード
		ENDIF
		SIF STRFLAG_REQ("EXPカード販売")
			PRINTFORM [13] %"Flower card",20,LEFT% 200P　
			;名花のカード
		PRINTL 
		PRINTL [99] Return
		$INPUT_CARD
		INPUT
		IF RESULT == 99
			PRINTL Ikutsuki:
			PRINTW 「Got enough?」
		ELSEIF RESULT < 0 || RESULT > 13 || (RESULT > 5 && !STRFLAG_REQ("マイナスカード販売")) || (RESULT == 13 && !STRFLAG_REQ("EXPカード販売"))
			CLEARLINE 1
			GOTO INPUT_CARD
		ELSE
			LOCAL:1 = RESULT < 12 ? 100 # 200
			SELECTCASE RESULT
				CASE IS < 6
					LOCAL = GETNUM(ITEM, "STRインセンスカード") + RESULT
				CASE IS < 13
					LOCAL = GETNUM(ITEM, "STRマイナスカード") + RESULT - 6
				CASE 13
					LOCAL = GETNUM(ITEM, "名花のカード")
			ENDSELECT
			PRINTL Ikutsuki:
			PRINTFORM 「%ITEMNAME_E(LOCAL)%?. That will be {LOCAL:1} points.
			IF 依頼フラグ:(FLAG:進行中依頼):0/LOCAL:1 == 0
				PRINTL However,
				PRINTL 　you don't have enough points. So I will not make this transaction.」
				GOTO START
			ENDIF
			PRINTL 
			PRINTFORML 　How many do you want?」
			PRINTFORML (Owned:{ITEM:LOCAL})
			CALL INPUT_MANY(0, 依頼フラグ:(FLAG:進行中依頼):0/LOCAL:1)
			IF RESULT == 0
				PRINTL Ikutsuki:
				PRINTW 「Is that so? You want to stop exchanging?」
			ELSE
				依頼フラグ:(FLAG:進行中依頼):0 -= LOCAL:1 * RESULT
				ITEM:LOCAL += RESULT
				PRINTFORMW >{RESULT} %ITEMNAME_E(LOCAL)% obtained
				GOTO CARDCHOICE
			ENDIF
		ENDIF
	ELSEIF RESULT == 3 && ダンジョンフラグ:[[ダンジョン:雪子姫の城]]:8 && STRFLAG_NUM_REQ("報告",,,,23) == 0
		CALLF STRFLAG_NUM_REQ("報告", "=", , DAY)
		PRINTL ＞In Paradigm Ｘ, a place called Princess Yukiko's Castle appeared. 
		PRINTW ＞Since there are shadows there, you decided to tell Ikutsuki about it.
		PRINTL 
		PRINTL Ikutsuki:
		PRINTW 「Well..., that there would be shadows there as well as in Tartarus...」
		PRINTW 「I understand. I shall investigate this.」
		PRINTW 「First though, I will give you 50 points for this information.」
		PRINTW 「I might have something for you when we meet again.」
		依頼フラグ:(FLAG:進行中依頼):0 += 50
;	ELSEIF RESULT == 4
;		PRINTL Ikutsuki:
;		PRINTFORML 「おや, 買い取ってくれるのかい？」
;		PRINTW 「それじゃ, 200点になるけど……」
;		IF 依頼フラグ:(FLAG:進行中依頼):0 >= 200
;			PRINTL 「どうする？」
;			PRINTFORML （現在 {依頼フラグ:(FLAG:進行中依頼):0}点）
;			CALL INPUT_YN
;			PRINTL Ikutsuki:
;			IF RESULT == 0
;				PRINTW 「それじゃあ, 事務所の方に届けさせとくけど……」
;				PRINTW 「なかなか暴れん坊だから, 気をつけてくれよ？」
;				PRINTL 
;				PRINTFORMW ＞メティスを手に入れた
;				CALLF STRFLAG_NUM_REQ("メティス", "=", , DAY)
;				依頼フラグ:(FLAG:進行中依頼):0 -= 200
;				CALL ADD_NEW_COMPANION, 4556, 200
;			ELSE
;				PRINTW 「おや, やめるのか」
;				PRINTW 「それじゃあ, まだ何か用はあるかな？」
;			ENDIF
;		ELSE
;			PRINTW 「おっと, 悪いけどポイントが足りないみたいだ」
;		ENDIF
	ELSE
		PRINTL Ikutsuki:
		PRINTW 「So thats all? Well, do your best so that you can buy a lot next time.」
		RETURN 0
	ENDIF
ENDIF
DRAWLINE
PRINTL 
GOTO START
