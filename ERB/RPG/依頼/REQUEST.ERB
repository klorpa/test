;コロシアム
;とりあえず今の所戦闘のテスト用
;クリアフラグにダンジョンフラグ:0:Xを使用


@SHOPCOMABLE_104
;パーティに一人以上いるなら
RESULTS = Request Contract
LOCAL = 0
REPEAT CHARANUM
	SIF CFLAG:COUNT:PTフラグ == 2
		LOCAL += 1
REND
IF LOCAL > 0
	RETURN 1
ELSE
	RETURN 0
ENDIF


@SHOW_REQUEST
CUSTOMDRAWLINE =

FOR LOCAL, 0, 999
	TFLAG:LOCAL = 0
	RESULTS = 
	TRYCCALLFORM PLAYABLE_REQUEST_{LOCAL}
		IF RESULT
			TFLAG:LOCAL = 1
			IF RESULTS != ""
				PRINTFORML [{LOCAL}] - %RESULTS%
			ENDIF
		ENDIF
	CATCH
		
	ENDCATCH
NEXT

@SHOP_COM_104
CALL SHOW_REQUEST
PRINTL [1000] Return

DRAWLINE
PRINTL Which request do you take？

$INPUT_LOOP
INPUT
IF RESULT == 1000
	RETURN 0
ELSEIF RESULT < 0 || RESULT >= VARSIZE("TFLAG")
	GOTO INPUT_LOOP
ELSEIF TFLAG:RESULT || FLAG:DEBUG
	LOCAL = RESULT
	DRAWLINE
	TRYCALLFORM EXPLAIN_REQUEST_{RESULT}
	DRAWLINE
	SELECTCASE RESULT
		;通常
		CASE 0
			PRINTL Take this request？
			CALL INPUT_YN,"Yes","No"

			IF RESULT == 0
				FLAG:進行中依頼 = LOCAL
				TRYCALLFORM REQUEST_{LOCAL}
				FLAG:進行中依頼 = 0
				FOR LOCAL,0,CHARANUM
					SIF CFLAG:LOCAL:悪魔変身 == 1
						CALL ACTION_2310 , LOCAL , 0
				NEXT
				IF RESULT == 1
					VARSET TFLAG,-1
					BEGIN TURNEND
				ENDIF
			ELSEIF RESULT == 1
				RESTART
			ENDIF
		;説明だけを見るパターン
		CASE 1
			WAIT
			RESTART
	ENDSELECT
ENDIF

VARSET TFLAG,-1
RETURN 0


