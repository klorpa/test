;================================================================
;ñÇèªëïîı
;================================================================
@MAKE_MASHO
FLAG:çáëÃó\íËà´ñÇ1 = -1
;LOCAL ÉãÅ[Évóp
;LOCAL:1 ëfçﬁÇÃìoò^î‘çÜ
LOCAL:1 = -1
;LOCAL:2 à´ñÇÇÃï\é¶ópïœêî
;LOCAL:3 çáëÃåãâ ÇÃåïòg
;LOCAL:4 çÏê¨Ç∑ÇÈñÇèªëïîıÇÃéÌóﬁ
;G çáëÃåïÇÃÉtÉâÉOÇä«óùÇ∑ÇÈïœêî 20-25:ÉoÉbÉhÉXÉeÅ[É^ÉXë∫ê≥óp

$START_MAKE
LOCAL:6 = 0

;ÉLÉÉÉâÉäÉXÉgÇï\é¶ÅEëIë
CALL INPUT_CHARA_LIST("Please choose a demon to infuse the nameless sword with.","CASTING_MASHO")
SIF RESULT == 1000
	RETURN 0
LOCAL:1 = RESULT


LOCAL:3 = -1
;ãÛÇ¢ÇƒÇ¢ÇÈçáëÃåïògÇéQè∆
FOR LOCAL,0,50
	IF DC:LOCAL:49 == 0
		LOCAL:3 = LOCAL
		BREAK
	ENDIF
NEXT
IF LOCAL:3 == -1
	PRINTW There is no sword frame available.
	RETURN 0
ENDIF

;çáëÃåïÇÃéÌóﬁÇåàÇﬂÇÈ
;èKìæÉXÉLÉãÇ…ÇÊÇ¡ÇƒGÇê›íË
VARSET G,-1
G:0 = 1
FOR LOCAL,1,FLAG:ÉXÉLÉãêî+1
	LOCALS = ÉXÉLÉã{LOCAL}
	IF ABL:(LOCAL:1):LOCALS > 0
		RESULT = 0
		;ëäê´Ç…ÇÊÇÈèåè
		TRYCALLFORM SKILL_TYPE_{ABL:(LOCAL:1):LOCALS},LOCAL:1
		G:RESULT = 1
	ENDIF
NEXT
;åïåÇà»äOÇÃï®óùÇÕñ≥Çµ
G:1 = -1
G:2 = -1
G:3 = -1


;NerveÅEê∏ê_ÇÕì¡éÍ
G:8 = -1
G:9 = -1
FOR LOCAL,1,FLAG:ÉXÉLÉãêî+1
	LOCALS = ÉXÉLÉã{LOCAL}
	IF ABL:(LOCAL:1):LOCALS > 0
		RESULT = 0
		;ëäê´Ç…ÇÊÇÈèåè
		TRYCCALLFORM SKILL_ADDTIONAL_STATE_{ABL:(LOCAL:1):LOCALS},LOCAL:1
			SELECTCASE GET_STATE(RESULT)
				CASE "POISON"
					G:20 = 1
				CASE "SLEEP"
					G:21 = 1
				CASE "PANIC"
					G:22 = 1
				CASE "HAPPY"
					G:23 = 1
				CASE "BIND"
					G:24 = 1
				CASE "CHARM"
					G:25 = 1
			ENDSELECT
		CATCH
		ENDCATCH
	ENDIF
NEXT

;åïÇÃÉ^ÉCÉvÇëIë
$PRINT_TYPE
DRAWLINE
PRINTL Please select the attack attributes to give the sword.
FOR LOCAL,0,FLAG:ëäê´êî
	SIF G:LOCAL > 0
		PRINTFORM [{LOCAL}] Åy%GET_TYPE_E(LOCAL)%Åz
	SIF G:LOCAL > 0 && LOCAL == 5
		PRINT & FREEZE ÇQÇOÅì
	SIF G:LOCAL > 0 && LOCAL == 6
		PRINT & SHOCK ÇQÇOÅì
	SIF G:LOCAL > 0
		PRINTL
NEXT
SIF G:20 > 0
	PRINTL [20] ÅySlashÅz& POISON ÇQÇOÅì
SIF G:21 > 0
	PRINTL [21] ÅySlashÅz& SLEEP ÇQÇTÅì
SIF G:22 > 0
	PRINTL [22] ÅySlashÅz& PANIC ÇQÇTÅì
SIF G:23 > 0
	PRINTL [23] ÅySlashÅz& HAPPY ÇRÇTÅì
SIF G:24 > 0
	PRINTL [24] ÅySlashÅz& BIND ÇQÇTÅì
SIF G:25 > 0
	PRINTL [25] ÅySlashÅz& CHARM ÇQÇOÅì

DRAWLINE
PRINTL [100]Cancel

$INPUT_TYPE
INPUT

IF RESULT == 100
	RESTART
ELSEIF G:RESULT > 0
	;DCÇ…ÉfÅ[É^Çì¸óÕ
	;Ç‹Ç∏ÇÕñºèÃÇ∆ëäê´ÅAí«â¡å¯â ÇåàÇﬂÇƒÇ®Ç≠
	SELECTCASE RESULT
		CASE 0
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = 1
		CASE 4,16
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = 2
		CASE 5
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = 3
			DC:(LOCAL:3):45 = GET_STATE_NUM("FREEZE")
			DC:(LOCAL:3):46 = 5
			DC:(LOCAL:3):47 = 20
			DC:(LOCAL:3):48 = 95
		CASE 6
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = 4
			DC:(LOCAL:3):45 = GET_STATE_NUM("SHOCK")
			DC:(LOCAL:3):46 = 6
			DC:(LOCAL:3):47 = 20
			DC:(LOCAL:3):48 = 95
		CASE 7
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = 5
		CASE 10,11
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = RESULT
		CASE 12 TO 15
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = RESULT - 6
		CASE 20
			DC:(LOCAL:3):40 = 0
			DC:(LOCAL:3):49 = 12
			DC:(LOCAL:3):45 = GET_STATE_NUM("POISON")
			DC:(LOCAL:3):46 = 8
			DC:(LOCAL:3):47 = 20
			DC:(LOCAL:3):48 = 95
		CASE 21
			DC:(LOCAL:3):40 = 0
			DC:(LOCAL:3):49 = 13
			DC:(LOCAL:3):45 = GET_STATE_NUM("SLEEP")
			DC:(LOCAL:3):46 = 8
			DC:(LOCAL:3):47 = 25
			DC:(LOCAL:3):48 = 95
		CASE 22
			DC:(LOCAL:3):40 = 0
			DC:(LOCAL:3):49 = 14
			DC:(LOCAL:3):45 = GET_STATE_NUM("PANIC")
			DC:(LOCAL:3):46 = 9
			DC:(LOCAL:3):47 = 25
			DC:(LOCAL:3):48 = 95
		CASE 23
			DC:(LOCAL:3):40 = 0
			DC:(LOCAL:3):49 = 15
			DC:(LOCAL:3):45 = GET_STATE_NUM("HAPPY")
			DC:(LOCAL:3):46 = 9
			DC:(LOCAL:3):47 = 35
			DC:(LOCAL:3):48 = 95
		CASE 24
			DC:(LOCAL:3):40 = 0
			DC:(LOCAL:3):49 = 16
			DC:(LOCAL:3):45 = GET_STATE_NUM("BIND")
			DC:(LOCAL:3):46 = 8
			DC:(LOCAL:3):47 = 25
			DC:(LOCAL:3):48 = 95
		CASE 25
			DC:(LOCAL:3):40 = 0
			DC:(LOCAL:3):49 = 17
			DC:(LOCAL:3):45 = GET_STATE_NUM("CHARM")
			DC:(LOCAL:3):46 = 9
			DC:(LOCAL:3):47 = 20
			DC:(LOCAL:3):48 = 95
		CASE 17
			DC:(LOCAL:3):40 = RESULT
			DC:(LOCAL:3):49 = 18
	ENDSELECT

	;çUåÇâÒêîÇëIë
	;íPëÃçUåÇÅïë¨Ç≥30à»è„Ç≈ÇQâÒçUåÇÅA50à»è„Ç≈ÇRâÒçUåÇÇëIëâ¬
	;îÕàÕÇ™íPëÃÇ≈Ç»Ç¢ÅAÇ‹ÇΩÇÕë¨Ç≥Ç™30ñ¢ñûÇÃèÍçáÇÕëIëéàÇ™èoÇ»Ç¢

	IF BASE:(LOCAL:1):ë¨Ç≥ >= 30 && ABL:(LOCAL:1):çUåÇîÕàÕ == 1
		;çUåÇâÒêîÇ…ÇÊÇ¡ÇƒGÇê›íË
		VARSET G,-1

		$PRINT_ATKTIMES
		DRAWLINE
		PRINTL åïÇÃçUåÇâÒêîÇëIëÇµÇƒÇ≠ÇæÇ≥Ç¢
		IF BASE:(LOCAL:1):ë¨Ç≥ >= 50
			PRINTL [1] ÇPâÒçUåÇ
			G:1 = 1
			PRINTL [2] ÇQâÒçUåÇÅiçUåÇÇWÇOÅìÅ@ñΩíÜÇVÇOÅìÅj
			G:2 = 1
			PRINTL [3] ÇRâÒçUåÇÅiçUåÇÇVÇOÅìÅ@ñΩíÜÇTÇOÅìÅj
			G:3 = 1
		ELSE
			PRINTL [1] ÇPâÒçUåÇ
			G:1 = 1
			PRINTL [2] ÇQâÒçUåÇÅiçUåÇÇWÇOÅìÅ@ñΩíÜÇVÇOÅìÅj
			G:2 = 1
		ENDIF
		DRAWLINE
		PRINTL [100] ÉLÉÉÉìÉZÉã

		$INPUT_ATKTIMES
		INPUT
	
		IF RESULT == 100
			RESTART
		ELSEIF G:RESULT > 0
			;DCÇ…çUåÇâÒêîÇì¸óÕÅBÉ}ÉCÉiÉXï‚ê≥ÇÕÇ†Ç∆Ç≈çsÇ§
			SELECTCASE RESULT
				CASE 1
					DC:(LOCAL:3):41 = 1
					DC:(LOCAL:3):42 = 1
				CASE 2
					DC:(LOCAL:3):41 = 2
					DC:(LOCAL:3):42 = 2
				CASE 3
					DC:(LOCAL:3):41 = 3
					DC:(LOCAL:3):42 = 3
			ENDSELECT
		ELSE
			CLEARLINE 1
			GOTO INPUT_ATKTIMES
		ENDIF
	ELSE
		DC:(LOCAL:3):41 = 1
		DC:(LOCAL:3):42 = 1
	ENDIF


	;äÓñ{î\óÕílèCê≥ÅAêÌì¨î\óÕílèCê≥ÇåàíË
	;äÓñ{
	DC:(LOCAL:3):0 += (MIN(ABL:(LOCAL:1):è]èá , 10) + MIN(ABL:(LOCAL:1):ó~ñ] , 10) + MIN(ABL:(LOCAL:1):ãZçI , 10) +3)/6 *(BASE:(LOCAL:1):LV+20)/20
	DC:(LOCAL:3):1 += (MIN(ABL:(LOCAL:1):ó~ñ] , 10)+1)/2 *(BASE:(LOCAL:1):LV+40)/40
	DC:(LOCAL:3):3 += (MIN(ABL:(LOCAL:1):ó~ñ] , 10)+1)/2 *(BASE:(LOCAL:1):LV+40)/40
	DC:(LOCAL:3):6 += (MIN(ABL:(LOCAL:1):è]èá , 10)+1)/2 *(BASE:(LOCAL:1):LV+40)/40
	DC:(LOCAL:3):4 += (MIN(ABL:(LOCAL:1):è]èá , 10)+1)/2 *(BASE:(LOCAL:1):LV+40)/40
	DC:(LOCAL:3):2 += (MIN(ABL:(LOCAL:1):ãZçI , 10)+1)/2 *(BASE:(LOCAL:1):LV+40)/40
	DC:(LOCAL:3):5 += (MIN(ABL:(LOCAL:1):ãZçI , 10)+1)/2 *(BASE:(LOCAL:1):LV+40)/40
	;ÉåÉxÉãÇ…ÇÊÇÈí≤ã≥å¯â ï‚ê≥
;	DC:(LOCAL:3):0 *= (BASE:(LOCAL:1):LV+20)/20
;	DC:(LOCAL:3):1 *= (BASE:(LOCAL:1):LV+40)/40
;	DC:(LOCAL:3):2 *= (BASE:(LOCAL:1):LV+40)/40
;	DC:(LOCAL:3):3 *= (BASE:(LOCAL:1):LV+40)/40
;	DC:(LOCAL:3):4 *= (BASE:(LOCAL:1):LV+40)/40
;	DC:(LOCAL:3):5 *= (BASE:(LOCAL:1):LV+40)/40
;	DC:(LOCAL:3):6 *= (BASE:(LOCAL:1):LV+40)/40
	;êÌì¨
	DC:(LOCAL:3):10 = (MIN(BASE:(LOCAL:1):LV,80)+5+DC:(LOCAL:3):0*2)*3/2 + BASE:(LOCAL:1):óÕ*3/2 + BASE:(LOCAL:1):ëœóÕ / 2
	DC:(LOCAL:3):11 = (MIN(BASE:(LOCAL:1):LV,80)+5+DC:(LOCAL:3):0*2) + BASE:(LOCAL:1):ë¨Ç≥*3/2 + BASE:(LOCAL:1):â^/2
	DC:(LOCAL:3):14 = (MIN(BASE:(LOCAL:1):LV,80)+5+DC:(LOCAL:3):0*2)*3/2 + BASE:(LOCAL:1):ñÇóÕ*3/2 + BASE:(LOCAL:1):ímåb / 2
	DC:(LOCAL:3):15 = (MIN(BASE:(LOCAL:1):LV,80)+5+DC:(LOCAL:3):0*2) + BASE:(LOCAL:1):ímåb + BASE:(LOCAL:1):â^/2 + BASE:(LOCAL:1):ñÇóÕ/2
	;åïédólÇ…ïœçX
	TIMES DC:(LOCAL:3):10 , 1.00
	DC:(LOCAL:3):11 += 10
	TIMES DC:(LOCAL:3):14 , 0.80
	TIMES DC:(LOCAL:3):15 , 0.40
	;íâêΩìxÇ…ÇÊÇÈâ¡éZ
	DC:(LOCAL:3):10 += MIN(BASE:(LOCAL:1):íâêΩìx/500,30)
	DC:(LOCAL:3):11 += MIN(BASE:(LOCAL:1):íâêΩìx/500,30)
	DC:(LOCAL:3):14 += MIN(BASE:(LOCAL:1):íâêΩìx/500,30)
	DC:(LOCAL:3):15 += MIN(BASE:(LOCAL:1):íâêΩìx/500,30)
	
	
	;çUåÇå`ë‘ÇÕëfçﬁÇÃÇ‡ÇÃÇÉRÉsÅ[
;	DC:(LOCAL:3):41 = ABL:(LOCAL:1):ç≈í·çUåÇâÒêî
;	DC:(LOCAL:3):41 = 1
;	DC:(LOCAL:3):42 = ABL:(LOCAL:1):ç≈ëÂçUåÇâÒêî
;	DC:(LOCAL:3):42 = 1
	DC:(LOCAL:3):43 = ABL:(LOCAL:1):éÀíˆ
	DC:(LOCAL:3):44 = ABL:(LOCAL:1):çUåÇîÕàÕ

	;çUåÇâÒêîÇ…ÇÊÇ¡ÇƒçUåÇÇ∆ñΩíÜÇ…èCê≥Ç™ì¸ÇÈ
	SELECTCASE DC:(LOCAL:3):41
		CASE 2
			TIMES DC:(LOCAL:3):10 , 0.80
			TIMES DC:(LOCAL:3):11 , 0.70
		CASE 3
			TIMES DC:(LOCAL:3):10 , 0.70
			TIMES DC:(LOCAL:3):11 , 0.50
	ENDSELECT
	
	;;éÀíˆÅEçUåÇîÕàÕÇ…ÇÊÇ¡ÇƒñΩíÜÇ∆çUåÇÇ…èCê≥Ç™ì¸ÇÈ
	;SELECTCASE DC:(LOCAL:3):43
	;	CASE 2
	;		TIMES DC:(LOCAL:3):11 , 0.8
	;	CASE 3
	;		TIMES DC:(LOCAL:3):11 , 0.6
	;ENDSELECT
	;íPëÃÇÕëfçﬁà´ñÇÇÃä◊óéèÛë‘Ç…ÇÊÇ¡Çƒç≈ëÂçUåÇâÒêîÇ™ëùâ¡
	;çUåÇÇ™óÒÇÕ90%ÅAëSëÃÇÕ60%
	SELECTCASE DC:(LOCAL:3):44
		CASE 1
			IF TALENT:(LOCAL:1):3 || TALENT:(LOCAL:1):4 || TALENT:(LOCAL:1):5
				DC:(LOCAL:3):42 += 1
			ELSEIF TALENT:(LOCAL:1):6 || TALENT:(LOCAL:1):7 || TALENT:(LOCAL:1):8
				DC:(LOCAL:3):42 += 2
			ELSE
			ENDIF
		CASE 2
			TIMES DC:(LOCAL:3):10 , 0.9
	;		TIMES DC:(LOCAL:3):10 , 0.7
	;		TIMES DC:(LOCAL:3):11 , 0.8
		CASE 3
			TIMES DC:(LOCAL:3):10 , 0.6
	;		TIMES DC:(LOCAL:3):10 , 0.4
	;		TIMES DC:(LOCAL:3):11 , 0.5
	ENDSELECT
	
	DC:(LOCAL:3):39 = GET_EQUIPNUM("åï")
	
	;í«â¡å¯â ïtÇ´ÇÃåïÇÕèCê≥Çâ¡Ç¶ÇÈ
	SELECTCASE DC:(LOCAL:3):49
		CASE 3,4
			TIMES DC:(LOCAL:3):10 , 0.95
			TIMES DC:(LOCAL:3):11 , 0.95
		CASE 12 TO 17
			TIMES DC:(LOCAL:3):10 , 0.90
			TIMES DC:(LOCAL:3):11 , 0.90
	ENDSELECT
	;ñhå‰ëäê´
	FOR LOCAL,0,FLAG:ëäê´êî
		DC:(LOCAL:3):(20+LOCAL) = 100
	NEXT
	SIF DC:(LOCAL:3):40 == 17
		TIMES DC:(LOCAL:3):10 , 0.75
	
ELSE
	CLEARLINE 1
	GOTO INPUT_TYPE
ENDIF

;çáëÃåãâ ÇÃåïÇï\é¶
CALL ëïîıê‡ñæ,(2450+LOCAL:3+450*DC:(LOCAL:3):39)



;çáëÃÇ∑ÇÈÇ©Ç«Ç§Ç©Å@Å®Å@çáëÃé¿çsÅié¿ç€Ç…ÇÕä˘Ç…èIÇÌÇ¡ÇƒÇ¢ÇÈÅj
PRINT Do you want to create this sword? 

CALL INPUT_YN,"Yes","No",2

SELECTCASE RESULT
	CASE 0
		ITEM:(2450+LOCAL:3+450*DC:(LOCAL:3):39) = 1
	CASE 1
		REPEAT 50
			DC:(LOCAL:3):COUNT = 0
		REND
		RESTART
ENDSELECT

PRINTFORMW %STR:(DC:(LOCAL:3):49+100)%ÇéËÇ…ì¸ÇÍÇΩ

CALL FUSION_LETTER,LOCAL:1,1

;çáëÃëfçﬁÇÃà´ñÇÇè¡ãé
CALL ÉLÉÉÉâçÌèú, LOCAL:1

ITEM:"Nameless Sword" -= 1

RETURN 0

GOTO START_MAKE


;==========================================================================
;ñÇèªëïîıÇëfçﬁÇ…ñﬂÇ∑
;==========================================================================
@DEL_MASHO
PRINTFORML What piece of equipment do you want to break up into it's base form?Å@ÅÉpage.{P + 1}ÅÑ
DRAWLINE
;éùÇ¡ÇƒÇ¢ÇÈÉAÉCÉeÉÄÇï\é¶
VARSET G,-1
FOR LOCAL,2000,VARSIZE("ITEM")
	IF ñÇèªëïîı(LOCAL)
		IF ITEM:LOCAL > 0
			PRINTFORMLC [{LOCAL}]%EQ_GETNAME_ñÇèªëïîı(LOCAL-2450-450*((LOCAL-2000)/500))%
			G:LOCAL = 1
		ENDIF
	ELSE
	ENDIF
NEXT

$PRINT_LIST
DRAWLINE
PRINTL [1000] Return
$INPUT_LOOP_1
INPUT
IF RESULT == 1000
		RETURN 0
ELSEIF RESULT < 0 || RESULT >= VARSIZE("G")
	GOTO INPUT_LOOP_1
ELSEIF G:RESULT != 1
	GOTO INPUT_LOOP_1
ENDIF
LOCAL:2 = RESULT
CALL ëïîıê‡ñæ,LOCAL:2

PRINTL Do you want to return this equipment to it's base form?
PRINTL [0]Yes [1]No
$INPUT_LOOP2
INPUT
IF RESULT == 1
	RESTART
ELSEIF RESULT != 0
	GOTO INPUT_LOOP2
ENDIF


ITEM:"Nameless Sword" += 1

FOR LOCAL,0,99
	DC:(LOCAL:2-2450-450*((LOCAL:2-2000)/500)):LOCAL = 0
NEXT

ITEM:(LOCAL:2) -= 1


;================================================================
;çﬁóøÇ…Ç≈Ç´ÇÈà´ñÇÇÃèåè
;================================================================
@CASTING_MASHO
SIF å_ñÒ(COUNT) > 0
	RETURN 0
SIF ABL:COUNT:éÌë∞ == 0 || ABL:COUNT:éÌë∞ > 44
	RETURN 0
SIF CFLAG:COUNT:òJñÉtÉâÉO == 3
	RETURN 0
SIF CFLAG:COUNT:Ç±ÇÃèÍÇ…ãèÇ»Ç¢ÉtÉâÉO == 1
	RETURN 0
SIF CFLAG:COUNT:çáëÃïsâ¬
	RETURN 0
SIF EQUIP:COUNT:åï != 0
	RETURN 0
SIF EQUIP:COUNT:èe != 0
	RETURN 0
SIF EQUIP:COUNT:ì™ != 0
	RETURN 0
SIF EQUIP:COUNT:ì∑ != 0
	RETURN 0
SIF EQUIP:COUNT:òr != 0
	RETURN 0
SIF EQUIP:COUNT:ë´ != 0
	RETURN 0
RETURN 1
