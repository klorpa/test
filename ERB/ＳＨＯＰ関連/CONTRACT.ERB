
@SHOPCOMABLE_150
LOCAL:1 = 0
FOR LOCAL,0,CHARANUM
	SIF LOCAL == MASTER
		CONTINUE
	SIF 陥落(LOCAL) == 2
		LOCAL:1 += 1
NEXT
IF LOCAL:1 > 0  && MONEY > 1000000
	RESULTS = Contract
	RETURN 1
ELSE
	RESULTS = ？？？？？
	RETURN 0
ENDIF

@SHOP_COM_150
CUSTOMDRAWLINE =
PRINTL A special contract can be made with a fallen(Love, Whore or Slave) character.
PRINTL This character will no longer be useable in most fusions.
DRAWLINE
LOCAL:1 = 0
LOCAL:2 = 0
LOCAL:3 = 0
FOR LOCAL,0,CHARANUM
	SIF LOCAL == MASTER
		CONTINUE
	SIF TALENT:LOCAL:親愛
		LOCAL:1 += 1
	SIF TALENT:LOCAL:娼婦
		LOCAL:2 += 1
	SIF TALENT:LOCAL:隷属
		LOCAL:3 += 1
NEXT

SIF LOCAL:1 && MONEY > 1000000
	PRINTL [1] Marry (1 mil￥)
SIF LOCAL:2 && MONEY > 1000000
	PRINTL [2] Make your special lewd toy (1 mil￥)
SIF LOCAL:3 && MONEY > 1000000
	PRINTL [3] Give a collar (1 mil￥)
;PRINTL [4] 使い魔にする (50万￥)
DRAWLINE
PRINTL [0] Return

$INPUT_LOOP
INPUT

IF RESULT == 0
	RETURN 0
ELSEIF ((RESULT == 1 && LOCAL:1) || (RESULT == 2 && LOCAL:2) || (RESULT == 3 && LOCAL:3)) && MONEY > 1000000
	CALL CONTRACT,RESULT
ELSE
	GOTO INPUT_LOOP
ENDIF
IF RESULT == 1
	RETURN 0
ELSE
	RESTART
ENDIF


@CONTRACT,ARG
Z = ARG
PRINTFORM Please choose the character 
IF ARG == 1
	CALL INPUT_CHARA_LIST("Please choose the character you want to marry", "CASTING_CONTRACT")
ELSEIF ARG == 2
	CALL INPUT_CHARA_LIST("Please choose the character you want to make into your special sex toy", "CASTING_CONTRACT")
ELSE
	CALL INPUT_CHARA_LIST("Please choose the character you want to put a collar on", "CASTING_CONTRACT")
ENDIF
IF RESULT == 1000
	RETURN 0
ENDIF
PRINTL
PRINTW .....
PRINTW ....
PRINTW ...
PRINTL


LOCAL = RESULT
IF ARG == 1
	IF TALENT:LOCAL:オトコ
		TALENT:LOCAL:夫 = 1
	ELSE
		TALENT:LOCAL:妻 = 1
	ENDIF
	MONEY -= 1000000
	TFLAG:13 = 40
	LOCAL:1 = TARGET
	TARGET = LOCAL
	CALL KOJO_MESSAGE_EVENT
	TARGET = LOCAL:1
	
	RETURN 1
ELSEIF ARG == 2
	MONEY -= 1000000
	TALENT:LOCAL:淫魔 = 1
	TFLAG:13 = 41
	LOCAL:1 = TARGET
	TARGET = LOCAL
	CALL KOJO_MESSAGE_EVENT
	TARGET = LOCAL:1
	RETURN 1
ELSEIF ARG == 3
	MONEY -= 1000000
	TALENT:LOCAL:玩具 = 1
	TFLAG:13 = 42
	LOCAL:1 = TARGET
	TARGET = LOCAL
	CALL KOJO_MESSAGE_EVENT
	TARGET = LOCAL:1
	RETURN 1
ENDIF


@CASTING_CONTRACT
SIF COUNT == MASTER
	RETURN 0
SIF TALENT:COUNT:妻 || TALENT:COUNT:夫 || TALENT:COUNT:淫魔 || TALENT:COUNT:玩具
	RETURN 0
SIF Z == 1 && TALENT:COUNT:親愛 == 0
	RETURN 0
SIF Z == 2 && TALENT:COUNT:娼婦 == 0
	RETURN 0
SIF Z == 3 && TALENT:COUNT:隷属 == 0
	RETURN 0
SIF CFLAG:COUNT:この場に居ないフラグ == 1
	RETURN 0
SIF CFLAG:COUNT:フィルタリングフラグ
	RETURN 0
RETURN 1
