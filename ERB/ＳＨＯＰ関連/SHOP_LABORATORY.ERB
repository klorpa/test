;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:SHOP_LABORATORY.ERB
;	Facility	:触手関連の関数群です。
;
;	Licence		:ライセンスフリー
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20XX/XX/XX		----					新規作成
;	002		2011/03/02		黒天					触手への生贄で一部処理での対象の指定が誤っているのを修正
;	003		2011/03/28		P						くくりを霊媒体質に
;	004		2013/11/24		ひみつ					リスト表示数設定
;	005		2017/04/05		JK好き					強化するたびにSHOP画面に戻されるのがうざいのでGOTOで最初に戻るように修正
;	006		2017/06/23		kuni					キャラ表示でINPUT_CHARA_LISTを使用するように変更
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#

@SHOPCOMABLE_172
IF (FLAG:触手エネルギー > 0 || FLAG:触手レベル > 0) && FLAG:47
	RESULTS = Tentacle Research
	RETURN 1
ELSE
	RESULTS = ？？？？
	RETURN 0
ENDIF

@SHOP_COM_172
DRAWLINE
PRINTFORMW Current tentacle　LV{FLAG:触手レベル}　Energy:　{FLAG:触手エネルギー}F
;現在の触手レベル　LV{FLAG:触手レベル}　エネルギー　{FLAG:触手エネルギー}Fです
DRAWLINE

$PRINT_LABO
PRINTL What will you do?
IF FLAG:触手レベル > 0
	PRINTL [0] Strengthen tentacles
ELSE
	PRINTL [0] Create strengthened tentacles
ENDIF
SIF FLAG:触手レベル > 0
	PRINTL [1] ＭＡＧ extraction
SIF CHARANUM > 1
	PRINTL [99] Sacrifice to tentacles
PRINTL [100]Leave
$INPUT_LOOP
INPUT
IF RESULT == 0
	CALL TENTACLE_LABORATORY_LVUP
ELSEIF RESULT == 1 && FLAG:触手レベル > 0
	CALL TENTACLE_LABORATORY_MAG
ELSEIF RESULT == 99 && CHARANUM > 1
	CALL TENTACLE_LABORATORY_SACRIFICE
ELSEIF RESULT == 100
	RETURN 0
ELSE
	GOTO INPUT_LOOP
ENDIF

@TENTACLE_LABORATORY_LVUP
LOCAL:0 = FLAG:触手レベル

PRINTFORML Current tentacle　LV:{FLAG:触手レベル})

SIF FLAG:触手エネルギー < 20*(FLAG:触手レベル+2)*(FLAG:触手レベル+3)
	SETCOLOR 0x404040
PRINTFORML   [ 1] +1 / {20*(FLAG:触手レベル+2)*(FLAG:触手レベル+3),7,RIGHT}

LOCAL:1 = 0
LOCAL:2 = 0
FOR LOCAL:5,0,2
	FOR LOCAL:6,0,5
		LOCAL:2 += 20*(FLAG:触手レベル+2)*(FLAG:触手レベル+3)
		LOCAL:0 += 100
	NEXT
	SIF LOCAL:1
		BREAK
	LOCAL:1 += LOCAL:2
NEXT

SIF FLAG:触手エネルギー < LOCAL:1
	SETCOLOR 0x404040
PRINTFORML   [ 2] +5 / {LOCAL:1,7,RIGHT}

SIF FLAG:触手エネルギー < LOCAL:2
	SETCOLOR 0x404040
PRINTFORML   [ 3]+10 / {LOCAL:2,7,RIGHT}
RESETCOLOR
PRINTL [0]Return
$INPUT_LOOP_T
INPUT
IF RESULT == 0
	RETURN 0
ELSEIF RESULT == 1
	IF FLAG:触手エネルギー < 20*(FLAG:触手レベル+2)*(FLAG:触手レベル+3)
		PRINTW Not enough tentacle energy
		GOTO INPUT_LOOP_T
	ENDIF
	FLAG:触手エネルギー,-= 20*(FLAG:触手レベル+2)*(FLAG:触手レベル+3)
	FLAG:触手レベル += 1
ELSEIF RESULT == 2
	IF FLAG:触手エネルギー < LOCAL:1
		PRINTW Not enough tentacle energy
		GOTO INPUT_LOOP_T
	ENDIF
	FLAG:触手エネルギー -= LOCAL:1
	FLAG:触手レベル += 5
ELSEIF RESULT == 3
	IF FLAG:触手エネルギー < LOCAL:2
		PRINTW Not enough tentacle energy
		GOTO INPUT_LOOP_T
	ENDIF
	FLAG:触手エネルギー -= LOCAL:2
	FLAG:触手レベル += 10
ELSE
	GOTO INPUT_LOOP_T
ENDIF
PRINTFORMW The tentacle LV is now: {FLAG:触手レベル}
RESTART
	
@TENTACLE_LABORATORY_MAG
CALL INPUT_CHARA_LIST("Who will receive the ＭＡＧ?", "CASTING_TENTACLE_LABORATORY_MAG")
IF RESULT == 1000
	RETURN 0
ENDIF

LOCAL = RESULT

PRINTFORML How much ＭＡＧ will you extract? Current energy: {FLAG:触手エネルギー}F
PRINTFORML ※Energy will be converted directly into ＭＡＧ
PRINTFORML %CALLNAME:LOCAL%　ＭＡＧ　{BASE:LOCAL:ＭＡＧ}/{MAXBASE:LOCAL:ＭＡＧ}
$INPUT_LOOP_2
INPUT
IF RESULT == 0
	RETURN 0
ELSEIF RESULT < 0
	GOTO INPUT_LOOP_2
ELSEIF RESULT > FLAG:触手エネルギー
	PRINTFORML Not enough energy
	RETURN 0
ELSEIF RESULT > MAXBASE:LOCAL:ＭＡＧ - BASE:LOCAL:ＭＡＧ
	PRINTFORML %CALLNAME:LOCAL% can't store this much ＭＡＧ.
	;はそこまでＭＡＧを持てません
	RETURN 0
ENDIF

	LOCAL:1 = RESULT

PRINTFORML Turn {LOCAL:1}F energy into ＭＡＧ to give to %CALLNAME:LOCAL%?
;エネルギー{LOCAL:1}Fを%CALLNAME:LOCAL%に与えますがよろしいですか？
CALL INPUT_YN,"Yes","NO"
IF  RESULT == 0
	PRINTFORML %CALLNAME:LOCAL% received {LOCAL:1} ＭＡＧ.
	;はＭＡＧ{LOCAL:1}を得た
	FLAG:触手エネルギー -= LOCAL:1
	BASE:LOCAL:ＭＡＧ += LOCAL:1
	RETURN 0
ELSE
	PRINTFORML Aborted ＭＡＧ extraction.
	;エネルギー{LOCAL:1}Fを%CALLNAME:LOCAL%に与えるのをやめました
	RETURN 0
ENDIF

@CASTING_TENTACLE_LABORATORY_MAG
;労役中キャラは除外
SIF CFLAG:COUNT:労役フラグ == 3
	RETURN 0
;従順が3未満だと除外
SIF ABL:COUNT:従順 < 3
	RETURN 0
SIF (TALENT:COUNT:妊娠 || TALENT:COUNT:育児中) && FLAG:出産機能ONOFF == 1
	RETURN 0
;失踪中などこの場にいないなら除外
SIF CFLAG:COUNT:この場に居ないフラグ
	RETURN 0
SIF CFLAG:COUNT:フィルタリングフラグ
	RETURN 0
RETURN 1

@TENTACLE_LABORATORY_SACRIFICE
CALL INPUT_CHARA_LIST("Who will be sacrificed to the tentacles?", "CASTING_TENTACLE_LABORATORY_SACRIFICE", "UP_PRINT_TENTACLE_LABORATORY_SACRIFICE")
IF RESULT == 1000
	RETURN 0
ENDIF

LOCAL = RESULT
PRINTFORML ※%CALLNAME:LOCAL% won't be seen again after being sacrificed.
PRINTL Still do the sacrifice?
PRINTC [0]Yes
PRINTC [1]No
PRINTL 
$INPUT_LOOP_2
INPUT
IF RESULT == 1
	RETURN 0
ELSEIF RESULT != 0
	GOTO INPUT_LOOP_2
ENDIF

IF ABL:LOCAL:種族 > 0 && ABL:LOCAL:種族 < 45 && NO:LOCAL != 3501 && NO:LOCAL != 3502
	S = (CSVBASE((NO:LOCAL),GETNUM(BASE,"LV"),0) < 13 ? 100 # 0 ) + CSVBASE((NO:LOCAL),GETNUM(BASE,"LV"),0) * (5+MAX(5,CSVBASE((NO:LOCAL),GETNUM(BASE,"LV"),0)/2)) * 5
ELSEIF ABL:LOCAL:種族 == 45
	S = 450 + BASE:LOCAL:LV * (3+BASE:LOCAL:LV/4) * 3
ELSEIF (TALENT:LOCAL:非戦闘員 == 0 || TALENT:LOCAL:霊媒体質) && (NO:LOCAL != 3501 && NO:LOCAL != 3502)
	S = BASE:LOCAL:LV * (3+BASE:LOCAL:LV/2) * 10
ELSEIF NO:LOCAL == 3501 || NO:LOCAL == 3502
	S = BASE:LOCAL:LV * (3+BASE:LOCAL:LV/10) * 1
ELSE
	S = BASE:LOCAL:LV * (3+BASE:LOCAL:LV/2) * 10 / 5
ENDIF

IF CFLAG:LOCAL:引継ぎ回数 > 0 && FLAG:5 < 9 && CHECK_TIMELIMIT(0,DAY < 51,1)
	S = CFLAG:LOCAL:初期LV * (5+CFLAG:LOCAL:初期LV/2) * 5 * DAY / 100
ENDIF
S /= 4

;ABLによる基礎値計算
LOCAL:4 = 0
LOCAL:3 = 100
;ABL:LOCAL:従順をみる
SELECTCASE ABL:LOCAL:従順
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 20
	CASE 4
		LOCAL:4 = 35
	CASE 5
		LOCAL:4 = 55
	CASE 6
		LOCAL:4 = 75
	CASE 7
		LOCAL:4 = 100
	CASE 8
		LOCAL:4 = 125
	CASE 9
		LOCAL:4 = 155
	CASEELSE
		LOCAL:4 = 200
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:欲望をみる
SELECTCASE ABL:LOCAL:欲望
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 20
	CASE 4
		LOCAL:4 = 35
	CASE 5
		LOCAL:4 = 55
	CASE 6
		LOCAL:4 = 75
	CASE 7
		LOCAL:4 = 100
	CASE 8
		LOCAL:4 = 125
	CASE 9
		LOCAL:4 = 155
	CASEELSE
		LOCAL:4 = 200
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4

;ABL:LOCAL:技巧をみる
SELECTCASE ABL:LOCAL:技巧
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 20
	CASE 4
		LOCAL:4 = 35
	CASE 5
		LOCAL:4 = 55
	CASE 6
		LOCAL:4 = 75
	CASE 7
		LOCAL:4 = 100
	CASE 8
		LOCAL:4 = 125
	CASE 9
		LOCAL:4 = 155
	CASEELSE
		LOCAL:4 = 200
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:Ｃ感覚をみる
SELECTCASE ABL:LOCAL:Ｃ感覚
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 2
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 9
	CASE 4
		LOCAL:4 = 15
	CASE 5
		LOCAL:4 = 20
	CASE 6
		LOCAL:4 = 25
	CASE 7
		LOCAL:4 = 35
	CASE 8
		LOCAL:4 = 45
	CASE 9
		LOCAL:4 = 60
	CASEELSE
		LOCAL:4 = 75
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:Ｖ感覚をみる
SELECTCASE ABL:LOCAL:Ｖ感覚
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 9
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 20
	CASE 5
		LOCAL:4 = 25
	CASE 6
		LOCAL:4 = 35
	CASE 7
		LOCAL:4 = 45
	CASE 8
		LOCAL:4 = 60
	CASE 9
		LOCAL:4 = 75
	CASEELSE
		LOCAL:4 = 95
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:Ａ感覚をみる
SELECTCASE ABL:LOCAL:Ａ感覚
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 9
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 20
	CASE 5
		LOCAL:4 = 25
	CASE 6
		LOCAL:4 = 35
	CASE 7
		LOCAL:4 = 45
	CASE 8
		LOCAL:4 = 60
	CASE 9
		LOCAL:4 = 75
	CASEELSE
		LOCAL:4 = 95
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:Ｂ感覚をみる
SELECTCASE ABL:LOCAL:Ｂ感覚
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 2
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 9
	CASE 4
		LOCAL:4 = 15
	CASE 5
		LOCAL:4 = 20
	CASE 6
		LOCAL:4 = 25
	CASE 7
		LOCAL:4 = 35
	CASE 8
		LOCAL:4 = 45
	CASE 9
		LOCAL:4 = 60
	CASEELSE
		LOCAL:4 = 75
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:奉仕精神をみる
SELECTCASE ABL:LOCAL:奉仕精神
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 10
	CASE 4
		LOCAL:4 = 10
	CASE 5
		LOCAL:4 = 15
	CASE 6
		LOCAL:4 = 20
	CASE 7
		LOCAL:4 = 25
	CASE 8
		LOCAL:4 = 30
	CASE 9
		LOCAL:4 = 35
	CASEELSE
		LOCAL:4 = 45
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:露出癖をみる
SELECTCASE ABL:LOCAL:露出癖
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 20
	CASE 5
		LOCAL:4 = 25
	CASE 6
		LOCAL:4 = 35
	CASE 7
		LOCAL:4 = 45
	CASE 8
		LOCAL:4 = 60
	CASE 9
		LOCAL:4 = 75
	CASEELSE
		LOCAL:4 = 90
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:マゾっ気をみる
SELECTCASE ABL:LOCAL:マゾっ気
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 20
	CASE 5
		LOCAL:4 = 30
	CASE 6
		LOCAL:4 = 40
	CASE 7
		LOCAL:4 = 50
	CASE 8
		LOCAL:4 = 60
	CASE 9
		LOCAL:4 = 70
	CASEELSE
		LOCAL:4 = 80
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4



;ABL:LOCAL:サドっ気をみる
SELECTCASE ABL:LOCAL:サドっ気
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 5
	CASE 4
		LOCAL:4 = 30
	CASE 5
		LOCAL:4 = 40
	CASE 6
		LOCAL:4 = 45
	CASE 7
		LOCAL:4 = 50
	CASE 8
		LOCAL:4 = 60
	CASE 9
		LOCAL:4 = 70
	CASEELSE
		LOCAL:4 = 75
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4



;ABL:LOCAL:レズっ気をみる
SELECTCASE ABL:LOCAL:レズっ気
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 10
	CASE 4
		LOCAL:4 = 10
	CASE 5
		LOCAL:4 = 20
	CASE 6
		LOCAL:4 = 25
	CASE 7
		LOCAL:4 = 30
	CASE 8
		LOCAL:4 = 35
	CASE 9
		LOCAL:4 = 40
	CASEELSE
		LOCAL:4 = 45
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4



;ABL:LOCAL:料理技能をみる
SELECTCASE ABL:LOCAL:料理技能
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 10
	CASE 4
		LOCAL:4 = 15
	CASE 5
		LOCAL:4 = 25
	CASE 6
		LOCAL:4 = 25
	CASE 7
		LOCAL:4 = 30
	CASE 8
		LOCAL:4 = 35
	CASE 9
		LOCAL:4 = 50
	CASEELSE
		LOCAL:4 = 60
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4



;ABL:LOCAL:撮影技能をみる
SELECTCASE ABL:LOCAL:撮影技能
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 0
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 10
	CASE 4
		LOCAL:4 = 15
	CASE 5
		LOCAL:4 = 20
	CASE 6
		LOCAL:4 = 25
	CASE 7
		LOCAL:4 = 30
	CASE 8
		LOCAL:4 = 35
	CASE 9
		LOCAL:4 = 45
	CASEELSE
		LOCAL:4 = 70
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4



;ABL:LOCAL:歌唱技能をみる
SELECTCASE ABL:LOCAL:歌唱技能
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 0
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 10
	CASE 4
		LOCAL:4 = 15
	CASE 5
		LOCAL:4 = 20
	CASE 6
		LOCAL:4 = 25
	CASE 7
		LOCAL:4 = 30
	CASE 8
		LOCAL:4 = 35
	CASE 9
		LOCAL:4 = 45
	CASEELSE
		LOCAL:4 = 70
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4



;ABL:LOCAL:自慰中毒をみる
SELECTCASE ABL:LOCAL:自慰中毒
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 25
	CASE 5
		LOCAL:4 = 35
	CASE 6
		LOCAL:4 = 45
	CASE 7
		LOCAL:4 = 60
	CASE 8
		LOCAL:4 = 75
	CASE 9
		LOCAL:4 = 90
	CASEELSE
		LOCAL:4 = 110
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:精液中毒をみる
SELECTCASE ABL:LOCAL:精液中毒
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 10
	CASE 2
		LOCAL:4 = 20
	CASE 3
		LOCAL:4 = 30
	CASE 4
		LOCAL:4 = 50
	CASE 5
		LOCAL:4 = 70
	CASE 6
		LOCAL:4 = 90
	CASE 7
		LOCAL:4 = 120
	CASE 8
		LOCAL:4 = 150
	CASE 9
		LOCAL:4 = 180
	CASEELSE
		LOCAL:4 = 220
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:レズ中毒をみる
SELECTCASE ABL:LOCAL:レズ中毒
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 25
	CASE 5
		LOCAL:4 = 35
	CASE 6
		LOCAL:4 = 45
	CASE 7
		LOCAL:4 = 60
	CASE 8
		LOCAL:4 = 75
	CASE 9
		LOCAL:4 = 90
	CASEELSE
		LOCAL:4 = 110
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:セックス中毒をみる
SELECTCASE ABL:LOCAL:セックス中毒
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 25
	CASE 5
		LOCAL:4 = 35
	CASE 6
		LOCAL:4 = 45
	CASE 7
		LOCAL:4 = 60
	CASE 8
		LOCAL:4 = 75
	CASE 9
		LOCAL:4 = 90
	CASEELSE
		LOCAL:4 = 110
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:噴乳中毒をみる
SELECTCASE ABL:LOCAL:噴乳中毒
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 25
	CASE 5
		LOCAL:4 = 35
	CASE 6
		LOCAL:4 = 45
	CASE 7
		LOCAL:4 = 60
	CASE 8
		LOCAL:4 = 75
	CASE 9
		LOCAL:4 = 90
	CASEELSE
		LOCAL:4 = 110
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:ＢＬっ気をみる
SELECTCASE ABL:LOCAL:ＢＬっ気
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 5
	CASE 3
		LOCAL:4 = 10
	CASE 4
		LOCAL:4 = 10
	CASE 5
		LOCAL:4 = 20
	CASE 6
		LOCAL:4 = 25
	CASE 7
		LOCAL:4 = 30
	CASE 8
		LOCAL:4 = 35
	CASE 9
		LOCAL:4 = 40
	CASEELSE
		LOCAL:4 = 45
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4


;ABL:LOCAL:ＢＬ中毒をみる
SELECTCASE ABL:LOCAL:ＢＬ中毒
	CASE 0
		LOCAL:4 = 0
	CASE 1
		LOCAL:4 = 5
	CASE 2
		LOCAL:4 = 10
	CASE 3
		LOCAL:4 = 15
	CASE 4
		LOCAL:4 = 25
	CASE 5
		LOCAL:4 = 35
	CASE 6
		LOCAL:4 = 45
	CASE 7
		LOCAL:4 = 60
	CASE 8
		LOCAL:4 = 75
	CASE 9
		LOCAL:4 = 90
	CASEELSE
		LOCAL:4 = 110
ENDSELECT
SIF LOCAL:4 > 0
LOCAL:3 += LOCAL:4

LOCAL:4 = LOCAL:3

LOCAL:3 = 100
;素質による売却額補正値計算
;TALENT:LOCAL:処女をみる
IF TALENT:LOCAL:0
	C = 100
	LOCAL:3 += 100
ENDIF
;TALENT:LOCAL:再生処女をみる
IF TALENT:LOCAL:1
	C = 20
	LOCAL:3 += 20
ENDIF
;素質による増減
;陥落素質
;恋慕
IF TALENT:LOCAL:3
	C = 50
	LOCAL:3 -= 50
ENDIF
;淫乱
IF TALENT:LOCAL:4
	C = 30
	LOCAL:3 += 30
ENDIF
;服従
IF TALENT:LOCAL:5
	C = 50
	LOCAL:3 += 50
ENDIF
;親愛
IF TALENT:LOCAL:6
	C = 80
	LOCAL:3 -= 80
ENDIF
;娼婦
IF TALENT:LOCAL:7
	C = 60
	LOCAL:3 += 60
ENDIF
;隷属
IF TALENT:LOCAL:8
	C = 100
	LOCAL:3 += 100
ENDIF



;その他素質
;臆病
IF TALENT:LOCAL:10
	C = 20
	LOCAL:3 -= 20
ENDIF
;反抗的
IF TALENT:LOCAL:11
	C = 20
	LOCAL:3 += 20
ENDIF
;気丈
IF TALENT:LOCAL:12
	C = 40
	LOCAL:3 += 40
ENDIF
;素直
IF TALENT:LOCAL:13
	C = 20
	LOCAL:3 -= 20
ENDIF
;大人しい
IF TALENT:LOCAL:14
	C = 20
	LOCAL:3 -= 20
ENDIF
;プライド高い
IF TALENT:LOCAL:15
	C = 20
	LOCAL:3 += 20
ENDIF
;生意気
IF TALENT:LOCAL:16
	C = 20
	LOCAL:3 += 20
ENDIF
;プライド低い
IF TALENT:LOCAL:17
	C = 20
	LOCAL:3 -= 20
ENDIF
;ツンデレ
IF TALENT:LOCAL:18
	C = 20
	LOCAL:3 += 20
ENDIF
;自制心
IF TALENT:LOCAL:20
	C = 20
	LOCAL:3 += 20
ENDIF
;無関心
IF TALENT:LOCAL:21
	C = 20
	LOCAL:3 -= 20
ENDIF
;感情乏しい
IF TALENT:LOCAL:22
	C = 20
	LOCAL:3 -= 20
ENDIF
;好奇心
IF TALENT:LOCAL:23
	C = 10
	LOCAL:3 += 10
ENDIF
;保守的
IF TALENT:LOCAL:24
	C = 10
	LOCAL:3 += 10
ENDIF
;一線越えない
IF TALENT:LOCAL:27
	C = 30
	LOCAL:3 += 30
ENDIF
;目立ちたがり
IF TALENT:LOCAL:28
	C = 10
	LOCAL:3 += 10
ENDIF
;貞操観念
IF TALENT:LOCAL:30
	C = 20
	LOCAL:3 += 20
ENDIF
;貞操無頓着
IF TALENT:LOCAL:31
	C = 20
	LOCAL:3 -= 20
ENDIF
;解放
IF TALENT:LOCAL:33
	C = 10
	LOCAL:3 += 10
ENDIF
;恥じらい
IF TALENT:LOCAL:35
	C = 10
	LOCAL:3 += 10
ENDIF
;恥薄い
IF TALENT:LOCAL:36
	C = 10
	LOCAL:3 -= 10
ENDIF
;痛みに弱い
IF TALENT:LOCAL:40
	C = 20
	LOCAL:3 -= 20
ENDIF
;痛みに強い
IF TALENT:LOCAL:41
	C = 20
	LOCAL:3 += 20
ENDIF
;濡れやすい
IF TALENT:LOCAL:42
	C = 10
	LOCAL:3 += 10
ENDIF
;濡れにくい
IF TALENT:LOCAL:43
	C = 10
	LOCAL:3 -= 10
ENDIF
;習得早い
IF TALENT:LOCAL:50
	C = 10
	LOCAL:3 += 10
ENDIF
;習得遅い
IF TALENT:LOCAL:51
	C = 10
	LOCAL:3 -= 10
ENDIF
;舌使い
IF TALENT:LOCAL:52
	C = 30
	LOCAL:3 += 30
ENDIF
;薬毒耐性
IF TALENT:LOCAL:56
	C = 20
	LOCAL:3 -= 20
ENDIF
;おもらし癖
IF TALENT:LOCAL:57
	C = 10
	LOCAL:3 += 10
ENDIF
;自慰しやすい
IF TALENT:LOCAL:60
	C = 10
	LOCAL:3 += 10
ENDIF
;汚臭鈍感
IF TALENT:LOCAL:61
	C = 20
	LOCAL:3 -= 20
ENDIF
;汚臭敏感
IF TALENT:LOCAL:62
	C = 20
	LOCAL:3 += 20
ENDIF
;献身的
IF TALENT:LOCAL:63
	C = 30
	LOCAL:3 += 30
ENDIF
;快感に素直
IF TALENT:LOCAL:70
	C = 30
	LOCAL:3 -= 30
ENDIF
;快感の否定
IF TALENT:LOCAL:71
	C = 30
	LOCAL:3 += 30
ENDIF
;即落ち
IF TALENT:LOCAL:73
	C = 50
	LOCAL:3 -= 50
ENDIF
;自慰狂い
IF TALENT:LOCAL:74
	C = 20
	LOCAL:3 += 20
ENDIF
;セックス狂
IF TALENT:LOCAL:75
	C = 30
	LOCAL:3 += 30
ENDIF
;尻穴狂い
IF TALENT:LOCAL:76
	C = 20
	LOCAL:3 += 20
ENDIF
;淫乳
IF TALENT:LOCAL:77
	C = 30
	LOCAL:3 += 30
ENDIF
;倒錯的
IF TALENT:LOCAL:80
	C = 10
	LOCAL:3 += 10
ENDIF
;男嫌い
IF TALENT:LOCAL:82
	C = 10
	LOCAL:3 -= 10
ENDIF
;サド
IF TALENT:LOCAL:83
	C = 30
	LOCAL:3 += 30
ENDIF
;マゾ
IF TALENT:LOCAL:84
	C = 40
	LOCAL:3 += 40
ENDIF
;妄信
IF TALENT:LOCAL:86
	C = 30
	LOCAL:3 += 30
ENDIF
;小悪魔
IF TALENT:LOCAL:87
	C = 20
	LOCAL:3 += 20
ENDIF
;女嫌い
IF TALENT:LOCAL:88
	C = 10
	LOCAL:3 -= 10
ENDIF
;妖狐
IF TALENT:LOCAL:91
	C = 20
	LOCAL:3 += 20
ENDIF
;魅力
IF TALENT:LOCAL:92
	C = 20
	LOCAL:3 += 20
ENDIF
;謎の魅力
IF TALENT:LOCAL:94
	C = 100
	LOCAL:3 += 100
ENDIF
;ＣInsensitive（感覚が4以上なら無効）
IF TALENT:LOCAL:101 && ABL:LOCAL:3 < 4
	C = 30
	LOCAL:3 -= 30
ENDIF
;ＣSensitive（感覚が3未満なら無効）
IF TALENT:LOCAL:102 && ABL:LOCAL:3 >= 3
	C = 30
	LOCAL:3 += 30
ENDIF
;ＶInsensitive（感覚が4以上なら無効）
IF TALENT:LOCAL:103 && ABL:LOCAL:4 < 4
	C = 30
	LOCAL:3 -= 30
ENDIF
;ＶSensitive（感覚が3未満なら無効）
IF TALENT:LOCAL:104 && ABL:LOCAL:4 >= 3
	C = 30
	LOCAL:3 += 30
ENDIF
;ＡInsensitive（感覚が4以上なら無効）
IF TALENT:LOCAL:105 && ABL:LOCAL:5 < 4
	C = 30
	LOCAL:3 -= 30
ENDIF
;ＡSensitive（感覚が3未満なら無効）
IF TALENT:LOCAL:106 && ABL:LOCAL:5 >= 3
	C = 30
	LOCAL:3 += 30
ENDIF
;ＢInsensitive（感覚が4以上なら無効）
IF TALENT:LOCAL:107 && ABL:LOCAL:6 < 4
	C = 30
	LOCAL:3 -= 30
ENDIF
;ＢSensitive（感覚が3未満なら無効）
IF TALENT:LOCAL:108 && ABL:LOCAL:6 >= 3
	C = 30
	LOCAL:3 += 30
ENDIF
;貧乳
IF TALENT:LOCAL:109
	C = 20
	LOCAL:3 -= 20
ENDIF
;絶壁
IF TALENT:LOCAL:110
	C = 10
	LOCAL:3 += 10
ENDIF
;巨乳
IF TALENT:LOCAL:111
	C = 20
	LOCAL:3 += 20
ENDIF
;爆乳
IF TALENT:LOCAL:112
	C = 10
	LOCAL:3 += 10
ENDIF
;回復早い
IF TALENT:LOCAL:130
	C = 20
	LOCAL:3 += 20
ENDIF
;回復遅い
IF TALENT:LOCAL:131
	C = 20
	LOCAL:3 -= 20
ENDIF
;吸血鬼
IF TALENT:LOCAL:132
	C = 30
	LOCAL:3 += 30
ENDIF
;動物耳
IF TALENT:LOCAL:143
	C = 20
	LOCAL:3 += 20
ENDIF
;人気
IF TALENT:LOCAL:145
	C = 50
	LOCAL:3 += 50
ENDIF
;蓬莱人
IF TALENT:LOCAL:147
	C = 70
	LOCAL:3 += 70
ENDIF
;母乳体質
IF TALENT:LOCAL:149
	C = 20
	LOCAL:3 += 20
ENDIF

;元助手
IF ISASSI:LOCAL == 1
	C = 100
	LOCAL:3 -= 100
ENDIF


;補正値が0以下の場合は100にする
SIF LOCAL:3 <= 0
	LOCAL:3 = 1

;補正値の適用
S *= LOCAL:3 * LOCAL:4
S /= 10000

;崩壊,狂気,妊娠は売却額をかなり低くする（従順によって、80％まで回復）
IF TALENT:LOCAL:9 || TALENT:LOCAL:141 || TALENT:LOCAL:153
	IF TALENT:LOCAL:9
		S *= ABL:LOCAL:0
		TIMES S , 0.08
		Z = ABL:LOCAL:0
		Z *= 8
	ELSEIF TALENT:LOCAL:141
		S *= ABL:LOCAL:0
		TIMES S , 0.08
		Z = ABL:LOCAL:0
		Z *= 8
	ELSEIF TALENT:LOCAL:153
		S *= ABL:LOCAL:0
		TIMES S , 0.08
		Z = ABL:LOCAL:0
		Z *= 8
	ENDIF
ENDIF


;難易度処理
;EASY
IF FLAG:4 == 1
	TIMES S , 1.20
;NORMAL
ELSEIF FLAG:4 == 2
	TIMES S , 1.00
;HARD
ELSEIF FLAG:4 == 3
	TIMES S , 0.80
ENDIF

;日数による売却価格低下(クリアすると100％に戻る)
;IF FLAG:5 < 9 && FLAG:調教難易度 > 1
;	S *= MAX(1,100 - (DAY-1))
;	S /= 100
;ENDIF
S *= (10 + ABL:LOCAL:触手中毒 * 9)
S /= 10
PRINTW ………………
PRINTW …………
PRINTW ……
PRINTFORMW ＜触手達は%CALLNAME:LOCAL%からエネルギーを搾り取った＞
PRINTFORML ＜触手エネルギー＋{S}F＞
PRINTFORMW ＜%CALLNAME:LOCAL%は二度と調教対象に選択できなくなりました＞
PRINTL 
CALL キャラ削除, LOCAL
FLAG:触手エネルギー += S
SIF FLAG:触手エネルギー > MAXBASE:MASTER:ＭＡＧ
	FLAG:触手エネルギー = MAXBASE:MASTER:ＭＡＧ
RETURN 0

@CASTING_TENTACLE_LABORATORY_SACRIFICE
;主人は除外
SIF COUNT == MASTER
	RETURN 0
;労役中キャラは除外
SIF CFLAG:COUNT:労役フラグ == 3
	RETURN 0
;従順が3未満だと除外
SIF ABL:COUNT:従順 < 3
	RETURN 0
SIF (TALENT:COUNT:妊娠 || TALENT:COUNT:育児中) && FLAG:出産機能ONOFF == 1
	RETURN 0
;失踪中などこの場にいないなら除外
SIF CFLAG:COUNT:この場に居ないフラグ
	RETURN 0
SIF CFLAG:COUNT:フィルタリングフラグ
	RETURN 0
RETURN 1

@UP_PRINT_TENTACLE_LABORATORY_SACRIFICE
PRINTL You can offer a sacrifice to the tentacles to give them energy.
PRINTFORML Who will be sacrificed?　\@ A > リスト表示数() ? ＜page.{P + 1}/{A / リスト表示数() + 1}＞ # \@
