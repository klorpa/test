
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		基礎,InFO.ERB
;
;	Licence		:ライセンスフリー。
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20XX/XX/XX		----					新規作成
;	002		2011/03/03		迷走中の人				FEELＣＶＡＢのソースを解放
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#

;@SOURCE_CHECK_PLAYER
;;-------------------------------------------------
;;FEELＣのソース
;;-------------------------------------------------
;;ＣSensitiveとＣInsensitiveはここで処理
;SIF TALENT:PLAYER:101
;	TIMES SOURCE:PLAYER:0 , 0.50
;SIF TALENT:PLAYER:102
;	TIMES SOURCE:PLAYER:0 , 2.00
;
;;C感覚
;SIF ABL:PLAYER:3 == 0
;	TIMES SOURCE:PLAYER:0 , 0.50
;SIF ABL:PLAYER:3 == 1
;	TIMES SOURCE:PLAYER:0 , 1.80
;SIF ABL:PLAYER:3 == 2
;	TIMES SOURCE:PLAYER:0 , 3.00
;SIF ABL:PLAYER:3 == 3
;	TIMES SOURCE:PLAYER:0 , 5.00
;SIF ABL:PLAYER:3 == 4
;	TIMES SOURCE:PLAYER:0 , 7.00
;SIF ABL:PLAYER:3 == 5
;	TIMES SOURCE:PLAYER:0 , 9.00
;SIF ABL:PLAYER:3 == 6
;	TIMES SOURCE:PLAYER:0 , 11.00
;SIF ABL:PLAYER:3 == 7
;	TIMES SOURCE:PLAYER:0 , 13.00
;SIF ABL:PLAYER:3 == 8
;	TIMES SOURCE:PLAYER:0 , 15.00
;SIF ABL:PLAYER:3 == 9
;	TIMES SOURCE:PLAYER:0 , 17.00
;SIF ABL:PLAYER:3 >= 10
;	TIMES SOURCE:PLAYER:0 , 20.00
;
;
;UP:0 += SOURCE:PLAYER:0
;
;;-------------------------------------------------
;;快Ｖのソース
;;-------------------------------------------------
;;ＶSensitiveとＶInsensitiveはここで処理
;SIF TALENT:PLAYER:103
;	TIMES SOURCE:PLAYER:1 , 0.50
;SIF TALENT:PLAYER:104
;	TIMES SOURCE:PLAYER:1 , 2.00
;
;;V感覚
;SIF ABL:PLAYER:4 == 0
;	TIMES SOURCE:PLAYER:1 , 0.50
;SIF ABL:PLAYER:4 == 1
;	TIMES SOURCE:PLAYER:1 , 1.80
;SIF ABL:PLAYER:4 == 2
;	TIMES SOURCE:PLAYER:1 , 3.00
;SIF ABL:PLAYER:4 == 3
;	TIMES SOURCE:PLAYER:1 , 5.00
;SIF ABL:PLAYER:4 == 4
;	TIMES SOURCE:PLAYER:1 , 7.00
;SIF ABL:PLAYER:4 == 5
;	TIMES SOURCE:PLAYER:1 , 9.00
;SIF ABL:PLAYER:4 == 6
;	TIMES SOURCE:PLAYER:1 , 11.00
;SIF ABL:PLAYER:4 == 7
;	TIMES SOURCE:PLAYER:1 , 13.00
;SIF ABL:PLAYER:4 == 8
;	TIMES SOURCE:PLAYER:1 , 15.00
;SIF ABL:PLAYER:4 == 9
;	TIMES SOURCE:PLAYER:1 , 17.00
;SIF ABL:PLAYER:4 >= 10
;	TIMES SOURCE:PLAYER:1 , 20.00
;
;;EXP:Ｖ経験をみる
;IF EXP:0 < EXPLV:1
;	TIMES SOURCE:PLAYER:1 , 0.20
;ELSEIF EXP:0 < EXPLV:2
;	TIMES SOURCE:PLAYER:1 , 0.60
;ELSEIF EXP:0 < EXPLV:3
;	TIMES SOURCE:PLAYER:1 , 1.00
;ELSEIF EXP:0 < EXPLV:4
;	TIMES SOURCE:PLAYER:1 , 1.20
;ELSEIF EXP:0 < EXPLV:5
;	TIMES SOURCE:PLAYER:1 , 1.40
;ELSEIF EXP:0 >= EXPLV:5
;	TIMES SOURCE:PLAYER:1 , 1.60
;ENDIF
;
;
;
;;小人体型
;IF TALENT:PLAYER:149
;	TIMES SOURCE:PLAYER:1 , 1.20
;ENDIF
;
;UP:1 += SOURCE:PLAYER:1
;
;;-------------------------------------------------
;;快Ａのソース
;;-------------------------------------------------
;;ＡSensitiveとＡInsensitiveはここで処理
;SIF TALENT:PLAYER:105
;	TIMES SOURCE:PLAYER:2 , 0.50
;SIF TALENT:PLAYER:106
;	TIMES SOURCE:PLAYER:2 , 2.00
;
;;男の娘
;SIF TALENT:PLAYER:男の娘
;	TIMES SOURCE:PLAYER:2 , 1.50
;
;;A感覚
;SIF ABL:PLAYER:5 == 0
;	TIMES SOURCE:PLAYER:2 , 0.50
;SIF ABL:PLAYER:5 == 1
;	TIMES SOURCE:PLAYER:2 , 1.80
;SIF ABL:PLAYER:5 == 2
;	TIMES SOURCE:PLAYER:2 , 3.00
;SIF ABL:PLAYER:5 == 3
;	TIMES SOURCE:PLAYER:2 , 5.00
;SIF ABL:PLAYER:5 == 4
;	TIMES SOURCE:PLAYER:2 , 7.00
;SIF ABL:PLAYER:5 == 5
;	TIMES SOURCE:PLAYER:2 , 9.00
;SIF ABL:PLAYER:5 == 6
;	TIMES SOURCE:PLAYER:2 , 11.00
;SIF ABL:PLAYER:5 == 7
;	TIMES SOURCE:PLAYER:2 , 13.00
;SIF ABL:PLAYER:5 == 8
;	TIMES SOURCE:PLAYER:2 , 15.00
;SIF ABL:PLAYER:5 == 9
;	TIMES SOURCE:PLAYER:2 , 17.00
;SIF ABL:PLAYER:5 >= 10
;	TIMES SOURCE:PLAYER:2 , 20.00
;
;;PALAM:欲情をみる
;;快ＡはあまりPALAM:欲情では差が出ない
;IF PALAM:6 < PALAMLV:1
;	TIMES A , 0.80
;ELSEIF PALAM:6 < PALAMLV:2
;	TIMES A , 1.00
;ELSEIF PALAM:6 < PALAMLV:3
;	TIMES A , 1.20
;ELSEIF PALAM:6 < PALAMLV:4
;	TIMES A , 1.40
;ELSEIF PALAM:6 >= PALAMLV:4
;	TIMES A , 1.60
;ENDIF
;
;
;;EXP:Ａ経験をみる
;IF EXP:1 < EXPLV:1
;	TIMES SOURCE:PLAYER:2 , 0.10
;ELSEIF EXP:1 < EXPLV:2
;	TIMES SOURCE:PLAYER:2 , 0.30
;ELSEIF EXP:1 < EXPLV:3
;	TIMES SOURCE:PLAYER:2 , 0.50
;ELSEIF EXP:1 < EXPLV:4
;	TIMES SOURCE:PLAYER:2 , 1.00
;ELSEIF EXP:1 < EXPLV:5
;	TIMES SOURCE:PLAYER:2 , 1.40
;ELSEIF EXP:1 >= EXPLV:5
;	TIMES SOURCE:PLAYER:2 , 1.60
;ENDIF
;
;
;;小人体型
;IF TALENT:PLAYER:149
;	TIMES SOURCE:PLAYER:2 , 1.50
;ENDIF
;
;
;UP:2 += SOURCE:PLAYER:2
;
;;-------------------------------------------------
;;快Ｂのソース
;;-------------------------------------------------
;;ＢSensitiveとＢInsensitiveはここで処理
;SIF TALENT:PLAYER:107
;	TIMES SOURCE:PLAYER:3 , 0.50
;SIF TALENT:PLAYER:108
;	TIMES SOURCE:PLAYER:3 , 2.00
;
;;男の娘
;SIF TALENT:PLAYER:男の娘
;	TIMES SOURCE:PLAYER:3 , 1.50
;
;;B感覚
;SIF ABL:PLAYER:6 == 0
;	TIMES SOURCE:PLAYER:3 , 0.50
;SIF ABL:PLAYER:6 == 1
;	TIMES SOURCE:PLAYER:3 , 1.80
;SIF ABL:PLAYER:6 == 2
;	TIMES SOURCE:PLAYER:3 , 3.00
;SIF ABL:PLAYER:6 == 3
;	TIMES SOURCE:PLAYER:3 , 5.00
;SIF ABL:PLAYER:6 == 4
;	TIMES SOURCE:PLAYER:3 , 7.00
;SIF ABL:PLAYER:6 == 5
;	TIMES SOURCE:PLAYER:3 , 9.00
;SIF ABL:PLAYER:6 == 6
;	TIMES SOURCE:PLAYER:3 , 11.00
;SIF ABL:PLAYER:6 == 7
;	TIMES SOURCE:PLAYER:3 , 13.00
;SIF ABL:PLAYER:6 == 8
;	TIMES SOURCE:PLAYER:3 , 15.00
;SIF ABL:PLAYER:6 == 9
;	TIMES SOURCE:PLAYER:3 , 17.00
;SIF ABL:PLAYER:6 >= 10
;	TIMES SOURCE:PLAYER:3 , 20.00
;
;UP:3 += SOURCE:PLAYER:3
;
;;-------------------------------------------------
;;素質などによる上下の処理（快楽系）
;;-------------------------------------------------
;;媚薬
;IF TEQUIP:PLAYER:26
;	TIMES UP:0 , 2.00
;	TIMES UP:1 , 2.00
;	TIMES UP:2 , 2.00
;	TIMES UP:3 , 2.00
;ENDIF
;
;;-------------------------------------------------
;;陥落素質
;;-------------------------------------------------
;;淫乱
;IF TALENT:PLAYER:4
;	TIMES UP:0 , 1.20
;	TIMES UP:1 , 1.20
;	TIMES UP:2 , 1.20
;	TIMES UP:3 , 1.20
;ENDIF
;
;;娼婦
;IF TALENT:PLAYER:7
;	TIMES UP:0 , 1.50
;	TIMES UP:1 , 1.50
;	TIMES UP:2 , 1.50
;	TIMES UP:3 , 1.50
;ENDIF
;
;;-------------------------------------------------
;;素質
;;-------------------------------------------------
;;自制心
;IF TALENT:PLAYER:20
;	TIMES UP:0 , 0.70
;	TIMES UP:1 , 0.90
;	TIMES UP:2 , 1.00
;	TIMES UP:3 , 0.70
;ENDIF
;
;;即落ち
;IF TALENT:PLAYER:73
;	TIMES UP:0 , 2.00
;	TIMES UP:1 , 2.00
;	TIMES UP:2 , 2.00
;	TIMES UP:3 , 2.00
;ENDIF
;;自慰狂い
;SIF TALENT:PLAYER:74
;	TIMES UP:0 , 1.20
;;セックス狂い
;SIF TALENT:PLAYER:75
;	TIMES UP:1 , 1.20
;;尻穴狂い
;SIF TALENT:PLAYER:76
;	TIMES UP:2 , 1.20
;;淫乳
;SIF TALENT:PLAYER:77
;	TIMES UP:3 , 1.20
;
;;オトコ
;IF IS_MALE(PLAYER)
;	TIMES UP:2 , 1.30
;ENDIF
;
;;-------------------------------------------------
;;難易度による上下の処理（快楽系）
;;-------------------------------------------------
;;EASY
;IF FLAG:4 == 1
;	TIMES UP:0 , 1.60
;	TIMES UP:1 , 1.60
;	TIMES UP:2 , 1.60
;	TIMES UP:3 , 1.60
;;NORMAL
;ELSEIF FLAG:4 == 2
;	TIMES UP:0 , 1.20
;	TIMES UP:1 , 1.20
;	TIMES UP:2 , 1.20
;	TIMES UP:3 , 1.20
;;HARD
;ELSEIF FLAG:4 == 3
;	TIMES UP:0 , 0.80
;	TIMES UP:1 , 0.80
;	TIMES UP:2 , 0.80
;	TIMES UP:3 , 0.80
;ENDIF
;
;CALL ORGASM_ADD_PLAYER
;CALL UPCHECK_PLAYER
;CALL PLAYER_MILK_CHECK

;;-------------------------------------------------
;;調教対象の噴乳チェック
;;-------------------------------------------------
;@PLAYER_MILK_CHECK
;SIF TALENT:PLAYER:149 == 0
;	RETURN 0
;
;A = UP:0 / 5 + UP:1 / 5 + UP:2 / 5 + UP:3 * 3
;
;;自制心
;SIF TALENT:PLAYER:20
;	A /= 2
;
;;快感に素直
;SIF TALENT:PLAYER:70
;	TIMES A , 1.20
;
;;快感の否定（淫乱、娼婦で無効）
;SIF TALENT:PLAYER:71 && (TALENT:PLAYER:4 == 0 && TALENT:PLAYER:7 == 0)
;	TIMES A , 0.80
;
;;B敏感
;SIF TALENT:PLAYER:107
;	TIMES A , 1.20
;
;;媚薬
;SIF TEQUIP:PLAYER:26
;	A *= 2
;
;;利尿剤
;SIF TEQUIP:PLAYER:27
;	A /= 2
;
;;調教者が幼児退行
;SIF TALENT:TARGET:150
;	TIMES A , 1.20
;
;;調教者が幼稚
;SIF TALENT:TARGET:151
;	TIMES A , 1.20
;
;;貧乳
;SIF TALENT:PLAYER:109
;	TIMES A , 0.50
;
;;噴乳中毒のレベルを見る
;IF ABL:PLAYER:19 == 0
;	TIMES A , 1.00
;ELSEIF ABL:PLAYER:19 == 1
;	TIMES A , 1.05
;ELSEIF ABL:PLAYER:19 == 2
;	TIMES A , 1.10
;ELSEIF ABL:PLAYER:19 == 3
;	TIMES A , 1.20
;ELSEIF ABL:PLAYER:19 == 4
;	TIMES A , 1.30
;ELSE
;	TIMES A , 1.50
;ENDIF
;
;A = 500 + A / 2
;BASE:PLAYER:3 += A
;
;S = BASE:PLAYER:3
;EJAC = MAXBASE:PLAYER:3
;
;IF  S > EJAC * 2
;	E = 2
;ELSEIF S > EJAC
;	E = 1
;ELSE
;	E = 0
;ENDIF
;
;;大量噴乳
;IF E == 2
;
;	PRINTFORML %NAME:PLAYER%は乳首から大量の母乳を噴出した
;	PRINTL MilkEXP＋２
;	IF EXP:PLAYER:54 == 0
;		EXP:PLAYER:50 += 1
;		PRINTL AbnormalEXP＋1
;	ENDIF
;	EXP:PLAYER:54 += 2
;	;Ｂに母乳汚れ
;	STAIN:PLAYER:5 |= 16
;
;	BASE:PLAYER:3 -= EJAC*2
;	SIF BASE:PLAYER:3 >= EJAC
;		BASE:PLAYER:3 = EJAC-1
;
;	IF ASSIPLAY
;		;調教対象が噴乳フラグ
;		TFLAG:助手が噴乳 += 2
;		;搾乳器で母乳が集められているかチェック
;		SIF TEQUIP:PLAYER:17
;			TFLAG:助手が搾乳中 += 2
;	ELSE
;		;調教対象が噴乳フラグ
;		TFLAG:主人が噴乳 += 2
;		;搾乳器で母乳が集められているかチェック
;		SIF TEQUIP:PLAYER:17
;			TFLAG:主人が搾乳中 += 2
;	ENDIF
;
;	NOWEX:PLAYER:4 += 1
;	EX:PLAYER:4 += 1
;;通常の噴乳
;ELSEIF E == 1
;
;	PRINTFORML %NAME:PLAYER%は乳首から母乳を垂れ流した
;	PRINTL MilkEXP＋１
;	IF EXP:PLAYER:54 == 0
;		EXP:PLAYER:50 += 1
;		PRINTL AbnormalEXP＋1
;	ENDIF
;	EXP:PLAYER:54 += 1
;	;Ｂに母乳汚れ
;	STAIN:PLAYER:5 |= 16
;
;	BASE:PLAYER:3 -= EJAC
;	SIF BASE:PLAYER:3 >= EJAC
;		BASE:PLAYER:3 = EJAC-1
;
;	IF ASSIPLAY
;		;調教対象が噴乳フラグ
;		TFLAG:助手が噴乳 += 1
;		;搾乳器で母乳が集められているかチェック
;		SIF TEQUIP:PLAYER:17
;			TFLAG:助手が搾乳中 += 1
;	ELSE
;		;調教対象が噴乳フラグ
;		TFLAG:主人が噴乳 += 1
;		;搾乳器で母乳が集められているかチェック
;		SIF TEQUIP:PLAYER:17
;			TFLAG:主人が搾乳中 += 1
;	ENDIF
;
;	NOWEX:PLAYER:4 += 1
;	EX:PLAYER:4 += 1
;ENDIF
;
;IF CFLAG:PLAYER:ＭＡＧ非被吸収 == 0 && E > 0
;	LOCAL = 2 * BASE:TARGET:LV * E * 20 * (5+MAX(ABL:TARGET:従順,ABL:TARGET:欲望,ABL:TARGET:技巧))/5
;	CALL DRAIN_MAG,PLAYER,LOCAL,TARGET
;ENDIF
;
;;-------------------------------------------------
;;調教者の絶頂処理
;;-------------------------------------------------
;@ORGASM_ADD_PLAYER
;LOCAL:0 = 0
;LOCAL:1 = 0
;LOCAL:2 = 0
;LOCAL:3 = 0
;
;;絶頂Ｃ
;IF CUP:PLAYER:0 + PALAM:PLAYER:0 >= PALAMLV:4 * 2
;	LOCAL:0 = 2
;	DOWN:0 = (PALAMLV:4 * 2 - 1000)
;	PRINTL 強絶頂Ｃ(調教者)
;ELSEIF UP:0 + PALAM:PLAYER:0 >= PALAMLV:4
;	LOCAL:0 = 1
;	DOWN:0 = (PALAMLV:4 - 1000)
;	PRINTL 絶頂Ｃ(調教者)
;ENDIF
;;DOWN:0で下げても絶頂以上なら
;;その値-1になるように調整（10000で絶頂なら9999）
;SIF UP:0 + PALAM:PLAYER:0 - DOWN:0 >= PALAMLV:4
;	DOWN:0 = UP:0 + PALAM:PLAYER:0 - PALAMLV:4 + 1
;
;;絶頂Ｖ
;IF UP:1 + PALAM:PLAYER:1 >= PALAMLV:4 * 2
;	LOCAL:1 = 2
;	DOWN:1 = (PALAMLV:4 * 2 - 1000)
;	PRINTL 強絶頂Ｖ(調教者)
;ELSEIF UP:1 + PALAM:PLAYER:1 >= PALAMLV:4
;	LOCAL:1 = 1
;	DOWN:1 = (PALAMLV:4 - 1000)
;	PRINTL 絶頂Ｖ(調教者)
;ENDIF
;;DOWN:1で下げても絶頂以上なら
;;その値-1になるように調整（10000で絶頂なら9999）
;SIF UP:1 + PALAM:PLAYER:1 - DOWN:1 >= PALAMLV:4
;	DOWN:1 = UP:1 + PALAM:PLAYER:1 - PALAMLV:4 + 1
;
;
;;絶頂Ａ
;IF UP:2 + PALAM:PLAYER:2 >= PALAMLV:4 * 2
;	LOCAL:2 = 2
;	DOWN:2 = (PALAMLV:4 * 2 - 1000)
;	PRINTL 強絶頂Ａ(調教者)
;ELSEIF UP:2 + PALAM:PLAYER:2 >= PALAMLV:4
;	LOCAL:2 = 1
;	DOWN:2 = (PALAMLV:4 - 1000)
;	PRINTL 絶頂Ａ(調教者)
;ENDIF
;;DOWN:2で下げても絶頂以上なら
;;その値-1になるように調整（10000で絶頂なら9999）
;SIF UP:2 + PALAM:PLAYER:2 - DOWN:2 >= PALAMLV:4
;	DOWN:2 = UP:2 + PALAM:PLAYER:2 - PALAMLV:4 + 1
;
;;絶頂Ｂ
;IF UP:3 + PALAM:PLAYER:3 >= PALAMLV:4 * 2
;	LOCAL:3 = 2
;	DOWN:3 = (PALAMLV:4 * 2 - 1000)
;	PRINTL 強絶頂Ｂ(調教者)
;ELSEIF UP:3 + PALAM:PLAYER:3 >= PALAMLV:4
;	LOCAL:3 = 1
;	DOWN:3 = (PALAMLV:4 - 1000)
;	PRINTL 絶頂Ｂ(調教者)
;ENDIF
;;DOWN:3で下げても絶頂以上なら
;;その値-1になるように調整（10000で絶頂なら9999）
;SIF UP:3 + PALAM:PLAYER:3 - DOWN:3 >= PALAMLV:4
;	DOWN:3 = UP:3 + PALAM:PLAYER:3 - PALAMLV:4 + 1
;
;;-------------------------------------------------
;;絶頂時の追加処理
;;-------------------------------------------------
;TFLAG:調教者絶頂強度 = LOCAL + LOCAL:1 + LOCAL:2 + LOCAL:3
;
;LOCAL:5 = 0
;
;IF LOCAL && LOCAL:1 && LOCAL:2 && LOCAL:3
;	PRINTL 四 重 絶 頂(調教者)
;	LOCAL *= 8
;	LOCAL:1 *= 8
;	LOCAL:2 *= 8
;	LOCAL:3 *= 8
;ELSEIF LOCAL && LOCAL:1 && LOCAL:2
;	PRINTL Ｃ＆Ｖ＆Ａ絶頂(調教者)
;	LOCAL *= 4
;	LOCAL:1 *= 4
;	LOCAL:2 *= 4
;ELSEIF LOCAL:3 && LOCAL:1 && LOCAL:2
;	PRINTL Ｂ＆Ｖ＆Ａ絶頂(調教者)
;	LOCAL:3 *= 4
;	LOCAL:1 *= 4
;	LOCAL:2 *= 4
;ELSEIF LOCAL && LOCAL:3 && LOCAL:2
;	PRINTL Ｃ＆Ｂ＆Ａ絶頂(調教者)
;	LOCAL *= 4
;	LOCAL:3 *= 4
;	LOCAL:2 *= 4
;ELSEIF LOCAL && LOCAL:1 && LOCAL:3
;	PRINTL Ｃ＆Ｖ＆Ｂ絶頂(調教者)
;	LOCAL *= 4
;	LOCAL:1 *= 4
;	LOCAL:3 *= 4
;ELSEIF LOCAL && LOCAL:1
;	PRINTL Ｃ＆Ｖ絶頂(調教者)
;	LOCAL *= 2
;	LOCAL:1 *= 2
;ELSEIF LOCAL && LOCAL:2
;	PRINTL Ｃ＆Ａ絶頂(調教者)
;	LOCAL *= 2
;	LOCAL:2 *= 2
;ELSEIF LOCAL:1 && LOCAL:2
;	PRINTL Ｖ＆Ａ絶頂(調教者)
;	LOCAL:1 *= 2
;	LOCAL:2 *= 2
;ELSEIF LOCAL && LOCAL:3
;	PRINTL Ｃ＆Ｂ絶頂(調教者)
;	LOCAL *= 2
;	LOCAL:3 *= 2
;ELSEIF LOCAL:1 && LOCAL:3
;	PRINTL Ｖ＆Ｂ絶頂(調教者)
;	LOCAL:1 *= 2
;	LOCAL:3 *= 2
;ELSEIF LOCAL:2 && LOCAL:3
;	PRINTL Ａ＆Ｂ絶頂(調教者)
;	LOCAL:2 *= 2
;	LOCAL:3 *= 2
;ENDIF
;LOCAL:5 = TFLAG:調教者絶頂強度
;
;SIF LOCAL
;	LOCAL:5 += 2
;
;IF LOCAL:5 > 0 && CFLAG:PLAYER:ＭＡＧ非被吸収 == 0
;	
;	LOCAL:5 *= MAXBASE:TARGET:LV * 20 * (5+MAX(ABL:TARGET:従順,ABL:TARGET:欲望,ABL:TARGET:技巧))/5
;	CALL DRAIN_MAG,PLAYER,LOCAL:5,TARGET
;ENDIF
;
;IF LOCAL
;	SOURCE:PLAYER:13 += 500 * LOCAL
;	SOURCE:PLAYER:14 += 200 * LOCAL
;	SOURCE:PLAYER:18 += 150 * LOCAL
;ENDIF
;IF LOCAL:1
;	SOURCE:PLAYER:11 += 800 * LOCAL:1
;	SOURCE:PLAYER:12 += 500 * LOCAL:1
;	SOURCE:PLAYER:13 += 700 * LOCAL:1
;	SOURCE:PLAYER:14 += 400 * LOCAL:1
;	SOURCE:PLAYER:18 += 300 * LOCAL:1
;ENDIF
;IF LOCAL:2
;	SOURCE:PLAYER:11 += 500 * LOCAL:2
;	SOURCE:PLAYER:12 += 700 * LOCAL:2
;	SOURCE:PLAYER:13 += 900 * LOCAL:2
;	SOURCE:PLAYER:14 += 500 * LOCAL:2
;	SOURCE:PLAYER:18 += 400 * LOCAL:2
;ENDIF
;IF LOCAL:3
;	SOURCE:PLAYER:13 += 500 * LOCAL:3
;	SOURCE:PLAYER:14 += 200 * LOCAL:3
;	SOURCE:PLAYER:18 += 150 * LOCAL:3
;ENDIF
;
;;NOWEXにデータを入れる（絶頂時口上に使う）
;NOWEX:PLAYER:0 = LOCAL
;NOWEX:PLAYER:1 = LOCAL:1
;NOWEX:PLAYER:2 = LOCAL:2
;NOWEX:PLAYER:3 = LOCAL:3
;
;;絶頂回数を増やす
;EX:PLAYER:0 += LOCAL
;EX:PLAYER:1 += LOCAL:1
;EX:PLAYER:2 += LOCAL:2
;EX:PLAYER:3 += LOCAL:3
;
;;ClimaxEXPを増やす
;EXP:PLAYER:2 += LOCAL+LOCAL:1+LOCAL:2+LOCAL:3
;
;RETURN 1

;---------------------------------------------------------
;絶頂するかのチェック
;---------------------------------------------------------
@EX_CHECK
;汎用的な関数なので、将来的にはすべての調教コマンドの射精チェックをここでやることも可能
S = BASE:PLAYER:99
EJAC = MAXBASE:PLAYER:99

;射精限界が来ている場合は、射精ゲージは強制的に0にする
IF CFLAG:PLAYER:11 == 0
	S = 0
	BASE:PLAYER:99 = 0
ENDIF

IF  S > EJAC * 99
	E = 2
ELSEIF S > EJAC
	E = 1
ELSE
	E = 0
ENDIF

@EX_CHECK_M
;調教者と対象が異なる場合（主人）
S = BASE:MASTER:99
EJAC = MAXBASE:MASTER:99

;射精限界が来ている場合は、射精ゲージは強制的に0にする
IF CFLAG:MASTER:11 == 0
	S = 0
	BASE:MASTER:2 = 0
ENDIF

;射精フラグはここで初期化

IF  S > EJAC * 2
	E = 2
ELSEIF S > EJAC
	E = 1
ELSE
	E = 0
ENDIF

@EX_CHECK_A
;調教者と対象が異なる場合（助手）
S = BASE:ASSI:99
EJAC = MAXBASE:ASSI:99

;射精限界が来ている場合は、射精ゲージは強制的に0にする
IF CFLAG:ASSI:11 == 0
	S = 0
	BASE:ASSI:2 = 0
ENDIF

IF  S > EJAC * 2
	E = 2
ELSEIF S > EJAC
	E = 1
ELSE
	E = 0
ENDIF

@EX_PLAYER,ARG,ARG:1
;ARGイった人
;ARG:1イかせた人

IF E == 2
	EXP:ARG:絶頂経験 += 2

	SIF TFLAG:998 & 1
	PRINTL Ｃ強絶頂(調教者)
	SIF TFLAG:998 & 2
	PRINTL Ｖ強絶頂(調教者)
	SIF TFLAG:998 & 4
	PRINTL Ａ強絶頂(調教者)
	SIF TFLAG:998 & 8
	PRINTL Ｂ強絶頂(調教者)
	SIF TALENT:ARG:149 && TFLAG:998 & 8
	PRINTL 大量噴乳(調教者)
	BASE:ARG:99 -= EJAC*2
	SIF BASE:ARG:99 >= EJAC
		BASE:ARG:99 = EJAC-1
	SIF TFLAG:998 & 1
		EX:ARG:0 += 2
	SIF TFLAG:998 & 2
		EX:ARG:1 += 2
	SIF TFLAG:998 & 4
		EX:ARG:2 += 2
	SIF TFLAG:998 & 8
		EX:ARG:3 += 2
	SIF TALENT:ARG:149 && TFLAG:998 & 8
		EXP:ARG:54 += 2
	
	
	IF CFLAG:ARG:ＭＡＧ非被吸収 == 0
		LOCAL = 2 * MAXBASE:(ARG:1):LV * 20 *  (5+MAX(ABL:(ARG:1):従順,ABL:(ARG:1):欲望,ABL:(ARG:1):技巧))/5
		CALL DRAIN_MAG,ARG,LOCAL,ARG:1
	ENDIF

;通常の射精
ELSEIF E == 1
	EXP:ARG:絶頂経験 += 1

	SIF TFLAG:998 & 1
	PRINTL Ｃ絶頂(調教者)
	SIF TFLAG:998 & 2
	PRINTL Ｖ絶頂(調教者)
	SIF TFLAG:998 & 4
	PRINTL Ａ絶頂(調教者)
	SIF TFLAG:998 & 8
	PRINTL Ｂ絶頂(調教者)
	SIF TALENT:ARG:149 && TFLAG:998 & 8
	PRINTL 噴乳(調教者)
	BASE:ARG:99 -= EJAC
	SIF BASE:ARG:99 >= EJAC
		BASE:ARG:99 = EJAC-1
	
	SIF TFLAG:998 & 1
		EX:ARG:0 += 1
	SIF TFLAG:998 & 2
		EX:ARG:1 += 1
	SIF TFLAG:998 & 4
		EX:ARG:2 += 1
	SIF TFLAG:998 & 8
		EX:ARG:3 += 1
	SIF TALENT:ARG:149 && TFLAG:998 & 8
		EXP:ARG:54 += 1
	IF CFLAG:ARG:ＭＡＧ非被吸収 == 0
		LOCAL = 2 * MAXBASE:(ARG:1):LV * 20 * (5+MAX(ABL:(ARG:1):従順,ABL:(ARG:1):欲望,ABL:(ARG:1):技巧))/5
		CALL DRAIN_MAG,ARG,LOCAL,ARG:1
	ENDIF
ENDIF

;射精後は再装填の時間を設ける
IF SELECTCOM == 124 || SELECTCOM == 125
	SIF E == 1
		CFLAG:MASTER:9 = 3
	SIF E == 2
		CFLAG:MASTER:9 = 5
	CFLAG:MASTER:11 -= 1
ELSE
	SIF E == 1
		CFLAG:PLAYER:9 = 3
	SIF E == 2
		CFLAG:PLAYER:9 = 5
	CFLAG:PLAYER:11 -= 1
ENDIF

;無限射精薬が有効なら再装填時間を0に
SIF CFLAG:MASTER:無限射精薬フラグ == 1
	CFLAG:MASTER:9 = 0
SIF CFLAG:PLAYER:無限射精薬フラグ == 1
	CFLAG:PLAYER:9 = 0

